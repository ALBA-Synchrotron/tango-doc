<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title></title>
<meta name="author" content="The TANGO Team" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">

<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>The TANGO Team</td></tr>
</tbody>
</table>
<!--  -->
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id148">Introduction</a><ul>
<li><a class="reference internal" href="#introduction-to-device-server" id="id149">Introduction to device server</a></li>
<li><a class="reference internal" href="#device-server-history" id="id150">Device server history</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-started" id="id151">Getting Started</a><ul>
<li><a class="reference internal" href="#a-c-tango-client" id="id152">A C++ TANGO client</a></li>
<li><a class="reference internal" href="#a-tango-device-server" id="id153">A TANGO device server</a><ul>
<li><a class="reference internal" href="#the-commands-and-attributes-code" id="id154">The commands and attributes code</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#the-tango-device-server-model" id="id155">The TANGO device server model</a><ul>
<li><a class="reference internal" href="#introduction-to-corba" id="id156">Introduction to CORBA</a></li>
<li><a class="reference internal" href="#the-model" id="id157">The model</a></li>
<li><a class="reference internal" href="#the-device" id="id158">The device</a><ul>
<li><a class="reference internal" href="#the-commands" id="id159">The commands</a></li>
<li><a class="reference internal" href="#the-tango-attributes" id="id160">The TANGO attributes</a></li>
<li><a class="reference internal" href="#the-tango-pipes" id="id161">The TANGO pipes</a></li>
<li><a class="reference internal" href="#command-attributes-or-pipes" id="id162">Command, attributes or pipes ?</a></li>
<li><a class="reference internal" href="#the-corba-attributes" id="id163">The CORBA attributes</a></li>
<li><a class="reference internal" href="#the-remaining-corba-operations" id="id164">The remaining CORBA operations</a></li>
<li><a class="reference internal" href="#the-special-case-of-the-device-state-and-status" id="id165">The special case of the device state and status</a></li>
<li><a class="reference internal" href="#the-device-polling" id="id166">The device polling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-server" id="id167">The server</a></li>
<li><a class="reference internal" href="#the-tango-logging-service" id="id168">The Tango Logging Service</a></li>
<li><a class="reference internal" href="#the-database" id="id169">The database</a></li>
<li><a class="reference internal" href="#the-controlled-access" id="id170">The controlled access</a></li>
<li><a class="reference internal" href="#the-application-programmers-interfaces" id="id171">The Application Programmers Interfaces</a><ul>
<li><a class="reference internal" href="#rules-of-the-api" id="id172">Rules of the API</a></li>
<li><a class="reference internal" href="#communication-between-client-and-server-using-the-api" id="id173">Communication between client and server using the API</a></li>
<li><a class="reference internal" href="#tango-events" id="id174">Tango events</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#writing-a-tango-client-using-tango-apis" id="id175">Writing a TANGO client using TANGO APIs</a><ul>
<li><a class="reference internal" href="#id7" id="id176">Introduction</a></li>
<li><a class="reference internal" href="#id8" id="id177">Getting Started</a></li>
<li><a class="reference internal" href="#basic-philosophy" id="id178">Basic Philosophy</a></li>
<li><a class="reference internal" href="#data-types" id="id179">Data types</a></li>
<li><a class="reference internal" href="#request-model" id="id180">Request model</a><ul>
<li><a class="reference internal" href="#synchronous-model" id="id181">Synchronous model</a></li>
<li><a class="reference internal" href="#asynchronous-model" id="id182">Asynchronous model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#events" id="id183">Events</a><ul>
<li><a class="reference internal" href="#id9" id="id184">Introduction</a></li>
<li><a class="reference internal" href="#event-definition" id="id185">Event definition</a></li>
<li><a class="reference internal" href="#event-types" id="id186">Event types</a></li>
<li><a class="reference internal" href="#event-filtering-removed-in-tango-release-8-and-above" id="id187">Event filtering (Removed in Tango release 8 and above)</a></li>
<li><a class="reference internal" href="#application-programmers-interface" id="id188">Application Programmer’s Interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#group" id="id189">Group</a><ul>
<li><a class="reference internal" href="#getting-started-with-tango-group" id="id190">Getting started with Tango group</a></li>
<li><a class="reference internal" href="#forward-or-not-forward" id="id191">Forward or not forward?</a></li>
<li><a class="reference internal" href="#executing-a-command" id="id192">Executing a command</a></li>
<li><a class="reference internal" href="#reading-attribute-s-sub-read-attr" id="id193">Reading attribute(s)[sub:Read-attr]</a></li>
<li><a class="reference internal" href="#writing-an-attribute" id="id194">Writing an attribute</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reading-writing-device-pipe" id="id195">Reading/Writing device pipe</a><ul>
<li><a class="reference internal" href="#reading-a-pipe" id="id196">Reading a pipe</a></li>
<li><a class="reference internal" href="#writing-a-pipe" id="id197">Writing a pipe</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-locking" id="id198">Device locking</a></li>
<li><a class="reference internal" href="#reconnection-and-exception" id="id199">Reconnection and exception</a></li>
<li><a class="reference internal" href="#thread-safety" id="id200">Thread safety</a></li>
<li><a class="reference internal" href="#compiling-and-linking-a-tango-client" id="id201">Compiling and linking a Tango client</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tangoatk-programmers-guide" id="id202">TangoATK Programmer’s Guide</a><ul>
<li><a class="reference internal" href="#id13" id="id203">Introduction</a><ul>
<li><a class="reference internal" href="#assumptions" id="id204">Assumptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-key-concepts-of-tangoatk" id="id205">The key concepts of TangoATK</a><ul>
<li><a class="reference internal" href="#minimize-development-time" id="id206">Minimize development time</a></li>
<li><a class="reference internal" href="#minimize-bugs-in-applications" id="id207">Minimize bugs in applications</a></li>
<li><a class="reference internal" href="#attributes-and-commands-from-different-devices" id="id208">Attributes and commands from different devices</a></li>
<li><a class="reference internal" href="#avoid-code-duplication" id="id209">Avoid code duplication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-real-getting-started" id="id210">The real getting started</a><ul>
<li><a class="reference internal" href="#single-device-applications" id="id211">Single device applications</a></li>
<li><a class="reference internal" href="#multi-device-applications" id="id212">Multi device applications</a></li>
<li><a class="reference internal" href="#more-on-displaying-attributes" id="id213">More on displaying attributes</a></li>
<li><a class="reference internal" href="#a-short-note-on-the-relationship-between-models-and-viewers" id="id214">A short note on the relationship between models and viewers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-key-objects-of-tangoatk" id="id215">The key objects of TangoATK</a><ul>
<li><a class="reference internal" href="#the-refreshers" id="id216">The Refreshers</a></li>
<li><a class="reference internal" href="#the-devicefactory" id="id217">The DeviceFactory</a></li>
<li><a class="reference internal" href="#the-attributefactory-and-the-commandfactory" id="id218">The AttributeFactory and the CommandFactory</a></li>
<li><a class="reference internal" href="#the-attributelist-and-the-commandlist" id="id219">The AttributeList and the CommandList</a></li>
<li><a class="reference internal" href="#the-attributes" id="id220">The Attributes</a></li>
<li><a class="reference internal" href="#id14" id="id221">The Commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#writing-a-tango-device-server" id="id222">Writing a TANGO device server</a><ul>
<li><a class="reference internal" href="#the-device-server-framework" id="id223">The device server framework</a><ul>
<li><a class="reference internal" href="#naming-convention-and-programming-language" id="id224">Naming convention and programming language</a></li>
<li><a class="reference internal" href="#the-device-pattern" id="id225">The device pattern</a></li>
<li><a class="reference internal" href="#startup-of-a-device-pattern" id="id226">Startup of a device pattern</a></li>
<li><a class="reference internal" href="#command-execution-sequence" id="id227">Command execution sequence</a></li>
<li><a class="reference internal" href="#the-automatically-added-commands" id="id228">The automatically added commands</a></li>
<li><a class="reference internal" href="#reading-writing-attributes" id="id229">Reading/Writing attributes</a></li>
<li><a class="reference internal" href="#id34" id="id230">The device server framework</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exchanging-data-between-client-and-server" id="id231">Exchanging data between client and server</a><ul>
<li><a class="reference internal" href="#command-attribute-data-types" id="id232">Command / Attribute data types</a></li>
<li><a class="reference internal" href="#passing-data-between-client-and-server" id="id233">Passing data between client and server</a></li>
<li><a class="reference internal" href="#c-memory-management" id="id234">C++ memory management</a></li>
<li><a class="reference internal" href="#reporting-errors" id="id235">Reporting errors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id37" id="id236">The Tango Logging Service</a><ul>
<li><a class="reference internal" href="#logging-targets" id="id237">Logging Targets</a></li>
<li><a class="reference internal" href="#logging-levels" id="id238">Logging Levels</a></li>
<li><a class="reference internal" href="#sending-tango-logging-messages" id="id239">Sending TANGO Logging Messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-a-device-server-process" id="id240">Writing a device server process</a><ul>
<li><a class="reference internal" href="#understanding-the-device" id="id241">Understanding the device</a></li>
<li><a class="reference internal" href="#defining-device-commands" id="id242">Defining device commands</a></li>
<li><a class="reference internal" href="#choosing-device-state" id="id243">Choosing device state</a></li>
<li><a class="reference internal" href="#device-server-utilities-to-ease-coding-debugging" id="id244">Device server utilities to ease coding/debugging</a></li>
<li><a class="reference internal" href="#avoiding-name-conflicts" id="id245">Avoiding name conflicts</a></li>
<li><a class="reference internal" href="#the-device-server-main-function" id="id246">The device server main function</a></li>
<li><a class="reference internal" href="#the-dserver-class-factory-method" id="id247">The DServer::class_factory method</a></li>
<li><a class="reference internal" href="#writing-the-steppermotorclass-class" id="id248">Writing the StepperMotorClass class</a></li>
<li><a class="reference internal" href="#the-devreadpositioncmd-class" id="id249">The DevReadPositionCmd class</a></li>
<li><a class="reference internal" href="#id42" id="id250">The PositionAttr class</a></li>
<li><a class="reference internal" href="#id52" id="id251">The StepperMotor class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-server-under-windows" id="id252">Device server under Windows</a><ul>
<li><a class="reference internal" href="#the-tango-device-server-graphical-interface" id="id253">The Tango device server graphical interface</a></li>
<li><a class="reference internal" href="#mfc-device-server" id="id254">MFC device server</a></li>
<li><a class="reference internal" href="#win32-application" id="id255">Win32 application</a></li>
<li><a class="reference internal" href="#device-server-as-service" id="id256">Device server as service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiling-linking-and-executing-a-tango-device-server-process" id="id257">Compiling, linking and executing a TANGO device server process</a><ul>
<li><a class="reference internal" href="#compiling-and-linking-a-c-device-server" id="id258">Compiling and linking a C++ device server</a></li>
<li><a class="reference internal" href="#running-a-c-device-server" id="id259">Running a C++ device server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-programming-techniques" id="id260">Advanced programming techniques</a><ul>
<li><a class="reference internal" href="#receiving-signal" id="id261">Receiving signal</a></li>
<li><a class="reference internal" href="#inheriting" id="id262">Inheriting</a></li>
<li><a class="reference internal" href="#using-another-device-pattern-implementation-within-the-same-server" id="id263">Using another device pattern implementation within the same server</a></li>
<li><a class="reference internal" href="#device-pipe" id="id264">Device pipe</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-features" id="id265">Advanced features</a><ul>
<li><a class="reference internal" href="#attribute-alarms" id="id266">Attribute alarms</a><ul>
<li><a class="reference internal" href="#the-level-alarms" id="id267">The level alarms</a></li>
<li><a class="reference internal" href="#the-read-different-than-set-rds-alarm" id="id268">The Read Different than Set (RDS) alarm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enumerated-attribute" id="id269">Enumerated attribute</a><ul>
<li><a class="reference internal" href="#usage-in-a-tango-class" id="id270">Usage in a Tango class</a></li>
<li><a class="reference internal" href="#usage-in-a-tango-client" id="id271">Usage in a Tango client</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-polling" id="id272">Device polling</a><ul>
<li><a class="reference internal" href="#id56" id="id273">Introduction</a></li>
<li><a class="reference internal" href="#configuring-the-polling-system" id="id274">Configuring the polling system</a></li>
<li><a class="reference internal" href="#reading-data-from-the-polling-buffer" id="id275">Reading data from the polling buffer</a></li>
<li><a class="reference internal" href="#retrieving-command-attribute-result-history" id="id276">Retrieving command/attribute result history</a></li>
<li><a class="reference internal" href="#externally-triggered-polling" id="id277">Externally triggered polling</a></li>
<li><a class="reference internal" href="#filling-polling-buffer" id="id278">Filling polling buffer</a></li>
<li><a class="reference internal" href="#setting-and-tuning-the-polling-in-a-tango-class" id="id279">Setting and tuning the polling in a Tango class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#threading" id="id280">Threading</a><ul>
<li><a class="reference internal" href="#device-server-process" id="id281">Device server process</a></li>
<li><a class="reference internal" href="#client-process" id="id282">Client process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-events-in-a-device-server" id="id283">Generating events in a device server</a></li>
<li><a class="reference internal" href="#using-multicast-protocol-to-transfer-events" id="id284">Using multicast protocol to transfer events</a><ul>
<li><a class="reference internal" href="#configuring-events-to-use-multicast-transport" id="id285">Configuring events to use multicast transport</a></li>
<li><a class="reference internal" href="#default-multicast-related-properties" id="id286">Default multicast related properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#memorized-attribute" id="id287">Memorized attribute</a></li>
<li><a class="reference internal" href="#forwarded-attribute" id="id288">Forwarded attribute</a><ul>
<li><a class="reference internal" href="#id57" id="id289">Definition</a></li>
<li><a class="reference internal" href="#coding" id="id290">Coding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transferring-images" id="id291">Transferring images</a></li>
<li><a class="reference internal" href="#device-server-with-user-defined-event-loop" id="id292">Device server with user defined event loop</a></li>
<li><a class="reference internal" href="#device-server-using-file-as-database" id="id293">Device server using file as database</a></li>
<li><a class="reference internal" href="#device-server-without-database" id="id294">Device server without database</a><ul>
<li><a class="reference internal" href="#example-of-device-server-started-without-database-usage" id="id295">Example of device server started without database usage</a></li>
<li><a class="reference internal" href="#connecting-client-to-device-within-a-device-server-started-without-database" id="id296">Connecting client to device within a device server started without database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiple-database-servers-within-a-tango-control-system" id="id297">Multiple database servers within a Tango control system</a></li>
<li><a class="reference internal" href="#the-tango-controlled-access-system" id="id298">The Tango controlled access system</a><ul>
<li><a class="reference internal" href="#user-rights-definition" id="id299">User rights definition</a></li>
<li><a class="reference internal" href="#running-a-tango-control-system-with-the-controlled-access" id="id300">Running a Tango control system with the controlled access</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#reference-part" id="id301">Reference part</a><ul>
<li><a class="reference internal" href="#device-parameter" id="id302">Device parameter</a><ul>
<li><a class="reference internal" href="#the-device-black-box" id="id303">The device black box</a></li>
<li><a class="reference internal" href="#the-device-description-field" id="id304">The device description field</a></li>
<li><a class="reference internal" href="#the-device-state-and-status" id="id305">The device state and status</a></li>
<li><a class="reference internal" href="#id58" id="id306">The device polling</a></li>
<li><a class="reference internal" href="#the-device-logging" id="id307">The device logging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-attribute" id="id308">Device attribute</a><ul>
<li><a class="reference internal" href="#hard-coded-device-attribute-parameters" id="id309">Hard-coded device attribute parameters</a></li>
<li><a class="reference internal" href="#modifiable-attribute-parameters" id="id310">Modifiable attribute parameters</a></li>
<li><a class="reference internal" href="#setting-modifiable-attribute-parameters" id="id311">Setting modifiable attribute parameters</a></li>
<li><a class="reference internal" href="#resetting-modifiable-attribute-parameters" id="id312">Resetting modifiable attribute parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id59" id="id313">Device pipe</a><ul>
<li><a class="reference internal" href="#hard-coded-device-pipe-parameters" id="id314">Hard-coded device pipe parameters</a></li>
<li><a class="reference internal" href="#modifiable-pipe-parameters" id="id315">Modifiable pipe parameters</a></li>
<li><a class="reference internal" href="#setting-modifiable-pipe-parameters" id="id316">Setting modifiable pipe parameters</a></li>
<li><a class="reference internal" href="#resetting-modifiable-pipe-parameters" id="id317">Resetting modifiable pipe parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-class-parameter" id="id318">Device class parameter</a></li>
<li><a class="reference internal" href="#id60" id="id319">The device black box</a></li>
<li><a class="reference internal" href="#automatically-added-commands" id="id320">Automatically added commands</a><ul>
<li><a class="reference internal" href="#the-state-command" id="id321">The State command</a></li>
<li><a class="reference internal" href="#the-status-command" id="id322">The Status command</a></li>
<li><a class="reference internal" href="#the-init-command" id="id323">The Init command</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dserver-class-device-commands" id="id324">DServer class device commands</a><ul>
<li><a class="reference internal" href="#id61" id="id325">The State command</a></li>
<li><a class="reference internal" href="#id62" id="id326">The Status command</a></li>
<li><a class="reference internal" href="#the-devrestart-command" id="id327">The DevRestart command</a></li>
<li><a class="reference internal" href="#the-restartserver-command" id="id328">The RestartServer command</a></li>
<li><a class="reference internal" href="#the-queryclass-command" id="id329">The QueryClass command</a></li>
<li><a class="reference internal" href="#the-querydevice-command" id="id330">The QueryDevice command</a></li>
<li><a class="reference internal" href="#the-kill-command" id="id331">The Kill command</a></li>
<li><a class="reference internal" href="#the-querywizardclassproperty-command" id="id332">The QueryWizardClassProperty command</a></li>
<li><a class="reference internal" href="#the-querywizarddevproperty-command" id="id333">The QueryWizardDevProperty command</a></li>
<li><a class="reference internal" href="#the-querysubdevice-command" id="id334">The QuerySubDevice command</a></li>
<li><a class="reference internal" href="#the-startpolling-command" id="id335">The StartPolling command</a></li>
<li><a class="reference internal" href="#the-stoppolling-command" id="id336">The StopPolling command</a></li>
<li><a class="reference internal" href="#the-addobjpolling-command" id="id337">The AddObjPolling command</a></li>
<li><a class="reference internal" href="#the-remobjpolling-command" id="id338">The RemObjPolling command</a></li>
<li><a class="reference internal" href="#the-updobjpollingperiod-command" id="id339">The UpdObjPollingPeriod command</a></li>
<li><a class="reference internal" href="#the-polleddevice-command" id="id340">The PolledDevice command</a></li>
<li><a class="reference internal" href="#the-devpollstatus-command" id="id341">The DevPollStatus command</a></li>
<li><a class="reference internal" href="#the-lockdevice-command" id="id342">The LockDevice command</a></li>
<li><a class="reference internal" href="#the-unlockdevice-command" id="id343">The UnLockDevice command</a></li>
<li><a class="reference internal" href="#the-relockdevices-command" id="id344">The ReLockDevices command</a></li>
<li><a class="reference internal" href="#the-devlockstatus-command" id="id345">The DevLockStatus command</a></li>
<li><a class="reference internal" href="#the-eventsubscriptionchange-command-c-server-only" id="id346">The EventSubscriptionChange command (C++ server only)</a></li>
<li><a class="reference internal" href="#the-zmqeventsubscriptionchange-command" id="id347">The ZmqEventSubscriptionChange command</a></li>
<li><a class="reference internal" href="#the-eventconfirmsubscription-command" id="id348">The EventConfirmSubscription command</a></li>
<li><a class="reference internal" href="#the-addloggingtarget-command" id="id349">The AddLoggingTarget command</a></li>
<li><a class="reference internal" href="#the-removeloggingtarget-command" id="id350">The RemoveLoggingTarget command</a></li>
<li><a class="reference internal" href="#the-getloggingtarget-command" id="id351">The GetLoggingTarget command</a></li>
<li><a class="reference internal" href="#the-getlogginglevel-command" id="id352">The GetLoggingLevel command</a></li>
<li><a class="reference internal" href="#the-setlogginglevel-command" id="id353">The SetLoggingLevel command</a></li>
<li><a class="reference internal" href="#the-stoplogging-command" id="id354">The StopLogging command</a></li>
<li><a class="reference internal" href="#the-startlogging-command" id="id355">The StartLogging command</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dserver-class-device-properties" id="id356">DServer class device properties</a></li>
<li><a class="reference internal" href="#tango-log-consumer" id="id357">Tango log consumer</a><ul>
<li><a class="reference internal" href="#the-available-log-consumer" id="id358">The available Log Consumer</a></li>
<li><a class="reference internal" href="#the-log-consumer-interface" id="id359">The Log Consumer interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#control-system-specific" id="id360">Control system specific</a><ul>
<li><a class="reference internal" href="#the-device-class-documentation-default-value" id="id361">The device class documentation default value</a></li>
<li><a class="reference internal" href="#the-services-definition" id="id362">The services definition</a></li>
<li><a class="reference internal" href="#tuning-the-event-system-buffers-hwm" id="id363">Tuning the event system buffers (HWM)</a></li>
<li><a class="reference internal" href="#allowing-nan-when-writing-attributes-floating-point" id="id364">Allowing NaN when writing attributes (floating point)</a></li>
<li><a class="reference internal" href="#tuning-multicasting-event-propagation" id="id365">Tuning multicasting event propagation</a></li>
<li><a class="reference internal" href="#summary-of-ctrlsystem-free-object-properties" id="id366">Summary of CtrlSystem free object properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#c-specific" id="id367">C++ specific</a><ul>
<li><a class="reference internal" href="#the-tango-master-include-file-tango-h" id="id368">The Tango master include file (tango.h)</a></li>
<li><a class="reference internal" href="#tango-specific-pre-processor-define" id="id369">Tango specific pre-processor define</a></li>
<li><a class="reference internal" href="#tango-specific-types" id="id370">Tango specific types</a></li>
<li><a class="reference internal" href="#tango-device-state-code" id="id371">Tango device state code</a></li>
<li><a class="reference internal" href="#tango-data-type" id="id372">Tango data type</a></li>
<li><a class="reference internal" href="#tango-command-display-level" id="id373">Tango command display level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-server-process-option-and-environment-variables" id="id374">Device server process option and environment variables</a><ul>
<li><a class="reference internal" href="#classical-device-server" id="id375">Classical device server</a></li>
<li><a class="reference internal" href="#device-server-process-as-windows-service" id="id376">Device server process as Windows service</a></li>
<li><a class="reference internal" href="#environment-variables" id="id377">Environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#the-tango-idl-file-module-tango" id="id378">The TANGO IDL file : Module Tango</a><ul>
<li><a class="reference internal" href="#aliases" id="id379">Aliases</a></li>
<li><a class="reference internal" href="#enums" id="id380">Enums</a></li>
<li><a class="reference internal" href="#structs" id="id381">Structs</a></li>
<li><a class="reference internal" href="#unions" id="id382">Unions</a></li>
<li><a class="reference internal" href="#exceptions" id="id383">Exceptions</a></li>
<li><a class="reference internal" href="#interface-tango-device" id="id384">Interface Tango::Device</a><ul>
<li><a class="reference internal" href="#attributes" id="id385">Attributes</a></li>
<li><a class="reference internal" href="#operations" id="id386">Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interface-tango-device-2" id="id387">Interface Tango::Device_2</a><ul>
<li><a class="reference internal" href="#id109" id="id388">Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interface-tango-device-3" id="id389">Interface Tango::Device_3</a><ul>
<li><a class="reference internal" href="#id114" id="id390">Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interface-tango-device-4" id="id391">Interface Tango::Device_4</a><ul>
<li><a class="reference internal" href="#id119" id="id392">Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interface-tango-device-5" id="id393">Interface Tango::Device_5</a><ul>
<li><a class="reference internal" href="#id124" id="id394">operations</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tango-object-naming-device-attribute-and-property" id="id395">Tango object naming (device, attribute and property)</a><ul>
<li><a class="reference internal" href="#device-name" id="id396">Device name</a></li>
<li><a class="reference internal" href="#full-object-name" id="id397">Full object name</a><ul>
<li><a class="reference internal" href="#some-examples" id="id398">Some examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#device-and-attribute-name-alias" id="id399">Device and attribute name alias</a></li>
<li><a class="reference internal" href="#reserved-words-and-characters-limitations" id="id400">Reserved words and characters, limitations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#starting-a-tango-control-system" id="id401">Starting a Tango control system</a><ul>
<li><a class="reference internal" href="#without-database" id="id402">Without database</a></li>
<li><a class="reference internal" href="#with-database" id="id403">With database</a></li>
<li><a class="reference internal" href="#with-database-and-event" id="id404">With database and event</a><ul>
<li><a class="reference internal" href="#for-tango-releases-lower-than-8" id="id405">For Tango releases lower than 8</a></li>
<li><a class="reference internal" href="#for-release-8-and-above" id="id406">For release 8 and above</a></li>
</ul>
</li>
<li><a class="reference internal" href="#with-file-used-as-database" id="id407">With file used as database</a></li>
<li><a class="reference internal" href="#with-file-used-as-database-and-event" id="id408">With file used as database and event</a><ul>
<li><a class="reference internal" href="#id133" id="id409">For Tango releases lower than 8</a></li>
<li><a class="reference internal" href="#id134" id="id410">For release 8 and above</a></li>
</ul>
</li>
<li><a class="reference internal" href="#with-the-controlled-access" id="id411">With the controlled access</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-notifd2db-utility" id="id412">The notifd2db utility</a><ul>
<li><a class="reference internal" href="#the-notifd2db-utility-usage-for-tango-releases-lower-than-8" id="id413">The notifd2db utility usage (For Tango releases lower than 8)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-property-file-syntax" id="id414">The property file syntax</a><ul>
<li><a class="reference internal" href="#property-file-usage" id="id415">Property file usage</a></li>
<li><a class="reference internal" href="#property-file-syntax" id="id416">Property file syntax</a></li>
</ul>
</li>
<li><a class="reference internal" href="#list-of-pictures" id="id417">List of pictures</a></li>
</ul>
</div>
<!--  -->
<p>[FirstPicture]|image|</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id148">Introduction</a></h1>
<div class="section" id="introduction-to-device-server">
<h2><a class="toc-backref" href="#id149">Introduction to device server</a></h2>
<p>Device servers were first developed at the European Synchrotron
radiation Facility (ESRF) for controlling the 6 Gev synchrotron
radiation source. This document is a Programmer’s Manual on how to write
TANGO device servers. It will not go into the details of the ESRF, nor
its Control System nor any of the specific device servers in the Control
System. The role of this document is to help programmers faced with the
task of writing TANGO device servers.</p>
<p>Device servers have been developed at the ESRF in order to solve the
main task of Control Systems viz provide read and write access to all
devices in a distributed system. The problem of distributed device
access is only part of the problem however. The other part of the
problem is providing a programming framework for a large number of
devices programmed by a large number of programmers each having
different levels of experience and style.</p>
<p>Device servers have been written at the ESRF for a large variety of
different devices. Devices vary from serial line devices to devices
interfaced by field-bus to memory mapped VME cards or PC cards to entire
data acquisition systems. The definition of a device depends very much
on the user’s requirements. In the simple case a device server can be
used to hide the serial line protocol required to communicate with a
device. For more complicated devices the device server can be used to
hide the entire complexity of the device timing, configuration and
acquisition cycle behind a set of high level commands.</p>
<p>In this manual the process of how to write TANGO client (applications)
and device servers will be treated. The manual has been organized as
follows :</p>
<ul class="simple">
<li>A getting started chapter.</li>
<li>The TANGO device server model is treated in chapter 3</li>
<li>Generalities on the Tango Application Programmer Interfaces are given
in chapter 4</li>
<li>Chapter 5 is an a programmer’s guide for the Tango Application
ToolKit (TangoATK). This is a Java toolkit to help Tango Java
application developers.</li>
<li>How to write a TANGO device server is explained in chapter 6</li>
<li>Chapter 7 describes advanced Tango features</li>
</ul>
<p>Throughout this manual examples of source code will be given in order to
illustrate what is meant. Most examples have been taken from the
StepperMotor class - a simulation of a stepper motor which illustrates
how a typical device server for a stepper motor at the ESRF functions.</p>
</div>
<div class="section" id="device-server-history">
<h2><a class="toc-backref" href="#id150">Device server history</a></h2>
<p>The concept of using device servers to access devices was first proposed
at the ESRF in 1989. It has been successfully used as the heart of the
ESRF Control System for the institute accelerator complex. This Control
System has been named TACO <a class="footnote-reference" href="#id135" id="id1">[1]</a>. Then, it has been decided to also used
TACO to control devices in the beam-lines. Today, more than 30 instances
of TACO are running at the ESRF. The main technologies used within TACO
are the leading technologies of the 80’s. The Sun Remote Procedure Call
(RPC) is used to communicate over the network between device server and
applications, OS-9 is used on the front-end computers, C is the
reference language to write device servers and clients and the device
server framework follows the MIT Widget model. In 1999, a renewal of the
control system was started. In June 2002, Soleil and ESRF offically
decide to collaborate to develop this renewal of the old TACO control
system. Soleil is a French synchrotron radiation facility currently
under construction in the Paris suburbs. See
 to get all information about
Soleil. In December 2003, Elettra joins the club. Elettra is an Italian
synchrotron radiation facility located in Trieste. See
 to get all information about
Elettra. Then, beginning of 2005, ALBA also decided to join. ALBA is a
Spanish synchrotron radiation facility located in Barcelona. See
 to get all information about ALBA. The new
version of the Alba/Elettra/ESRF/Soleil control system is named
TANGO <a class="footnote-reference" href="#id136" id="id2">[2]</a> and is based on the 21 century technologies :</p>
<ul class="simple">
<li>CORBA <a class="footnote-reference" href="#id137" id="id3">[3]</a> and ZMQ:raw-latex:<cite>cite{ZMQ}</cite> to communicate between
device server and clients</li>
<li>C++, Python and Java as reference programming languages</li>
<li>Linux and Windows as operating systems</li>
<li>Modern object oriented design patterns</li>
</ul>
</div>
</div>
<div class="section" id="getting-started">
<h1><a class="toc-backref" href="#id151">Getting Started</a></h1>
<div class="section" id="a-c-tango-client">
<h2><a class="toc-backref" href="#id152">A C++ TANGO client</a></h2>
<p>The quickest way of getting started is by studying this example :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment multiline">/*
</span><span class="ln"> 2 </span><span class="comment multiline">   * example of a client using the TANGO C++ api.
</span><span class="ln"> 3 </span><span class="comment multiline">   */</span>
<span class="ln"> 4 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 5 </span><span class="comment preproc"></span>  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="name">Tango</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>  <span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">unsigned</span> <span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span> <span class="keyword type">char</span> <span class="operator">**</span><span class="name">argv</span><span class="punctuation">)</span>
<span class="ln"> 7 </span>  <span class="punctuation">{</span>
<span class="ln"> 8 </span>      <span class="name">try</span>
<span class="ln"> 9 </span>      <span class="punctuation">{</span>
<span class="ln">10 </span>
<span class="ln">11 </span>  <span class="comment single">//
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="comment single">// create a connection to a TANGO device
</span><span class="ln">13 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">14 </span><span class="comment single"></span>
<span class="ln">15 </span>          <span class="name">DeviceProxy</span> <span class="operator">*</span><span class="name">device</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">DeviceProxy</span><span class="punctuation">(</span><span class="literal string">&quot;sys/database/2&quot;</span><span class="punctuation">);</span>
<span class="ln">16 </span>
<span class="ln">17 </span>  <span class="comment single">//
</span><span class="ln">18 </span><span class="comment single"></span>  <span class="comment single">// Ping the device
</span><span class="ln">19 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">20 </span><span class="comment single"></span>
<span class="ln">21 </span>          <span class="name">device</span><span class="operator">-&gt;</span><span class="name">ping</span><span class="punctuation">();</span>
<span class="ln">22 </span>
<span class="ln">23 </span>  <span class="comment single">//
</span><span class="ln">24 </span><span class="comment single"></span>  <span class="comment single">// Execute a command on the device and extract the reply as a string
</span><span class="ln">25 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">26 </span><span class="comment single"></span>
<span class="ln">27 </span>          <span class="name">string</span> <span class="name">db_info</span><span class="punctuation">;</span>
<span class="ln">28 </span>          <span class="name">DeviceData</span> <span class="name">cmd_reply</span><span class="punctuation">;</span>
<span class="ln">29 </span>          <span class="name">cmd_reply</span> <span class="operator">=</span> <span class="name">device</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;DbInfo&quot;</span><span class="punctuation">);</span>
<span class="ln">30 </span>          <span class="name">cmd_reply</span> <span class="operator">&gt;&gt;</span> <span class="name">db_info</span><span class="punctuation">;</span>
<span class="ln">31 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Command reply &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">db_info</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">32 </span>
<span class="ln">33 </span>  <span class="comment single">//
</span><span class="ln">34 </span><span class="comment single"></span>  <span class="comment single">// Read a device attribute (string data type)
</span><span class="ln">35 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">36 </span><span class="comment single"></span>
<span class="ln">37 </span>          <span class="name">string</span> <span class="name">spr</span><span class="punctuation">;</span>
<span class="ln">38 </span>          <span class="name">DeviceAttribute</span> <span class="name">att_reply</span><span class="punctuation">;</span>
<span class="ln">39 </span>          <span class="name">att_reply</span> <span class="operator">=</span> <span class="name">device</span><span class="operator">-&gt;</span><span class="name">read_attribute</span><span class="punctuation">(</span><span class="literal string">&quot;StoredProcedureRelease&quot;</span><span class="punctuation">);</span>
<span class="ln">40 </span>          <span class="name">att_reply</span> <span class="operator">&gt;&gt;</span> <span class="name">spr</span><span class="punctuation">;</span>
<span class="ln">41 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Database device stored procedure release: &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">spr</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">42 </span>      <span class="punctuation">}</span>
<span class="ln">43 </span>      <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">DevFailed</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">44 </span>      <span class="punctuation">{</span>
<span class="ln">45 </span>          <span class="name">Except</span><span class="operator">::</span><span class="name">print_exception</span><span class="punctuation">(</span><span class="name">e</span><span class="punctuation">);</span>
<span class="ln">46 </span>          <span class="name">exit</span><span class="punctuation">(</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">);</span>
<span class="ln">47 </span>      <span class="punctuation">}</span>
<span class="ln">48 </span>  <span class="punctuation">}</span>
</pre>
<p>Modify this example to fit your device server or client’s needs, compile
it and link with the library -ltango. Forget about those painful early
TANGO days when you had to learn CORBA and manipulate Any’s. Life’s
going to easy and fun from now on !</p>
</div>
<div class="section" id="a-tango-device-server">
<h2><a class="toc-backref" href="#id153">A TANGO device server</a></h2>
<p>The code given in this chapter as example has been generated using POGO.
Pogo is a code generator for Tango device server. See
 for more information about POGO. The
following examples briefly describe how to write device class with
commands which receives and return different kind of Tango data types
and also how to write device attributes The device class implements 5
commands and 3 attributes. The commands are :</p>
<ul class="simple">
<li>The command <strong>DevSimple</strong> deals with simple Tango data type</li>
<li>The command <strong>DevString</strong> deals with Tango strings</li>
<li><strong>DevArray</strong> receive and return an array of simple Tango data type</li>
<li><strong>DevStrArray</strong> which does not receive any data but which returns an
array of strings</li>
<li><strong>DevStruct</strong> which also does not receive data but which returns one
of the two Tango composed types (DevVarDoubleStringArray)</li>
</ul>
<p>For all these commands, the default behavior of the state machine
(command always allowed) is acceptable. The attributes are :</p>
<ul class="simple">
<li>A spectrum type attribute of the Tango string type called <strong>StrAttr</strong></li>
<li>A readable attribute of the Tango::DevLong type called
<strong>LongRdAttr</strong>. This attribute is linked with the following writable
attribute</li>
<li>A writable attribute also of the Tango::DevLong type called
<strong>LongWrAttr</strong>.</li>
</ul>
<p>Since release 9, a Tango device also supports pipe. This is an advanced
feature reserved for some specific cases. Therefore, there is no device
pipe example in this Getting started chapter.</p>
<div class="section" id="the-commands-and-attributes-code">
<h3><a class="toc-backref" href="#id154">The commands and attributes code</a></h3>
<p>For each command called DevXxxx, pogo generates in the device class a
method named dev_xxx which will be executed when the command is
requested by a client. In this chapter, the name of the device class is
<em>DocDs</em></p>
<div class="section" id="the-devsimple-command">
<h4>The DevSimple command</h4>
<p>This method receives a Tango::DevFloat type and also returns a data of
the Tango::DevFloat type which is simply the double of the input value.
The code for the method executed by this command is the following:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevFloat</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_simple</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevFloat</span> <span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevFloat</span> <span class="name">argout</span> <span class="punctuation">;</span>
<span class="ln"> 4 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_simple(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln"> 7 </span><span class="comment single"></span>
<span class="ln"> 8 </span>          <span class="name">argout</span> <span class="operator">=</span> <span class="name">argin</span> <span class="operator">*</span> <span class="literal number integer">2</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">10 </span>  <span class="punctuation">}</span>
</pre>
<p>This method is fairly simple. The received data is passed to the method
as its argument. It is</p>
<p>doubled at line 8 and the method simply returns the result.</p>
</div>
<div class="section" id="the-devarray-command">
<h4>The DevArray command</h4>
<p>This method receives a data of the Tango::DevVarLongArray type and also
returns a data of the Tango::DevVarLongArray type. Each element of the
array is doubled. The code for the method executed by the command is the
following :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="operator">*</span><span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_array</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="operator">*</span><span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span>  <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span><span class="punctuation">();</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_array(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">11 </span>
<span class="ln">12 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>          <span class="keyword type">long</span> <span class="name">argin_length</span> <span class="operator">=</span> <span class="name">argin</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">();</span>
<span class="ln">15 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="name">argin_length</span><span class="punctuation">);</span>
<span class="ln">16 </span>          <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">argin_length</span><span class="punctuation">;</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">17 </span>                  <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="operator">*</span><span class="name">argin</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">*</span> <span class="literal number integer">2</span><span class="punctuation">;</span>
<span class="ln">18 </span>
<span class="ln">19 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">20 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout data array is created at line 8. Its length is set at line 15
from the input argument length. The array is populated at line 16,17 and
returned. This method allocates memory for the argout array. This memory
is freed by the Tango core classes after the data have been sent to the
caller (no delete is needed). It is also possible to return data from a
statically allocated array without copying. Look at chapter [Data
exchange] for all the details.</p>
</div>
<div class="section" id="the-devstring-command">
<h4>The DevString command</h4>
<p>This method receives a data of the Tango::DevString type and also
returns a data of the Tango::DevString type. The command simply displays
the content of the input string and returns a hard-coded string. The
code for the method executed by the command is the following :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_string</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span>        <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_string(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">10 </span>
<span class="ln">11 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">12 </span><span class="comment single"></span>
<span class="ln">13 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;the received string is &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">argin</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">14 </span>
<span class="ln">15 </span>          <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Am I a good Tango dancer ?&quot;</span><span class="punctuation">);</span>
<span class="ln">16 </span>          <span class="name">argout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword type">char</span><span class="punctuation">[</span><span class="name">str</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">()</span> <span class="operator">+</span> <span class="literal number integer">1</span><span class="punctuation">];</span>
<span class="ln">17 </span>          <span class="name">strcpy</span><span class="punctuation">(</span><span class="name">argout</span><span class="punctuation">,</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">18 </span>
<span class="ln">19 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">20 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout string is created at line 8. Internally, this method is using
a standard C++ string. Memory for the returned data is allocated at line
16 and is initialized at line 17. This method allocates memory for the
argout string. This memory is freed by the Tango core classes after the
data have been sent to the caller (no delete is needed). It is also
possible to return data from a statically allocated string without
copying. Look at chapter [Data exchange] for all the details.</p>
</div>
<div class="section" id="the-devstrarray-command">
<h4>The DevStrArray command</h4>
<p>This method does not receive input data but returns an array of strings
(Tango::DevVarStringArray type). The code for the method executed by
this command is the following:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="operator">*</span><span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_str_array</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span>        <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span><span class="punctuation">();</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_str_array(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">11 </span>
<span class="ln">12 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln">15 </span>          <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Rumba&quot;</span><span class="punctuation">);</span>
<span class="ln">16 </span>          <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Waltz&quot;</span><span class="punctuation">);</span>
<span class="ln">17 </span>          <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Jerck&quot;</span><span class="punctuation">);</span>
<span class="ln">18 </span>          <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">19 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">20 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout data array is created at line 8. Its length is set at line
14. The array is populated at line 15,16 and 18. The last array element
is initialized from a standard C++ string created at line 17. Note the
usage of the <em>string_dup</em> function of the CORBA namespace. This is
necessary for strings array due to the CORBA memory allocation schema.</p>
</div>
<div class="section" id="the-devstruct-command">
<h4>The DevStruct command</h4>
<p>This method does not receive input data but returns a structure of the
Tango::DevVarDoubleStringArray type. This type is a composed type with
an array of double and an array of strings. The code for the method
executed by this command is the following:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarDoubleStringArray</span> <span class="operator">*</span><span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_struct</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarDoubleStringArray</span>  <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarDoubleStringArray</span><span class="punctuation">();</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_struct(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">11 </span>
<span class="ln">12 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln">15 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span><span class="punctuation">;</span>
<span class="ln">16 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">11.11</span><span class="punctuation">;</span>
<span class="ln">17 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">22.22</span><span class="punctuation">;</span>
<span class="ln">18 </span>
<span class="ln">19 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">svalue</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln">20 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">svalue</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Be Bop&quot;</span><span class="punctuation">);</span>
<span class="ln">21 </span>          <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Smurf&quot;</span><span class="punctuation">);</span>
<span class="ln">22 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">svalue</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">23 </span>
<span class="ln">24 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">25 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout data structure is created at line 8. The length of the double
array in the output structure is set at line 14. The array is populated
between lines 15 and 17. The length of the string array in the output
structure is set at line 19. This string array is populated between
lines 20 an 22 from a hard-coded string and from a standard C++ string.
This method allocates memory for the argout data. This memory is freed
by the Tango core classes after the data have been sent to the caller
(no delete is needed). Note the usage of the <em>string_dup</em> function of
the CORBA namespace. This is necessary for strings array due to the
CORBA memory allocation schema.</p>
</div>
<div class="section" id="the-three-attributes">
<h4>The three attributes</h4>
<p>Some data have been added to the definition of the device class in order
to store attributes value. These data are (part of the class definition)
:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword">protected</span> <span class="operator">:</span>
<span class="ln">2 </span>          <span class="comment single">//      Add your own data members here
</span><span class="ln">3 </span><span class="comment single"></span>          <span class="comment single">//-----------------------------------------
</span><span class="ln">4 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span>        <span class="name">attr_str_array</span><span class="punctuation">[</span><span class="literal number integer">5</span><span class="punctuation">];</span>
<span class="ln">5 </span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span>          <span class="name">attr_rd</span><span class="punctuation">;</span>
<span class="ln">6 </span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span>          <span class="name">attr_wr</span><span class="punctuation">;</span>
</pre>
<p>One data has been created for each attribute. As the StrAttr attribute
is of type spectrum with a maximum X dimension of 5, an array of length
5 has been reserved.</p>
<p>Several methods are necessary to implement these attributes. One method
to read the hardware which is common to all readable attributes plus one
read method for each readable attribute and one write method for each
writable attribute. The code for these methods is the following :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">)</span>
<span class="ln"> 2 </span> <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_attr_hardware(vector&lt;long&gt; &amp;attr_list) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 4 </span> <span class="comment single">// Add your own code here
</span><span class="ln"> 5 </span><span class="comment single"></span>
<span class="ln"> 6 </span>     <span class="name">string</span> <span class="name">att_name</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">long</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">attr_list</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>     <span class="punctuation">{</span>
<span class="ln"> 9 </span>         <span class="name">att_name</span> <span class="operator">=</span> <span class="name">dev_attr</span><span class="operator">-&gt;</span><span class="name">get_attr_by_ind</span><span class="punctuation">(</span><span class="name">attr_list</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]).</span><span class="name">get_name</span><span class="punctuation">();</span>
<span class="ln">10 </span>
<span class="ln">11 </span>        <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">att_name</span> <span class="operator">==</span> <span class="literal string">&quot;LongRdAttr&quot;</span><span class="punctuation">)</span>
<span class="ln">12 </span>        <span class="punctuation">{</span>
<span class="ln">13 </span>            <span class="name">attr_rd</span> <span class="operator">=</span> <span class="literal number integer">5</span><span class="punctuation">;</span>
<span class="ln">14 </span>        <span class="punctuation">}</span>
<span class="ln">15 </span>    <span class="punctuation">}</span>
<span class="ln">16 </span> <span class="punctuation">}</span>
<span class="ln">17 </span>
<span class="ln">18 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_LongRdAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">19 </span> <span class="punctuation">{</span>
<span class="ln">20 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_LongRdAttr(Tango::Attribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">21 </span>
<span class="ln">22 </span>     <span class="name">attr</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">attr_rd</span><span class="punctuation">);</span>
<span class="ln">23 </span> <span class="punctuation">}</span>
<span class="ln">24 </span>
<span class="ln">25 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_LongWrAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">26 </span> <span class="punctuation">{</span>
<span class="ln">27 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_LongWrAttr(Tango::Attribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">28 </span>
<span class="ln">29 </span>     <span class="name">attr</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">attr_wr</span><span class="punctuation">);</span>
<span class="ln">30 </span> <span class="punctuation">}</span>
<span class="ln">31 </span>
<span class="ln">32 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">write_LongWrAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">WAttribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">33 </span> <span class="punctuation">{</span>
<span class="ln">34 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::write_LongWrAttr(Tango::WAttribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">35 </span>
<span class="ln">36 </span>     <span class="name">attr</span><span class="punctuation">.</span><span class="name">get_write_value</span><span class="punctuation">(</span><span class="name">attr_wr</span><span class="punctuation">);</span>
<span class="ln">37 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Value to be written = &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">attr_wr</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">38 </span> <span class="punctuation">}</span>
<span class="ln">39 </span>
<span class="ln">40 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_StrAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">41 </span> <span class="punctuation">{</span>
<span class="ln">42 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_StrAttr(Tango::Attribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">43 </span>
<span class="ln">44 </span>     <span class="name">attr_str_array</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="keyword">const_cast</span><span class="operator">&lt;</span><span class="keyword type">char</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="literal string">&quot;Rock&quot;</span><span class="punctuation">);</span>
<span class="ln">45 </span>     <span class="name">attr_str_array</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="keyword">const_cast</span><span class="operator">&lt;</span><span class="keyword type">char</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="literal string">&quot;Samba&quot;</span><span class="punctuation">);</span>
<span class="ln">46 </span>
<span class="ln">47 </span>     <span class="name">attr_set_value</span><span class="punctuation">(</span><span class="name">attr_str_array</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln">48 </span> <span class="punctuation">}</span>
</pre>
<p>The <em>read_attr_hardware()</em> method is executed once when a client
execute the read_attributes CORBA request whatever the number of
attribute to be read is. The rule of this method is to read the hardware
and to store the read values somewhere in the device object. In our
example, only the LongRdAttr attribute internal value is set by this
method at line 13. The method <em>read_LongRdAttr()</em> is executed by the
read_attributes CORBA call when the LongRdAttr attribute is read but
after the read_attr_hardware() method has been executed. Its rule is
to set the attribute value in the TANGO core classes object representing
the attribute. This is done at line 22. The method <em>read_LongWrAttr()</em>
will be executed when the LongWrAttr attribute is read (after the
<em>read_attr_hardware()</em> method). The attribute value is set at line 29.
In the same manner, the method called <em>read_StrAttr()</em> will be executed
when the attribute StrAttr is read. Its value is initialized in this
method at line 44 and 45 with the <em>string_dup</em> Tango function. There
are several ways to code spectrum or image attribute of the DevString
data type. A HowTo related to this topic is available on the Tango
control system Web site. The <em>write_LongWrAttr()</em> method is executed
when the LongWrAttr attribute value is set by a client. The new
attribute value coming from the client is stored in the object data at
line 36.</p>
<p>Pogo also generates a file called DocDsStateMachine.cpp (for a Tango
device server class called DocDs). This file is used to store methods
coding the device state machine. By default a allways allowed state
machine is provided. For more information about coding the state
machine, refer to the chapter Writing a device server.</p>
<p>[APicture]|image|</p>
</div>
</div>
</div>
</div>
<div class="section" id="the-tango-device-server-model">
<h1><a class="toc-backref" href="#id155">The TANGO device server model</a></h1>
<p>This chapter will present the TANGO device server object model hereafter
referred as TDSOM. First, it will introduce CORBA. Then, it will
describe each of the basic features of the TDSOM and their function. The
TDSOM can be divided into the following basic elements - the <em>device</em>,
the <em>server</em>, the <em>database</em> and the <em>application programmers
interface</em>. This chapter will treat each of the above elements
separately.</p>
<div class="section" id="introduction-to-corba">
<h2><a class="toc-backref" href="#id156">Introduction to CORBA</a></h2>
<p>CORBA is a definition of how to write object request brokers (ORB). The
definition is managed by the Object Management Group (OMG
). Various commercial and non-commercial
implementations exist for CORBA for all the mainstream operating
systems. CORBA uses a programming language independent definition
language (called IDL) to defined network object interfaces. Language
mappings are defined from IDL to the main programming languages e.g.
C++, Java, C, COBOL, Smalltalk and ADA. Within an interface, CORBA
defines two kinds of actions available to the outside world. These
actions are called <strong>attributes</strong> and <strong>operations</strong>.</p>
<p>Operations are all the actions offered by an interface. For instance,
within an interface for a Thermostat class, operations could be the
action to read the temperature or to set the nominal temperature. An
attribute defines a pair of operations a client can call to send or
receive a value. For instance, the position of a motor can be defined as
an attribute because it is a data that you only set or get. A read only
attribute defines a single operation the client can call to receives a
value. In case of error, an operation is able to throw an exception to
the client, attributes cannot raises exception except system exception
(du to network fault for instance).</p>
<p>Intuitively, IDL interface correspond to C++ classes and IDL operations
correspond to C++ member functions and attributes as a way to read/write
public member variable. Nevertheless, IDL defines only the interface to
an object and say nothing about the object implementation. IDL is only a
descriptive language. Once the interface is fully described in the IDL
language, a compiler (from IDL to C++, from IDL to Java...) generates
code to implement this interface. Obviously, you still have to write how
operations are implemented.</p>
<p>The act of invoking an operation on an interface causes the ORB to send
a message to the corresponding object implementation. If the target
object is in another address space, the ORB run time sends a remote
procedure call to the implementation. If the target object is in the
same address space as the caller, the invocation is accomplished as an
ordinary function call to avoid the overhead of using a networking
protocol.</p>
<p>For an excellent reference on CORBA with C++ refer to
. The complete TANGO IDL file can be found in
the TANGO web page:raw-latex:<cite>cite{Tango web}</cite> or at the end of this
document in the appendix 2 chapter.</p>
</div>
<div class="section" id="the-model">
<h2><a class="toc-backref" href="#id157">The model</a></h2>
<p>The basic idea of the TDSOM is to treat each device as an <strong>object</strong>.
Each device is a separate entity which has its own data and behavior.
Each device has a unique name which identifies it in network name space.
Devices are organized according to <strong>classes</strong>, each device belonging to
a class. All classes are derived from one root class thus allowing some
common behavior for all devices. Four kind of requests can be sent to a
device (locally i.e. in the same process, or remotely i.e. across the
network) :</p>
<ul class="simple">
<li>Execute actions via <strong>commands</strong></li>
<li>Read/Set data specific to each device belonging to a class via TANGO
<strong>attributes</strong></li>
<li>Read/Set data specific to each device belonging to a class via TANGO
<strong>pipes</strong></li>
<li>Read some basic device data available for all devices via CORBA
attributes.</li>
<li>Execute a predefined set of actions available for every devices via
CORBA operations</li>
</ul>
<p>Each device is stored in a process called a <strong>device server</strong>. Devices
are configured at runtime via <strong>properties</strong> which are stored in a
<strong>database</strong>.</p>
</div>
<div class="section" id="the-device">
<h2><a class="toc-backref" href="#id158">The device</a></h2>
<p>The device is the heart of the TDSOM. A device is an abstract concept
defined by the TDSOM. In reality, it can be a piece of hardware (an
interlock bit) a collection of hardware (a screen attached to a stepper
motor) a logical device (a taper) or a combination of all these (an
accelerator). Each device has a unique name in the control system and
eventually one alias. Within Tango, a four field name space has been
adopted consisting of</p>
<p>[//FACILITY/]DOMAIN/CLASS/MEMBER</p>
<p>Facility refers to the control system instance, domain refers to the
sub-system, class the class and member the instance of the device.
Device name alias(es) must also be unique within a control system. There
is no predefined syntax for device name alias.</p>
<p>Each device belongs to a class. The device class contains a complete
description and implementation of the behavior of all members of that
class. New device classes can be constructed out of existing device
classes. This way a new hierarchy of classes can be built up in a short
time. Device classes can use existing devices as sub-classes or as
sub-objects. The practice of reusing existing classes is classical for
Object Oriented Programming and is one of its main advantages.</p>
<p>All device classes are derived from the same class (the device root
class) and implement <strong>the same CORBA interface</strong>. All devices
implementing the same CORBA interface ensures all control object support
the same set of CORBA operations and attributes. The device root class
contains part of the common device code. By inheriting from this class,
all devices shared a common behavior. This also makes maintenance and
improvements to the TDSOM easy to carry out.</p>
<p>All devices also support a <strong>black box</strong> where client requests for
attributes or operations are recorded. This feature allows easier
debugging session for device already installed in a running control
system.</p>
<div class="section" id="the-commands">
<h3><a class="toc-backref" href="#id159">The commands</a></h3>
<p>Each device class implements a list of commands. Commands are very
important because they are the client’s major dials and knobs for
controlling a device. Commands have a fixed calling syntax - consisting
of one input argument and one output argument. Arguments type must be
chosen in a fixed set of data types: All simple types (boolean, short,
long (32 bits), long (64 bits), float, double, unsigned short, unsigned
long (32 bits), unsigned long (64 bits) and string) and arrays of simple
types plus array of strings and longs and array of strings and doubles).
Commands can execute any sequence of actions. Commands can be executed
synchronously (the requester is blocked until the command ended) or
asynchronously (the requester send the request and is called back when
the command ended).</p>
<p>Commands are executed using two CORBA operations named
<strong>command_inout</strong> for synchronous commands and
<strong>command_inout_async</strong> for asynchronous commands. These two
operations called a special method implemented in the device root class
- the <em>command_handler</em> method. The <em>command_handler</em> calls an
<em>is_allowed</em> method implemented in the device class before calling the
command itself. The <em>is_allowed</em> method is specific to each
command <a class="footnote-reference" href="#id138" id="id4">[4]</a>. It checks to see whether the command to be executed is
compatible with the present device state. The command function is
executed only if the <em>is_allowed</em> method allows it. Otherwise, an
exception is sent to the client.</p>
</div>
<div class="section" id="the-tango-attributes">
<h3><a class="toc-backref" href="#id160">The TANGO attributes</a></h3>
<p>In addition to commands, TANGO devices also support normalized data
types called attributes <a class="footnote-reference" href="#id139" id="id5">[5]</a>. Commands are device specific and the data
they transport are not normalized i.e. they can be any one of the TANGO
data types with no restriction on what each byte means. This means that
it is difficult to interpret the output of a command in terms of what
kind of value(s) it represents. Generic display programs need to know
what the data returned represents, in what units it is, plus additional
information like minimum, maximum, quality etc. Tango attributes solve
this problem.</p>
<p>TANGO attributes are zero, one or two dimensional data which have a fix
set of properties e.g. quality, minimum and maximum, alarm low and high.
They are transferred in a specialized TANGO type and can be read, write
or read-write. A device can support a list of attributes. Clients can
read one or more attributes from one or more devices. To read TANGO
attributes, the client uses the <strong>read_attributes</strong> operation. To write
TANGO attributes, a client uses the <strong>write_attributes</strong> operation. To
write then read TANGO attributes within the same network request, the
client uses the <strong>write_read_attributes</strong> operation. To query a device
for all the attributes it supports, a client uses the
<strong>get_attribute_config</strong> operation. A client is also able to modify
some of parameters defining an attribute with the
<strong>set_attribute_config</strong> operation. These five operations are defined
in the device CORBA interface.</p>
<p>TANGO support thirteen data types for attributes (and arrays of for one
or two dimensional data) which are: boolean, short, long (32 bits), long
(64 bits), float, double, unsigned char, unsigned short, unsigned long
(32 bits), unsigned long (64 bits), string, a specific data type for
Tango device state and finally another specific data type to transfer
data as an array of unsigned char with a string describing the coding of
these data.</p>
</div>
<div class="section" id="the-tango-pipes">
<h3><a class="toc-backref" href="#id161">The TANGO pipes</a></h3>
<p>Since release 9, in addition to commands and attributes, TANGO devices
also support pipes.</p>
<p>In some cases, it is required to exchange data between client and device
of varrying data type. This is for instance the case of data gathered
during a scan on one experiment. Because the number of actuators and
sensors involved in the scan may change from one scan to another, it is
not possible to use a well defined data type. TANGO pipes have been
designed for such cases. A TANGO pipe is basically a pipe dedicated to
transfer data between client and device. A pipe has a set of two
properties which are the pipe label and its description. A pipe can be
read or read-write. A device can support a list of pipes. Clients can
read one or more pipes from one or more devices. To read a TANGO pipe,
the client uses the <strong>read_pipe</strong> operation. To write a TANGO pipe, a
client uses the <strong>write_pipe</strong> operation. To write then read a TANGO
pipe within the same network request, the client uses the
<strong>write_read_pipe</strong> operation. To query a device for all the pipes it
supports, a client uses the <strong>get_pipe_config</strong> operation. A client is
also able to modify some of parameters defining a pipe with the
<strong>set_pipe_config</strong> operation. These five operations are defined in
the device CORBA interface.</p>
<p>In contrary of commands or attributes, a TANGO pipe does not have a
pre-defined data type. Data transferred through pipes may be of any
basic Tango data type (or array of) and this may change every time a
pipe is read or written.</p>
</div>
<div class="section" id="command-attributes-or-pipes">
<h3><a class="toc-backref" href="#id162">Command, attributes or pipes ?</a></h3>
<p>There are no strict rules concerning what should be returned as command
result and what should be implemented as an attribute or as a pipe.
Nevertheless, attributes are more adapted to return physical value which
have a kind of time consistency. Attribute also have more properties
which help the client to precisely know what it represents. For
instance, the state and the status of a power supply are not physical
values and are returned as command result. The current generated by the
power supply is a physical value and is implemented as an attribute. The
attribute properties allow a client to know its unit, its label and some
other informations which are related to a physical value. Command are
well adapted to send order to a device like switching from one mode of
operation to another mode of operation. For a power supply, the switch
from a STANDBY mode to a ON mode is typically done via a command.
Finally pipe is well adapted when the kind and number of data exchanged
between the client and the device change with time.</p>
</div>
<div class="section" id="the-corba-attributes">
<h3><a class="toc-backref" href="#id163">The CORBA attributes</a></h3>
<p>Some key data implemented for each device can be read without the need
to call a command or read an attribute. These data are :</p>
<ul class="simple">
<li>The device state</li>
<li>The device status</li>
<li>The device name</li>
<li>The administration device name called adm_name</li>
<li>The device description</li>
</ul>
<p>The device state is a number representing its state. A set of predefined
states are defined in the TDSOM. The device status is a string
describing in plain text the device state and any additional useful
information of the device as a formatted ascii string. The device name
is its name as defined in [sec:dev]. For each set of devices grouped
within the same server, an administration device is automatically added.
This adm_name is the name of the administration device. The device
description is also an ascii string describing the device rule.</p>
<p>These five CORBA attributes are implemented in the device root class and
therefore do not need any coding from the device class programmer. As
explained in [sec:corba], the CORBA attributes are not allowed to raise
exceptions whereas command (which are implemented using CORBA
operations) can.</p>
</div>
<div class="section" id="the-remaining-corba-operations">
<h3><a class="toc-backref" href="#id164">The remaining CORBA operations</a></h3>
<p>The TDSOM also supports a list of actions defined as CORBA operations in
the device interface and implemented in the device root class.
Therefore, these actions are implemented automatically for every TANGO
device. These operations are :</p>
<p>MMMMMMMMMMM</p>
<p>to ping a device to check if the device is alive. Obviously, it checks
only the connection from a client to the device and not all the device
functionalities</p>
<p>request a list of all the commands supported by a device with their
input and output types and description</p>
<p>request information about a specific command which are its input and
output type and description</p>
<p>request general information on the device like its name, the host where
the device server hosting the device is running...</p>
<p>read the device black-box as an array of strings</p>
</div>
<div class="section" id="the-special-case-of-the-device-state-and-status">
<h3><a class="toc-backref" href="#id165">The special case of the device state and status</a></h3>
<p>Device state and status are the most important key device informations.
Nearly all client software dealing with Tango device needs device(s)
state and/or status. In order to simplify client software developper
work, it is possible to get these two piece of information in three
different manners :</p>
<ol class="arabic simple">
<li>Using the appropriate CORBA attribute (state or status)</li>
<li>Using command on the device. The command are called State or Status</li>
<li>Using attribute. Even if the state and status are not real attribute,
it is possible to get their value using the read_attributes
operation. Nevertheless, it is not possible to set the attribute
configuration for state and status. An error is reported by the
server if a client try to do so.</li>
</ol>
</div>
<div class="section" id="the-device-polling">
<h3><a class="toc-backref" href="#id166">The device polling</a></h3>
<p>Within the Tango framework, it is also possible to force executing
command(s) or reading attribute(s) at a fixed frequency. It is called
<em>device polling</em>. This is automatically handled by Tango core software
with a polling threads pool. The command result or attribute value are
stored in circular buffers. When a client want to read attribute value
(or command result) for a polled attribute (or a polled command), he has
the choice to get the attribute value (or command result) with a real
access to the device of from the last value stored in the device ring
buffer. This is a great advantage for “slow” devices. Getting data from
the buffer is much faster than accessing the device itself. The
technical disadvantage is the time shift between the data returned from
the polling buffer and the time of the request. Polling a command is
only possible for command without input arguments. It is not possible to
poll a device pipe.</p>
<p>Two other CORBA operations called <em>command_inout_history_X</em> and
<em>read_attribute _history_X</em> allow a client to retrieve the history of
polled command or attribute stored in the polling buffers. Obviously,
this history is limited to the depth of the polling buffer.</p>
<p>The whole polling system is available only since Tango release 2.x and
above in CPP and since TangORB release 3.7.x and above in Java.</p>
</div>
</div>
<div class="section" id="the-server">
<h2><a class="toc-backref" href="#id167">The server</a></h2>
<p>Another integral part of the TDSOM is the server concept. The server
(also referred as device server) is a process whose main task is to
offer one or more services to one or more clients. To do this, the
server has to spend most of its time in a wait loop waiting for clients
to connect to it. The devices are hosted in the server process. A server
is able to host several classes of devices. In the TDSOM, a device of
the <strong>DServer</strong> class is automatically hosted by each device server.
This class of device supports commands which enable remote device server
process administration.</p>
<p>TANGO supports device server process on two families of operating system
: Linux and Windows.</p>
</div>
<div class="section" id="the-tango-logging-service">
<h2><a class="toc-backref" href="#id168">The Tango Logging Service</a></h2>
<p>During software life, it is always convenient to print miscellaneous
informations which help to:</p>
<ul class="simple">
<li>Debug the software</li>
<li>Report on error</li>
<li>Give regular information to user</li>
</ul>
<p>This is classically done using cout (or C printf) in C++ or println
method in Java language. In a highly distributed control system, it is
difficult to get all these informations coming from a high number of
different processes running on a large number of computers. Since its
release 3, Tango has incorporated a Logging Service called the Tango
Logging Service (TLS) which allows print messages to be:</p>
<ul class="simple">
<li>Displayed on a console (the classical way)</li>
<li>Sent to a file</li>
<li>Sent to specific Tango device called log consumer. Tango package has
an implementation of log consumer where every consumer device is
associated to a graphical interface. This graphical interface display
messages but could also be used to sort messages, to filter
messages... Using this feature, it is possible to centralise display
of these messages coming from different devices embedded within
different processes. These log consumers can be:<ul>
<li>Statically configured meaning that it memorizes the list of Tango
devices for which it will get and display messages.</li>
<li>Dynamically configured. The user, with the help of the graphical
interface, chooses devices from which he want to see messages.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-database">
<h2><a class="toc-backref" href="#id169">The database</a></h2>
<p>To achieve complete device independence, it is necessary however to
supplement device classes with a possibility for configuring device
dependencies at runtime. The utility which does this in the TDSOM is the
<strong>property database</strong>. Properties <a class="footnote-reference" href="#id140" id="id6">[6]</a> are identified by an ascii string
and the device name. TANGO attributes are also configured using
properties. This database is also used to store device network addresses
(CORBA IOR’s), list of classes hosted by a device server process and
list of devices for each class in a device server process. The database
ensure the uniqueness of device name and of alias. It also links device
name and it list of aliases.</p>
<p>TANGO uses MySQL:raw-latex:<cite>cite{mysql}</cite> as its database. MySQL is a
relational database which implements the SQL language. However, this is
largely enough to implement all the functionalities needed by the TDSOM.
The database is accessed via a classical TANGO device hosted in a device
server. Therefore, client access the database via TANGO commands
requested on the database device. For a good reference on MySQL refer to
</p>
</div>
<div class="section" id="the-controlled-access">
<h2><a class="toc-backref" href="#id170">The controlled access</a></h2>
<p>Tango also provides a controlled access system. It’s a simple controlled
access system. It does not provide encrypted communication or
sophisticated authentification. It simply defines which user (based on
computer loggin authentification) is allowed to do which command (or
write attribute) on which device and from which host. The information
used to configure this controlled access feature are stored in the Tango
database and accessed by a specific Tango device server which is not the
classsical Tango database device server described in the previous
section. Two access levels are defined:</p>
<ul class="simple">
<li>Everything is allowed for this user from this host</li>
<li>The write-like calls on the device are forbidden and according to
configuration, a command subset is also forbidden for this user from
this host</li>
</ul>
<p>This feature is precisely described in the chapter Advanced features</p>
</div>
<div class="section" id="the-application-programmers-interfaces">
<h2><a class="toc-backref" href="#id171">The Application Programmers Interfaces</a></h2>
<div class="section" id="rules-of-the-api">
<h3><a class="toc-backref" href="#id172">Rules of the API</a></h3>
<p>While it is true TANGO clients can be programmed using only the CORBA
API, CORBA knows nothing about TANGO. This means client have to know all
the details of retrieving IORs from the TANGO database, additional
information to send on the wire, TANGO version control etc. These
details can and should be wrapped in TANGO Application Programmer
Interface (API). The API is implemented as a library in C++ and as a
package in Java. The API is what makes TANGO clients easy to write. The
API’s consists the following basic classes :</p>
<ul class="simple">
<li>DeviceProxy which is a <em>proxy</em> to the real device</li>
<li>DeviceData to encapsulate data send/receive from/to device via
commands</li>
<li>DeviceAttribute to encapsulate data send/receive from/to device via
attributes</li>
<li>Group which is a <em>proxy</em> to a group of devices</li>
</ul>
<p>In addition to these main classes, many other classes allows a full
interface to TANGO features. The following figure is a drawing of a
typical client/server application using TANGO.</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>The database is used during server and client startup phase to establish
connection between client and server.</p>
</div>
<div class="section" id="communication-between-client-and-server-using-the-api">
<h3><a class="toc-backref" href="#id173">Communication between client and server using the API</a></h3>
<p>With the API, it is possible to request command to be executed on a
device or to read/write device attribute(s) using one of the two
communication models implemented. These two models are:</p>
<ol class="arabic simple">
<li>The synchronous model where client waits (and is blocked) for the
server to send the answer or until the timeout is reached</li>
<li>The asynchronous model. In this model, the clients send the request
and immediately returns. It is not blocked. It is free to do whatever
it has to do like updating a graphical user interface. The client has
the choice to retrieve the server answer by checking if the reply is
arrived by calling an API specific call or by requesting that a
call-back method is executed when the client receives the server
answer.</li>
</ol>
<p>The asynchronous model is available with Tango release 3 and above.</p>
</div>
<div class="section" id="tango-events">
<h3><a class="toc-backref" href="#id174">Tango events</a></h3>
<p>On top of the two communication model previously described, TANGO offers
an event system. The standard TANGO communication paradigm is a
synchronou/asynchronous two-way call. In this paradigm the call is
initiated by the client who contacts the server. The server handles the
client’s request and sends the answer to the client or throws an
exception which the client catches. This paradigm involves two calls to
receive a single answer and requires the client to be active in
initiating the request. If the client has a permanent interest in a
value he is obliged to poll the server for an update in a value every
time. This is not efficient in terms of network bandwidth nor in terms
of client programming.</p>
<p>For clients who are permanently interested in values the event-driven
communication paradigm is a more efficient and natural way of
programming. In this paradigm the client registers his interest once in
an event (value). After that the server informs the client every time
the event has occurred. This paradigm avoids the client polling, frees
it for doing other things, is fast and makes efficient use of the
network.</p>
<p>Before TANGO release 8, TANGO used the CORBA OMG COS Notification
Service to generates events. TANGO uses the omniNotify implementation of
the Notification service. omniNotify was developed in conjunction with
the omniORB CORBA implementation also used by TANGO. The heart of the
Notification Service is the notification daemon. The omniNotify daemons
are the processes which receive events from device servers and
distribute them to all clients which are subscribed. In order to
distribute the load of the events there is one notification daemon per
host. Servers send their events to the daemon on the local host. Clients
and servers get the IOR for the host from the TANGO database.</p>
<p>The following figure is a schematic of the Tango event system for Tango
releases before Tango 8.</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>Starting with Tango 8, a new design of the event system has been
implemented. This new design is based on the ZMQ library. ZMQ is a
library allowing users to create communicating system. It implements
several well known communication pattern including the Publish/Subscribe
pattern which is the basic of the new Tango event system. Using this
library, a separate notification service is not needed anymore and event
communiction is available with only client and server processes which
simplifies the overall design. Starting with Tango 8.1, the event
propagation between devices and clients could be done using a
multicasting protocol. The aim of this is to reduce both the network
bandwidth use and the CPU consumption on the device server side. See
chapter on Advanced Features to get all the details on this feature.</p>
<p>The following figure is a schematic of the Tango event system for Tango
releases starting with Tango release 8.</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>[OneRicardo]|image|</p>
</div>
</div>
</div>
<div class="section" id="writing-a-tango-client-using-tango-apis">
<h1><a class="toc-backref" href="#id175">Writing a TANGO client using TANGO APIs</a></h1>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id176">Introduction</a></h2>
<p>TANGO devices and database are implemented using the TANGO device server
model. To access them the user has the CORBA interface e.g.
command_inout(), write_attributes() etc. defined by the idl file.
These methods are very low-level and assume a good working knowledge of
CORBA. In order to simplify this access, high-level api has been
implemented which hides all CORBA aspects of TANGO. In addition the api
hides details like how to connect to a device via the database, how to
reconnect after a device has been restarted, how to correctly pack and
unpack attributes and so on by implementing these in a manner
transparent to the user. The api provides a unified error handling for
all TANGO and CORBA errors. Unlike the CORBA C++ bindings the TANGO api
supports native C++ data types e.g. strings and vectors.</p>
<p>This chapter describes how to use these API’s. It is not a reference
guide. Reference documentation is available as Web pages in the <a class="reference external" href="http://www.tango-controls.org">Tango
Web site</a></p>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id177">Getting Started</a></h2>
<p>Refer to the chapter Getting Started for an example on getting start
with the C++ or Java api.</p>
</div>
<div class="section" id="basic-philosophy">
<h2><a class="toc-backref" href="#id178">Basic Philosophy</a></h2>
<p>The basic philosophy is to have high level classes to deal with Tango
devices. To communicate with Tango device, uses the <strong>DeviceProxy</strong>
class. To send/receive data to/from Tango device, uses the <strong>DeviceData,
DeviceAttribute</strong> or <strong>DevicePipe</strong> classes. To communicate with a group
of devices, use the <strong>Group</strong> class. If you are interested only in some
attributes provided by a Tango device, uses the <strong>AttributeProxy</strong>
class. Even if the Tango database is implemented as any other devices
(and therefore accessible with one instance of a DeviceProxy class),
specific high level classes have been developped to query it. Uses the
<strong>Database</strong>, <strong>DbDevice</strong>, <strong>DbClass</strong>, <strong>DbServer</strong> or <strong>DbData</strong>
classes when interfacing the Tango database. Callback for asynchronous
requests or events are implemented via a <strong>CallBack</strong> class. An utility
class called <strong>ApiUtil</strong> is also available.</p>
</div>
<div class="section" id="data-types">
<h2><a class="toc-backref" href="#id179">Data types</a></h2>
<p>The definition of the basic data type you can transfert using Tango is:</p>
<dl class="docutils">
<dt>|c|c| Tango type name &amp; C++ equivalent type</dt>
<dd>DevBoolean &amp; boolean
DevShort &amp; short
DevEnum &amp; enumeration (only for attribute / See chapter on advanced</dd>
<dt>features)</dt>
<dd>DevLong &amp; int (always 32 bits data)
DevLong64 &amp; long long on 32 bits chip or long on 64 bits chip
&amp; always 64 bits data
DevFloat &amp; float
DevDouble &amp; double
DevString &amp; char *
DevEncoded &amp; structure with 2 fields: a string and an array of unsigned</dd>
<dt>char</dt>
<dd>DevUChar &amp; unsigned char
DevUShort &amp; unsigned short
DevULong &amp; unsigned int (always 32 bits data)
DevULong64 &amp; unsigned long long on 32 bits chip or unsigned long on 64</dd>
<dt>bits chip</dt>
<dd>&amp; always 64 bits data
DevState &amp; Tango specific data type</dd>
</dl>
<p>Using commands, you are able to transfert all these data types, array of
these basic types and two other Tango specific data types called
DevVarLongStringArray and DevVarDoubleStringArray. See chapter [Data
exchange] to get details about them. You are also able to create
attributes using any of these basic data types to transfer data between
clients and servers.</p>
</div>
<div class="section" id="request-model">
<h2><a class="toc-backref" href="#id180">Request model</a></h2>
<p>For the most important API remote calls (command_inout,
read_attribute(s) and write_attribute(s)), Tango supports two kind of
requests which are the synchronous model and the asynchronous model.
Synchronous model means that the client wait (and is blocked) for the
server to send an answer. Asynchronous model means that the client does
not wait for the server to send an answer. The client sends the request
and immediately returns allowing the CPU to do anything else (like
updating a graphical user interface). Device pipe supports only the
synchronous model. Within Tango, there are two ways to retrieve the
server answer when using asynchronous model. They are:</p>
<ol class="arabic simple">
<li>The polling mode</li>
<li>The callback mode</li>
</ol>
<p>In polling mode, the client executes a specific call to check if the
answer is arrived. If this is not the case, an exception is thrown. If
the reply is there, it is returned to the caller and if the reply was an
exception, it is re-thrown. There are two calls to check if the reply is
arrived:</p>
<ul class="simple">
<li>Call which does not wait before the server answer is returned to the
caller.</li>
<li>Call which wait with timeout before returning the server answer to
the caller (or throw the exception) if the answer is not arrived.</li>
</ul>
<p>In callback model, the caller must supply a callback method which will
be executed when the command returns. They are two sub-modes:</p>
<ol class="arabic simple">
<li>The pull callback mode</li>
<li>The push callback mode</li>
</ol>
<p>In the pull callback mode, the callback is triggered if the server
answer is arrived when the client decide it by calling a
<em>synchronization</em> method (The client pull-out the answer). In push mode,
the callback is executed as soon as the reply arrives in a separate
thread (The server pushes the answer to the client).</p>
<div class="section" id="synchronous-model">
<h3><a class="toc-backref" href="#id181">Synchronous model</a></h3>
<p>Synchronous access to Tango device are provided using the <em>DeviceProxy</em>
or <em>AttributeProxy</em> class. For the <em>DeviceProxy</em> class, the main
synchronous call methods are :</p>
<ul class="simple">
<li><em>command_inout()</em> to execute a Tango device command</li>
<li><em>read_attribute()</em> or <em>read_attributes()</em> to read a Tango device
attribute(s)</li>
<li><em>write_attribute()</em> or <em>write_attributes()</em> to write a Tango device
attribute(s)</li>
<li><em>write_read_attribute()</em> or <em>write_read_attributes()</em> to write
then read Tango device attribute(s)</li>
<li><em>read_pipe()</em> to read a Tango device pipe</li>
<li><em>write_pipe()</em> to write a Tango device pipe</li>
<li><em>write_read_pipe()</em> to write then read Tango device pipe</li>
</ul>
<p>For commands, data are send/received to/from device using the
<em>DeviceData</em> class. For attributes, data are send/received to/from
device attribute using the <em>DeviceAttribute</em> class. For pipes, data are
send/receive to/from device pipe using the <em>DevicePipe</em> and
<em>DevicePipeBlob</em> classes.</p>
<p>In some cases, only attributes provided by a Tango device are
interesting for the application. You can use the <em>AttributeProxy</em> class.
Its main synchronous methods are :</p>
<ul class="simple">
<li><em>read()</em> to read the attribute value</li>
<li><em>write()</em> to write the attribute value</li>
<li><em>write_read()</em> to write then read the attribute value</li>
</ul>
<p>Data are transmitted using the <em>DeviceAttribute</em> class.</p>
</div>
<div class="section" id="asynchronous-model">
<h3><a class="toc-backref" href="#id182">Asynchronous model</a></h3>
<p>Asynchronous access to Tango device are provided using <em>DeviceProxy</em> or
<em>AttributeProxy, CallBack</em> and <em>ApiUtil</em> classes methods. The main
asynchronous call methods and used classes are :</p>
<ul class="simple">
<li>To execute a command on a device<ul>
<li><em>DeviceProxy::command_inout_asynch()</em> and
<em>DeviceProxy::command_inout_reply()</em> in polling model.</li>
<li><em>DeviceProxy::command_inout_asynch()</em>,
<em>DeviceProxy::get_asynch_replies()</em> and <em>CallBack</em> class in
callback pull model</li>
<li><em>DeviceProxy::command_inout_asynch()</em>,
<em>ApiUtil::set_asynch_cb_sub_model()</em> and <em>CallBack</em> class in
callback push model</li>
</ul>
</li>
<li>To read a device attribute<ul>
<li><em>DeviceProxy::read_attribute_asynch()</em> and
<em>DeviceProxy::read_attribute_reply()</em> in polling model</li>
<li><em>DeviceProxy::read_attribute_asynch()</em>,
<em>DeviceProxy::get_asynch_replies()</em> and <em>CallBack</em> class in
callback pull model.</li>
<li><em>DeviceProxy::read_attribute_asynch()</em>,
<em>ApiUtil::set_asynch_cb_sub_model()</em> and <em>CallBack</em> class in
callback push model</li>
</ul>
</li>
<li>To write a device attribute<ul>
<li><em>DeviceProxy::write_attribute_asynch()</em> in polling model</li>
<li><em>DeviceProxy::write_attribute_asynch()</em> and <em>CallBack</em> class in
callback pull model</li>
<li><em>DeviceProxy::write_attribute_asynch()</em>,
<em>ApiUtil::set_asynch_cb_sub_model()</em> and <em>CallBack</em> class in
callback push model</li>
</ul>
</li>
</ul>
<p>For commands, data are send/received to/from device using the
<em>DeviceData</em> class. For attributes, data are send/received to/from
device attribute using the <em>DeviceAttribute</em> class. It is also possible
to generate asynchronous request(s) using the <em>AttributeProxy</em> class
following the same schema than above. Methods to use are :</p>
<ul class="simple">
<li><em>read_asynch(</em>) and <em>read_reply()</em> to asynchronously read the
attribute value</li>
<li><em>write_asynch()</em> and <em>write_reply()</em> to asynchronously write the
attribute value</li>
</ul>
</div>
</div>
<div class="section" id="events">
<h2><a class="toc-backref" href="#id183">Events</a></h2>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id184">Introduction</a></h3>
<p>Events are a critical part of any distributed control system. Their aim
is to provide a communication mechanism which is fast and efficient.</p>
<p>The standard CORBA communication paradigm is a synchronous or
asynchronous two-way call. In this paradigm the call is initiated by the
client who contacts the server. The server handles the client’s request
and sends the answer to the client or throws an exception which the
client catches. This paradigm involves two calls to receive a single
answer and requires the client to be active in initiating the request.
If the client has a permanent interest in a value he is obliged to poll
the server for an update in a value every time. This is not efficient in
terms of network bandwidth nor in terms of client programming.</p>
<p>For clients who are permanently interested in values the event-driven
communication paradigm is a more efficient and natural way of
programming. In this paradigm the client registers her interest once in
an event (value). After that the server informs the client every time
the event has occurred. This paradigm avoids the client polling, frees
it for doing other things, is fast and makes efficient use of the
network.</p>
<p>The rest of this chapter explains how the TANGO events are implemented
and the application programmer’s interface.</p>
</div>
<div class="section" id="event-definition">
<h3><a class="toc-backref" href="#id185">Event definition</a></h3>
<p>TANGO events represent an alternative channel for reading TANGO device
attributes. Device attributes values are sent to all subscribed clients
when an event occurs. Events can be an attribute value change, a change
in the data quality or a periodically send event. The clients continue
receiving events as long as they stay subscribed. Most of the time, the
device server polling thread detects the event and then pushes the
device attribute value to all clients. Nevertheless, in some cases, the
delay introduced by the polling thread in the event propagation is
detrimental. For such cases, some API calls directly push the event.
Until TANGO release 8, the omniNotify implementation of the CORBA
Notification service was used to dispatch events. Starting with TANGO 8,
this CORBA Notification service has been replaced by the ZMQ library
which implements a Publish/Subscribe communication model well adapted to
TANGO events communication.</p>
</div>
<div class="section" id="event-types">
<h3><a class="toc-backref" href="#id186">Event types</a></h3>
<p>The following eight event types have been implemented in TANGO :</p>
<ol class="arabic simple">
<li><strong>change</strong> - an event is triggered and the attribute value is sent
when the attribute value changes significantly. The exact meaning of
significant is device attribute dependent. For analog and digital
values this is a delta fixed per attribute, for string values this is
any non-zero change i.e. if the new attribute value is not equal to
the previous attribute value. The delta can either be specified as a
relative or absolute change. The delta is the same for all clients
unless a filter is specified (see below). To easily write
applications using the change event, it is also triggered in the
following case :<ol class="arabic">
<li>When a spectrum or image attribute size changes.</li>
<li>At event subscription time</li>
<li>When the polling thread receives an exception during attribute
reading</li>
<li>When the polling thread detects that the attribute quality factor
has changed.</li>
<li>The first good reading of the attribute after the polling thread
has received exception when trying to read the attribute</li>
<li>The first time the polling thread detects that the attribute
quality factor has changed from INVALID to something else</li>
<li>When a change event is pushed manually from the device server
code. (<em>DeviceImpl::push_change_event()</em>).</li>
<li>By the methods Attribute::set_quality() and
Attribute::set_value_date_quality() if a client has subscribed
to the change event on the attribute. This has been implemented
for cases where the delay introduced by the polling thread in the
event propagation is not authorized.</li>
</ol>
</li>
<li><strong>periodic</strong> - an event is sent at a fixed periodic interval. The
frequency of this event is determined by the <em>event_period</em> property
of the attribute and the polling frequency. The polling frequency
determines the highest frequency at which the attribute is read. The
event_period determines the highest frequency at which the periodic
event is sent. Note if the event_period is not an integral number of
the polling period there will be a beating of the two
frequencies <a class="footnote-reference" href="#id141" id="id10">[7]</a>. Clients can reduce the frequency at which they
receive periodic events by specifying a filter on the periodic event
counter.</li>
<li><strong>archive</strong> - an event is sent if one of the archiving conditions is
satisfied. Archiving conditions are defined via properties in the
database. These can be a mixture of delta_change and periodic.
Archive events can be send from the polling thread or can be manually
pushed from the device server code
(<em>DeviceImpl::push_archive_event()</em>).</li>
<li><strong>attribute configuration</strong> - an event is sent if the attribute
configuration is changed.</li>
<li><strong>data ready</strong> - This event is sent when coded by the device server
programmer who uses a specific method of one of the Tango device
server class to fire the event
(<em>DeviceImpl::push_data_ready_event()</em>). The rule of this event is
to inform a client that it is now possible to read an attribute. This
could be useful in case of attribute with many data.</li>
<li><strong>user</strong> - The criteria and configuration of these user events are
managed by the device server programmer who uses a specific method of
one of the Tango device server class to fire the event
(<em>DeviceImpl::push_event()</em>).</li>
<li><strong>device interface change</strong> - This event is sent when the device
interface changes. Using Tango, it is possible to dynamically
add/remove attribute/command to a device. This event is the way to
inform client(s) that attribute/command has been added/removed from a
device. Note that this type of event is attached to a device and not
to one attribute (like all other event types). This event is
triggered in the following case :<ol class="arabic">
<li>A dynamic attribute or command is added or removed. The event is
sent after a small delay (50 mS) in order to eliminate the risk of
events storm in case several attributes/commands are added/removed
in a loop</li>
<li>At the end of admin device RestartServer or DevRestart command</li>
<li>After a re-connection due to a device server restart. Because the
device interface is not memorized, the event is sent even if it is
highly possible that the device interface has not changed. A flag
in the data propagated with the event inform listening
applications that the device interface change is not guaranteed.</li>
<li>At event re-connection time. This case is similar to the previous
one (device interface change not guaranteed)</li>
</ol>
</li>
<li><strong>pipe</strong> - This is the kind of event which has to be used when the
user want to push data through a pipe. This kind of event is only
sent by the user code by using a specific method
(<em>DeviceImpl::push_pipe_event()</em>). There is no way to ask the Tango
kernel to automatically push this kind of event.</li>
</ol>
<p>The first three above events are automatically generated by the TANGO
library or fired by the user code. Events number 4 and 7 are only
automatically sent by the library and events 5, 6 and 8 are fired only
by the user code.</p>
</div>
<div class="section" id="event-filtering-removed-in-tango-release-8-and-above">
<h3><a class="toc-backref" href="#id187">Event filtering (Removed in Tango release 8 and above)</a></h3>
<p>Please, note that this feature is available only for Tango releases
older than Tango 8. The CORBA Notification Service allows event
filtering. This means that a client can ask the Notification Service to
send the event only if some filter is evaluated to true. Within the
Tango control system, some pre-defined fields can be used as filter.
These fields depend on the event type.</p>
<p>|c|c|c|c| Event type &amp; Filterable field name &amp; Filterable field
value &amp; type</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 1460)</p>
Unexpected indentation.</div>
<blockquote>
&amp; delta_change_rel &amp; Relative change (in %) since last event &amp; double
&amp; delta_change_abs &amp; Absolute change since last event &amp; double
&amp; quality &amp; Is set to 1 when the attribute quality factor has &amp; double
&amp; &amp; changed, otherwise it is 0 &amp;
&amp; forced_event &amp; Is set to 1 when the event was fired on exception &amp;</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 1465)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<dl class="docutils">
<dt>double</dt>
<dd>&amp; &amp; or a quality factor set to invalid &amp;
periodic &amp; counter &amp; Incremented each time the event is sent &amp; long
&amp; delta_change_rel &amp; Relative change (in %) since last event &amp; double
&amp; delta_change_abs &amp; Absolute change since last event &amp; double
&amp; quality &amp; Is set to 1 when the attribute quality factor has &amp; double
&amp; &amp; changed, otherwise it is 0 &amp;
&amp; &amp; Incremented each time the event is sent &amp;
&amp; counter &amp; for periodic reason. Set to -1 if event &amp; long
&amp; &amp; sent for change reason &amp;
&amp; forced_event &amp; Is set to 1 when the event was fired on exception &amp;</dd>
<dt>double</dt>
<dd>&amp; &amp; or a quality factor set to invalid &amp;
&amp; delta_event &amp; Number of milli-seconds since previous event &amp; double</dd>
</dl>
<p>Filter are defined as a string following a grammar defined by CORBA. It
is defined in . The following example shows
you the most common use of these filters in the Tango world :</p>
<ul>
<li><p class="first">To receive periodic event one out of every three, the filter must be</p>
<p>$counter % 3 == 0</p>
</li>
<li><p class="first">To receive change event only if the relative change is greater than
% (positive and negative), the filter must be</p>
<p>$delta_change_rel &gt;= 20 or $delta_change_rel &lt;= -20</p>
</li>
<li><p class="first">To receive a change event only on quality change, the filter must be</p>
<p>$quality == 1</p>
</li>
</ul>
<p>For user events, the filter field name(s) and their value are defined by
the device server programmer.</p>
</div>
<div class="section" id="application-programmers-interface">
<h3><a class="toc-backref" href="#id188">Application Programmer’s Interface</a></h3>
<p>How to setup and use the TANGO events ? The interfaces described here
are intended as user friendly interfaces to the underlying CORBA calls.
The interface is modeled after the asynchronous <em>command_inout()</em>
interface so as to maintain coherency. The event system supports <strong>push
callback model</strong> as well as the <strong>pull callback model.</strong></p>
<p>The two event reception modes are:</p>
<ul class="simple">
<li><strong>Push callback model</strong> : On event reception a callbacks method gets
immediately executed.</li>
<li><strong>Pull callback model</strong> : The event will be buffered the client until
the client is ready to receive the event data. The client triggers
the execution of the callback method.</li>
</ul>
<p>The event reception buffer in the <strong>pull callback model</strong>, is
implemented as a round robin buffer. The client can choose the size when
subscribing for the event. This way the client can set-up different ways
to receive events.</p>
<ul class="simple">
<li>Event reception buffer size = 1 : The client is interested only in
the value of the last event received. All other events that have been
received since the last reading are discarded.</li>
<li>Event reception buffer size &gt; 1 : The client has chosen to keep an
event history of a given size. When more events arrive since the last
reading, older events will be discarded.</li>
<li>Event reception buffer size = ALL_EVENTS : The client buffers all
received events. The buffer size is unlimited and only restricted by
the available memory for the client.</li>
</ul>
<div class="section" id="configuring-events">
<h4>Configuring events</h4>
<p>The attribute configuration set is used to configure under what
conditions events are generated. A set of standard attribute properties
(part of the standard attribute configuration) are read from the
database at device startup time and used to configure the event engine.
If there are no properties defined then default values specified in the
code are used.</p>
<div class="section" id="change">
<h5>change</h5>
<p>The attribute properties and their default values for the change event
are :</p>
<ol class="arabic simple">
<li><strong>rel_change</strong> - a property of maximum 2 values. It specifies the
positive and negative relative change of the attribute value w.r.t.
the value of the previous change event which will trigger the event.
If the attribute is a spectrum or an image then a change event is
generated if any one of the attribute value’s satisfies the above
criterium. If only one property is specified then it is used for the
positive and negative change. If no property is specified, no events
are generated.</li>
<li><strong>abs_change</strong> - a property of maximum 2 values.It specifies the
positive and negative absolute change of the attribute value w.r.t
the value of the previous change event which will trigger the event.
If the attribute is a spectrum or an image then a change event is
generated if any one of the attribute value’s satisfies the above
criterium. If only one property is specified then it is used for the
positive and negative change. If no properties are specified then the
relative change is used.</li>
</ol>
</div>
<div class="section" id="periodic">
<h5>periodic</h5>
<p>The attribute properties and their default values for the periodic event
are :</p>
<ol class="arabic simple">
<li><strong>event_period</strong> - the minimum time between events (in
milliseconds). If no property is specified then a default value of 1
second is used.</li>
</ol>
</div>
<div class="section" id="archive">
<h5>archive</h5>
<p>The attribute properties and their default values for the archive event
are :</p>
<ol class="arabic simple">
<li><strong>archive_rel_change</strong> - a property of maximum 2 values which
specifies the positive and negative relative change w.r.t. the
previous attribute value which will trigger the event. If the
attribute is a spectrum or an image then an archive event is
generated if any one of the attribute value’s satisfies the above
criterium. If only one property is specified then it is used for the
positive and negative change. If no properties are specified then no
events are generate.</li>
<li><strong>archive_abs_change</strong> - a property of maximum 2 values which
specifies the positive and negative absolute change w.r.t the
previous attribute value which will trigger the event. If the
attribute is a spectrum or an image then an archive event is
generated if any one of the attribute value’s satisfies the above
criterium. If only one property is specified then it is used for the
positive and negative change. If no properties are specified then the
relative change is used.</li>
<li><strong>archive_period</strong> - the minimum time between archive events (in
milliseconds). If no property is specified, no periodic archiving
events are send.</li>
</ol>
</div>
</div>
<div class="section" id="c-clients">
<h4>C++ Clients</h4>
<p>This is the interface for clients who want to receive events. The main
action of the client is to subscribe and unsubscribe to events. Once the
client has subscribed to one or more events the events are received in a
separate thread by the client.</p>
<p>Two reception modes are possible:</p>
<ul class="simple">
<li>On event reception a callbacks method gets immediately executed.</li>
<li>The event will be buffered until the client until the client is ready
to receive the event data.</li>
</ul>
<p>The mode to be used has to be chosen when subscribing for the event.</p>
<div class="section" id="subscribing-to-events">
<h5>Subscribing to events</h5>
<p>The client call to subscribe to an event is named
<em>DeviceProxy::subscribe_event()</em> . During the event subscription the
client has to choose the event reception mode to use.</p>
<p><strong>Push model</strong>:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">subscribe_event</span><span class="punctuation">(</span>
<span class="ln">2 </span>               <span class="keyword">const</span> <span class="name">string</span> <span class="operator">&amp;</span><span class="name">attribute</span><span class="punctuation">,</span>
<span class="ln">3 </span>               <span class="name">Tango</span><span class="operator">::</span><span class="name">EventType</span> <span class="name">event</span><span class="punctuation">,</span>
<span class="ln">4 </span>               <span class="name">Tango</span><span class="operator">::</span><span class="name">CallBack</span> <span class="operator">*</span><span class="name">callback</span><span class="punctuation">,</span>
<span class="ln">5 </span>               <span class="keyword type">bool</span> <span class="name">stateless</span> <span class="operator">=</span> <span class="name builtin">false</span><span class="punctuation">);</span>
</pre>
<p>The client implements a callback method which is triggered when the
event is received. Note that this callback method will be executed by a
thread started by the underlying ORB. This thread is not the application
main thread. For Tango releases before 8, a similar call with one extra
parameter for event filtering is also available.</p>
<p><strong>Pull model</strong>:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">subscribe_event</span><span class="punctuation">(</span>
<span class="ln">2 </span>               <span class="keyword">const</span> <span class="name">string</span> <span class="operator">&amp;</span><span class="name">attribute</span><span class="punctuation">,</span>
<span class="ln">3 </span>               <span class="name">Tango</span><span class="operator">::</span><span class="name">EventType</span> <span class="name">event</span><span class="punctuation">,</span>
<span class="ln">4 </span>               <span class="keyword type">int</span> <span class="name">event_queue_size</span><span class="punctuation">,</span>
<span class="ln">5 </span>               <span class="keyword type">bool</span> <span class="name">stateless</span> <span class="operator">=</span> <span class="name builtin">false</span><span class="punctuation">);</span>
</pre>
<p>The client chooses the size of the round robin event reception buffer.
Arriving events will be buffered until the client uses
<em>DeviceProxy::get_events()</em> to extract the event data. For Tango
releases before 8, a similar call with one extra parameter for event
filtering is also available.</p>
<p>On top of the user filter defined by the <em>filters</em> parameter, basic
filtering is done based on the reason specified and the event type. For
example when reading the state and the reason specified is change the
event will be fired only when the state changes. Events consist of an
attribute name and the event reason. A standard set of reasons are
implemented by the system, additional device specific reasons can be
implemented by device servers programmers.</p>
<p>The stateless flag = false indicates that the event subscription will
only succeed when the given attribute is known and available in the
Tango system. Setting stateless = true will make the subscription
succeed, even if an attribute of this name was never known. The real
event subscription will happen when the given attribute will be
available in the Tango system.</p>
<p>Note that in this model, the callback method will be executed by the
thread doing the <em>DeviceProxy::get_events()</em> call.</p>
</div>
<div class="section" id="the-callback-class">
<h5>The CallBack class</h5>
<p>In C++, the client has to implement a class inheriting from the Tango
CallBack class and pass this to the <em>DeviceProxy::subscribe_event()</em>
method. The CallBack class is the same class as the one proposed for the
TANGO asynchronous call. This is as follows for events :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">MyCallback</span> <span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">CallBack</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="punctuation">.</span>
<span class="ln"> 4 </span>     <span class="punctuation">.</span>
<span class="ln"> 5 </span>     <span class="punctuation">.</span>
<span class="ln"> 6 </span>     <span class="keyword">virtual</span> <span class="name">push_event</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">EventData</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>     <span class="keyword">virtual</span> <span class="name function">push_event</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">AttrConfEventData</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>     <span class="keyword">virtual</span> <span class="name function">push_event</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DataReadyEventData</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>     <span class="keyword">virtual</span> <span class="name function">push_event</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevIntrChangeEventData</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">10 </span>     <span class="keyword">virtual</span> <span class="name function">push_event</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">PipeEventData</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">11 </span>  <span class="punctuation">}</span>
</pre>
<p>where EventData is defined as follows :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">EventData</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">DeviceProxy</span>       <span class="operator">*</span><span class="name">device</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>     <span class="name">string</span>            <span class="name">attr_name</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>     <span class="name">string</span>            <span class="name">event</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>     <span class="name">DeviceAttribute</span>   <span class="operator">*</span><span class="name">attr_value</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="keyword type">bool</span>              <span class="name">err</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>     <span class="name">DevErrorList</span>      <span class="name">errors</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
</pre>
<p>AttrConfEventData is defined as follows :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">AttrConfEventData</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">DeviceProxy</span>       <span class="operator">*</span><span class="name">device</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>     <span class="name">string</span>            <span class="name">attr_name</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>     <span class="name">string</span>            <span class="name">event</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>     <span class="name">AttributeInfoEx</span>   <span class="operator">*</span><span class="name">attr_conf</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="keyword type">bool</span>              <span class="name">err</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>     <span class="name">DevErrorList</span>      <span class="name">errors</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
</pre>
<p>DataReadyEventData is defined as follows :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">DataReadyEventData</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">DeviceProxy</span>       <span class="operator">*</span><span class="name">device</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>     <span class="name">string</span>            <span class="name">attr_name</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>     <span class="name">string</span>            <span class="name">event</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>     <span class="keyword type">int</span>               <span class="name">attr_data_type</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="keyword type">int</span>               <span class="name">ctr</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>     <span class="keyword type">bool</span>              <span class="name">err</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>     <span class="name">DevErrorList</span>      <span class="name">errors</span><span class="punctuation">;</span>
<span class="ln">10 </span>  <span class="punctuation">}</span>
</pre>
<p>DevIntrChangeEventData is defined as follows :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">DevIntrChangeEventData</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">DeviceProxy</span>            <span class="name">device</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>     <span class="name">string</span>                 <span class="name">event</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>     <span class="name">string</span>                 <span class="name">device_name</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>     <span class="name">CommandInfoList</span>        <span class="name">cmd_list</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="name">AttributeInfoListEx</span>    <span class="name">att_list</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>     <span class="keyword type">bool</span>                   <span class="name">dev_started</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>     <span class="keyword type">bool</span>                   <span class="name">err</span><span class="punctuation">;</span>
<span class="ln">10 </span>     <span class="name">DevErrorList</span>           <span class="name">errors</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="punctuation">}</span>
</pre>
<p>and PipeEventData is defined as follows :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">PipeEventData</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">DeviceProxy</span>       <span class="operator">*</span><span class="name">device</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>     <span class="name">string</span>            <span class="name">pipe_name</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>     <span class="name">string</span>            <span class="name">event</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>     <span class="name">DevicePipe</span>        <span class="operator">*</span><span class="name">pipe_value</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="keyword type">bool</span>              <span class="name">err</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>     <span class="name">DevErrorList</span>      <span class="name">errors</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
</pre>
<p>In push model, there are some cases (same callback used for events
coming from different devices hosted in device server process running on
different hosts) where the callback method could be executed concurently
by different threads started by the ORB. The user has to code his
callback method in a <strong>thread</strong> <strong>safe</strong> manner.</p>
</div>
<div class="section" id="unsubscribing-from-an-event">
<h5>Unsubscribing from an event</h5>
<p>Unsubscribe a client from receiving the event specified by <em>event_id</em>
is done by calling the <em>DeviceProxy::unsubscribe_event()</em> method :</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword type">void</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">unsubscribe_event</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">);</span>
</pre>
</div>
<div class="section" id="extract-buffered-event-data">
<h5>Extract buffered event data</h5>
<p>When the pull model was chosen during the event subscription, the
received event data can be extracted with <em>DeviceProxy::get_events().</em>
Two possibilities are available for data extraction. Either a callback
method can be executed for every event in the buffer when using</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">get_events</span><span class="punctuation">(</span>
<span class="ln">2 </span>               <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">,</span>
<span class="ln">3 </span>               <span class="name">CallBack</span> <span class="operator">*</span><span class="name">cb</span><span class="punctuation">);</span>
</pre>
<p>Or all the event data can be directly extracted as EventDataList,
AttrConfEventDataList , DataReadyEventDataList,
DevIntrChangeEventDataList or PipeEventDataList when using</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">get_events</span><span class="punctuation">(</span>
<span class="ln"> 2 </span>               <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">,</span>
<span class="ln"> 3 </span>               <span class="name">EventDataList</span> <span class="operator">&amp;</span><span class="name">event_list</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">get_events</span><span class="punctuation">(</span>
<span class="ln"> 6 </span>               <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">,</span>
<span class="ln"> 7 </span>               <span class="name">AttrConfEventDataList</span> <span class="operator">&amp;</span><span class="name">event_list</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">get_events</span><span class="punctuation">(</span>
<span class="ln">10 </span>               <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">,</span>
<span class="ln">11 </span>               <span class="name">DataReadyEventDataList</span> <span class="operator">&amp;</span><span class="name">event_list</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">get_events</span><span class="punctuation">(</span>
<span class="ln">14 </span>               <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">,</span>
<span class="ln">15 </span>               <span class="name">DevIntrChangeEventDataList</span> <span class="operator">&amp;</span><span class="name">event_list</span><span class="punctuation">);</span>
<span class="ln">16 </span>
<span class="ln">17 </span>  <span class="keyword type">int</span> <span class="name">DeviceProxy</span><span class="operator">::</span><span class="name">get_events</span><span class="punctuation">(</span>
<span class="ln">18 </span>               <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">,</span>
<span class="ln">19 </span>               <span class="name">PipeEventDataList</span> <span class="operator">&amp;</span><span class="name">event_list</span><span class="punctuation">);</span>
</pre>
<p>The event data lists are vectors of EventData, AttrConfEventData,
DataReadyEventData or PipeEventData pointers with special destructor and
clean-up methods to ease the memory handling.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword">class</span> <span class="name class">EventDataList</span><span class="operator">:</span><span class="keyword">public</span> <span class="name">vector</span><span class="operator">&lt;</span><span class="name">EventData</span> <span class="operator">*&gt;</span>
<span class="ln">2 </span>  <span class="keyword">class</span> <span class="name class">AttrConfEventDataList</span><span class="operator">:</span><span class="keyword">public</span> <span class="name">vector</span><span class="operator">&lt;</span><span class="name">AttrConfEventData</span> <span class="operator">*&gt;</span>
<span class="ln">3 </span>  <span class="keyword">class</span> <span class="name class">DataReadyEventDataList</span><span class="operator">:</span><span class="keyword">public</span> <span class="name">vector</span><span class="operator">&lt;</span><span class="name">DataReadyEventData</span> <span class="operator">*&gt;</span>
<span class="ln">4 </span>  <span class="keyword">class</span> <span class="name class">DevIntrChangeEventDataList</span><span class="operator">:</span><span class="keyword">public</span> <span class="name">vector</span><span class="operator">&lt;</span><span class="name">DevIntrChangeEventData</span> <span class="operator">*&gt;</span>
<span class="ln">5 </span>  <span class="keyword">class</span> <span class="name class">PipeEventDataList</span><span class="operator">:</span><span class="keyword">public</span> <span class="name">vector</span><span class="operator">&lt;</span><span class="name">PipeEventData</span> <span class="operator">*&gt;</span>
</pre>
</div>
<div class="section" id="example">
<h5>Example</h5>
<p>Here is a typical code example of a client to register and receive
events. First, you have to define a callback method as follows:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">DoubleEventCallBack</span> <span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">CallBack</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="keyword type">void</span> <span class="name">push_event</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">EventData</span><span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>  <span class="punctuation">};</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>  <span class="keyword type">void</span> <span class="name">DoubleEventCallBack</span><span class="operator">::</span><span class="name">push_event</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">EventData</span> <span class="operator">*</span><span class="name">myevent</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>  <span class="punctuation">{</span>
<span class="ln"> 9 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarDoubleArray</span> <span class="operator">*</span><span class="name">double_value</span><span class="punctuation">;</span>
<span class="ln">10 </span>      <span class="name">try</span>
<span class="ln">11 </span>      <span class="punctuation">{</span>
<span class="ln">12 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DoubleEventCallBack::push_event(): called attribute &quot;</span>
<span class="ln">13 </span>               <span class="operator">&lt;&lt;</span> <span class="name">myevent</span><span class="operator">-&gt;</span><span class="name">attr_name</span>
<span class="ln">14 </span>               <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; event &quot;</span>
<span class="ln">15 </span>               <span class="operator">&lt;&lt;</span> <span class="name">myevent</span><span class="operator">-&gt;</span><span class="name">event</span>
<span class="ln">16 </span>               <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; (err=&quot;</span>
<span class="ln">17 </span>               <span class="operator">&lt;&lt;</span> <span class="name">myevent</span><span class="operator">-&gt;</span><span class="name">err</span>
<span class="ln">18 </span>               <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;)&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">19 </span>
<span class="ln">20 </span>
<span class="ln">21 </span>           <span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span><span class="name">myevent</span><span class="operator">-&gt;</span><span class="name">err</span><span class="punctuation">)</span>
<span class="ln">22 </span>           <span class="punctuation">{</span>
<span class="ln">23 </span>               <span class="operator">*</span><span class="punctuation">(</span><span class="name">myevent</span><span class="operator">-&gt;</span><span class="name">attr_value</span><span class="punctuation">)</span> <span class="operator">&gt;&gt;</span> <span class="name">double_value</span><span class="punctuation">;</span>
<span class="ln">24 </span>               <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;double value &quot;</span>
<span class="ln">25 </span>                    <span class="operator">&lt;&lt;</span> <span class="punctuation">(</span><span class="operator">*</span><span class="name">double_value</span><span class="punctuation">)[</span><span class="literal number integer">0</span><span class="punctuation">]</span>
<span class="ln">26 </span>                    <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">27 </span>               <span class="keyword">delete</span> <span class="name">double_value</span><span class="punctuation">;</span>
<span class="ln">28 </span>           <span class="punctuation">}</span>
<span class="ln">29 </span>      <span class="punctuation">}</span>
<span class="ln">30 </span>      <span class="keyword">catch</span> <span class="punctuation">(...)</span>
<span class="ln">31 </span>      <span class="punctuation">{</span>
<span class="ln">32 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DoubleEventCallBack::push_event(): could not extract data !</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span><span class="punctuation">;</span>
<span class="ln">33 </span>      <span class="punctuation">}</span>
<span class="ln">34 </span>  <span class="punctuation">}</span>
</pre>
<p>Then the main code must subscribe to the event and choose the push or
the pull model for event reception.</p>
<p><strong>Push model</strong>:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DoubleEventCallBack</span> <span class="operator">*</span><span class="name">double_callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">DoubleEventCallBack</span><span class="punctuation">;</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceProxy</span> <span class="operator">*</span><span class="name">mydevice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceProxy</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/1&quot;</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>  <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>  <span class="keyword">const</span> <span class="name">string</span> <span class="name function">attr_name</span><span class="punctuation">(</span><span class="literal string">&quot;current&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="name">event_id</span> <span class="operator">=</span> <span class="name">mydevice</span><span class="operator">-&gt;</span><span class="name">subscribe_event</span><span class="punctuation">(</span><span class="name">attr_name</span><span class="punctuation">,</span>
<span class="ln"> 8 </span>                           <span class="name">Tango</span><span class="operator">::</span><span class="name">CHANGE_EVENT</span><span class="punctuation">,</span>
<span class="ln"> 9 </span>                           <span class="name">double_callback</span><span class="punctuation">);</span>
<span class="ln">10 </span>  <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;event_client() id = &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">event_id</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">11 </span>
<span class="ln">12 </span>  <span class="comment single">// The callback methods are executed by the Tango event reception thread.
</span><span class="ln">13 </span><span class="comment single"></span>  <span class="comment single">// The main thread is not concerned of event reception.
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="comment single">// Whatch out with synchronisation and data access in a multi threaded environment!
</span><span class="ln">15 </span><span class="comment single"></span>
<span class="ln">16 </span>  <span class="name">sleep</span><span class="punctuation">(</span><span class="literal number integer">1000</span><span class="punctuation">);</span> <span class="comment single">// wait for events
</span><span class="ln">17 </span><span class="comment single"></span>
<span class="ln">18 </span>  <span class="name">mydevice</span><span class="operator">-&gt;</span><span class="name">unsubscribe_event</span><span class="punctuation">(</span><span class="name">event_id</span><span class="punctuation">);</span>
</pre>
<p><strong>Pull model</strong>:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DoubleEventCallBack</span> <span class="operator">*</span><span class="name">double_callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">DoubleEventCallBack</span><span class="punctuation">;</span>
<span class="ln"> 2 </span>  <span class="keyword type">int</span> <span class="name">event_queue_size</span> <span class="operator">=</span> <span class="literal number integer">100</span><span class="punctuation">;</span> <span class="comment single">// keep the last 100 events
</span><span class="ln"> 3 </span><span class="comment single"></span>
<span class="ln"> 4 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceProxy</span> <span class="operator">*</span><span class="name">mydevice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceProxy</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/1&quot;</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="keyword type">int</span> <span class="name">event_id</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>  <span class="keyword">const</span> <span class="name">string</span> <span class="name function">attr_name</span><span class="punctuation">(</span><span class="literal string">&quot;current&quot;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>  <span class="name">event_id</span> <span class="operator">=</span> <span class="name">mydevice</span><span class="operator">-&gt;</span><span class="name">subscribe_event</span><span class="punctuation">(</span><span class="name">attr_name</span><span class="punctuation">,</span>
<span class="ln"> 9 </span>                           <span class="name">Tango</span><span class="operator">::</span><span class="name">CHANGE_EVENT</span><span class="punctuation">,</span>
<span class="ln">10 </span>                           <span class="name">event_queue_size</span><span class="punctuation">);</span>
<span class="ln">11 </span>  <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;event_client() id = &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">event_id</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">12 </span>
<span class="ln">13 </span>  <span class="comment single">// Check every 3 seconds whether new events have arrived and trigger the callback method
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="comment single">// for the new events.
</span><span class="ln">15 </span><span class="comment single"></span>
<span class="ln">16 </span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">i</span> <span class="operator">&lt;</span> <span class="literal number integer">100</span><span class="punctuation">;</span> <span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">17 </span>  <span class="punctuation">{</span>
<span class="ln">18 </span>      <span class="name">sleep</span> <span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln">19 </span>
<span class="ln">20 </span>      <span class="comment single">// Read the stored event data from the queue and call the callback method for every event.
</span><span class="ln">21 </span><span class="comment single"></span>      <span class="name">mydevice</span><span class="operator">-&gt;</span><span class="name">get_events</span><span class="punctuation">(</span><span class="name">event_id</span><span class="punctuation">,</span> <span class="name">double_callback</span><span class="punctuation">);</span>
<span class="ln">22 </span>  <span class="punctuation">}</span>
<span class="ln">23 </span>
<span class="ln">24 </span>  <span class="name">event_test</span><span class="operator">-&gt;</span><span class="name">unsubscribe_event</span><span class="punctuation">(</span><span class="name">event_id</span><span class="punctuation">);</span>
</pre>
</div>
</div>
</div>
</div>
<div class="section" id="group">
<h2><a class="toc-backref" href="#id189">Group</a></h2>
<p>A Tango Group provides the user with a single point of control for a
collection of devices. By analogy, one could see a Tango Group as a
proxy for a collection of devices. For instance, the Tango Group API
supplies a <em>command_inout()</em> method to execute the same command on all
the elements of a group.</p>
<p>A Tango Group is also a hierarchical object. In other words, it is
possible to build a group of both groups and individual devices. This
feature allows creating logical views of the control system - each view
representing a hierarchical family of devices or a sub-system.</p>
<p>In this chapter, we will use the term <em>hierarchy</em> to refer to a group
and its sub-groups. The term <em>Group</em> designates to the local set of
devices attached to a specific Group.</p>
<div class="section" id="getting-started-with-tango-group">
<h3><a class="toc-backref" href="#id190">Getting started with Tango group</a></h3>
<p>The quickest way of getting started is to study an example…</p>
<p>Imagine we are vacuum engineers who need to monitor and control hundreds
of gauges distributed over the 16 cells of a large-scale instrument.
Each cell contains several penning and pirani gauges. It also contains
one strange gauge. Our main requirement is to be able to control the
whole set of gauges, a family of gauges located into a particular cell
(e.g. all the penning gauges of the 6th cell) or a single gauge (e.g.
the strange gauge of the 7th cell). Using a Tango Group, such features
are quite straightforward to obtain.</p>
<p>Reading the description of the problem, the device hierarchy becomes
obvious. Our gauges group will have the following structure:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="operator">-&gt;</span> <span class="name">gauges</span>
<span class="ln"> 2 </span>    <span class="operator">|</span>  <span class="operator">-&gt;</span> <span class="name">cell</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln"> 3 </span>    <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">strange</span>
<span class="ln"> 4 </span>    <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">penning</span>
<span class="ln"> 5 </span>    <span class="operator">|</span>     <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln"> 6 </span>    <span class="operator">|</span>     <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="literal number oct">02</span>
<span class="ln"> 7 </span>    <span class="operator">|</span>     <span class="operator">|</span>   <span class="operator">|-</span> <span class="punctuation">...</span>
<span class="ln"> 8 </span>    <span class="operator">|</span>     <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="name">xx</span>
<span class="ln"> 9 </span>    <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">pirani</span>
<span class="ln">10 </span>    <span class="operator">|</span>         <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">pirani</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln">11 </span>    <span class="operator">|</span>         <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln">12 </span>    <span class="operator">|</span>         <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">pirani</span><span class="operator">-</span><span class="name">xx</span>
<span class="ln">13 </span>    <span class="operator">|</span>  <span class="operator">-&gt;</span> <span class="name">cell</span><span class="operator">-</span><span class="literal number oct">02</span>
<span class="ln">14 </span>    <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c02</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">strange</span>
<span class="ln">15 </span>    <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">penning</span>
<span class="ln">16 </span>    <span class="operator">|</span>     <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c02</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln">17 </span>    <span class="operator">|</span>     <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln">18 </span>    <span class="operator">|</span>     <span class="operator">|</span>
<span class="ln">19 </span>    <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">pirani</span>
<span class="ln">20 </span>    <span class="operator">|</span>     <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln">21 </span>    <span class="operator">|</span>  <span class="operator">-&gt;</span> <span class="name">cell</span><span class="operator">-</span><span class="literal number oct">03</span>
<span class="ln">22 </span>    <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln">23 </span>    <span class="operator">|</span>         <span class="operator">|</span> <span class="operator">-&gt;</span> <span class="punctuation">...</span>
</pre>
<p>In the C++, such a hierarchy can be build as follows (basic version):</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- step0: create the root group
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span> <span class="operator">*</span><span class="name">gauges</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span><span class="punctuation">(</span><span class="literal string">&quot;gauges&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>  <span class="comment single">//- step1: create a group for the n-th cell
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span> <span class="operator">*</span><span class="name">cell</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span><span class="punctuation">(</span><span class="literal string">&quot;cell-01&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="comment single">//- step2: make the cell a sub-group of the root group
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="name">cell</span><span class="punctuation">);</span>
<span class="ln">11 </span>
<span class="ln">12 </span>
<span class="ln">13 </span>  <span class="comment single">//- step3: create a &quot;penning&quot; group
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span> <span class="operator">*</span><span class="name">gauge_family</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span><span class="punctuation">(</span><span class="literal string">&quot;penning&quot;</span><span class="punctuation">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>
<span class="ln">17 </span>  <span class="comment single">//- step4: add all penning gauges located into the cell (note the wildcard)
</span><span class="ln">18 </span><span class="comment single"></span>  <span class="name">gauge_family</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;inst-c01/vac-gauge/penning*&quot;</span><span class="punctuation">);</span>
<span class="ln">19 </span>
<span class="ln">20 </span>
<span class="ln">21 </span>  <span class="comment single">//- step5: add the penning gauges to the cell
</span><span class="ln">22 </span><span class="comment single"></span>  <span class="name">cell</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="name">gauge_family</span><span class="punctuation">);</span>
<span class="ln">23 </span>
<span class="ln">24 </span>
<span class="ln">25 </span>  <span class="comment single">//- step6: create a &quot;pirani&quot; group
</span><span class="ln">26 </span><span class="comment single"></span>  <span class="name">gauge_family</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span><span class="punctuation">(</span><span class="literal string">&quot;pirani&quot;</span><span class="punctuation">);</span>
<span class="ln">27 </span>
<span class="ln">28 </span>
<span class="ln">29 </span>  <span class="comment single">//- step7: add all pirani gauges located into the cell (note the wildcard)
</span><span class="ln">30 </span><span class="comment single"></span>  <span class="name">gauge_family</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;inst-c01/vac-gauge/pirani*&quot;</span><span class="punctuation">);</span>
<span class="ln">31 </span>
<span class="ln">32 </span>
<span class="ln">33 </span>  <span class="comment single">//- step8: add the pirani gauges to the cell
</span><span class="ln">34 </span><span class="comment single"></span>  <span class="name">cell</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="name">gauge_family</span><span class="punctuation">);</span>
<span class="ln">35 </span>
<span class="ln">36 </span>
<span class="ln">37 </span>  <span class="comment single">//- step9: add the &quot;strange&quot; gauge to the cell
</span><span class="ln">38 </span><span class="comment single"></span>  <span class="name">cell</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;inst-c01/vac-gauge/strange&quot;</span><span class="punctuation">);</span>
<span class="ln">39 </span>
<span class="ln">40 </span>
<span class="ln">41 </span>  <span class="comment single">//- repeat step 1 to 9 for the remaining cells
</span><span class="ln">42 </span><span class="comment single"></span>  <span class="name">cell</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span><span class="punctuation">(</span><span class="literal string">&quot;cell-02&quot;</span><span class="punctuation">);</span>
<span class="ln">43 </span>  <span class="punctuation">...</span>
</pre>
<p><strong>Important note</strong>: There is no particular order to create the
hierarchy. However, the insertion order of the devices is conserved
throughout the lifecycle of the Group and cannot be changed. That way,
the Group implementation can guarantee the order in which results are
returned (see below).</p>
<p>Keeping a reference to the root group is enough to manage the whole
hierarchy (i.e. there no need to keep trace of the sub-groups or
individual devices). The Group interface provides methods to retrieve a
sub-group or an individual device.</p>
<p>Be aware that a C++ group allways gets the ownership of its children and
deletes them when it is itself deleted. Therefore, never try to delete a
Group (respectively a DeviceProxy) returned by a call to
<em>Tango::Group::get_group()</em> (respectively to
<em>Tango::Group::get_device()</em>). Use the <em>Tango::Group::remove()</em> method
instead (see the Tango Group class API documentation for details).</p>
<p>We can now perform any action on any element of our gauges group. For
instance, let’s ping the whole hierarchy to be sure that all devices are
alive.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- ping the whole hierarchy
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">ping</span><span class="punctuation">()</span> <span class="operator">==</span> <span class="name builtin">true</span><span class="punctuation">)</span>
<span class="ln"> 3 </span>  <span class="punctuation">{</span>
<span class="ln"> 4 </span>      <span class="name">std</span><span class="operator">::</span><span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;all devices alive&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">std</span><span class="operator">::</span><span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>  <span class="punctuation">}</span>
<span class="ln"> 6 </span>  <span class="keyword">else</span>
<span class="ln"> 7 </span>  <span class="punctuation">{</span>
<span class="ln"> 8 </span>      <span class="name">std</span><span class="operator">::</span><span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;at least one dead/busy/locked/... device&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">std</span><span class="operator">::</span><span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
</pre>
</div>
<div class="section" id="forward-or-not-forward">
<h3><a class="toc-backref" href="#id191">Forward or not forward?</a></h3>
<p>Since a Tango Group is a hierarchical object, any action performed on a
group can be forwarded to its sub-groups. Most of the methods in the
Group interface have a so-called <em>forward</em> option controlling this
propagation. When set to <em>false</em>, the action is only performed on the
local set of devices. Otherwise, the action is also forwarded to the
sub-groups, in other words, propagated along the hierarchy. In C++ , the
forward option defaults to true (thanks to the C++ default argument
value). There is no such mechanism in Java and the forward option must
be systematically specified.</p>
</div>
<div class="section" id="executing-a-command">
<h3><a class="toc-backref" href="#id192">Executing a command</a></h3>
<p>As a proxy for a collection of devices, the Tango Group provides an
interface similar to the DeviceProxy’s. For the execution of a command,
the Group interface contains several implementations of the
<em>command_inout</em> method. Both synchronous and asynchronous forms are
supported.</p>
<div class="section" id="obtaining-command-results">
<h4>Obtaining command results</h4>
<p>Command results are returned using a Tango::GroupCmdReplyList. This is
nothing but a vector containing a Tango::GroupCmdReply for each device
in the group. The Tango::GroupCmdReply contains the actual data (i.e.
the Tango::DeviceData). By inheritance, it may also contain any error
occurred during the execution of the command (in which case the data is
invalid).</p>
<p>We previously indicated that the Tango Group implementation guarantees
that the command results are returned in the order in which its elements
were attached to the group. For instance, if g1 is a group containing
three devices attached in the following order:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/01&quot;</span><span class="punctuation">);</span>
<span class="ln">2 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/03&quot;</span><span class="punctuation">);</span>
<span class="ln">3 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/02&quot;</span><span class="punctuation">);</span>
</pre>
<p>the results of</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupCmdReplyList</span> <span class="name">crl</span> <span class="operator">=</span> <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;Status&quot;</span><span class="punctuation">);</span>
</pre>
<p>will be organized as follows:</p>
<div class="line-block">
<div class="line"><em>crl[0]</em> contains the status of my/device/01</div>
<div class="line"><em>crl[1]</em> contains the status of my/device/03</div>
<div class="line"><em>crl[2]</em> contains the status of my/device/02</div>
</div>
<p>Things get more complicated if sub-groups are added between devices.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">g2</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/04&quot;</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>  <span class="name">g2</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/05&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>  <span class="name">g4</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/08&quot;</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>  <span class="name">g4</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/09&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="name">g3</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/06&quot;</span><span class="punctuation">);</span>
<span class="ln">10 </span>  <span class="name">g3</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="name">g4</span><span class="punctuation">);</span>
<span class="ln">11 </span>  <span class="name">g3</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/07&quot;</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>
<span class="ln">14 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/01&quot;</span><span class="punctuation">);</span>
<span class="ln">15 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="name">g2</span><span class="punctuation">);</span>
<span class="ln">16 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/03&quot;</span><span class="punctuation">);</span>
<span class="ln">17 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="name">g3</span><span class="punctuation">);</span>
<span class="ln">18 </span>  <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;my/device/02&quot;</span><span class="punctuation">);</span>
</pre>
<p>The result order in the Tango::GroupCmdReplyList depends on the value of
the forward option. If set to <em>true</em>, the results will be organized as
follows:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupCmdReplyList</span> <span class="name">crl</span> <span class="operator">=</span> <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;Status&quot;</span><span class="punctuation">,</span> <span class="name builtin">true</span><span class="punctuation">);</span>
</pre>
<div class="line-block">
<div class="line"><em>crl[0]</em> contains the status of my/device/01 which belongs to g1</div>
<div class="line"><em>crl[1]</em> contains the status of my/device/04 which belongs to g1.g2</div>
<div class="line"><em>crl[2]</em> contains the status of my/device/05 which belongs to g1.g2</div>
<div class="line"><em>crl[3]</em> contains the status of my/device/03 which belongs to g1</div>
<div class="line"><em>crl[4]</em> contains the status of my/device/06 which belongs to g1.g3</div>
<div class="line"><em>crl[5]</em> contains the status of my/device/08 which belongs to g1.g3.g4</div>
<div class="line"><em>crl[6]</em> contains the status of my/device/09 which belongs to g1.g3.g</div>
<div class="line"><em>crl[7]</em> contains the status of my/device/07 which belongs to g1.g3</div>
<div class="line"><em>crl[8]</em> contains the status of my/device/02 which belongs to g1</div>
</div>
<p>If the forward option is set to <em>false</em>, the results are:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupCmdReplyList</span> <span class="name">crl</span> <span class="operator">=</span> <span class="name">g1</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;Status&quot;</span><span class="punctuation">,</span> <span class="name builtin">false</span><span class="punctuation">);</span>
</pre>
<div class="line-block">
<div class="line"><em>crl[0]</em> contains the status of my/device/01 which belongs to g</div>
<div class="line"><em>crl[1]</em> contains the status of my/device/03 which belongs to g1</div>
<div class="line"><em>crl[2]</em> contains the status of my/device/02 which belongs to g1</div>
</div>
<p>The Tango::GroupCmdReply contains some public members allowing the
identification of both the device (Tango::GroupCmdReply::dev_name) and
the command (Tango::GroupCmdReply::obj_name). It means that, depending
of your application, you can associate a response with its source using
its position in the response list or using the
Tango::GroupCmdReply::dev_name member.</p>
</div>
<div class="section" id="case-1-a-command-no-argument">
<h4>Case 1: a command, no argument</h4>
<p>As an example, we execute the Status command on the whole hierarchy
synchronously.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupCmdReplyList</span> <span class="name">crl</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;Status&quot;</span><span class="punctuation">);</span>
</pre>
<p>As a first step in the results processing, it could be interesting to
check value returned by the <em>has_failed()</em> method of the
GroupCmdReplyList. If it is set to true, it means that at least one
error occurred during the execution of the command (i.e. at least one
device gave error).</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">crl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">())</span>
<span class="ln">2 </span>  <span class="punctuation">{</span>
<span class="ln">3 </span>      <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;at least one error occurred&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">4 </span>  <span class="punctuation">}</span>
<span class="ln">5 </span>  <span class="keyword">else</span>
<span class="ln">6 </span>  <span class="punctuation">{</span>
<span class="ln">7 </span>      <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;no error &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">8 </span>  <span class="punctuation">}</span>
</pre>
<p>Now, we have to process each individual response in the list.</p>
</div>
<div class="section" id="a-few-words-on-error-handling-and-data-extraction">
<h4>A few words on error handling and data extraction</h4>
<p>Depending of the application and/or the developer’s programming habits,
each individual error can be handle by the C++ (or Java) exception
mechanism or using the dedicated <em>has_failed()</em> method. The GroupReply
class - which is the mother class of both GroupCmdReply and
GroupAttrReply - contains a static method to enable (or disable)
exceptions called <em>enable_exception()</em>. By default, exceptions are
disabled. The following example is proposed with both exceptions enable
and disable.</p>
<p>In C++, data can be extracted directly from an individual reply. The
GroupCmdReply interface contains a template operator &gt;&gt; allowing the
extraction of any supported Tango type (in fact the actual data
extraction is delegated to DeviceData::operator &gt;&gt;). One dedicated
extract method is also provided in order to extract
DevVarLongStringArray and DevVarDoubleStringArray types to std::vectors.</p>
<p>Error and data handling C++ example:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//-------------------------------------------------------
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="comment single">//- synch. group command example with exception enabled
</span><span class="ln"> 3 </span><span class="comment single"></span>  <span class="comment single">//-------------------------------------------------------
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="comment single">//- enable exceptions and save current mode
</span><span class="ln"> 5 </span><span class="comment single"></span>  <span class="keyword type">bool</span> <span class="name">last_mode</span> <span class="operator">=</span> <span class="name">GroupReply</span><span class="operator">::</span><span class="name">enable_exception</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>  <span class="comment single">//- process each response in the list ...
</span><span class="ln"> 7 </span><span class="comment single"></span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">r</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">r</span> <span class="operator">&lt;</span> <span class="name">crl</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">r</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>  <span class="punctuation">{</span>
<span class="ln"> 9 </span>  <span class="comment single">//- enter a try/catch block
</span><span class="ln">10 </span><span class="comment single"></span>     <span class="name">try</span>
<span class="ln">11 </span>     <span class="punctuation">{</span>
<span class="ln">12 </span>  <span class="comment single">//- try to extract the data from the r-th reply
</span><span class="ln">13 </span><span class="comment single"></span>  <span class="comment single">//- suppose data contains a double
</span><span class="ln">14 </span><span class="comment single"></span>         <span class="keyword type">double</span> <span class="name">ans</span><span class="punctuation">;</span>
<span class="ln">15 </span>         <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">]</span> <span class="operator">&gt;&gt;</span> <span class="name">ans</span><span class="punctuation">;</span>
<span class="ln">16 </span>         <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">dev_name</span><span class="punctuation">()</span>
<span class="ln">17 </span>              <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;::&quot;</span>
<span class="ln">18 </span>              <span class="operator">&lt;&lt;</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">obj_name</span><span class="punctuation">()</span>
<span class="ln">19 </span>              <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; returned &quot;</span>
<span class="ln">20 </span>              <span class="operator">&lt;&lt;</span> <span class="name">ans</span>
<span class="ln">21 </span>              <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">22 </span>      <span class="punctuation">}</span>
<span class="ln">23 </span>      <span class="keyword">catch</span> <span class="punctuation">(</span><span class="keyword">const</span> <span class="name">DevFailed</span><span class="operator">&amp;</span> <span class="name">df</span><span class="punctuation">)</span>
<span class="ln">24 </span>      <span class="punctuation">{</span>
<span class="ln">25 </span>  <span class="comment single">//- DevFailed caught while trying to extract the data from reply
</span><span class="ln">26 </span><span class="comment single"></span>        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">err</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">err</span> <span class="operator">&lt;</span> <span class="name">df</span><span class="punctuation">.</span><span class="name">errors</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">();</span> <span class="name">err</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">27 </span>        <span class="punctuation">{</span>
<span class="ln">28 </span>             <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;error: &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">df</span><span class="punctuation">.</span><span class="name">errors</span><span class="punctuation">[</span><span class="name">err</span><span class="punctuation">].</span><span class="name">desc</span><span class="punctuation">.</span><span class="name">in</span><span class="punctuation">()</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">29 </span>        <span class="punctuation">}</span>
<span class="ln">30 </span>  <span class="comment single">//- alternatively, one can use crl[r].get_err_stack() see below
</span><span class="ln">31 </span><span class="comment single"></span>      <span class="punctuation">}</span>
<span class="ln">32 </span>      <span class="keyword">catch</span> <span class="punctuation">(...)</span>
<span class="ln">33 </span>      <span class="punctuation">{</span>
<span class="ln">34 </span>         <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;unknown exception caught&quot;</span><span class="punctuation">;</span>
<span class="ln">35 </span>      <span class="punctuation">}</span>
<span class="ln">36 </span>  <span class="punctuation">}</span>
<span class="ln">37 </span>  <span class="comment single">//- restore last exception mode (if needed)
</span><span class="ln">38 </span><span class="comment single"></span>  <span class="name">GroupReply</span><span class="operator">::</span><span class="name">enable_exception</span><span class="punctuation">(</span><span class="name">last_mode</span><span class="punctuation">);</span>
<span class="ln">39 </span>  <span class="comment single">//- Clear the response list (if reused later in the code)
</span><span class="ln">40 </span><span class="comment single"></span>  <span class="name">crl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
<span class="ln">41 </span>
<span class="ln">42 </span>
<span class="ln">43 </span>  <span class="comment single">//-------------------------------------------------------
</span><span class="ln">44 </span><span class="comment single"></span>  <span class="comment single">//- synch. group command example with exception disabled
</span><span class="ln">45 </span><span class="comment single"></span>  <span class="comment single">//-------------------------------------------------------
</span><span class="ln">46 </span><span class="comment single"></span>  <span class="comment single">//- disable exceptions and save current mode bool
</span><span class="ln">47 </span><span class="comment single"></span>  <span class="name">last_mode</span> <span class="operator">=</span> <span class="name">GroupReply</span><span class="operator">::</span><span class="name">enable_exception</span><span class="punctuation">(</span><span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln">48 </span>  <span class="comment single">//- process each response in the list ...
</span><span class="ln">49 </span><span class="comment single"></span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">r</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">r</span> <span class="operator">&lt;</span> <span class="name">crl</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">r</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">50 </span>  <span class="punctuation">{</span>
<span class="ln">51 </span>  <span class="comment single">//- did the r-th device give error?
</span><span class="ln">52 </span><span class="comment single"></span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">has_failed</span><span class="punctuation">()</span> <span class="operator">==</span> <span class="name builtin">true</span><span class="punctuation">)</span>
<span class="ln">53 </span>      <span class="punctuation">{</span>
<span class="ln">54 </span>  <span class="comment single">//- printout error description
</span><span class="ln">55 </span><span class="comment single"></span>         <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;an error occurred while executing &quot;</span>
<span class="ln">56 </span>              <span class="operator">&lt;&lt;</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">obj_name</span><span class="punctuation">()</span>
<span class="ln">57 </span>              <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; on &quot;</span>
<span class="ln">58 </span>              <span class="operator">&lt;&lt;</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">dev_name</span><span class="punctuation">()</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">59 </span>  <span class="comment single">//- dump error stack
</span><span class="ln">60 </span><span class="comment single"></span>         <span class="keyword">const</span> <span class="name">DevErrorList</span><span class="operator">&amp;</span> <span class="name">el</span> <span class="operator">=</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">get_err_stack</span><span class="punctuation">();</span>
<span class="ln">61 </span>         <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">err</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">err</span> <span class="operator">&lt;</span> <span class="name">el</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">err</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">62 </span>         <span class="punctuation">{</span>
<span class="ln">63 </span>             <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="name">el</span><span class="punctuation">[</span><span class="name">err</span><span class="punctuation">].</span><span class="name">desc</span><span class="punctuation">.</span><span class="name">in</span><span class="punctuation">();</span>
<span class="ln">64 </span>         <span class="punctuation">}</span>
<span class="ln">65 </span>      <span class="punctuation">}</span>
<span class="ln">66 </span>      <span class="keyword">else</span>
<span class="ln">67 </span>      <span class="punctuation">{</span>
<span class="ln">68 </span>  <span class="comment single">//- no error (suppose data contains a double)
</span><span class="ln">69 </span><span class="comment single"></span>         <span class="keyword type">double</span> <span class="name">ans</span><span class="punctuation">;</span>
<span class="ln">70 </span>         <span class="keyword type">bool</span> <span class="name">result</span> <span class="operator">=</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">]</span> <span class="operator">&gt;&gt;</span> <span class="name">ans</span><span class="punctuation">;</span>
<span class="ln">71 </span>         <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">result</span> <span class="operator">==</span> <span class="name builtin">false</span><span class="punctuation">)</span>
<span class="ln">72 </span>         <span class="punctuation">{</span>
<span class="ln">73 </span>             <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;could not extract double from &quot;</span>
<span class="ln">74 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">dev_name</span><span class="punctuation">()</span>
<span class="ln">75 </span>                  <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; reply&quot;</span>
<span class="ln">76 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">77 </span>         <span class="punctuation">}</span>
<span class="ln">78 </span>         <span class="keyword">else</span>
<span class="ln">79 </span>         <span class="punctuation">{</span>
<span class="ln">80 </span>             <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">dev_name</span><span class="punctuation">()</span>
<span class="ln">81 </span>                  <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;::&quot;</span>
<span class="ln">82 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">crl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">obj_name</span><span class="punctuation">()</span>
<span class="ln">83 </span>                  <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; returned &quot;</span>
<span class="ln">84 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">ans</span>
<span class="ln">85 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">86 </span>         <span class="punctuation">}</span>
<span class="ln">87 </span>      <span class="punctuation">}</span>
<span class="ln">88 </span>  <span class="punctuation">}</span>
<span class="ln">89 </span>  <span class="comment single">//- restore last exception mode (if needed)
</span><span class="ln">90 </span><span class="comment single"></span>  <span class="name">GroupReply</span><span class="operator">::</span><span class="name">enable_exception</span><span class="punctuation">(</span><span class="name">last_mode</span><span class="punctuation">);</span>
<span class="ln">91 </span>  <span class="comment single">//- Clear the response list (if reused later in the code)
</span><span class="ln">92 </span><span class="comment single"></span>  <span class="name">crl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>Now execute the same command asynchronously. C++ example:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//-------------------------------------------------------
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="comment single">//- asynch. group command example (C++ example)
</span><span class="ln"> 3 </span><span class="comment single"></span>  <span class="comment single">//-------------------------------------------------------
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="keyword type">long</span> <span class="name">request_id</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">command_inout_asynch</span><span class="punctuation">(</span><span class="literal string">&quot;Status&quot;</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>  <span class="comment single">//- do some work
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">do_some_work</span><span class="punctuation">();</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="comment single">//- get results
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="name">crl</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">command_inout_reply</span><span class="punctuation">(</span><span class="name">request_id</span><span class="punctuation">);</span>
<span class="ln">11 </span>  <span class="comment single">//- process responses as previously describe in the synch. implementation
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">r</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">r</span> <span class="operator">&lt;</span> <span class="name">crl</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">r</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">13 </span>  <span class="punctuation">{</span>
<span class="ln">14 </span>  <span class="comment single">//- data processing and error handling goes here
</span><span class="ln">15 </span><span class="comment single"></span>  <span class="comment single">//- copy/paste code from previous example
</span><span class="ln">16 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">17 </span>  <span class="punctuation">}</span>
<span class="ln">18 </span>  <span class="comment single">//- clear the response list (if reused later in the code)
</span><span class="ln">19 </span><span class="comment single"></span>  <span class="name">crl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
</div>
<div class="section" id="case-2-a-command-one-argument-sub-case-2">
<h4>Case 2: a command, one argument[sub:Case-2]</h4>
<p>Here, we give an example in which the same input argument is applied to
all devices in the group (or its sub-groups).</p>
<p>In C++:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="comment single">//- the argument value
</span><span class="ln">2 </span><span class="comment single"></span>  <span class="keyword type">double</span> <span class="name">d</span> <span class="operator">=</span> <span class="literal number float">0.1</span><span class="punctuation">;</span>
<span class="ln">3 </span>  <span class="comment single">//- insert it into the TANGO generic container for command: DeviceData
</span><span class="ln">4 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceData</span> <span class="name">dd</span><span class="punctuation">;</span>
<span class="ln">5 </span>  <span class="name">dd</span> <span class="operator">&lt;&lt;</span> <span class="name">d</span><span class="punctuation">;</span>
<span class="ln">6 </span>  <span class="comment single">//- execute the command: Dev_Void SetDummyFactor (Dev_Double)
</span><span class="ln">7 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupCmdReplyList</span> <span class="name">crl</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;SetDummyFactor&quot;</span><span class="punctuation">,</span> <span class="name">dd</span><span class="punctuation">);</span>
</pre>
<p>Since the SetDummyFactor command does not return any value, the
individual replies (i.e. the GroupCmdReply) do not contain any data.
However, we have to check their <em>has_failed()</em> method returned value to
be sure that the command completed successfully on each device
(acknowledgement). Note that in such a case, exceptions are useless
since we never try to extract data from the replies.</p>
<p>In C++ we should have something like:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- no need to process the results if no error occurred (Dev_Void command)
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">crl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">())</span>
<span class="ln"> 3 </span>  <span class="punctuation">{</span>
<span class="ln"> 4 </span>  <span class="comment single">//- at least one error occurred
</span><span class="ln"> 5 </span><span class="comment single"></span>      <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">r</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">r</span> <span class="operator">&lt;</span> <span class="name">crl</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">r</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 6 </span>      <span class="punctuation">{</span>
<span class="ln"> 7 </span>  <span class="comment single">//- handle errors here (see previous C++ examples)
</span><span class="ln"> 8 </span><span class="comment single"></span>      <span class="punctuation">}</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
<span class="ln">10 </span>  <span class="comment single">//- clear the response list (if reused later in the code)
</span><span class="ln">11 </span><span class="comment single"></span>  <span class="name">crl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>See case 1 for an example of asynchronous command.</p>
</div>
<div class="section" id="case-3-a-command-several-arguments">
<h4>Case 3: a command, several arguments</h4>
<p>Here, we give an example in which a <strong>specific</strong> input argument is
applied to each device in the hierarchy. In order to use this form of
command_inout, the user must have an a priori and perfect knowledge of
the devices order in the hierarchy. In such a case, command arguments
are passed in an array (with one entry for each device in the
hierarchy).</p>
<p>The C++ implementation provides a template method which accepts a
std::vector of C++ type for command argument. This allows passing any
kind of data using a single method.</p>
<p>The size of this vector must equal the number of device in the hierarchy
(respectively the number of device in the group) if the forward option
is set to true (respectively set to false). Otherwise, an exception is
thrown.</p>
<p>The first item in the vector is applied to the first device in the
hierarchy, the second to the second device in the hierarchy, and so
on…That’s why the user must have a perfect knowledge of the devices
order in the hierarchy.</p>
<p>Assuming that gauges are ordered by name, the SetDummyFactor command can
be executed on group cell-01 (and its sub-groups) as follows:</p>
<p>Remember, cell-01 has the following internal structure:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="operator">-&gt;</span> <span class="name">gauges</span>
<span class="ln"> 2 </span>     <span class="operator">|</span> <span class="operator">-&gt;</span> <span class="name">cell</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln"> 3 </span>     <span class="operator">|</span>    <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">strange</span>
<span class="ln"> 4 </span>     <span class="operator">|</span>    <span class="operator">|-&gt;</span> <span class="name">penning</span>
<span class="ln"> 5 </span>     <span class="operator">|</span>    <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln"> 6 </span>     <span class="operator">|</span>    <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="literal number oct">02</span>
<span class="ln"> 7 </span>     <span class="operator">|</span>    <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln"> 8 </span>     <span class="operator">|</span>    <span class="operator">|</span>   <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="name">xx</span>
<span class="ln"> 9 </span>     <span class="operator">|</span>    <span class="operator">|-&gt;</span> <span class="name">pirani</span>
<span class="ln">10 </span>     <span class="operator">|</span>        <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">pirani</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln">11 </span>     <span class="operator">|</span>        <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln">12 </span>     <span class="operator">|</span>        <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">pirani</span><span class="operator">-</span><span class="name">xx</span>
</pre>
<p>Passing a specific argument to each device in C++:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- get a reference to the target group
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span> <span class="operator">*</span><span class="name">g</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">get_group</span><span class="punctuation">(</span><span class="literal string">&quot;cell-01&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>  <span class="comment single">//- get number of device in the hierarchy (starting at cell-01)
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="keyword type">long</span> <span class="name">n_dev</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">get_size</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>  <span class="comment single">//- Build argin list
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">std</span><span class="operator">::</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">argins</span><span class="punctuation">(</span><span class="name">n_dev</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="comment single">//- argument for inst-c01/vac-gauge/strange
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">argins</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="comment single">//- argument for inst-c01/vac-gauge/penning-01
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="name">argins</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.1</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="comment single">//- argument for inst-c01/vac-gauge/penning-02
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="name">argins</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.2</span><span class="punctuation">;</span>
<span class="ln">13 </span>  <span class="comment single">//- argument for remaining devices in cell-01.penning
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">15 </span>  <span class="comment single">//- argument for devices in cell-01.pirani
</span><span class="ln">16 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">17 </span>  <span class="comment single">//- the reply list
</span><span class="ln">18 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupCmdReplyList</span> <span class="name">crl</span><span class="punctuation">;</span>
<span class="ln">19 </span>  <span class="comment single">//- enter a try/catch block (see below)
</span><span class="ln">20 </span><span class="comment single"></span>  <span class="name">try</span>
<span class="ln">21 </span>  <span class="punctuation">{</span>
<span class="ln">22 </span>  <span class="comment single">//- execute the command
</span><span class="ln">23 </span><span class="comment single"></span>      <span class="name">crl</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;SetDummyFactor&quot;</span><span class="punctuation">,</span> <span class="name">argins</span><span class="punctuation">,</span> <span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">24 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">crl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">())</span>
<span class="ln">25 </span>      <span class="punctuation">{</span>
<span class="ln">26 </span>  <span class="comment single">//- error handling goes here (see case 1)
</span><span class="ln">27 </span><span class="comment single"></span>      <span class="punctuation">}</span>
<span class="ln">28 </span>  <span class="punctuation">}</span>
<span class="ln">29 </span>  <span class="keyword">catch</span> <span class="punctuation">(</span><span class="keyword">const</span> <span class="name">DevFailed</span><span class="operator">&amp;</span> <span class="name">df</span><span class="punctuation">)</span>
<span class="ln">30 </span>  <span class="punctuation">{</span>
<span class="ln">31 </span>  <span class="comment single">//- see below
</span><span class="ln">32 </span><span class="comment single"></span>  <span class="punctuation">}</span>
<span class="ln">33 </span>  <span class="name">crl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>If we want to execute the command locally on cell-01 (i.e. not on its
sub-groups), we should write the following C++ code:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- get a reference to the target group
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span> <span class="operator">*</span><span class="name">g</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">get_group</span><span class="punctuation">(</span><span class="literal string">&quot;cell-01&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>  <span class="comment single">//- get number of device in the group (starting at cell-01)
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="keyword type">long</span> <span class="name">n_dev</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">get_size</span><span class="punctuation">(</span><span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>  <span class="comment single">//- Build argin list
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">std</span><span class="operator">::</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">argins</span><span class="punctuation">(</span><span class="name">n_dev</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="comment single">//- argins for inst-c01/vac-gauge/penning-01
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">argins</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.1</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="comment single">//- argins for inst-c01/vac-gauge/penning-02
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="name">argins</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.2</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="comment single">//- argins for remaining devices in cell-01.penning
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">13 </span>  <span class="comment single">//- the reply list
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupCmdReplyList</span> <span class="name">crl</span><span class="punctuation">;</span>
<span class="ln">15 </span>  <span class="comment single">//- enter a try/catch block (see below)
</span><span class="ln">16 </span><span class="comment single"></span>  <span class="name">try</span>
<span class="ln">17 </span>  <span class="punctuation">{</span>
<span class="ln">18 </span>  <span class="comment single">//- execute the command
</span><span class="ln">19 </span><span class="comment single"></span>      <span class="name">crl</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;SetDummyFactor&quot;</span><span class="punctuation">,</span> <span class="name">argins</span><span class="punctuation">,</span> <span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln">20 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">crl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">())</span>
<span class="ln">21 </span>      <span class="punctuation">{</span>
<span class="ln">22 </span>  <span class="comment single">//- error handling goes here (see case 1)
</span><span class="ln">23 </span><span class="comment single"></span>      <span class="punctuation">}</span>
<span class="ln">24 </span>  <span class="punctuation">}</span>
<span class="ln">25 </span>  <span class="keyword">catch</span> <span class="punctuation">(</span><span class="keyword">const</span> <span class="name">DevFailed</span><span class="operator">&amp;</span> <span class="name">df</span><span class="punctuation">)</span>
<span class="ln">26 </span>  <span class="punctuation">{</span>
<span class="ln">27 </span>  <span class="comment single">//- see below
</span><span class="ln">28 </span><span class="comment single"></span>  <span class="punctuation">}</span>
<span class="ln">29 </span>  <span class="name">crl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>Note: if we want to execute the command locally on cell-01 (i.e. not on
its sub-groups), we should write the following code:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- get a reference to the target group
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="name">Group</span> <span class="name">g</span> <span class="operator">=</span> <span class="name">gauges</span><span class="punctuation">.</span><span class="name">get_group</span><span class="punctuation">(</span><span class="literal string">&quot;cell-01&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>  <span class="comment single">//- get pre-build arguments list for the group (starting&#64;cell-01)
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="name">DeviceData</span><span class="punctuation">[]</span> <span class="name">argins</span> <span class="operator">=</span> <span class="name">g</span><span class="punctuation">.</span><span class="name">get_command_specific_argument_list</span><span class="punctuation">(</span><span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>  <span class="comment single">//- argins for inst-c01/vac-gauge/penning-01
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">argins</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">].</span><span class="name">insert</span><span class="punctuation">(</span><span class="literal number float">0.1</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="comment single">//- argins for inst-c01/vac-gauge/penning-02
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">argins</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">].</span><span class="name">insert</span><span class="punctuation">(</span><span class="literal number float">0.2</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>  <span class="comment single">//- argins for remaining devices in cell-01.penning
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">11 </span>  <span class="comment single">//- the reply list
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="name">GroupCmdReplyList</span> <span class="name">crl</span><span class="punctuation">;</span>
<span class="ln">13 </span>  <span class="comment single">//- enter a try/catch block (see below)
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="name">try</span>
<span class="ln">15 </span>  <span class="punctuation">{</span>
<span class="ln">16 </span>  <span class="comment single">//- execute the command
</span><span class="ln">17 </span><span class="comment single"></span>      <span class="name">crl</span> <span class="operator">=</span> <span class="name">g</span><span class="punctuation">.</span><span class="name">command_inout</span><span class="punctuation">(</span><span class="literal string">&quot;SetDummyFactor&quot;</span><span class="punctuation">,</span> <span class="name">argins</span><span class="punctuation">,</span> <span class="name builtin">false</span><span class="punctuation">,</span> <span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln">18 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">crl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">())</span>
<span class="ln">19 </span>      <span class="punctuation">{</span>
<span class="ln">20 </span>  <span class="comment single">//- error handling goes here (see case 1)
</span><span class="ln">21 </span><span class="comment single"></span>      <span class="punctuation">}</span>
<span class="ln">22 </span>  <span class="punctuation">}</span>
<span class="ln">23 </span>  <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">DevFailed</span> <span class="name">d</span><span class="punctuation">)</span>
<span class="ln">24 </span>  <span class="punctuation">{</span>
<span class="ln">25 </span>  <span class="comment single">//- see below
</span><span class="ln">26 </span><span class="comment single"></span>  <span class="punctuation">}</span>
</pre>
<p>This form of <em>command_inout</em> (the one that accepts an array of value as
its input argument), may throw an exception <strong>before</strong> executing the
command if the number of elements in the input array does not match the
number of individual devices in the group or in the hierarchy (depending
on the forward option).</p>
<p>An asynchronous version of this method is also available. See case 1 for
an example of asynchronous command.</p>
</div>
</div>
<div class="section" id="reading-attribute-s-sub-read-attr">
<h3><a class="toc-backref" href="#id193">Reading attribute(s)[sub:Read-attr]</a></h3>
<p>In order to read attribute(s), the Group interface contains several
implementations of the <em>read_attribute()</em> and <em>read_attributes()</em>
methods. Both synchronous and asynchronous forms are supported. Reading
several attributes is very similar to reading a single attribute. Simply
replace the std::string used for attribute name by a vector of
std::string with one element for each attribute name. In case of
read_attributes() call, the order of attribute value returned in the
GroupAttrReplyList is all attributes for first element in the group
followed by all attributes for the second group element and so on.</p>
<div class="section" id="obtaining-attribute-values">
<h4>Obtaining attribute values</h4>
<p>Attribute values are returned using a GroupAttrReplyList. This is
nothing but an array containing a GroupAttrReply for each device in the
group. The GroupAttrReply contains the actual data (i.e. the
DeviceAttribute). By inheritance, it may also contain any error occurred
during the execution of the command (in which case the data is invalid).</p>
<p>Here again, the Tango Group implementation guarantees that the attribute
values are returned in the order in which its elements were attached to
the group. See Obtaining command results for details.</p>
<p>The GroupAttrReply contains some public methods allowing the
identification of both the device (GroupAttrReply::dev_name) and the
attribute (GroupAttrReply::obj_name). It means that, depending of your
application, you can associate a response with its source using its
position in the response list or using the
Tango::GroupAttrReply::dev_name member.</p>
</div>
<div class="section" id="id11">
<h4>A few words on error handling and data extraction</h4>
<p>Here again, depending of the application and/or the developer’s
programming habits, each individual error can be handle by the C++
exception mechanism or using the dedicated <em>has_failed()</em> method. The
GroupReply class - which is the mother class of both GroupCmdReply and
GroupAttrReply - contains a static method to enable (or disable)
exceptions called <em>enable_exception()</em>. By default, exceptions are
disabled. The following example is proposed with both exceptions enable
and disable.</p>
<p>In C++, data can be extracted directly from an individual reply. The
GroupAttrReply interface contains a template operator&gt;&gt; allowing the
extraction of any supported Tango type (in fact the actual data
extraction is delegated to DeviceAttribute::operator&gt;&gt;).</p>
<p>Reading an attribute is very similar to executing a command.</p>
<p>Reading an attribute in C++:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//-----------------------------------------------------------------
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="comment single">//- synch. read &quot;vacuum&quot; attribute on each device in the hierarchy
</span><span class="ln"> 3 </span><span class="comment single"></span>  <span class="comment single">//- with exceptions enabled - C++ example
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="comment single">//-----------------------------------------------------------------
</span><span class="ln"> 5 </span><span class="comment single"></span>  <span class="comment single">//- enable exceptions and save current mode
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="keyword type">bool</span> <span class="name">last_mode</span> <span class="operator">=</span> <span class="name">GroupReply</span><span class="operator">::</span><span class="name">enable_exception</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="comment single">//- read attribute
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupAttrReplyList</span> <span class="name">arl</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">read_attribute</span><span class="punctuation">(</span><span class="literal string">&quot;vacuum&quot;</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>  <span class="comment single">//- for each response in the list ...
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">r</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">r</span> <span class="operator">&lt;</span> <span class="name">arl</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">r</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">11 </span>  <span class="punctuation">{</span>
<span class="ln">12 </span>  <span class="comment single">//- enter a try/catch block
</span><span class="ln">13 </span><span class="comment single"></span>     <span class="name">try</span>
<span class="ln">14 </span>     <span class="punctuation">{</span>
<span class="ln">15 </span>  <span class="comment single">//- try to extract the data from the r-th reply
</span><span class="ln">16 </span><span class="comment single"></span>  <span class="comment single">//- suppose data contains a double
</span><span class="ln">17 </span><span class="comment single"></span>        <span class="keyword type">double</span> <span class="name">ans</span><span class="punctuation">;</span>
<span class="ln">18 </span>        <span class="name">arl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">]</span> <span class="operator">&gt;&gt;</span> <span class="name">ans</span><span class="punctuation">;</span>
<span class="ln">19 </span>        <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="name">arl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">dev_name</span><span class="punctuation">()</span>
<span class="ln">20 </span>             <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;::&quot;</span>
<span class="ln">21 </span>             <span class="operator">&lt;&lt;</span> <span class="name">arl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">obj_name</span><span class="punctuation">()</span>
<span class="ln">22 </span>             <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; value is &quot;</span>
<span class="ln">23 </span>             <span class="operator">&lt;&lt;</span> <span class="name">ans</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">24 </span>     <span class="punctuation">}</span>
<span class="ln">25 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="keyword">const</span> <span class="name">DevFailed</span><span class="operator">&amp;</span> <span class="name">df</span><span class="punctuation">)</span>
<span class="ln">26 </span>     <span class="punctuation">{</span>
<span class="ln">27 </span>  <span class="comment single">//- DevFailed caught while trying to extract the data from reply
</span><span class="ln">28 </span><span class="comment single"></span>        <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">err</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">err</span> <span class="operator">&lt;</span> <span class="name">df</span><span class="punctuation">.</span><span class="name">errors</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">();</span> <span class="name">err</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">29 </span>        <span class="punctuation">{</span>
<span class="ln">30 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;error: &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">df</span><span class="punctuation">.</span><span class="name">errors</span><span class="punctuation">[</span><span class="name">err</span><span class="punctuation">].</span><span class="name">desc</span><span class="punctuation">.</span><span class="name">in</span><span class="punctuation">()</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">31 </span>        <span class="punctuation">}</span>
<span class="ln">32 </span>  <span class="comment single">//- alternatively, one can use arl[r].get_err_stack() see below
</span><span class="ln">33 </span><span class="comment single"></span>     <span class="punctuation">}</span>
<span class="ln">34 </span>     <span class="keyword">catch</span> <span class="punctuation">(...)</span>
<span class="ln">35 </span>     <span class="punctuation">{</span>
<span class="ln">36 </span>        <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;unknown exception caught&quot;</span><span class="punctuation">;</span>
<span class="ln">37 </span>     <span class="punctuation">}</span>
<span class="ln">38 </span>  <span class="punctuation">}</span>
<span class="ln">39 </span>  <span class="comment single">//- restore last exception mode (if needed)
</span><span class="ln">40 </span><span class="comment single"></span>  <span class="name">GroupReply</span><span class="operator">::</span><span class="name">enable_exception</span><span class="punctuation">(</span><span class="name">last_mode</span><span class="punctuation">);</span>
<span class="ln">41 </span>  <span class="comment single">//- clear the reply list (if reused later in the code)
</span><span class="ln">42 </span><span class="comment single"></span>  <span class="name">arl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>In C++, an asynchronous version of the previous example could be:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- read the attribute asynchronously
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="keyword type">long</span> <span class="name">request_id</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">read_attribute_asynch</span><span class="punctuation">(</span><span class="literal string">&quot;vacuum&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>  <span class="comment single">//- do some work
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="name">do_some_work</span><span class="punctuation">();</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>  <span class="comment single">//- get results
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupAttrReplyList</span> <span class="name">arl</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">read_attribute_reply</span><span class="punctuation">(</span><span class="name">request_id</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>  <span class="comment single">//- process replies as previously described in the synch. implementation
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">r</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">r</span> <span class="operator">&lt;</span> <span class="name">arl</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">r</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">11 </span>  <span class="punctuation">{</span>
<span class="ln">12 </span>  <span class="comment single">//- data processing and/or error handling goes here
</span><span class="ln">13 </span><span class="comment single"></span>  <span class="punctuation">...</span>
<span class="ln">14 </span>  <span class="punctuation">}</span>
<span class="ln">15 </span>  <span class="comment single">//- clear the reply list (if reused later in the code)
</span><span class="ln">16 </span><span class="comment single"></span>  <span class="name">arl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
</div>
</div>
<div class="section" id="writing-an-attribute">
<h3><a class="toc-backref" href="#id194">Writing an attribute</a></h3>
<p>The Group interface contains several implementations of the
<em>write_attribute()</em> method. Both synchronous and asynchronous forms are
supported. However, writing more than one attribute at a time is not
supported.</p>
<div class="section" id="obtaining-acknowledgement">
<h4>Obtaining acknowledgement</h4>
<p>Acknowledgements are returned using a GroupReplyList. This is nothing
but an array containing a GroupReply for each device in the group. The
GroupReply may contain any error occurred during the execution of the
command. The return value of the <em>has_failed()</em> method indicates
whether an error occurred or not. If this flag is set to true, the
<em>GroupReply::get_err_stack()</em> method gives error details.</p>
<p>Here again, the Tango Group implementation guarantees that the attribute
values are returned in the order in which its elements were attached to
the group. See Obtaining command results for details.</p>
<p>The GroupReply contains some public members allowing the identification
of both the device (GroupReply::dev_name) and the attribute
(GroupReply::obj_name). It means that, depending of your application,
you can associate a response with its source using its position in the
response list or using the GroupReply::dev_name member.</p>
</div>
<div class="section" id="case-1-one-value-for-all-devices-sub-case-1-writing">
<h4>Case 1: one value for all devices[sub:Case-1-writing]</h4>
<p>Here, we give an example in which the same attribute value is written on
all devices in the group (or its sub-groups). Exceptions are supposed to
be disabled.</p>
<p>Writing an attribute in C++:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//-----------------------------------------------------------------
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="comment single">//- synch. write &quot;dummy&quot; attribute on each device in the hierarchy
</span><span class="ln"> 3 </span><span class="comment single"></span>  <span class="comment single">//-----------------------------------------------------------------
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="comment single">//- assume each device support a &quot;dummy&quot; writable attribute
</span><span class="ln"> 5 </span><span class="comment single"></span>  <span class="comment single">//- insert the value to be written into a generic container
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceAttribute</span> <span class="name">value</span><span class="punctuation">(</span><span class="name">std</span><span class="operator">::</span><span class="name">string</span><span class="punctuation">(</span><span class="literal string">&quot;dummy&quot;</span><span class="punctuation">),</span> <span class="literal number float">3.14159</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="comment single">//- write the attribute
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupReplyList</span> <span class="name">rl</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">write_attribute</span><span class="punctuation">(</span><span class="name">value</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>  <span class="comment single">//- any error?
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">rl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">()</span> <span class="operator">==</span> <span class="name builtin">false</span><span class="punctuation">)</span>
<span class="ln">11 </span>  <span class="punctuation">{</span>
<span class="ln">12 </span>      <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;no error&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">13 </span>  <span class="punctuation">}</span>
<span class="ln">14 </span>  <span class="keyword">else</span>
<span class="ln">15 </span>  <span class="punctuation">{</span>
<span class="ln">16 </span>      <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;at least one error occurred&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">17 </span>  <span class="comment single">//- for each response in the list ...
</span><span class="ln">18 </span><span class="comment single"></span>      <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">r</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">r</span> <span class="operator">&lt;</span> <span class="name">rl</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">r</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">19 </span>      <span class="punctuation">{</span>
<span class="ln">20 </span>  <span class="comment single">//- did the r-th device give error?
</span><span class="ln">21 </span><span class="comment single"></span>         <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">rl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">has_failed</span><span class="punctuation">()</span> <span class="operator">==</span> <span class="name builtin">true</span><span class="punctuation">)</span>
<span class="ln">22 </span>         <span class="punctuation">{</span>
<span class="ln">23 </span>  <span class="comment single">//- printout error description
</span><span class="ln">24 </span><span class="comment single"></span>             <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;an error occurred while reading &quot;</span>
<span class="ln">25 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">rl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">obj_name</span><span class="punctuation">()</span>
<span class="ln">26 </span>                  <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; on &quot;</span>
<span class="ln">27 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">rl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">dev_name</span><span class="punctuation">()</span>
<span class="ln">28 </span>                  <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">29 </span>  <span class="comment single">//- dump error stack
</span><span class="ln">30 </span><span class="comment single"></span>             <span class="keyword">const</span> <span class="name">DevErrorList</span><span class="operator">&amp;</span> <span class="name">el</span> <span class="operator">=</span> <span class="name">rl</span><span class="punctuation">[</span><span class="name">r</span><span class="punctuation">].</span><span class="name">get_err_stack</span><span class="punctuation">();</span>
<span class="ln">31 </span>             <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">err</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">err</span> <span class="operator">&lt;</span> <span class="name">el</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span> <span class="name">err</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">32 </span>             <span class="punctuation">{</span>
<span class="ln">33 </span>                <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="name">el</span><span class="punctuation">[</span><span class="name">err</span><span class="punctuation">].</span><span class="name">desc</span><span class="punctuation">.</span><span class="name">in</span><span class="punctuation">();</span>
<span class="ln">34 </span>             <span class="punctuation">}</span>
<span class="ln">35 </span>          <span class="punctuation">}</span>
<span class="ln">36 </span>       <span class="punctuation">}</span>
<span class="ln">37 </span>  <span class="punctuation">}</span>
<span class="ln">38 </span>  <span class="comment single">//- clear the reply list (if reused later in the code)
</span><span class="ln">39 </span><span class="comment single"></span>  <span class="name">rl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>Here is a C++ asynchronous version:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- insert the value to be written into a generic container
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceAttribute</span> <span class="name">value</span><span class="punctuation">(</span><span class="name">std</span><span class="operator">::</span><span class="name">string</span><span class="punctuation">(</span><span class="literal string">&quot;dummy&quot;</span><span class="punctuation">),</span> <span class="literal number float">3.14159</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>  <span class="comment single">//- write the attribute asynchronously
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="keyword type">long</span> <span class="name">request_id</span> <span class="operator">=</span> <span class="name">gauges</span><span class="punctuation">.</span><span class="name">write_attribute_asynch</span><span class="punctuation">(</span><span class="name">value</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>  <span class="comment single">//- do some work
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">do_some_work</span><span class="punctuation">();</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="comment single">//- get results
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupReplyList</span> <span class="name">rl</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">write_attribute_reply</span><span class="punctuation">(</span><span class="name">request_id</span><span class="punctuation">);</span>
<span class="ln">11 </span>  <span class="comment single">//- process replies as previously describe in the synch. implementation ...</span>
</pre>
</div>
<div class="section" id="case-2-a-specific-value-per-device">
<h4>Case 2: a specific value per device</h4>
<p>Here, we give an example in which a <strong>specific</strong> attribute value is
applied to each device in the hierarchy. In order to use this form of
<em>write_attribute()</em>, the user must have an a priori and perfect
knowledge of the devices order in the hierarchy.</p>
<p>The C++ implementation provides a template method which accepts a
std::vector of C++ type for command argument. This allows passing any
kind of data using a single method.</p>
<p>The size of this vector must equal the number of device in the hierarchy
(respectively the number of device in the group) if the forward option
is set to true (respectively set to false). Otherwise, an exception is
thrown.</p>
<p>The first item in the vector is applied to the first device in the
group, the second to the second device in the group, and so on…That’s
why the user must have a perfect knowledge of the devices order in the
group.</p>
<p>Assuming that gauges are ordered by name, the dummy attribute can be
written as follows on group cell-01 (and its sub-groups) as follows:</p>
<p>Remember, cell-01 has the following internal structure:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="operator">-&gt;</span> <span class="name">gauges</span>
<span class="ln"> 2 </span>      <span class="operator">|</span> <span class="operator">-&gt;</span> <span class="name">cell</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln"> 3 </span>      <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">strange</span>
<span class="ln"> 4 </span>      <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">penning</span>
<span class="ln"> 5 </span>      <span class="operator">|</span>     <span class="operator">|</span>    <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln"> 6 </span>      <span class="operator">|</span>     <span class="operator">|</span>    <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="literal number oct">02</span>
<span class="ln"> 7 </span>      <span class="operator">|</span>     <span class="operator">|</span>    <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln"> 8 </span>      <span class="operator">|</span>     <span class="operator">|</span>    <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">penning</span><span class="operator">-</span><span class="name">xx</span>
<span class="ln"> 9 </span>      <span class="operator">|</span>     <span class="operator">|-&gt;</span> <span class="name">pirani</span>
<span class="ln">10 </span>      <span class="operator">|</span>          <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">pirani</span><span class="operator">-</span><span class="literal number oct">01</span>
<span class="ln">11 </span>      <span class="operator">|</span>          <span class="operator">|-&gt;</span> <span class="punctuation">...</span>
<span class="ln">12 </span>      <span class="operator">|</span>          <span class="operator">|-&gt;</span> <span class="name">inst</span><span class="operator">-</span><span class="name">c01</span><span class="operator">/</span><span class="name">vac</span><span class="operator">-</span><span class="name">gauge</span><span class="operator">/</span><span class="name">pirani</span><span class="operator">-</span><span class="name">xx</span>
</pre>
<p>C++ version:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- get a reference to the target group
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span> <span class="operator">*</span><span class="name">g</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">get_group</span><span class="punctuation">(</span><span class="literal string">&quot;cell-01&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>  <span class="comment single">//- get number of device in the hierarchy (starting at cell-01)
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="keyword type">long</span> <span class="name">n_dev</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">get_size</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>  <span class="comment single">//- Build value list
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">std</span><span class="operator">::</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">values</span><span class="punctuation">(</span><span class="name">n_dev</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="comment single">//- value for inst-c01/vac-gauge/strange
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">values</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">3.14159</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="comment single">//- value for inst-c01/vac-gauge/penning-01
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="name">values</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number float">3.14159</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="comment single">//- value for inst-c01/vac-gauge/penning-02
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="name">values</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">3</span> <span class="operator">*</span> <span class="literal number float">3.14159</span><span class="punctuation">;</span>
<span class="ln">13 </span>  <span class="comment single">//- value for remaining devices in cell-01.penning
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">15 </span>  <span class="comment single">//- value for devices in cell-01.pirani
</span><span class="ln">16 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">17 </span>  <span class="comment single">//- the reply list
</span><span class="ln">18 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupReplyList</span> <span class="name">rl</span><span class="punctuation">;</span>
<span class="ln">19 </span>  <span class="comment single">//- enter a try/catch block (see below)
</span><span class="ln">20 </span><span class="comment single"></span>  <span class="name">try</span>
<span class="ln">21 </span>  <span class="punctuation">{</span>
<span class="ln">22 </span>  <span class="comment single">//- write the &quot;dummy&quot; attribute
</span><span class="ln">23 </span><span class="comment single"></span>      <span class="name">rl</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">write_attribute</span><span class="punctuation">(</span><span class="literal string">&quot;dummy&quot;</span><span class="punctuation">,</span> <span class="name">values</span><span class="punctuation">,</span> <span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">24 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">rl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">())</span>
<span class="ln">25 </span>      <span class="punctuation">{</span>
<span class="ln">26 </span>  <span class="comment single">//- error handling (see previous cases)
</span><span class="ln">27 </span><span class="comment single"></span>      <span class="punctuation">}</span>
<span class="ln">28 </span>  <span class="punctuation">}</span>
<span class="ln">29 </span>  <span class="keyword">catch</span> <span class="punctuation">(</span><span class="keyword">const</span> <span class="name">DevFailed</span><span class="operator">&amp;</span> <span class="name">df</span><span class="punctuation">)</span>
<span class="ln">30 </span>  <span class="punctuation">{</span>
<span class="ln">31 </span>  <span class="comment single">//- see below
</span><span class="ln">32 </span><span class="comment single"></span>  <span class="punctuation">}</span>
<span class="ln">33 </span>  <span class="name">rl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>Note: if we want to execute the command locally on cell-01 (i.e. not on
its sub-groups), we should write the following code</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">//- get a reference to the target group
</span><span class="ln"> 2 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Group</span> <span class="operator">*</span><span class="name">g</span> <span class="operator">=</span> <span class="name">gauges</span><span class="operator">-&gt;</span><span class="name">get_group</span><span class="punctuation">(</span><span class="literal string">&quot;cell-01&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>  <span class="comment single">//- get number of device in the group
</span><span class="ln"> 4 </span><span class="comment single"></span>  <span class="keyword type">long</span> <span class="name">n_dev</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">get_size</span><span class="punctuation">(</span><span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>  <span class="comment single">//- Build value list
</span><span class="ln"> 6 </span><span class="comment single"></span>  <span class="name">std</span><span class="operator">::</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">values</span><span class="punctuation">(</span><span class="name">n_dev</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>  <span class="comment single">//- value for inst-c01/vac-gauge/penning-01
</span><span class="ln"> 8 </span><span class="comment single"></span>  <span class="name">values</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number float">3.14159</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="comment single">//- value for inst-c01/vac-gauge/penning-02
</span><span class="ln">10 </span><span class="comment single"></span>  <span class="name">values</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">3</span> <span class="operator">*</span> <span class="literal number float">3.14159</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="comment single">//- value for remaining devices in cell-01.penning
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="punctuation">.</span> <span class="punctuation">.</span> <span class="punctuation">.</span>
<span class="ln">13 </span>  <span class="comment single">//- the reply list
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">GroupReplyList</span> <span class="name">rl</span><span class="punctuation">;</span>
<span class="ln">15 </span>  <span class="comment single">//- enter a try/catch block (see below)
</span><span class="ln">16 </span><span class="comment single"></span>  <span class="name">try</span>
<span class="ln">17 </span>  <span class="punctuation">{</span>
<span class="ln">18 </span>  <span class="comment single">//- write the &quot;dummy&quot; attribute
</span><span class="ln">19 </span><span class="comment single"></span>     <span class="name">rl</span> <span class="operator">=</span> <span class="name">g</span><span class="operator">-&gt;</span><span class="name">write_attribute</span><span class="punctuation">(</span><span class="literal string">&quot;dummy&quot;</span><span class="punctuation">,</span> <span class="name">values</span><span class="punctuation">,</span> <span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln">20 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">rl</span><span class="punctuation">.</span><span class="name">has_failed</span><span class="punctuation">())</span>
<span class="ln">21 </span>     <span class="punctuation">{</span>
<span class="ln">22 </span>  <span class="comment single">//- error handling (see previous cases)
</span><span class="ln">23 </span><span class="comment single"></span>     <span class="punctuation">}</span>
<span class="ln">24 </span>  <span class="punctuation">}</span>
<span class="ln">25 </span>  <span class="keyword">catch</span> <span class="punctuation">(</span><span class="keyword">const</span> <span class="name">DevFailed</span><span class="operator">&amp;</span> <span class="name">df</span><span class="punctuation">)</span>
<span class="ln">26 </span>  <span class="punctuation">{</span>
<span class="ln">27 </span>  <span class="comment single">//- see below
</span><span class="ln">28 </span><span class="comment single"></span>  <span class="punctuation">}</span>
<span class="ln">29 </span>  <span class="name">rl</span><span class="punctuation">.</span><span class="name">reset</span><span class="punctuation">();</span>
</pre>
<p>This form of <em>write_attribute()</em> (the one that accepts an array of
value as its input argument), may throw an exception before executing
the command if the number of elements in the input array does not match
the number of individual devices in the group or in the hierarchy
(depending on the forward option).</p>
<p>An asynchronous version of this method is also available.</p>
</div>
</div>
</div>
<div class="section" id="reading-writing-device-pipe">
<h2><a class="toc-backref" href="#id195">Reading/Writing device pipe</a></h2>
<p>Reading or writing device pipe is made possible using DeviceProxy class
methods. To read a pipe, you have to use the method <strong>read_pipe()</strong>. To
write a pipe, use the <strong>write_pipe()</strong> method. A method
<strong>write_read_pipe()</strong> is also provided in case you need to write then
read a pipe in a non-interuptible way. All these calls generate
synchronous request and support only reading or writing a single pipe at
a time. Those pipe related DeviceProxy class methods (read_pipe,
write_pipe,...) use DevicePipe class instances. A DevicePipe instance
is nothing more than a string for the pipe name and a <em>DevicePipeBlob</em>
instance called the root blob. In a DevicePipeBlob instance, you have:</p>
<ul class="simple">
<li>The blob name</li>
<li>One array of <em>DataElement.</em> Each instance of this DataElement class
has:<ul>
<li>A name</li>
<li>A value which can be either<ul>
<li>Scalar or array of any basic Tango type</li>
<li>Another DevicePipeBlob</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Therefore, this is a recursive data structure and you may have
DevicePipeBlob in DevicePipeBlob. There is no limit on the depth of this
recursivity even if it is not recommended to have a too large depth. The
following figure summarizes DevicePipe data structure</p>
<div class="figure">
<img alt="DevicePipe data structure" src="gen_api/pipe" style="width: 14.00000cm; height: 8.00000cm;" />
<p class="caption">DevicePipe data structure</p>
</div>
<p>Many methods to insert/extract data into/from a DevicePipe are
available. In the DevicePipe class, these methods simply forward their
action to the DevicePipe root blob. The same methods are available in
the DevicePipeBlob in case you need to use the recursivity provided by
this data structure.</p>
<div class="section" id="reading-a-pipe">
<h3><a class="toc-backref" href="#id196">Reading a pipe</a></h3>
<p>When you read a pipe, you have to extract data received from the pipe.
Because data transferred through a pipe can change at any moment, two
differents cases are possible:</p>
<ol class="arabic simple">
<li>The client has a prior knowledge of what should be transferred
through the pipe</li>
<li>The client does not know at all what has been received through the
pipe</li>
</ol>
<p>Those two cases are detailed in the following sub-chapters.</p>
<div class="section" id="extracting-data-with-pipe-content-prior-knowledge">
<h4>Extracting data with pipe content prior knowledge</h4>
<p>To extract data from a DevicePipe object (or from a DevicePipeBlob
object), you have to use its extraction operator &gt;&gt;. Let’s suppose that
we already know (prior knowledge) that the pipe contains 3 data elements
with a Tango long, an array of double and finally an array of unsigned
short. The code you need to extract these data is (Without error case
treatment detailed in a next sub-chapter)</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="name">DevicePipe</span> <span class="name">dp</span> <span class="operator">=</span> <span class="name">mydev</span><span class="punctuation">.</span><span class="name">read_pipe</span><span class="punctuation">(</span><span class="literal string">&quot;MyPipe&quot;</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span> <span class="name">DevLong</span> <span class="name">dl</span><span class="punctuation">;</span>
<span class="ln"> 4 </span> <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">v_db</span><span class="punctuation">;</span>
<span class="ln"> 5 </span> <span class="name">DevVarUShortArray</span> <span class="operator">*</span><span class="name">dvush</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">DevVarUShortArray</span><span class="punctuation">();</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span> <span class="name">dp</span> <span class="operator">&gt;&gt;</span> <span class="name">dl</span> <span class="operator">&gt;&gt;</span> <span class="name">v_db</span> <span class="operator">&gt;&gt;</span> <span class="name">dvush</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span> <span class="keyword">delete</span> <span class="name">dvush</span><span class="punctuation">;</span>
</pre>
<p>The pipe is read at line 1. Pipe (or root blob) data extracttion is at
line 7. As you can see, it is just a matter of chaining extraction
operator (&gt;&gt;) into local data (declared line 3 to 5). In this example,
the transported array of double is extracted into a C++ vector while the
unsigned short array is extracted in a Tango sequence data type. When
you extract data into a vector, there is a unavoidable memory copy
between the DevicePipe object and the vector. When you extract data in a
Tango sequence data type, there is no memory copy but the extraction
method consumes the memory and it is therefore caller responsability to
delete the memory. This is the rule of line 9. If there is a
DevicePipeBlob inside the DevicePipe, simply extract it into one
instance of the DevicePipeBlob class.</p>
<p>You may notice that the pipe root blob data elements name are lost in
the previous example. The Tango API also has a DataElement class which
allows you to retrieve/set data element name. The following code is how
you can extract pipe data and retrieve data element name (same pipe then
previously)</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="name">DevicePipe</span> <span class="name">dp</span> <span class="operator">=</span> <span class="name">mydev</span><span class="punctuation">.</span><span class="name">read_pipe</span><span class="punctuation">(</span><span class="literal string">&quot;MyPipe&quot;</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span> <span class="name">DataElement</span><span class="operator">&lt;</span><span class="name">DevLong</span><span class="operator">&gt;</span> <span class="name">de_dl</span><span class="punctuation">;</span>
<span class="ln"> 4 </span> <span class="name">DataElement</span><span class="operator">&lt;</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="operator">&gt;</span> <span class="name">de_v_db</span><span class="punctuation">;</span>
<span class="ln"> 5 </span> <span class="name">DataElement</span><span class="operator">&lt;</span><span class="name">DevVarUShortArray</span> <span class="operator">*&gt;</span> <span class="name">de_dvush</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">DevVarUShortArray</span><span class="punctuation">());</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span> <span class="name">dp</span> <span class="operator">&gt;&gt;</span> <span class="name">de_dl</span> <span class="operator">&gt;&gt;</span> <span class="name">de_v_db</span> <span class="operator">&gt;&gt;</span> <span class="name">de_dvush</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span> <span class="keyword">delete</span> <span class="name">de_dvush</span><span class="punctuation">.</span><span class="name">value</span><span class="punctuation">;</span>
</pre>
<p>The extraction line (number 7) is similar to the previous case but local
data are instances of DataElement class. This is template class and
instances are created at lines 4 to 6. Each DataElement instance has
only two elements which are:</p>
<ol class="arabic simple">
<li>The data element name (a C++ string): <em>name</em></li>
<li>The data element value (One instance of the template parameter):
<em>value</em></li>
</ol>
</div>
<div class="section" id="extracting-data-in-a-generic-way-without-prior-knowledge">
<h4>Extracting data in a generic way (without prior knowledge)</h4>
<p>Due to the dynamicity of the data transferred through a pipe, the API
alows to extract data from a pipe without any prior knowledge of its
content. This is achived with methods <em>get_data_elt_nb()</em>,
<em>get_data_elt_type()</em>, <em>get_data_elt_name()</em> and the extraction
operator &gt;&gt;. These methods belong to the DevicePipeBlob class but they
also exist on the DevicePipe class for its root blob. Here is one
example of how you use them:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DevicePipe</span> <span class="name">dp</span> <span class="operator">=</span> <span class="name">mydev</span><span class="punctuation">.</span><span class="name">read_pipe</span><span class="punctuation">(</span><span class="literal string">&quot;MyPipe&quot;</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="keyword type">size_t</span> <span class="name">nb_de</span> <span class="operator">=</span> <span class="name">dp</span><span class="punctuation">.</span><span class="name">get_data_elt_nb</span><span class="punctuation">();</span>
<span class="ln"> 4 </span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">size_t</span> <span class="name">loop</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">loop</span> <span class="operator">&lt;</span> <span class="name">nb</span><span class="punctuation">;</span><span class="name">loop</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>     <span class="keyword type">int</span> <span class="name">data_type</span> <span class="operator">=</span> <span class="name">dp</span><span class="punctuation">.</span><span class="name">get_data_elt_type</span><span class="punctuation">(</span><span class="name">loop</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>     <span class="name">string</span> <span class="name">de_name</span> <span class="operator">=</span> <span class="name">dp</span><span class="punctuation">.</span><span class="name">get_data_elt_name</span><span class="punctuation">(</span><span class="name">loop</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>     <span class="keyword">switch</span><span class="punctuation">(</span><span class="name">data_type</span><span class="punctuation">)</span>
<span class="ln"> 9 </span>     <span class="punctuation">{</span>
<span class="ln">10 </span>        <span class="keyword">case</span> <span class="name label">DEV_LONG</span><span class="punctuation">:</span>
<span class="ln">11 </span>        <span class="punctuation">{</span>
<span class="ln">12 </span>            <span class="name">DevLong</span> <span class="name">lg</span><span class="punctuation">;</span>
<span class="ln">13 </span>            <span class="name">dp</span> <span class="operator">&gt;&gt;</span> <span class="name">lg</span><span class="punctuation">;</span>
<span class="ln">14 </span>        <span class="punctuation">}</span>
<span class="ln">15 </span>        <span class="keyword">break</span><span class="punctuation">;</span>
<span class="ln">16 </span>
<span class="ln">17 </span>        <span class="keyword">case</span> <span class="name label">DEVVAR_DOUBLEARRAY</span><span class="punctuation">:</span>
<span class="ln">18 </span>        <span class="punctuation">{</span>
<span class="ln">19 </span>            <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">v_db</span><span class="punctuation">;</span>
<span class="ln">20 </span>            <span class="name">dp</span> <span class="operator">&gt;&gt;</span> <span class="name">v_db</span><span class="punctuation">;</span>
<span class="ln">21 </span>        <span class="punctuation">}</span>
<span class="ln">22 </span>        <span class="keyword">break</span><span class="punctuation">;</span>
<span class="ln">23 </span>        <span class="punctuation">....</span>
<span class="ln">24 </span>    <span class="punctuation">}</span>
<span class="ln">25 </span>    <span class="punctuation">...</span>
<span class="ln">26 </span> <span class="punctuation">}</span>
</pre>
<p>The number of data element in the pipe root blob is retrieve at line 3.
Then a loop for each data element is coded. For each data element, its
value data type and its name are retrieved at lines 6 and 7. Then,
according to the data element value data type, the data are extracted
using the classical extraction operator (lines 13 or 20)</p>
</div>
<div class="section" id="error-management">
<h4>Error management</h4>
<p>By default, in case of error, the DevicePipe object throws different
kind of exceptions according to the error kind. It is possible to
disable exception throwing. If you do so, the code has to test the
DevicePipe state after extraction. The possible error cases are:</p>
<ul class="simple">
<li>DevicePipe object is empty</li>
<li>Wrong data type for extraction (For instance extraction into a double
data while the DataElement contains a string)</li>
<li>Wrong number of DataElement (Extraction code extract 5 data element
while the pipe contains only four)</li>
<li>Mix of extraction (or insertion) method kind (classical operators &lt;&lt;
or &gt;&gt;) and [] operator.</li>
</ul>
<p>Methods <em>exceptions()</em> and <em>reset_exceptions()</em> of the DevicePipe and
DevicePipeBlob classes allow the user to select which kind of error he
is interested in. For error treatment without exceptions, methods
<em>has_failed()</em> and <em>state()</em> has to be used. See reference
documentation for details about these methods.</p>
</div>
</div>
<div class="section" id="writing-a-pipe">
<h3><a class="toc-backref" href="#id197">Writing a pipe</a></h3>
<p>Writing data into a DevicePipe or a DevicePipeBlob is similar to reading
data from a pipe. The main method is the insertion operator &lt;&lt;. Let’s
have a look at a first example if you want to write a pipe with a Tango
long, a vector of double and finally an array of unsigned short.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DevicePipe</span> <span class="name function">dp</span><span class="punctuation">(</span><span class="literal string">&quot;MyPipe&quot;</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">de_names</span> <span class="punctuation">{</span><span class="literal string">&quot;FirstDE&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;SecondDE&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;ThirdDE&quot;</span><span class="punctuation">};</span>
<span class="ln"> 4 </span>  <span class="name">db</span><span class="punctuation">.</span><span class="name">set_data_elt_names</span><span class="punctuation">(</span><span class="name">de_names</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="name">DevLong</span> <span class="name">dl</span> <span class="operator">=</span> <span class="literal number integer">666</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>  <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">v_db</span> <span class="punctuation">{</span><span class="literal number float">1.11</span><span class="punctuation">,</span><span class="literal number float">2.22</span><span class="punctuation">};</span>
<span class="ln"> 8 </span>  <span class="keyword type">unsigned</span> <span class="keyword type">short</span> <span class="operator">*</span><span class="name">array</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword type">unsigned</span> <span class="keyword type">short</span> <span class="punctuation">[</span><span class="literal number integer">100</span><span class="punctuation">];</span>
<span class="ln"> 9 </span>  <span class="name">DevVarUShortArray</span> <span class="operator">*</span><span class="name">dvush</span> <span class="operator">=</span> <span class="name">create_DevVarUShortArray</span><span class="punctuation">(</span><span class="name">array</span><span class="punctuation">,</span><span class="literal number integer">100</span><span class="punctuation">);</span>
<span class="ln">10 </span>
<span class="ln">11 </span> <span class="name">try</span>
<span class="ln">12 </span> <span class="punctuation">{</span>
<span class="ln">13 </span>    <span class="name">dp</span> <span class="operator">&lt;&lt;</span> <span class="name">dl</span> <span class="operator">&lt;&lt;</span> <span class="name">v_db</span> <span class="operator">&lt;&lt;</span> <span class="name">dvush</span><span class="punctuation">;</span>
<span class="ln">14 </span>    <span class="name">mydev</span><span class="punctuation">.</span><span class="name">write_pipe</span><span class="punctuation">(</span><span class="name">dp</span><span class="punctuation">);</span>
<span class="ln">15 </span> <span class="punctuation">}</span>
<span class="ln">16 </span> <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">DevFailed</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">17 </span> <span class="punctuation">{</span>
<span class="ln">18 </span>    <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DevicePipeBlob insertion failed&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">19 </span>    <span class="punctuation">....</span>
<span class="ln">20 </span> <span class="punctuation">}</span>
</pre>
<p>Insertion into the DevicePipe is done at line 12 with the insert
operators. The main difference with extracting data from the pipe is at
line 3 and 4. When inserting data into a pipe, you need to FIRST define
its number od name of data elements. In our example, the device pipe is
initialized to carry three data element and the names of these data
elements is defined at line 4. This is a mandatory requirement. If you
don’t define data element number, exception will be thrown during the
use of insertion methods. The population of the array used for the third
pipe data element is not represented here.</p>
<p>It’s also possible to use DataElement class instances to set the pipe
data element. Here is the previous example modified to use DataElement
class.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DevicePipe</span> <span class="name function">dp</span><span class="punctuation">(</span><span class="literal string">&quot;MyPipe&quot;</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="name">DataElement</span><span class="operator">&lt;</span><span class="name">DevLong</span><span class="operator">&gt;</span> <span class="name">de_dl</span><span class="punctuation">(</span><span class="literal string">&quot;FirstElt&quot;</span><span class="punctuation">,</span><span class="literal number integer">666</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>  <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span>  <span class="name">v_db</span> <span class="punctuation">{</span><span class="literal number float">1.11</span><span class="punctuation">,</span><span class="literal number float">2.22</span><span class="punctuation">};</span>
<span class="ln"> 5 </span>  <span class="name">DataElement</span><span class="operator">&lt;</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="operator">&gt;</span> <span class="name">de_v_db</span><span class="punctuation">(</span><span class="literal string">&quot;SecondElt,v_db);</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>  <span class="keyword type">unsigned</span> <span class="keyword type">short</span> <span class="operator">*</span><span class="name">array</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword type">unsigned</span> <span class="keyword type">short</span> <span class="punctuation">[</span><span class="literal number integer">100</span><span class="punctuation">];</span>
<span class="ln"> 8 </span>  <span class="name">DevVarUShortArray</span> <span class="operator">*</span><span class="name">dvush</span> <span class="operator">=</span> <span class="name">create_DevVarUShortArray</span><span class="punctuation">(</span><span class="name">array</span><span class="punctuation">,</span><span class="literal number integer">100</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>  <span class="name">DataElement</span><span class="operator">&lt;</span><span class="name">DevVarUShortArray</span> <span class="operator">*&gt;</span> <span class="name">de_dvush</span><span class="punctuation">(</span><span class="literal string">&quot;ThirdDE&quot;</span><span class="punctuation">,</span><span class="name">array</span><span class="punctuation">);</span>
<span class="ln">10 </span>
<span class="ln">11 </span> <span class="name">try</span>
<span class="ln">12 </span> <span class="punctuation">{</span>
<span class="ln">13 </span>    <span class="name">dp</span> <span class="operator">&lt;&lt;</span> <span class="name">de_dl</span> <span class="operator">&lt;&lt;</span> <span class="name">de_v_db</span> <span class="operator">&lt;&lt;</span> <span class="name">de_dvush</span><span class="punctuation">;</span>
<span class="ln">14 </span>    <span class="name">mydev</span><span class="punctuation">.</span><span class="name">write_pipe</span><span class="punctuation">(</span><span class="name">dp</span><span class="punctuation">);</span>
<span class="ln">15 </span> <span class="punctuation">}</span>
<span class="ln">16 </span> <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">DevFailed</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">17 </span> <span class="punctuation">{</span>
<span class="ln">18 </span>    <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DevicePipeBlob insertion failed&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">19 </span>    <span class="punctuation">....</span>
<span class="ln">20 </span> <span class="punctuation">}</span>
</pre>
<p>The population of the array used for the third pipe data element is not
represented here. Finally, there is a third way to insert data into a
device pipe. You have to defined number and names of the data element
within the pipe (similar to first insertion method) but you are able to
insert data into the data element in any order using the operator
overwritten for the DevicePipe and DevicePipeBlob classes. Look at the
following example:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DevicePipe</span> <span class="name function">dp</span><span class="punctuation">(</span><span class="literal string">&quot;MyPipe&quot;</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">de_names</span> <span class="punctuation">{</span><span class="literal string">&quot;FirstDE&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;SecondDE&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;ThirdDE&quot;</span><span class="punctuation">};</span>
<span class="ln"> 4 </span>  <span class="name">db</span><span class="punctuation">.</span><span class="name">set_data_elt_names</span><span class="punctuation">(</span><span class="name">de_names</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="name">DevLong</span> <span class="name">dl</span> <span class="operator">=</span> <span class="literal number integer">666</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>  <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">v_db</span> <span class="operator">=</span> <span class="punctuation">{</span><span class="literal number float">1.11</span><span class="punctuation">,</span><span class="literal number float">2.22</span><span class="punctuation">};</span>
<span class="ln"> 8 </span>  <span class="keyword type">unsigned</span> <span class="keyword type">short</span> <span class="operator">*</span><span class="name">array</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword type">unsigned</span> <span class="keyword type">short</span> <span class="punctuation">[</span><span class="literal number integer">100</span><span class="punctuation">];</span>
<span class="ln"> 9 </span>  <span class="name">DevVarUShortArray</span> <span class="operator">*</span><span class="name">dvush</span> <span class="operator">=</span> <span class="name">create_DevVarUShortArray</span><span class="punctuation">(</span><span class="name">array</span><span class="punctuation">,</span><span class="literal number integer">100</span><span class="punctuation">);</span>
<span class="ln">10 </span>
<span class="ln">11 </span> <span class="name">dp</span><span class="punctuation">[</span><span class="literal string">&quot;SecondDE&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;&lt;</span> <span class="name">v_db</span><span class="punctuation">;</span>
<span class="ln">12 </span> <span class="name">dp</span><span class="punctuation">[</span><span class="literal string">&quot;FirstDE&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;&lt;</span> <span class="name">dl</span><span class="punctuation">;</span>
<span class="ln">13 </span> <span class="name">dp</span><span class="punctuation">[</span><span class="literal string">&quot;ThirdDE&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;&lt;</span> <span class="name">dvush</span><span class="punctuation">;</span>
</pre>
<p>Insertion into the device pipe is now done at lines 11 to 13. The
population of the array used for the third pipe data element is not
represented here. Note that the data element name is case insensitive.</p>
<div class="section" id="id12">
<h4>Error management</h4>
<p>When inserting data into a DevicePipe or a DevicePipeBlob, error
management is very similar to reading data from from a DevicePipe or a
DevicePipeBlob. The difference is that there is one moer case which
could trigger one exception during the insertion. This case is</p>
<ul class="simple">
<li>Insertion into the DevicePipe (or DevicePipeBlob) if its data element
number have not been set.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="device-locking">
<h2><a class="toc-backref" href="#id198">Device locking</a></h2>
<p>Starting with Tango release 7 (and device inheriting from
Device_4Impl), device locking is supported. For instance, this feature
could be used by an application doing a scan on a synchrotron beam line.
In such a case, you want to move an actuator then read a sensor, move
the actuator again, read the sensor...You don’t want the actuator to be
moved by another client while the application is doing the scan. If the
application doing the scan locks the actuator device, it will be sure
that this device is reserved for the application doing the scan and
other client will not be able to move it until the scan application
un-locks this actuator.</p>
<p>A locked device is protected against:</p>
<ul class="simple">
<li><em>command_inout</em> call except for device state and status requested
via command and for the set of commands defined as allowed following
the definition of allowed command in the Tango control access schema.</li>
<li><em>write_attribute</em> and <em>write_pipe</em> call</li>
<li><em>write_read_attribute, write_read_attributes</em> and
<em>write_read_pipe</em> call</li>
<li><em>set_attribute_config</em> and <em>set_pipe_config</em> call</li>
<li>polling and logging commands related to the locked device</li>
</ul>
<p>Other clients trying to do one of these calls on a locked device will
get a DevFailed exception. In case of application with locked device
crashed, the lock will be automatically release after a defined
interval. The API provides a set of methods for application code to
lock/unlock device. These methods are:</p>
<ul class="simple">
<li><em>DeviceProxy::lock()</em> and <em>DeviceProxy::unlock()</em> to lock/unlock
device</li>
<li><em>DeviceProxy::locking_status()</em>, <em>DeviceProxy::is_locked()</em>,
<em>DeviceProxy::is_locked_by_me()</em> and <em>DeviceProxy::get_locker()</em>
to get locking information</li>
</ul>
<p>These methods are precisely described in the API reference chapters.</p>
</div>
<div class="section" id="reconnection-and-exception">
<h2><a class="toc-backref" href="#id199">Reconnection and exception</a></h2>
<p>The Tango API automatically manages re-connection between client and
server in case of communication error during a network access between a
client and a server. By default, when a communication error occurs, an
exception is returned to the caller and the connection is internally
marked as bad. On the next try to contact the device, the API will try
to re-build the network connection. With the
<em>set_transparency_reconnection()</em> method of the DeviceProxy class, it
is even possible not to have any exception thrown in case of
communication error. The API will try to re-build the network connection
as soon as it is detected as bad. This is the default mode. See
[sec:Reconnection-and-exception] for more details on this subject.</p>
</div>
<div class="section" id="thread-safety">
<h2><a class="toc-backref" href="#id200">Thread safety</a></h2>
<p>Starting with Tango 7.2, some classes of the C++ API has been made
thread safe. These classes are:</p>
<ul class="simple">
<li>DeviceProxy</li>
<li>Database</li>
<li>Group</li>
<li>ApiUtil</li>
<li>AttributeProxy</li>
</ul>
<p>This means that it is possible to share between threads a pointer to a
DeviceProxy instance. It is safe to execute a call on this DeviceProxy
instance while another thread is also doing a call to the same
DeviceProxy instance. Obviously, this also means that it is possible to
create thread local DeviceProxy instances and to execute method calls on
these instances. Nevertheless, data local to a DeviceProxy instance like
its timeout are not managed on a per thread basis. For a DeviceProxy
instance shared between two threads, if thread 1 changes the instance
timeout, thread 2 will also see this change.</p>
</div>
<div class="section" id="compiling-and-linking-a-tango-client">
<h2><a class="toc-backref" href="#id201">Compiling and linking a Tango client</a></h2>
<p>Compiling and linking a Tango client is similar to compiling and linking
a Tango device server. Please, refer to chapter Compiling, Linking and
executing a Tango device server process ([sec:Compiling,-linking-and])
to get all the details.</p>
<p>[ThreeRicardo]|image|</p>
</div>
</div>
<div class="section" id="tangoatk-programmers-guide">
<h1><a class="toc-backref" href="#id202">TangoATK Programmer’s Guide</a></h1>
<p>This chapter is only a brief Tango ATK (Application ToolKit)
programmer’s guide. You can find a reference guide with a full
description of TangoATK classes and methods in the ATK JavaDoc
.</p>
<p>A tutorial document  is also provided
and includes the detailed description of the ATK architecture and the
ATK components. In the ATK Tutorial  you
can find some code examples and also Flash Demos which explain how to
start using Tango ATK.</p>
<div class="section" id="id13">
<h2><a class="toc-backref" href="#id203">Introduction</a></h2>
<p>This document describes how to develop applications using the Tango
Application Toolkit, TangoATK for short. It will start with a brief
description of the main concepts behind the toolkit, and then continue
with more practical, real-life examples to explain key parts.</p>
<div class="section" id="assumptions">
<h3><a class="toc-backref" href="#id204">Assumptions</a></h3>
<p>The author assumes that the reader has a good knowledge of the Java
programming language, and a thorough understanding of object-oriented
programming. Also, it is expected that the reader is fluent in all
aspects regarding Tango devices, attributes, and commands.</p>
</div>
</div>
<div class="section" id="the-key-concepts-of-tangoatk">
<h2><a class="toc-backref" href="#id205">The key concepts of TangoATK</a></h2>
<p>TangoATK was developed with these goals in mind</p>
<ul class="simple">
<li>TangoATK should help minimize development time</li>
<li>TangoATK should help minimize bugs in applications</li>
<li>TangoATK should support applications that contain attributes and
commands from several different devices.</li>
<li>TangoATK should help avoid code duplication.</li>
</ul>
<p>Since most Tango-applications were foreseen to be displayed on some sort
of graphic terminal, TangoATK needed to provide support for some sort of
graphic building blocks. To enable this, and since the toolkit was to be
written in Java, we looked to Swing to figure out how to do this.</p>
<p>Swing is developed using a variant over a design-pattern the
Model-View-Controller (MVC) pattern called <em>model-delegate</em>, where the
view and the controller of the MVC-pattern are merged into one object.</p>
<div class="line-block">
<div class="line"><img alt="image" src="dance/AT97-65-size" /></div>
</div>
<p>This pattern made the choice of labor division quite easy: all
non-graphic parts of TangoATK reside in the packages beneath
<tt class="docutils literal">fr.esrf.tangoatk.core</tt>, and anything remotely graphic are located
beneath <tt class="docutils literal">fr.esrf.tangoatk.widge</tt>t. More on the content and
organization of this will follow.</p>
<p>The communication between the non-graphic and graphic objects are done
by having the graphic object registering itself as a listener to the
non-graphic object, and the non-graphic object emmiting events telling
the listeners that its state has changed.</p>
<div class="section" id="minimize-development-time">
<h3><a class="toc-backref" href="#id206">Minimize development time</a></h3>
<p>For TangoATK to help minimize the development time of graphic
applications, the toolkit has been developed along two lines of thought</p>
<ul class="simple">
<li>Things that are needed in most applications are included, eg
<tt class="docutils literal">Splash</tt>, a splash window which gives a graphical way for the
application to show the progress of a long operation. The splash
window is moslty used in the startup phase of the application.</li>
<li>Building blocks provided by TangoATK should be easy to use and follow
certain patterns, eg every graphic widget has a <tt class="docutils literal">setModel</tt> method
which is used to connect the widget with its non-graphic model.</li>
</ul>
<p>In addition to this, TangoATK provides a framework for error handling,
something that is often a time consuming task.</p>
</div>
<div class="section" id="minimize-bugs-in-applications">
<h3><a class="toc-backref" href="#id207">Minimize bugs in applications</a></h3>
<p>Together with the Tango API, TangoATK takes care of most of the hard
things related to programming with Tango. Using TangoATK the developer
can focus on developing her application, not on understanding Tango.</p>
</div>
<div class="section" id="attributes-and-commands-from-different-devices">
<h3><a class="toc-backref" href="#id208">Attributes and commands from different devices</a></h3>
<p>To be able to create applications with attributes and commands from
different devices, it was decided that the central objects of TangoATK
were not to be the device, but rather the <em>attributes and the commands</em>.
This will certainly feel a bit awkward at first, but trust me, the
design holds.</p>
<p>For this design to be feasible, a structure was needed to keep track of
the commands and attributes, so the <em>command-list and the
attribute-list</em> was introduced. These two objects can hold commands and
attributes from any number of devices.</p>
</div>
<div class="section" id="avoid-code-duplication">
<h3><a class="toc-backref" href="#id209">Avoid code duplication</a></h3>
<p>When writing applications for a control-system without a framework much
code is duplicated. Anything from simple widgets for showing numeric
values to error handling has to be implemented each time. TangoATK
supplies a number of frequently used widgets along with a framework for
connecting these widgets with their non-graphic counterparts. Because of
this, the developer only needs to write the <em>glue</em> - the code which
connects these objects in a manner that suits the specified application.</p>
</div>
</div>
<div class="section" id="the-real-getting-started">
<h2><a class="toc-backref" href="#id210">The real getting started</a></h2>
<p>Generally there are two kinds of end-user applications: Applications
that only know how to treat one device, and applications that treat many
devices.</p>
<div class="section" id="single-device-applications">
<h3><a class="toc-backref" href="#id211">Single device applications</a></h3>
<p>Single device applications are quite easy to write, even with a gui. The
following steps are required</p>
<ol class="arabic simple">
<li>Instantiate an AttributeList and fill it with the attributes you
want.</li>
<li>Instantiate a CommandList and fill it with the commands you want.</li>
<li>Connect the whole <em>AttributeList</em> with a <em>list viewer</em> and / or each
<em>individual attribute</em> with an <em>attribute viewer</em>.</li>
<li>Connect the whole <em>CommandList</em> to a <em>command list viewer</em> and / or
connect each <em>individual command</em> in the command list with a <em>command
viewer</em>.</li>
</ol>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>The following program (FirstApplication) shows an implementation of the
list mentioned above. It should be rather self-explanatory with the
comments.</p>
<pre class="code cpp literal-block">
<span class="ln">  1 </span>  <span class="name">package</span> <span class="name">examples</span><span class="punctuation">;</span>
<span class="ln">  2 </span>
<span class="ln">  3 </span>
<span class="ln">  4 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JFrame</span><span class="punctuation">;</span>
<span class="ln">  5 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenuItem</span><span class="punctuation">;</span>
<span class="ln">  6 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenuBar</span><span class="punctuation">;</span>
<span class="ln">  7 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenu</span><span class="punctuation">;</span>
<span class="ln">  8 </span>
<span class="ln">  9 </span>
<span class="ln"> 10 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">;</span>
<span class="ln"> 11 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionEvent</span><span class="punctuation">;</span>
<span class="ln"> 12 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">BorderLayout</span><span class="punctuation">;</span>
<span class="ln"> 13 </span>
<span class="ln"> 14 </span>
<span class="ln"> 15 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">AttributeList</span><span class="punctuation">;</span>
<span class="ln"> 16 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">ConnectionException</span><span class="punctuation">;</span>
<span class="ln"> 17 </span>
<span class="ln"> 18 </span>
<span class="ln"> 19 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">CommandList</span><span class="punctuation">;</span>
<span class="ln"> 20 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="name">ErrorHistory</span><span class="punctuation">;</span>
<span class="ln"> 21 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="name">ATKGraphicsUtils</span><span class="punctuation">;</span>
<span class="ln"> 22 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">attribute</span><span class="punctuation">.</span><span class="name">ScalarListViewer</span><span class="punctuation">;</span>
<span class="ln"> 23 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">command</span><span class="punctuation">.</span><span class="name">CommandComboViewer</span><span class="punctuation">;</span>
<span class="ln"> 24 </span>
<span class="ln"> 25 </span>
<span class="ln"> 26 </span>  <span class="keyword">public</span> <span class="keyword">class</span> <span class="name class">FirstApplication</span> <span class="name">extends</span> <span class="name">JFrame</span>
<span class="ln"> 27 </span>  <span class="punctuation">{</span>
<span class="ln"> 28 </span>  <span class="name">JMenuBar</span> <span class="name">menu</span><span class="punctuation">;</span>                    <span class="comment single">// So that our application looks
</span><span class="ln"> 29 </span><span class="comment single"></span>                                    <span class="comment single">// halfway decent.
</span><span class="ln"> 30 </span><span class="comment single"></span>  <span class="name">AttributeList</span> <span class="name">attributes</span><span class="punctuation">;</span>         <span class="comment single">// The list that will contain our
</span><span class="ln"> 31 </span><span class="comment single"></span>                                    <span class="comment single">// attributes
</span><span class="ln"> 32 </span><span class="comment single"></span>  <span class="name">CommandList</span> <span class="name">commands</span><span class="punctuation">;</span>             <span class="comment single">// The list that will contain our
</span><span class="ln"> 33 </span><span class="comment single"></span>                                    <span class="comment single">// commands
</span><span class="ln"> 34 </span><span class="comment single"></span>  <span class="name">ErrorHistory</span> <span class="name">errorHistory</span><span class="punctuation">;</span>        <span class="comment single">// A window that displays errors
</span><span class="ln"> 35 </span><span class="comment single"></span>  <span class="name">ScalarListViewer</span> <span class="name">sListViewer</span><span class="punctuation">;</span>     <span class="comment single">// A viewer which knows how to
</span><span class="ln"> 36 </span><span class="comment single"></span>                                    <span class="comment single">// display a list of scalar attributes.
</span><span class="ln"> 37 </span><span class="comment single"></span>                                    <span class="comment single">// If you want to display other types
</span><span class="ln"> 38 </span><span class="comment single"></span>                                    <span class="comment single">// than scalars, you'll have to wait
</span><span class="ln"> 39 </span><span class="comment single"></span>                                    <span class="comment single">// for the next example.
</span><span class="ln"> 40 </span><span class="comment single"></span>  <span class="name">CommandComboViewer</span> <span class="name">commandViewer</span><span class="punctuation">;</span> <span class="comment single">// A viewer which knows how to display
</span><span class="ln"> 41 </span><span class="comment single"></span>                                    <span class="comment single">// a combobox of commands and execute
</span><span class="ln"> 42 </span><span class="comment single"></span>                                    <span class="comment single">// them.
</span><span class="ln"> 43 </span><span class="comment single"></span>  <span class="name">String</span> <span class="name">device</span><span class="punctuation">;</span>                    <span class="comment single">// The name of our device.
</span><span class="ln"> 44 </span><span class="comment single"></span>
<span class="ln"> 45 </span>
<span class="ln"> 46 </span>  <span class="keyword">public</span> <span class="name function">FirstApplication</span><span class="punctuation">()</span>
<span class="ln"> 47 </span>  <span class="punctuation">{</span>
<span class="ln"> 48 </span>     <span class="comment single">// The swing stuff to create the menu bar and its pulldown menus
</span><span class="ln"> 49 </span><span class="comment single"></span>     <span class="name">menu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuBar</span><span class="punctuation">();</span>
<span class="ln"> 50 </span>     <span class="name">JMenu</span> <span class="name">fileMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="punctuation">();</span>
<span class="ln"> 51 </span>     <span class="name">fileMenu</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;File&quot;</span><span class="punctuation">);</span>
<span class="ln"> 52 </span>     <span class="name">JMenu</span> <span class="name">viewMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="punctuation">();</span>
<span class="ln"> 53 </span>     <span class="name">viewMenu</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;View&quot;</span><span class="punctuation">);</span>
<span class="ln"> 54 </span>
<span class="ln"> 55 </span>     <span class="name">JMenuItem</span> <span class="name">quitItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="punctuation">();</span>
<span class="ln"> 56 </span>     <span class="name">quitItem</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;Quit&quot;</span><span class="punctuation">);</span>
<span class="ln"> 57 </span>     <span class="name">quitItem</span><span class="punctuation">.</span><span class="name">addActionListener</span><span class="punctuation">(</span><span class="keyword">new</span>
<span class="ln"> 58 </span>        <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">()</span>
<span class="ln"> 59 </span>        <span class="punctuation">{</span>
<span class="ln"> 60 </span>         <span class="keyword">public</span> <span class="keyword type">void</span>
<span class="ln"> 61 </span>         <span class="name">actionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln"> 62 </span>         <span class="punctuation">{</span><span class="name">quitItemActionPerformed</span><span class="punctuation">(</span><span class="name">evt</span><span class="punctuation">);}</span>
<span class="ln"> 63 </span>        <span class="punctuation">});</span>
<span class="ln"> 64 </span>     <span class="name">fileMenu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">quitItem</span><span class="punctuation">);</span>
<span class="ln"> 65 </span>
<span class="ln"> 66 </span>     <span class="name">JMenuItem</span> <span class="name">errorHistItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="punctuation">();</span>
<span class="ln"> 67 </span>     <span class="name">errorHistItem</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;Error History&quot;</span><span class="punctuation">);</span>
<span class="ln"> 68 </span>     <span class="name">errorHistItem</span><span class="punctuation">.</span><span class="name">addActionListener</span><span class="punctuation">(</span><span class="keyword">new</span>
<span class="ln"> 69 </span>             <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">()</span>
<span class="ln"> 70 </span>             <span class="punctuation">{</span>
<span class="ln"> 71 </span>              <span class="keyword">public</span> <span class="keyword type">void</span>
<span class="ln"> 72 </span>              <span class="name">actionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln"> 73 </span>              <span class="punctuation">{</span><span class="name">errHistItemActionPerformed</span><span class="punctuation">(</span><span class="name">evt</span><span class="punctuation">);}</span>
<span class="ln"> 74 </span>             <span class="punctuation">});</span>
<span class="ln"> 75 </span>     <span class="name">viewMenu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">errorHistItem</span><span class="punctuation">);</span>
<span class="ln"> 76 </span>     <span class="name">menu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">fileMenu</span><span class="punctuation">);</span>
<span class="ln"> 77 </span>     <span class="name">menu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">viewMenu</span><span class="punctuation">);</span>
<span class="ln"> 78 </span>
<span class="ln"> 79 </span>     <span class="comment single">//
</span><span class="ln"> 80 </span><span class="comment single"></span>     <span class="comment single">// Here we create ATK objects to handle attributes, commands and errors.
</span><span class="ln"> 81 </span><span class="comment single"></span>     <span class="comment single">//
</span><span class="ln"> 82 </span><span class="comment single"></span>     <span class="name">attributes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">AttributeList</span><span class="punctuation">();</span>
<span class="ln"> 83 </span>     <span class="name">commands</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">CommandList</span><span class="punctuation">();</span>
<span class="ln"> 84 </span>     <span class="name">errorHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ErrorHistory</span><span class="punctuation">();</span>
<span class="ln"> 85 </span>     <span class="name">device</span> <span class="operator">=</span> <span class="literal string">&quot;id14/eh3_mirror/1&quot;</span><span class="punctuation">;</span>
<span class="ln"> 86 </span>     <span class="name">sListViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ScalarListViewer</span><span class="punctuation">();</span>
<span class="ln"> 87 </span>     <span class="name">commandViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">CommandComboViewer</span><span class="punctuation">();</span>
<span class="ln"> 88 </span>
<span class="ln"> 89 </span>
<span class="ln"> 90 </span>  <span class="comment single">//
</span><span class="ln"> 91 </span><span class="comment single"></span>  <span class="comment single">// A feature of the command and attribute list is that if you
</span><span class="ln"> 92 </span><span class="comment single"></span>  <span class="comment single">// supply an errorlistener to these lists, they'll add that
</span><span class="ln"> 93 </span><span class="comment single"></span>  <span class="comment single">// errorlistener to all subsequently created attributes or
</span><span class="ln"> 94 </span><span class="comment single"></span>  <span class="comment single">// commands. So it is important to do this _before_ you
</span><span class="ln"> 95 </span><span class="comment single"></span>  <span class="comment single">// start adding attributes or commands.
</span><span class="ln"> 96 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln"> 97 </span><span class="comment single"></span>
<span class="ln"> 98 </span>     <span class="name">attributes</span><span class="punctuation">.</span><span class="name">addErrorListener</span><span class="punctuation">(</span><span class="name">errorHistory</span><span class="punctuation">);</span>
<span class="ln"> 99 </span>     <span class="name">commands</span><span class="punctuation">.</span><span class="name">addErrorListener</span><span class="punctuation">(</span><span class="name">errorHistory</span><span class="punctuation">);</span>
<span class="ln">100 </span>
<span class="ln">101 </span>  <span class="comment single">//
</span><span class="ln">102 </span><span class="comment single"></span>  <span class="comment single">// Sometimes we're out of luck and the device or the attributes
</span><span class="ln">103 </span><span class="comment single"></span>  <span class="comment single">// are not available. In that case a ConnectionException is thrown.
</span><span class="ln">104 </span><span class="comment single"></span>  <span class="comment single">// This is why we add the attributes in a try/catch
</span><span class="ln">105 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">106 </span><span class="comment single"></span>
<span class="ln">107 </span>     <span class="name">try</span>
<span class="ln">108 </span>     <span class="punctuation">{</span>
<span class="ln">109 </span>
<span class="ln">110 </span>  <span class="comment single">//
</span><span class="ln">111 </span><span class="comment single"></span>  <span class="comment single">// Another feature of the attribute and command list is that they
</span><span class="ln">112 </span><span class="comment single"></span>  <span class="comment single">// can add wildcard names, currently only `*' is supported.
</span><span class="ln">113 </span><span class="comment single"></span>  <span class="comment single">// When using a wildcard, the lists will add all commands or
</span><span class="ln">114 </span><span class="comment single"></span>  <span class="comment single">// attributes available on the device.
</span><span class="ln">115 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">116 </span><span class="comment single"></span>     <span class="name">attributes</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot;/*&quot;</span><span class="punctuation">);</span>
<span class="ln">117 </span>     <span class="punctuation">}</span>
<span class="ln">118 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="punctuation">)</span>
<span class="ln">119 </span>     <span class="punctuation">{</span>
<span class="ln">120 </span>        <span class="name">System</span><span class="punctuation">.</span><span class="name">out</span><span class="punctuation">.</span><span class="name">println</span><span class="punctuation">(</span><span class="literal string">&quot;Error fetching &quot;</span> <span class="operator">+</span>
<span class="ln">121 </span>                           <span class="literal string">&quot;attributes from &quot;</span> <span class="operator">+</span>
<span class="ln">122 </span>                           <span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="punctuation">);</span>
<span class="ln">123 </span>     <span class="punctuation">}</span>
<span class="ln">124 </span>
<span class="ln">125 </span>
<span class="ln">126 </span>  <span class="comment single">//
</span><span class="ln">127 </span><span class="comment single"></span>  <span class="comment single">// See the comments for attributelist
</span><span class="ln">128 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">129 </span><span class="comment single"></span>
<span class="ln">130 </span>
<span class="ln">131 </span>     <span class="name">try</span>
<span class="ln">132 </span>     <span class="punctuation">{</span>
<span class="ln">133 </span>        <span class="name">commands</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot;/*&quot;</span><span class="punctuation">);</span>
<span class="ln">134 </span>     <span class="punctuation">}</span>
<span class="ln">135 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="punctuation">)</span>
<span class="ln">136 </span>     <span class="punctuation">{</span>
<span class="ln">137 </span>        <span class="name">System</span><span class="punctuation">.</span><span class="name">out</span><span class="punctuation">.</span><span class="name">println</span><span class="punctuation">(</span><span class="literal string">&quot;Error fetching &quot;</span> <span class="operator">+</span>
<span class="ln">138 </span>                           <span class="literal string">&quot;commands from &quot;</span> <span class="operator">+</span>
<span class="ln">139 </span>                           <span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="punctuation">);</span>
<span class="ln">140 </span>     <span class="punctuation">}</span>
<span class="ln">141 </span>
<span class="ln">142 </span>
<span class="ln">143 </span>  <span class="comment single">//
</span><span class="ln">144 </span><span class="comment single"></span>  <span class="comment single">// Here we tell the scalarViewer what it's to show. The
</span><span class="ln">145 </span><span class="comment single"></span>  <span class="comment single">// ScalarListViewer loops through the attribute-list and picks out
</span><span class="ln">146 </span><span class="comment single"></span>  <span class="comment single">// the ones which are scalars and show them.
</span><span class="ln">147 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">148 </span><span class="comment single"></span>
<span class="ln">149 </span>     <span class="name">sListViewer</span><span class="punctuation">.</span><span class="name">setModel</span><span class="punctuation">(</span><span class="name">attributes</span><span class="punctuation">);</span>
<span class="ln">150 </span>
<span class="ln">151 </span>
<span class="ln">152 </span>  <span class="comment single">//
</span><span class="ln">153 </span><span class="comment single"></span>  <span class="comment single">// This is where the CommandComboViewer is told what it's to
</span><span class="ln">154 </span><span class="comment single"></span>  <span class="comment single">// show. It knows how to show and execute most commands.
</span><span class="ln">155 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">156 </span><span class="comment single"></span>
<span class="ln">157 </span>
<span class="ln">158 </span>     <span class="name">commandViewer</span><span class="punctuation">.</span><span class="name">setModel</span><span class="punctuation">(</span><span class="name">commands</span><span class="punctuation">);</span>
<span class="ln">159 </span>
<span class="ln">160 </span>
<span class="ln">161 </span>  <span class="comment single">//
</span><span class="ln">162 </span><span class="comment single"></span>  <span class="comment single">// add the menubar to the frame
</span><span class="ln">163 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">164 </span><span class="comment single"></span>
<span class="ln">165 </span>
<span class="ln">166 </span>     <span class="name">setJMenuBar</span><span class="punctuation">(</span><span class="name">menu</span><span class="punctuation">);</span>
<span class="ln">167 </span>
<span class="ln">168 </span>
<span class="ln">169 </span>  <span class="comment single">//
</span><span class="ln">170 </span><span class="comment single"></span>  <span class="comment single">// Make the layout nice.
</span><span class="ln">171 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">172 </span><span class="comment single"></span>
<span class="ln">173 </span>
<span class="ln">174 </span>     <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">setLayout</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">BorderLayout</span><span class="punctuation">());</span>
<span class="ln">175 </span>     <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">add</span><span class="punctuation">(</span><span class="name">commandViewer</span><span class="punctuation">,</span> <span class="name">BorderLayout</span><span class="punctuation">.</span><span class="name">NORTH</span><span class="punctuation">);</span>
<span class="ln">176 </span>     <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">add</span><span class="punctuation">(</span><span class="name">sListViewer</span><span class="punctuation">,</span> <span class="name">BorderLayout</span><span class="punctuation">.</span><span class="name">SOUTH</span><span class="punctuation">);</span>
<span class="ln">177 </span>
<span class="ln">178 </span>
<span class="ln">179 </span>  <span class="comment single">//
</span><span class="ln">180 </span><span class="comment single"></span>  <span class="comment single">// A third feature of the attributelist is that it knows how
</span><span class="ln">181 </span><span class="comment single"></span>  <span class="comment single">// to refresh its attributes.
</span><span class="ln">182 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">183 </span><span class="comment single"></span>
<span class="ln">184 </span>
<span class="ln">185 </span>     <span class="name">attributes</span><span class="punctuation">.</span><span class="name">startRefresher</span><span class="punctuation">();</span>
<span class="ln">186 </span>
<span class="ln">187 </span>
<span class="ln">188 </span>  <span class="comment single">//
</span><span class="ln">189 </span><span class="comment single"></span>  <span class="comment single">// JFrame stuff to make the thing show.
</span><span class="ln">190 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">191 </span><span class="comment single"></span>
<span class="ln">192 </span>
<span class="ln">193 </span>     <span class="name">pack</span><span class="punctuation">();</span>
<span class="ln">194 </span>     <span class="name">ATKGraphicsUtils</span><span class="punctuation">.</span><span class="name">centerFrameOnScreen</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">);</span> <span class="comment single">//ATK utility to center window
</span><span class="ln">195 </span><span class="comment single"></span>
<span class="ln">196 </span>     <span class="name">setVisible</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">197 </span>     <span class="punctuation">}</span>
<span class="ln">198 </span>
<span class="ln">199 </span>
<span class="ln">200 </span>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword type">void</span> <span class="name function">main</span><span class="punctuation">(</span><span class="name">String</span> <span class="punctuation">[]</span> <span class="name">args</span><span class="punctuation">)</span>
<span class="ln">201 </span>     <span class="punctuation">{</span>
<span class="ln">202 </span>        <span class="keyword">new</span> <span class="name">FirstApplication</span><span class="punctuation">();</span>
<span class="ln">203 </span>     <span class="punctuation">}</span>
<span class="ln">204 </span>
<span class="ln">205 </span>     <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">quitItemActionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln">206 </span>     <span class="punctuation">{</span>
<span class="ln">207 </span>        <span class="name">System</span><span class="punctuation">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">);</span>
<span class="ln">208 </span>     <span class="punctuation">}</span>
<span class="ln">209 </span>
<span class="ln">210 </span>     <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">errHistItemActionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln">211 </span>     <span class="punctuation">{</span>
<span class="ln">212 </span>        <span class="name">errorHistory</span><span class="punctuation">.</span><span class="name">setVisible</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">213 </span>     <span class="punctuation">}</span>
<span class="ln">214 </span>  <span class="punctuation">}</span>
</pre>
<p>The program should look something like this (depending on your platform
and your device)</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
</div>
<div class="section" id="multi-device-applications">
<h3><a class="toc-backref" href="#id212">Multi device applications</a></h3>
<div class="line-block">
<div class="line">Multi device applications are quite similar to the single device
applications, the only difference is that it does not suffice to add
the attributes by wildcard, you need to add them explicitly, like
this:</div>
</div>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">try</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="comment single">// a StringScalar attribute from the device one
</span><span class="ln"> 4 </span><span class="comment single"></span>     <span class="name">attributes</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;jlp/test/1/att_cinq&quot;</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>     <span class="comment single">// a NumberSpectrum attribute from the device one
</span><span class="ln"> 6 </span><span class="comment single"></span>     <span class="name">attributes</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;jlp/test/1/att_spectrum&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>     <span class="comment single">// a NumberImage attribute from the device two
</span><span class="ln"> 8 </span><span class="comment single"></span>     <span class="name">attributes</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;sr/d-ipc/id25-1n/Image&quot;</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
<span class="ln">10 </span>  <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="punctuation">)</span>
<span class="ln">11 </span>  <span class="punctuation">{</span>
<span class="ln">12 </span>     <span class="name">System</span><span class="punctuation">.</span><span class="name">out</span><span class="punctuation">.</span><span class="name">println</span><span class="punctuation">(</span><span class="literal string">&quot;Error fetching &quot;</span> <span class="operator">+</span>
<span class="ln">13 </span>         <span class="literal string">&quot;attributes&quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="punctuation">);</span>
<span class="ln">14 </span>  <span class="punctuation">}</span>
</pre>
<p>The same goes for commands.</p>
</div>
<div class="section" id="more-on-displaying-attributes">
<h3><a class="toc-backref" href="#id213">More on displaying attributes</a></h3>
<p>So far, we’ve only considered scalar attributes, and not only that,
we’ve also cheated quite a bit since we just passed the attribute list
to the <tt class="docutils literal">fr.esrf.tangoatk.widget.attribute.ScalarListViewer</tt> and let it
do all the magic. The attribute list viewers are only available for
scalar attributes (NumberScalarListViewer and ScalarListViewer). If you
have one or several spectrum or image attributes you must connect each
spectrum or image attribute to it’s corresponding attribute viewer
individually. So let’s take a look at how you can connect individual
attributes (and not a whole attribute list) to an individual attribute
viewer (and not to an attribute list viewer).</p>
<div class="section" id="connecting-an-attribute-to-a-viewer">
<h4>Connecting an attribute to a viewer</h4>
<p>Generally it is done in the following way:</p>
<ol class="arabic simple">
<li>You retrieve the attribute from the attribute list</li>
<li>You instantiate the viewer</li>
<li>Your call the <tt class="docutils literal">setModel</tt> method on the viewer with the attribute as
argument.</li>
<li>You add your viewer to some panel</li>
</ol>
<p>The following example (SecondApplication), is a Multi-device
application. Since this application uses individual attribute viewers
and not an attribute list viewer, it shows an implementation of the list
mentioned above.</p>
<pre class="code cpp literal-block">
<span class="ln">  1 </span>  <span class="name">package</span> <span class="name">examples</span><span class="punctuation">;</span>
<span class="ln">  2 </span>
<span class="ln">  3 </span>
<span class="ln">  4 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JFrame</span><span class="punctuation">;</span>
<span class="ln">  5 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenuItem</span><span class="punctuation">;</span>
<span class="ln">  6 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenuBar</span><span class="punctuation">;</span>
<span class="ln">  7 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenu</span><span class="punctuation">;</span>
<span class="ln">  8 </span>
<span class="ln">  9 </span>
<span class="ln"> 10 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">;</span>
<span class="ln"> 11 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionEvent</span><span class="punctuation">;</span>
<span class="ln"> 12 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">BorderLayout</span><span class="punctuation">;</span>
<span class="ln"> 13 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">Color</span><span class="punctuation">;</span>
<span class="ln"> 14 </span>
<span class="ln"> 15 </span>
<span class="ln"> 16 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">AttributeList</span><span class="punctuation">;</span>
<span class="ln"> 17 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">ConnectionException</span><span class="punctuation">;</span>
<span class="ln"> 18 </span>
<span class="ln"> 19 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">IStringScalar</span><span class="punctuation">;</span>
<span class="ln"> 20 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">INumberSpectrum</span><span class="punctuation">;</span>
<span class="ln"> 21 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">core</span><span class="punctuation">.</span><span class="name">INumberImage</span><span class="punctuation">;</span>
<span class="ln"> 22 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="name">ErrorHistory</span><span class="punctuation">;</span>
<span class="ln"> 23 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="name">Gradient</span><span class="punctuation">;</span>
<span class="ln"> 24 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="name">ATKGraphicsUtils</span><span class="punctuation">;</span>
<span class="ln"> 25 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">attribute</span><span class="punctuation">.</span><span class="name">NumberImageViewer</span><span class="punctuation">;</span>
<span class="ln"> 26 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">attribute</span><span class="punctuation">.</span><span class="name">NumberSpectrumViewer</span><span class="punctuation">;</span>
<span class="ln"> 27 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">attribute</span><span class="punctuation">.</span><span class="name">SimpleScalarViewer</span><span class="punctuation">;</span>
<span class="ln"> 28 </span>
<span class="ln"> 29 </span>  <span class="keyword">public</span> <span class="keyword">class</span> <span class="name class">SecondApplication</span> <span class="name">extends</span> <span class="name">JFrame</span>
<span class="ln"> 30 </span>  <span class="punctuation">{</span>
<span class="ln"> 31 </span>       <span class="name">JMenuBar</span>            <span class="name">menu</span><span class="punctuation">;</span>
<span class="ln"> 32 </span>       <span class="name">AttributeList</span>       <span class="name">attributes</span><span class="punctuation">;</span>   <span class="comment single">// The list that will contain our attributes
</span><span class="ln"> 33 </span><span class="comment single"></span>       <span class="name">ErrorHistory</span>        <span class="name">errorHistory</span><span class="punctuation">;</span> <span class="comment single">// A window that displays errors
</span><span class="ln"> 34 </span><span class="comment single"></span>       <span class="name">IStringScalar</span>        <span class="name">ssAtt</span><span class="punctuation">;</span>
<span class="ln"> 35 </span>       <span class="name">INumberSpectrum</span>      <span class="name">nsAtt</span><span class="punctuation">;</span>
<span class="ln"> 36 </span>       <span class="name">INumberImage</span>         <span class="name">niAtt</span><span class="punctuation">;</span>
<span class="ln"> 37 </span>       <span class="keyword">public</span> <span class="name function">SecondApplication</span><span class="punctuation">()</span>
<span class="ln"> 38 </span>       <span class="punctuation">{</span>
<span class="ln"> 39 </span>          <span class="comment single">// Swing stuff to create the menu bar and its pulldown menus
</span><span class="ln"> 40 </span><span class="comment single"></span>          <span class="name">menu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuBar</span><span class="punctuation">();</span>
<span class="ln"> 41 </span>          <span class="name">JMenu</span> <span class="name">fileMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="punctuation">();</span>
<span class="ln"> 42 </span>          <span class="name">fileMenu</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;File&quot;</span><span class="punctuation">);</span>
<span class="ln"> 43 </span>          <span class="name">JMenu</span> <span class="name">viewMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="punctuation">();</span>
<span class="ln"> 44 </span>          <span class="name">viewMenu</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;View&quot;</span><span class="punctuation">);</span>
<span class="ln"> 45 </span>          <span class="name">JMenuItem</span> <span class="name">quitItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="punctuation">();</span>
<span class="ln"> 46 </span>          <span class="name">quitItem</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;Quit&quot;</span><span class="punctuation">);</span>
<span class="ln"> 47 </span>          <span class="name">quitItem</span><span class="punctuation">.</span><span class="name">addActionListener</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">()</span>
<span class="ln"> 48 </span>                                        <span class="punctuation">{</span>
<span class="ln"> 49 </span>                                         <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name">actionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln"> 50 </span>                                         <span class="punctuation">{</span><span class="name">quitItemActionPerformed</span><span class="punctuation">(</span><span class="name">evt</span><span class="punctuation">);}</span>
<span class="ln"> 51 </span>                                        <span class="punctuation">});</span>
<span class="ln"> 52 </span>
<span class="ln"> 53 </span>          <span class="name">fileMenu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">quitItem</span><span class="punctuation">);</span>
<span class="ln"> 54 </span>          <span class="name">JMenuItem</span> <span class="name">errorHistItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="punctuation">();</span>
<span class="ln"> 55 </span>          <span class="name">errorHistItem</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;Error History&quot;</span><span class="punctuation">);</span>
<span class="ln"> 56 </span>          <span class="name">errorHistItem</span><span class="punctuation">.</span><span class="name">addActionListener</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">()</span>
<span class="ln"> 57 </span>                  <span class="punctuation">{</span>
<span class="ln"> 58 </span>                   <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name">actionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln"> 59 </span>                   <span class="punctuation">{</span><span class="name">errHistItemActionPerformed</span><span class="punctuation">(</span><span class="name">evt</span><span class="punctuation">);}</span>
<span class="ln"> 60 </span>                  <span class="punctuation">});</span>
<span class="ln"> 61 </span>          <span class="name">viewMenu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">errorHistItem</span><span class="punctuation">);</span>
<span class="ln"> 62 </span>          <span class="name">menu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">fileMenu</span><span class="punctuation">);</span>
<span class="ln"> 63 </span>          <span class="name">menu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">viewMenu</span><span class="punctuation">);</span>
<span class="ln"> 64 </span>        <span class="comment single">//
</span><span class="ln"> 65 </span><span class="comment single"></span>        <span class="comment single">// Here we create TangoATK objects to view attributes and errors.
</span><span class="ln"> 66 </span><span class="comment single"></span>        <span class="comment single">//
</span><span class="ln"> 67 </span><span class="comment single"></span>          <span class="name">attributes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">AttributeList</span><span class="punctuation">();</span>
<span class="ln"> 68 </span>          <span class="name">errorHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ErrorHistory</span><span class="punctuation">();</span>
<span class="ln"> 69 </span>        <span class="comment single">//
</span><span class="ln"> 70 </span><span class="comment single"></span>        <span class="comment single">// We create a SimpleScalarViewer, a NumberSpectrumViewer and
</span><span class="ln"> 71 </span><span class="comment single"></span>        <span class="comment single">// a NumberImageViewer, since we already knew that we were
</span><span class="ln"> 72 </span><span class="comment single"></span>        <span class="comment single">// playing with a scalar attribute, a number spectrum attribute
</span><span class="ln"> 73 </span><span class="comment single"></span>        <span class="comment single">// and a number image attribute this time.
</span><span class="ln"> 74 </span><span class="comment single"></span>        <span class="comment single">//
</span><span class="ln"> 75 </span><span class="comment single"></span>        <span class="name">SimpleScalarViewer</span>     <span class="name">ssViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">SimpleScalarViewer</span><span class="punctuation">();</span>
<span class="ln"> 76 </span>          <span class="name">NumberSpectrumViewer</span>   <span class="name">nSpectViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">NumberSpectrumViewer</span><span class="punctuation">();</span>
<span class="ln"> 77 </span>          <span class="name">NumberImageViewer</span>      <span class="name">nImageViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">NumberImageViewer</span><span class="punctuation">();</span>
<span class="ln"> 78 </span>          <span class="name">attributes</span><span class="punctuation">.</span><span class="name">addErrorListener</span><span class="punctuation">(</span><span class="name">errorHistory</span><span class="punctuation">);</span>
<span class="ln"> 79 </span>       <span class="comment single">//
</span><span class="ln"> 80 </span><span class="comment single"></span>       <span class="comment single">// The attribute (and command) list has the feature of returning the last
</span><span class="ln"> 81 </span><span class="comment single"></span>       <span class="comment single">// attribute that was added to it. Just remember that it is returned as an
</span><span class="ln"> 82 </span><span class="comment single"></span>       <span class="comment single">// IEntity object, so you need to cast it into a more specific object, like
</span><span class="ln"> 83 </span><span class="comment single"></span>       <span class="comment single">// IStringScalar, which is the interface which defines a string scalar
</span><span class="ln"> 84 </span><span class="comment single"></span>       <span class="comment single">//
</span><span class="ln"> 85 </span><span class="comment single"></span>         <span class="name">try</span>
<span class="ln"> 86 </span>          <span class="punctuation">{</span>
<span class="ln"> 87 </span>
<span class="ln"> 88 </span>             <span class="name">ssAtt</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="name">IStringScalar</span><span class="punctuation">)</span> <span class="name">attributes</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;jlp/test/1/att_cinq&quot;</span><span class="punctuation">);</span>
<span class="ln"> 89 </span>             <span class="name">nsAtt</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="name">INumberSpectrum</span><span class="punctuation">)</span> <span class="name">attributes</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;jlp/test/1/att_spectrum&quot;</span><span class="punctuation">);</span>
<span class="ln"> 90 </span>             <span class="name">niAtt</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="name">INumberImage</span><span class="punctuation">)</span> <span class="name">attributes</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="literal string">&quot;sr/d-ipc/id25-1n/Image&quot;</span><span class="punctuation">);</span>
<span class="ln"> 91 </span>          <span class="punctuation">}</span>
<span class="ln"> 92 </span>          <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="punctuation">)</span>
<span class="ln"> 93 </span>          <span class="punctuation">{</span>
<span class="ln"> 94 </span>             <span class="name">System</span><span class="punctuation">.</span><span class="name">out</span><span class="punctuation">.</span><span class="name">println</span><span class="punctuation">(</span><span class="literal string">&quot;Error fetching one of the attributes  &quot;</span><span class="operator">+</span><span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="punctuation">);</span>
<span class="ln"> 95 </span>             <span class="name">System</span><span class="punctuation">.</span><span class="name">out</span><span class="punctuation">.</span><span class="name">println</span><span class="punctuation">(</span><span class="literal string">&quot;Application Aborted.&quot;</span><span class="punctuation">);</span>
<span class="ln"> 96 </span>             <span class="name">System</span><span class="punctuation">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">);</span>
<span class="ln"> 97 </span>          <span class="punctuation">}</span>
<span class="ln"> 98 </span>          <span class="comment single">//
</span><span class="ln"> 99 </span><span class="comment single"></span>          <span class="comment single">// Pay close attention to the following three lines!! This is how it's done!
</span><span class="ln">100 </span><span class="comment single"></span>          <span class="comment single">// This is how it's always done! The setModelsetModel method of any viewer takes care
</span><span class="ln">101 </span><span class="comment single"></span>         <span class="comment single">// of connecting the viewer to the attribute (model) it's in charge of displaying.
</span><span class="ln">102 </span><span class="comment single"></span>         <span class="comment single">// This is the way to tell each viewer what (which attribute) it has to show.
</span><span class="ln">103 </span><span class="comment single"></span>         <span class="comment single">// Note that we use a viewer adapted to each type of attribute
</span><span class="ln">104 </span><span class="comment single"></span>         <span class="comment single">//
</span><span class="ln">105 </span><span class="comment single"></span>          <span class="name">ssViewer</span><span class="punctuation">.</span><span class="name">setModel</span><span class="punctuation">(</span><span class="name">ssAtt</span><span class="punctuation">);</span>
<span class="ln">106 </span>          <span class="name">nSpectViewer</span><span class="punctuation">.</span><span class="name">setModel</span><span class="punctuation">(</span><span class="name">nsAtt</span><span class="punctuation">);</span>
<span class="ln">107 </span>          <span class="name">nImageViewer</span><span class="punctuation">.</span><span class="name">setModel</span><span class="punctuation">(</span><span class="name">niAtt</span><span class="punctuation">);</span>
<span class="ln">108 </span>       <span class="comment single">//
</span><span class="ln">109 </span><span class="comment single"></span>          <span class="name">nSpectViewer</span><span class="punctuation">.</span><span class="name">setPreferredSize</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">Dimension</span><span class="punctuation">(</span><span class="literal number integer">400</span><span class="punctuation">,</span> <span class="literal number integer">300</span><span class="punctuation">));</span>
<span class="ln">110 </span>          <span class="name">nImageViewer</span><span class="punctuation">.</span><span class="name">setPreferredSize</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">Dimension</span><span class="punctuation">(</span><span class="literal number integer">500</span><span class="punctuation">,</span> <span class="literal number integer">300</span><span class="punctuation">));</span>
<span class="ln">111 </span>          <span class="name">Gradient</span>  <span class="name">g</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Gradient</span><span class="punctuation">();</span>
<span class="ln">112 </span>          <span class="name">g</span><span class="punctuation">.</span><span class="name">buidColorGradient</span><span class="punctuation">();</span>
<span class="ln">113 </span>          <span class="name">g</span><span class="punctuation">.</span><span class="name">setColorAt</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="name">Color</span><span class="punctuation">.</span><span class="name">black</span><span class="punctuation">);</span>
<span class="ln">114 </span>          <span class="name">nImageViewer</span><span class="punctuation">.</span><span class="name">setGradient</span><span class="punctuation">(</span><span class="name">g</span><span class="punctuation">);</span>
<span class="ln">115 </span>          <span class="name">nImageViewer</span><span class="punctuation">.</span><span class="name">setBestFit</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">116 </span>
<span class="ln">117 </span>          <span class="comment single">//
</span><span class="ln">118 </span><span class="comment single"></span>          <span class="comment single">// Add the viewers into the frame to show them
</span><span class="ln">119 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">120 </span><span class="comment single"></span>          <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">setLayout</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">BorderLayout</span><span class="punctuation">());</span>
<span class="ln">121 </span>          <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">add</span><span class="punctuation">(</span><span class="name">ssViewer</span><span class="punctuation">,</span> <span class="name">BorderLayout</span><span class="punctuation">.</span><span class="name">SOUTH</span><span class="punctuation">);</span>
<span class="ln">122 </span>          <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">add</span><span class="punctuation">(</span><span class="name">nSpectViewer</span><span class="punctuation">,</span> <span class="name">BorderLayout</span><span class="punctuation">.</span><span class="name">CENTER</span><span class="punctuation">);</span>
<span class="ln">123 </span>          <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">add</span><span class="punctuation">(</span><span class="name">nImageViewer</span><span class="punctuation">,</span> <span class="name">BorderLayout</span><span class="punctuation">.</span><span class="name">EAST</span><span class="punctuation">);</span>
<span class="ln">124 </span>          <span class="comment single">//
</span><span class="ln">125 </span><span class="comment single"></span>          <span class="comment single">// To have the attributes values refreshed we should start the
</span><span class="ln">126 </span><span class="comment single"></span>          <span class="comment single">// attribute list's refresher.
</span><span class="ln">127 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">128 </span><span class="comment single"></span>          <span class="name">attributes</span><span class="punctuation">.</span><span class="name">startRefresher</span><span class="punctuation">();</span>
<span class="ln">129 </span>          <span class="comment single">//
</span><span class="ln">130 </span><span class="comment single"></span>          <span class="comment single">// add the menubar to the frame
</span><span class="ln">131 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">132 </span><span class="comment single"></span>          <span class="name">setJMenuBar</span><span class="punctuation">(</span><span class="name">menu</span><span class="punctuation">);</span>
<span class="ln">133 </span>          <span class="comment single">//
</span><span class="ln">134 </span><span class="comment single"></span>          <span class="comment single">// JFrame stuff to make the thing show.
</span><span class="ln">135 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">136 </span><span class="comment single"></span>          <span class="name">pack</span><span class="punctuation">();</span>
<span class="ln">137 </span>          <span class="name">ATKGraphicsUtils</span><span class="punctuation">.</span><span class="name">centerFrameOnScreen</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">);</span> <span class="comment single">//ATK utility to center window
</span><span class="ln">138 </span><span class="comment single"></span>          <span class="name">setVisible</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">139 </span>       <span class="punctuation">}</span>
<span class="ln">140 </span>       <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword type">void</span> <span class="name function">main</span><span class="punctuation">(</span><span class="name">String</span> <span class="punctuation">[]</span> <span class="name">args</span><span class="punctuation">)</span>
<span class="ln">141 </span>       <span class="punctuation">{</span>
<span class="ln">142 </span>          <span class="keyword">new</span> <span class="name">SecondApplication</span><span class="punctuation">();</span>
<span class="ln">143 </span>       <span class="punctuation">}</span>
<span class="ln">144 </span>       <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">quitItemActionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln">145 </span>       <span class="punctuation">{</span>
<span class="ln">146 </span>          <span class="name">System</span><span class="punctuation">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">);</span>
<span class="ln">147 </span>       <span class="punctuation">}</span>
<span class="ln">148 </span>       <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">errHistItemActionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln">149 </span>       <span class="punctuation">{</span>
<span class="ln">150 </span>          <span class="name">errorHistory</span><span class="punctuation">.</span><span class="name">setVisible</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">151 </span>       <span class="punctuation">}</span>
<span class="ln">152 </span>  <span class="punctuation">}</span>
</pre>
<div class="line-block">
<div class="line">This program (SeondApplication) should look something like this
(depending on your platform and your device attributes)</div>
<div class="line"><img alt="image" src="dance/AT97-65-size" /></div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 3939)</p>
<p>Content block expected for the &quot;code&quot; directive; none found.</p>
<pre class="literal-block">
.. code:: cpp
  :number-lines:

</pre>
</div>
</div>
<div class="section" id="synoptic-viewer">
<h4>Synoptic viewer</h4>
<p>TangoATK provides a generic class to view and to animate the synoptics.
The name of this class is
fr.esrf.tangoatk.widget.jdraw.SynopticFileViewer. This class is based on
a “home-made” graphical layer called jdraw. The jdraw package is also
included inside TangoATK distribution.</p>
<p>SynopticFileViewer is a sub-class of the class TangoSynopticHandler. All
the work for connection to tango devices and run time animation is done
inside the TangoSynopticHandler.</p>
<p>The recipe for using the TangoATK synoptic viewer is the following</p>
<ol class="arabic simple">
<li>You use Jdraw graphical editor to draw your synoptic</li>
<li>During drawing phase don’t forget to associate parts of the drawing
to tango attributes or commands. Use the “name” in the property
window to do this</li>
<li>During drawing phase you can also aasociate a class (frequently a
“specific panel” class) which will be displayed when the user clicks
on some part of the drawing. Use the “extension” tab in the property
window to do this.</li>
<li>Test the run-time behaviour of your synoptic. Use “Tango Synoptic
view” command in the “views” pulldown menu to do this.</li>
<li>Save the drawing file.</li>
<li>There is a simple synoptic application (SynopticAppli) which is
provided ready to use. If this generic application is enough for you,
you can forget about the step 7.</li>
<li>You can now develop a specific TangoATK based application which
instantiates the SynopticFileViewer. To load the synoptic file in the
SynopticFileViewer you have the choice : either you load it by giving
the absolute path name of the synoptic file or you load the synoptic
file using Java input streams. The second solution is used when the
synoptic file is included inside the application jarfile.</li>
</ol>
<p>The SynopticFilerViewer will browse the objects in the synoptic file at
run time. It discovers if some parts of the drawing is associated with
an attribute or a command. In this case it will automatically connect to
the corresponding attribute or command. Once the connection is
successfull SynopticFileViewer will animate the synoptic according to
the default behaviour described below :</p>
<ul class="simple">
<li>For <em>tango state attributes</em> : the colour of the drawing object
reflects the value of the state. A mouse click on the drawing object
associated with the tango state attribute will instantiate and
display the class specified during the drawing phase. If no class is
specified the atkpanel generic device panel is displayed.</li>
<li>For <em>tango attributes</em> : the current value of the attribute is
displayed through the drawing object</li>
<li>For <em>tango commands</em> : the mouse click on the drawing object
associated with the command will launch the device command.</li>
<li>If the tooltip property is set to “name” when the mouse enters <em>any
tango object</em> ( attribute or command), inside the synoptic drawing
the name of the tango object is displayed in a tooltip.</li>
</ul>
<p>The following example (ThirdApplication), is a Synoptic application. We
assume that the synoptic has already been drawn using Jdraw graphical
editor.</p>
<pre class="code cpp literal-block">
<span class="ln">  1 </span>  <span class="name">package</span> <span class="name">examples</span><span class="punctuation">;</span>
<span class="ln">  2 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">io</span><span class="punctuation">.</span><span class="operator">*</span><span class="punctuation">;</span>
<span class="ln">  3 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="operator">*</span><span class="punctuation">;</span>
<span class="ln">  4 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JFrame</span><span class="punctuation">;</span>
<span class="ln">  5 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenuItem</span><span class="punctuation">;</span>
<span class="ln">  6 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenuBar</span><span class="punctuation">;</span>
<span class="ln">  7 </span>  <span class="name">import</span> <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JMenu</span><span class="punctuation">;</span>
<span class="ln">  8 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">;</span>
<span class="ln">  9 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionEvent</span><span class="punctuation">;</span>
<span class="ln"> 10 </span>  <span class="name">import</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">BorderLayout</span><span class="punctuation">;</span>
<span class="ln"> 11 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="name">ErrorHistory</span><span class="punctuation">;</span>
<span class="ln"> 12 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">util</span><span class="punctuation">.</span><span class="name">ATKGraphicsUtils</span><span class="punctuation">;</span>
<span class="ln"> 13 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">jdraw</span><span class="punctuation">.</span><span class="name">SynopticFileViewer</span><span class="punctuation">;</span>
<span class="ln"> 14 </span>  <span class="name">import</span> <span class="name">fr</span><span class="punctuation">.</span><span class="name">esrf</span><span class="punctuation">.</span><span class="name">tangoatk</span><span class="punctuation">.</span><span class="name">widget</span><span class="punctuation">.</span><span class="name">jdraw</span><span class="punctuation">.</span><span class="name">TangoSynopticHandler</span><span class="punctuation">;</span>
<span class="ln"> 15 </span>  <span class="keyword">public</span> <span class="keyword">class</span> <span class="name class">ThirdApplication</span> <span class="name">extends</span> <span class="name">JFrame</span>
<span class="ln"> 16 </span>  <span class="punctuation">{</span>
<span class="ln"> 17 </span>       <span class="name">JMenuBar</span>              <span class="name">menu</span><span class="punctuation">;</span>
<span class="ln"> 18 </span>       <span class="name">ErrorHistory</span>          <span class="name">errorHistory</span><span class="punctuation">;</span>  <span class="comment single">// A window that displays errors
</span><span class="ln"> 19 </span><span class="comment single"></span>       <span class="name">SynopticFileViewer</span>    <span class="name">sfv</span><span class="punctuation">;</span>           <span class="comment single">// TangoATK generic synoptic viewer
</span><span class="ln"> 20 </span><span class="comment single"></span>
<span class="ln"> 21 </span>
<span class="ln"> 22 </span>       <span class="keyword">public</span> <span class="name function">ThirdApplication</span><span class="punctuation">()</span>
<span class="ln"> 23 </span>       <span class="punctuation">{</span>
<span class="ln"> 24 </span>          <span class="comment single">// Swing stuff to create the menu bar and its pulldown menus
</span><span class="ln"> 25 </span><span class="comment single"></span>          <span class="name">menu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuBar</span><span class="punctuation">();</span>
<span class="ln"> 26 </span>          <span class="name">JMenu</span> <span class="name">fileMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="punctuation">();</span>
<span class="ln"> 27 </span>          <span class="name">fileMenu</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;File&quot;</span><span class="punctuation">);</span>
<span class="ln"> 28 </span>          <span class="name">JMenu</span> <span class="name">viewMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="punctuation">();</span>
<span class="ln"> 29 </span>          <span class="name">viewMenu</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;View&quot;</span><span class="punctuation">);</span>
<span class="ln"> 30 </span>          <span class="name">JMenuItem</span> <span class="name">quitItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="punctuation">();</span>
<span class="ln"> 31 </span>          <span class="name">quitItem</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;Quit&quot;</span><span class="punctuation">);</span>
<span class="ln"> 32 </span>          <span class="name">quitItem</span><span class="punctuation">.</span><span class="name">addActionListener</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">()</span>
<span class="ln"> 33 </span>                                        <span class="punctuation">{</span>
<span class="ln"> 34 </span>                                         <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name">actionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln"> 35 </span>                                         <span class="punctuation">{</span><span class="name">quitItemActionPerformed</span><span class="punctuation">(</span><span class="name">evt</span><span class="punctuation">);}</span>
<span class="ln"> 36 </span>                                        <span class="punctuation">});</span>
<span class="ln"> 37 </span>          <span class="name">fileMenu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">quitItem</span><span class="punctuation">);</span>
<span class="ln"> 38 </span>          <span class="name">JMenuItem</span> <span class="name">errorHistItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="punctuation">();</span>
<span class="ln"> 39 </span>          <span class="name">errorHistItem</span><span class="punctuation">.</span><span class="name">setText</span><span class="punctuation">(</span><span class="literal string">&quot;Error History&quot;</span><span class="punctuation">);</span>
<span class="ln"> 40 </span>          <span class="name">errorHistItem</span><span class="punctuation">.</span><span class="name">addActionListener</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">java</span><span class="punctuation">.</span><span class="name">awt</span><span class="punctuation">.</span><span class="name">event</span><span class="punctuation">.</span><span class="name">ActionListener</span><span class="punctuation">()</span>
<span class="ln"> 41 </span>                  <span class="punctuation">{</span>
<span class="ln"> 42 </span>                   <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name">actionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln"> 43 </span>                   <span class="punctuation">{</span><span class="name">errHistItemActionPerformed</span><span class="punctuation">(</span><span class="name">evt</span><span class="punctuation">);}</span>
<span class="ln"> 44 </span>                  <span class="punctuation">});</span>
<span class="ln"> 45 </span>          <span class="name">viewMenu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">errorHistItem</span><span class="punctuation">);</span>
<span class="ln"> 46 </span>          <span class="name">menu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">fileMenu</span><span class="punctuation">);</span>
<span class="ln"> 47 </span>          <span class="name">menu</span><span class="punctuation">.</span><span class="name">add</span><span class="punctuation">(</span><span class="name">viewMenu</span><span class="punctuation">);</span>
<span class="ln"> 48 </span>          <span class="comment single">//
</span><span class="ln"> 49 </span><span class="comment single"></span>          <span class="comment single">// Here we create TangoATK synoptic viewer and error window.
</span><span class="ln"> 50 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln"> 51 </span><span class="comment single"></span>          <span class="name">errorHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ErrorHistory</span><span class="punctuation">();</span>
<span class="ln"> 52 </span>          <span class="name">sfv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">SynopticFileViewer</span><span class="punctuation">();</span>
<span class="ln"> 53 </span>          <span class="name">try</span>
<span class="ln"> 54 </span>          <span class="punctuation">{</span>
<span class="ln"> 55 </span>              <span class="name">sfv</span><span class="punctuation">.</span><span class="name">setErrorWindow</span><span class="punctuation">(</span><span class="name">errorHistory</span><span class="punctuation">);</span>
<span class="ln"> 56 </span>          <span class="punctuation">}</span>
<span class="ln"> 57 </span>          <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">Exception</span> <span class="name">setErrwExcept</span><span class="punctuation">)</span>
<span class="ln"> 58 </span>          <span class="punctuation">{</span>
<span class="ln"> 59 </span>              <span class="name">System</span><span class="punctuation">.</span><span class="name">out</span><span class="punctuation">.</span><span class="name">println</span><span class="punctuation">(</span><span class="literal string">&quot;Cannot set Error History Window&quot;</span><span class="punctuation">);</span>
<span class="ln"> 60 </span>          <span class="punctuation">}</span>
<span class="ln"> 61 </span>
<span class="ln"> 62 </span>          <span class="comment single">//
</span><span class="ln"> 63 </span><span class="comment single"></span>          <span class="comment single">// Here we define the name of the synoptic file to show and the tooltip mode to use
</span><span class="ln"> 64 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln"> 65 </span><span class="comment single"></span>          <span class="name">try</span>
<span class="ln"> 66 </span>          <span class="punctuation">{</span>
<span class="ln"> 67 </span>            <span class="name">sfv</span><span class="punctuation">.</span><span class="name">setJdrawFileName</span><span class="punctuation">(</span><span class="literal string">&quot;/users/poncet/ATK_OLD/jdraw_files/id14.jdw&quot;</span><span class="punctuation">);</span>
<span class="ln"> 68 </span>            <span class="name">sfv</span><span class="punctuation">.</span><span class="name">setToolTipMode</span> <span class="punctuation">(</span><span class="name">TangoSynopticHandler</span><span class="punctuation">.</span><span class="name">TOOL_TIP_NAME</span><span class="punctuation">);</span>
<span class="ln"> 69 </span>          <span class="punctuation">}</span>
<span class="ln"> 70 </span>          <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">FileNotFoundException</span>  <span class="name">fnfEx</span><span class="punctuation">)</span>
<span class="ln"> 71 </span>          <span class="punctuation">{</span>
<span class="ln"> 72 </span>             <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JOptionPane</span><span class="punctuation">.</span><span class="name">showMessageDialog</span><span class="punctuation">(</span>
<span class="ln"> 73 </span>                <span class="name">null</span><span class="punctuation">,</span> <span class="literal string">&quot;Cannot find the synoptic file : id14.jdw.</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span>
<span class="ln"> 74 </span>                     <span class="operator">+</span> <span class="literal string">&quot;Check the file name you entered;&quot;</span>
<span class="ln"> 75 </span>                     <span class="operator">+</span> <span class="literal string">&quot; Application will abort ...</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span>
<span class="ln"> 76 </span>                     <span class="operator">+</span> <span class="name">fnfEx</span><span class="punctuation">,</span>
<span class="ln"> 77 </span>                     <span class="literal string">&quot;No such file&quot;</span><span class="punctuation">,</span>
<span class="ln"> 78 </span>                     <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JOptionPane</span><span class="punctuation">.</span><span class="name">ERROR_MESSAGE</span><span class="punctuation">);</span>
<span class="ln"> 79 </span>             <span class="name">System</span><span class="punctuation">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">);</span>
<span class="ln"> 80 </span>          <span class="punctuation">}</span>
<span class="ln"> 81 </span>          <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">IllegalArgumentException</span>  <span class="name">illEx</span><span class="punctuation">)</span>
<span class="ln"> 82 </span>          <span class="punctuation">{</span>
<span class="ln"> 83 </span>             <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JOptionPane</span><span class="punctuation">.</span><span class="name">showMessageDialog</span><span class="punctuation">(</span>
<span class="ln"> 84 </span>                <span class="name">null</span><span class="punctuation">,</span> <span class="literal string">&quot;Cannot parse the synoptic file : id14.jdw.</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span>
<span class="ln"> 85 </span>                     <span class="operator">+</span> <span class="literal string">&quot;Check if the file is a Jdraw file.&quot;</span>
<span class="ln"> 86 </span>                     <span class="operator">+</span> <span class="literal string">&quot; Application will abort ...</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span>
<span class="ln"> 87 </span>                     <span class="operator">+</span> <span class="name">illEx</span><span class="punctuation">,</span>
<span class="ln"> 88 </span>                     <span class="literal string">&quot;Cannot parse the file&quot;</span><span class="punctuation">,</span>
<span class="ln"> 89 </span>                     <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JOptionPane</span><span class="punctuation">.</span><span class="name">ERROR_MESSAGE</span><span class="punctuation">);</span>
<span class="ln"> 90 </span>             <span class="name">System</span><span class="punctuation">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">);</span>
<span class="ln"> 91 </span>          <span class="punctuation">}</span>
<span class="ln"> 92 </span>          <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">MissingResourceException</span>  <span class="name">mrEx</span><span class="punctuation">)</span>
<span class="ln"> 93 </span>          <span class="punctuation">{</span>
<span class="ln"> 94 </span>             <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JOptionPane</span><span class="punctuation">.</span><span class="name">showMessageDialog</span><span class="punctuation">(</span>
<span class="ln"> 95 </span>                <span class="name">null</span><span class="punctuation">,</span> <span class="literal string">&quot;Cannot parse the synoptic file : id14.jdw.</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span>
<span class="ln"> 96 </span>                     <span class="operator">+</span> <span class="literal string">&quot; Application will abort ...</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span>
<span class="ln"> 97 </span>                     <span class="operator">+</span> <span class="name">mrEx</span><span class="punctuation">,</span>
<span class="ln"> 98 </span>                     <span class="literal string">&quot;Cannot parse the file&quot;</span><span class="punctuation">,</span>
<span class="ln"> 99 </span>                     <span class="name">javax</span><span class="punctuation">.</span><span class="name">swing</span><span class="punctuation">.</span><span class="name">JOptionPane</span><span class="punctuation">.</span><span class="name">ERROR_MESSAGE</span><span class="punctuation">);</span>
<span class="ln">100 </span>             <span class="name">System</span><span class="punctuation">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">);</span>
<span class="ln">101 </span>          <span class="punctuation">}</span>
<span class="ln">102 </span>          <span class="comment single">//
</span><span class="ln">103 </span><span class="comment single"></span>          <span class="comment single">// Add the viewers into the frame to show them
</span><span class="ln">104 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">105 </span><span class="comment single"></span>          <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">setLayout</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">BorderLayout</span><span class="punctuation">());</span>
<span class="ln">106 </span>          <span class="name">getContentPane</span><span class="punctuation">().</span><span class="name">add</span><span class="punctuation">(</span><span class="name">sfv</span><span class="punctuation">,</span> <span class="name">BorderLayout</span><span class="punctuation">.</span><span class="name">CENTER</span><span class="punctuation">);</span>
<span class="ln">107 </span>          <span class="comment single">//
</span><span class="ln">108 </span><span class="comment single"></span>          <span class="comment single">// add the menubar to the frame
</span><span class="ln">109 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">110 </span><span class="comment single"></span>          <span class="name">setJMenuBar</span><span class="punctuation">(</span><span class="name">menu</span><span class="punctuation">);</span>
<span class="ln">111 </span>          <span class="comment single">//
</span><span class="ln">112 </span><span class="comment single"></span>          <span class="comment single">// JFrame stuff to make the thing show.
</span><span class="ln">113 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">114 </span><span class="comment single"></span>          <span class="name">pack</span><span class="punctuation">();</span>
<span class="ln">115 </span>          <span class="name">ATKGraphicsUtils</span><span class="punctuation">.</span><span class="name">centerFrameOnScreen</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">);</span> <span class="comment single">//TangoATK utility to center window
</span><span class="ln">116 </span><span class="comment single"></span>          <span class="name">setVisible</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">117 </span>       <span class="punctuation">}</span>
<span class="ln">118 </span>       <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword type">void</span> <span class="name function">main</span><span class="punctuation">(</span><span class="name">String</span> <span class="punctuation">[]</span> <span class="name">args</span><span class="punctuation">)</span>
<span class="ln">119 </span>       <span class="punctuation">{</span>
<span class="ln">120 </span>          <span class="keyword">new</span> <span class="name">ThirdApplication</span><span class="punctuation">();</span>
<span class="ln">121 </span>       <span class="punctuation">}</span>
<span class="ln">122 </span>       <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">quitItemActionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln">123 </span>       <span class="punctuation">{</span>
<span class="ln">124 </span>          <span class="name">System</span><span class="punctuation">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">);</span>
<span class="ln">125 </span>       <span class="punctuation">}</span>
<span class="ln">126 </span>       <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">errHistItemActionPerformed</span><span class="punctuation">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="punctuation">)</span>
<span class="ln">127 </span>       <span class="punctuation">{</span>
<span class="ln">128 </span>          <span class="name">errorHistory</span><span class="punctuation">.</span><span class="name">setVisible</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">129 </span>       <span class="punctuation">}</span>
<span class="ln">130 </span>  <span class="punctuation">}</span>
<span class="ln">131 </span>  <span class="punctuation">[</span><span class="name label">Input</span><span class="punctuation">:</span> <span class="name">line</span><span class="punctuation">.</span><span class="name">tex</span><span class="punctuation">]</span>
</pre>
<div class="line-block">
<div class="line">The synoptic application (ThirdApplication) should look something like
this (depending on your synoptic drawing file)</div>
<div class="line"><img alt="image" src="dance/AT97-65-size" /></div>
</div>
</div>
</div>
<div class="section" id="a-short-note-on-the-relationship-between-models-and-viewers">
<h3><a class="toc-backref" href="#id214">A short note on the relationship between models and viewers</a></h3>
<p>As seen in the examples above, the connection between a model and its
viewer is generally done by calling <tt class="docutils literal">setModel(model)</tt> on the viewer,
it is never explained what happens behind the scenes when this is done.</p>
<div class="section" id="listeners">
<h4>Listeners</h4>
<p>Most of the viewers implement some sort of <em>listener</em> interface, eg
INumberScalarListener. An object implementing such a listener interface
has the capability of receiving and treating <em>events</em> from a model which
emits events.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment single">// this is the setModel of a SimpleScalarViewer
</span><span class="ln"> 2 </span><span class="comment single"></span>    <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">setModelsetModel</span><span class="punctuation">(</span><span class="name">INumberScalar</span> <span class="name">scalar</span><span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>      <span class="name">clearModel</span><span class="punctuation">();</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">scalar</span> <span class="operator">!=</span> <span class="name">null</span><span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="ln"> 7 </span>        <span class="name">format</span> <span class="operator">=</span> <span class="name">scalar</span><span class="punctuation">.</span><span class="name">getProperty</span><span class="punctuation">(</span><span class="literal string">&quot;format&quot;</span><span class="punctuation">).</span><span class="name">getPresentation</span><span class="punctuation">();</span>
<span class="ln"> 8 </span>        <span class="name">numberModel</span> <span class="operator">=</span> <span class="name">scalar</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>     <span class="comment single">// this is where the viewer connects itself to the
</span><span class="ln">11 </span><span class="comment single"></span>     <span class="comment single">// model. After this the viewer will (hopefully) receive
</span><span class="ln">12 </span><span class="comment single"></span>     <span class="comment single">// events through its numberScalarChange() method
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>     <span class="name">numberModel</span><span class="punctuation">.</span><span class="name">addNumberScalarListener</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>
<span class="ln">17 </span>          <span class="name">numberModel</span><span class="punctuation">.</span><span class="name">getProperty</span><span class="punctuation">(</span><span class="literal string">&quot;format&quot;</span><span class="punctuation">).</span><span class="name">addPresentationListener</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">);</span>
<span class="ln">18 </span>        <span class="name">numberModel</span><span class="punctuation">.</span><span class="name">getProperty</span><span class="punctuation">(</span><span class="literal string">&quot;unit&quot;</span><span class="punctuation">).</span><span class="name">addPresentationListener</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">);</span>
<span class="ln">19 </span>      <span class="punctuation">}</span>
<span class="ln">20 </span>
<span class="ln">21 </span>    <span class="punctuation">}</span>
<span class="ln">22 </span>
<span class="ln">23 </span>
<span class="ln">24 </span>
<span class="ln">25 </span>  <span class="comment single">// Each time the model of this viewer (the numberscalar attribute) decides it is time, it
</span><span class="ln">26 </span><span class="comment single"></span>  <span class="comment single">// calls the numberScalarChange method of all its registered listeners
</span><span class="ln">27 </span><span class="comment single"></span>  <span class="comment single">// with a NumberScalarEvent object which contains the
</span><span class="ln">28 </span><span class="comment single"></span>  <span class="comment single">// the new value of the numberscalar attribute.
</span><span class="ln">29 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">30 </span><span class="comment single"></span>
<span class="ln">31 </span>    <span class="keyword">public</span> <span class="keyword type">void</span> <span class="name function">numberScalarChange</span><span class="punctuation">(</span><span class="name">NumberScalarEvent</span> <span class="name">evt</span><span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="ln">32 </span>      <span class="name">String</span> <span class="name">val</span><span class="punctuation">;</span>
<span class="ln">33 </span>      <span class="name">val</span> <span class="operator">=</span> <span class="name">getDisplayString</span><span class="punctuation">(</span><span class="name">evt</span><span class="punctuation">);</span>
<span class="ln">34 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">unitVisible</span><span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="ln">35 </span>        <span class="name">setText</span><span class="punctuation">(</span><span class="name">val</span> <span class="operator">+</span> <span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">numberModel</span><span class="punctuation">.</span><span class="name">getUnit</span><span class="punctuation">());</span>
<span class="ln">36 </span>      <span class="punctuation">}</span> <span class="keyword">else</span> <span class="punctuation">{</span>
<span class="ln">37 </span>        <span class="name">setText</span><span class="punctuation">(</span><span class="name">val</span><span class="punctuation">);</span>
<span class="ln">38 </span>      <span class="punctuation">}</span>
<span class="ln">39 </span>    <span class="punctuation">}</span>
</pre>
<p>All listeners in TangoATK implement the <tt class="docutils literal">IErrorListener</tt> interface
which specifies the <tt class="docutils literal">errorChange(ErrorEvent e)</tt> method. This means
that all listeners are forced to handle errors in some way or another.</p>
</div>
</div>
</div>
<div class="section" id="the-key-objects-of-tangoatk">
<h2><a class="toc-backref" href="#id215">The key objects of TangoATK</a></h2>
<p>As seen from the examples above, the key objects of TangoATK are the
<tt class="docutils literal">CommandList</tt> and the <tt class="docutils literal">AttributeList</tt>. These two classes inherit
from the abstract class <tt class="docutils literal">AEntityList</tt> which implements all of the
common functionality between the two lists. These lists use the
functionality of the <tt class="docutils literal">CommandFactory</tt>, the <tt class="docutils literal">AttributeFactory</tt>, which
both derive from <tt class="docutils literal">AEntityFactory,</tt> and the <tt class="docutils literal">DeviceFactory</tt>.</p>
<p>In addition to these factories and lists there is one (for the time
being) other important functionality lurking around, the refreshers.</p>
<div class="section" id="the-refreshers">
<h3><a class="toc-backref" href="#id216">The Refreshers</a></h3>
<p>The refreshers, represented in TangoATK by the <tt class="docutils literal">Refresher</tt> object, is
simply a subclass of <tt class="docutils literal">java.lang.Thread</tt> which will sleep for a given
amount of time and then call a method refresh on whatever kind of
<tt class="docutils literal">IRefreshee</tt> it has been given as parameter, as shown below</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="comment single">// This is an example from DeviceFactory.
</span><span class="ln">2 </span><span class="comment single"></span>  <span class="comment single">// We create a new Refresher with the name &quot;device&quot;
</span><span class="ln">3 </span><span class="comment single"></span>  <span class="comment single">// We add ourself to it, and start the thread
</span><span class="ln">4 </span><span class="comment single"></span>
<span class="ln">5 </span>
<span class="ln">6 </span>  <span class="name">Refresher</span> <span class="name">refresher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Refresher</span><span class="punctuation">(</span><span class="literal string">&quot;device&quot;</span><span class="punctuation">);</span>
<span class="ln">7 </span>  <span class="name">refresher</span><span class="punctuation">.</span><span class="name">addRefreshee</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">).</span><span class="name">start</span><span class="punctuation">();</span>
</pre>
<p>Both the <tt class="docutils literal">AttributeList</tt> and the <tt class="docutils literal">DeviceFactory</tt> implement the
<tt class="docutils literal">IRefreshee</tt> interface which specify only one method, <tt class="docutils literal">refresh()</tt>,
and can thus be refreshed by the <tt class="docutils literal">Refresher</tt>. Even if the new release
of TangoATK is based on the Tango Events, the refresher mecanisme will
not be removed. As a matter of fact, the method refresh() implemented in
AttributeList skips all attributes (members of the list) for which the
subscribe to the tango event has succeeded and calls the old refresh()
method for the others (for which subscribe to tango events has failed).</p>
<p>In a first stage this will allow the TangoATK applications to mix the
use of the old tango device servers (which do not implement tango
events) and the new ones in the same code. In other words, TangoATK
subscribes for tango events if possible otherwise TangoATK will refresh
the attributes through the old refresher mecanisme.</p>
<p>Another reason for keeping the refresher is that the subscribe event can
fail even for the attributes of the new Tango device servers. As soon as
the specified attribute is not polled the Tango events cannot be
generated for that attribute. Therefore the event subscription will
fail. In this case the attribute will be refreshed thanks to the ATK
attribute list refresher.</p>
<p>The <tt class="docutils literal">AttributePolledList</tt> class allows the application programmer to
force explicitly the use of the refresher method for all attributes
added in an AttributePolledList even if the corresponding device servers
implement tango events. Some viewers
(fr.esrf.tangoatk.widget.attribute.Trend) need an AttributePolledList in
order to force the refresh of the attribute without using tango events.</p>
<div class="section" id="what-happens-on-a-refresh">
<h4>What happens on a refresh</h4>
<p>When <tt class="docutils literal">refresh</tt> is called on the <tt class="docutils literal">AttributeList</tt> and the
<tt class="docutils literal">DeviceFactory</tt>, they loop through their objects, <tt class="docutils literal">IAttributes</tt> and
<tt class="docutils literal">IDevices</tt>, respectively, and ask them to refresh themselves if they
are not event driven.</p>
<p>When AttributeFactory, creates an <tt class="docutils literal">IAttribute</tt>, TangoATK tries to
subscribe for Tango Change event for that attribute. If the subscription
succeeds then the attribute is marked as event driven. If the
subscription for Tango Change event fails, TangoATK tries to subscribe
for Tango Periodic event. If the subscription succeeds then the
attribute is marked as event driven. If the subscription fails then the
attribute is marked as to be “ without events”.</p>
<p>In the refresh() method of the AttributeList during the loop through the
objects if the object is marked event driven then the object is simply
skipped. But if the object (attribute) is not marked as event driven,
the refresh() method of the AttributeList, asks the object to refresh
itself by calling the “refresh()” method of that object (attribute or
device). The refresh() method of an attribute will in turn call the
“readAttribute” on the Tango device.</p>
<p>The result of this is that the <tt class="docutils literal">IAttributes</tt> fire off events to their
registered listeners containing snapshots of their state. The events are
fired either because the IAttribute has received a Tango Change event,
respectively a Tango Periodic event (event driven objects), or because
the refresh() method of the object has issued a readAttribute on the
Tango device.</p>
</div>
</div>
<div class="section" id="the-devicefactory">
<h3><a class="toc-backref" href="#id217">The DeviceFactory</a></h3>
<p>The device factory is responsible for two things</p>
<ol class="arabic simple">
<li>Creating new devices (Tango device proxies) when needed</li>
<li>Refreshing the state and status of these devices</li>
</ol>
<p>Regarding the first point, new devices are created when they are asked
for and only if they have not already been created. If a programmer asks
for the same device twice, she is returned a reference to the same
device-object.</p>
<p>The <tt class="docutils literal">DeviceFactory</tt> contains a Refresher as described above, which
makes sure that the all in the updates their state and status and fire
events to its listeners.</p>
</div>
<div class="section" id="the-attributefactory-and-the-commandfactory">
<h3><a class="toc-backref" href="#id218">The AttributeFactory and the CommandFactory</a></h3>
<p>These factories are responsible for taking a name of an attribute or
command and returning an object representing the attribute or command.
It is also responsible for making sure that the appropriate <tt class="docutils literal">IDevice</tt>
is already available. Normally the programmer does not want to use these
factory classes directly. They are used by TangoATK classes indirectly
when the application programmer calls the AttributeList’s (or
CommandList’s) add() method.</p>
</div>
<div class="section" id="the-attributelist-and-the-commandlist">
<h3><a class="toc-backref" href="#id219">The AttributeList and the CommandList</a></h3>
<p>These lists are containers for attributes and commands. They delegate
the construction-work to the factories mentioned above, and generally do
not do much more, apart from containing refreshers, and thus being able
to make the objects they contain refresh their listeners.</p>
</div>
<div class="section" id="the-attributes">
<h3><a class="toc-backref" href="#id220">The Attributes</a></h3>
<p>The attributes come in several flavors. Tango supports the following
types:</p>
<ul class="simple">
<li>Short</li>
<li>Long</li>
<li>Double</li>
<li>String</li>
<li>Unsigned Char</li>
<li>Boolean</li>
<li>Unsigned Short</li>
<li>Float</li>
<li>Unsigned Long</li>
</ul>
<p>According to Tango specifications, all these types can be of the
following formats:</p>
<ul class="simple">
<li>Scalar, a single value</li>
<li>Spectrum, a single array</li>
<li>Image, a two dimensional array</li>
</ul>
<p>For the sake of simplicity, TangoATK has combined all the numeric types
into one, presenting all of them as doubles. So the TangoATK classes
which handle the numeric attributes are : NumberScalar, NumberSpectrum
and NumberImage (Number can be short, long, double, float, ...).</p>
<div class="section" id="the-hierarchy">
<h4>The hierarchy</h4>
<p>The numeric attribute hierarchy is expressed in the following
interfaces:</p>
<dl class="docutils">
<dt>INumberScalar</dt>
<dd>extends <strong>INumber</strong></dd>
<dt>INumberSpectrum</dt>
<dd>extends <strong>INumber</strong></dd>
<dt>INumberImage</dt>
<dd><p class="first">extends <strong>INumber</strong></p>
<p class="last"><strong>INumber</strong> in turn extends <strong>IAttribute</strong></p>
</dd>
</dl>
<p>Each of these types emit their proper events and have their proper
listeners. Please consult the javadoc for further information.</p>
</div>
</div>
<div class="section" id="id14">
<h3><a class="toc-backref" href="#id221">The Commands</a></h3>
<p>The commands in Tango are rather ugly beasts. There exists the following
kinds of commands</p>
<ul class="simple">
<li>Those which take input</li>
<li>Those which do not take input</li>
<li>Those which do output</li>
<li>Those which do not do output</li>
</ul>
<p>Now, for both input and output we have the following types:</p>
<ul class="simple">
<li>Double</li>
<li>Float</li>
<li>Unsigned Long</li>
<li>Long</li>
<li>Unsigned Short</li>
<li>Short</li>
<li>String</li>
</ul>
<p>These types can appear in scalar or array formats. In addition to this,
there are also four other types of parameters:</p>
<ol class="arabic simple">
<li>Boolean</li>
<li>Unsigned Char Array</li>
<li>The StringLongArray</li>
<li>The StringDoubleArray</li>
</ol>
<p>The last two types mentioned above are two-dimensional arrays containing
a string array in the first dimension and a long or double array in the
second dimension, respectively.</p>
<p>As for the attributes, all numeric types have been converted into
doubles, but there has been made little or no effort to create an
hierarchy of types for the commands.</p>
<div class="section" id="events-and-listeners">
<h4>Events and listeners</h4>
<p>The commands publish results to their <tt class="docutils literal">IResultListener</tt>s, by the
means of a <tt class="docutils literal">ResultEvent</tt>. The <tt class="docutils literal">IResultListener</tt> extends
<tt class="docutils literal">IErrorListener</tt>, any viewer of command-results should also know how
to handle errors. So a viewer of command-results implements
IResultListener interface and registers itself as a resultListener for
the command it has to show the results.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 4458)</p>
<p>Content block expected for the &quot;code&quot; directive; none found.</p>
<pre class="literal-block">
.. code:: cpp
  :number-lines:



</pre>
</div>
<p>[TwoRicardo]|image|</p>
</div>
</div>
</div>
</div>
<div class="section" id="writing-a-tango-device-server">
<h1><a class="toc-backref" href="#id222">Writing a TANGO device server</a></h1>
<div class="section" id="the-device-server-framework">
<h2><a class="toc-backref" href="#id223">The device server framework</a></h2>
<p>This chapter will present the TANGO device server framework. It will
introduce what is the device server pattern and then it will describe a
complete device server framework. A definition of classes used by the
device server framework is given in this chapter. This manual is not
intended to give the complete and detailed description of classes data
member or methods, refer to  to get
this full description. But first, the naming convention used in this
project is detailed.</p>
<p>The aim of the class definition given in this chapter is only to help
the reader to understand how a TANGO device server works. For a detailed
description of these classes (and their methods), refer to chapter
[Writing_chapter] or to .</p>
<div class="section" id="naming-convention-and-programming-language">
<h3><a class="toc-backref" href="#id224">Naming convention and programming language</a></h3>
<p>TANGO fully supports three different programming languages which are
<strong>C++, Java</strong> and <strong>Python</strong>. This documentation focuses on C++ Tango
class. For Java and Python Tango class, have a look at the <a class="reference external" href="http://www.tango-controls.org">Tango
web</a> pages where similar chapter for
Java and Python are available.</p>
<p>Every software project needs a naming convention. The naming convention
adopted for the TDSOM is very simple and only defines two guidelines
which are:</p>
<ul class="simple">
<li>Class names start with uppercase and use capitalization for compound
words (For instance MyClassName).</li>
<li>Method names are in lowercase and use underscores for compound words
(For instance my_method_name).</li>
</ul>
</div>
<div class="section" id="the-device-pattern">
<h3><a class="toc-backref" href="#id225">The device pattern</a></h3>
<p>Device server are written using the Device pattern. The aim of this
pattern is to provide the control programmer with a framework in which
s/he can develop new control objects. The device pattern uses other
design patterns like the Singleton and Command patterns. These patterns
are fully described in . The device pattern
class diagram for stepper motor device is drawn in figure [Dvice pattern
figure]</p>
<p>. In this figure, only classes surrounded with a dash line square are
device specific. All the other classes are part of the TDSOM core and
are developed by the Tango system team. Different kind of classes are
used by the device pattern.</p>
<ul class="simple">
<li>Three of them are root classes and it is only necessary to inherit
from them. These classes are the <strong>DeviceImpl</strong>, <strong>DeviceClass</strong> and
<strong>Command</strong> classes.</li>
<li>Classes necessary to implement commands. The TDSOM supports two ways
to create command : Using inheritance or using the template command
model. It is possible to mix model within the same device pattern<ol class="arabic">
<li>Using <strong>inheritance</strong>. This model of creating command heavily used
the polymorphism offered by each modern object oriented
programming language. In this schema, each command supported by a
device via the command_inout or command_inout_async operation
is implemented by a separate class. The Command class is the root
class for each of these classes. It is an abstract class. A
<em>execute</em> method must be defined in each sub-class. A
<em>is_allowed</em> method may also be re-defined in each class if the
default one does not fulfill all the needs <a class="footnote-reference" href="#id142" id="id15">[8]</a>. In our stepper
motor device server example, the DevReadPosition command follows
this model.</li>
<li>Using the <strong>template command</strong> model. Using this model, it is not
necessary to write one class for each command. You create one
instance of classes already defined in the TDSOM for each command.
The link between command name and method which need to be executed
is done through pointers to method. To support different kind of
command, four classes are part of the TDSOM. These classes are :<ol class="arabic">
<li>The <strong>TemplCommand</strong> class for command without input or output
parameter</li>
<li>The <strong>TemplCommandIn</strong> class for command with input parameter
but without output parameter</li>
<li>The <strong>TemplCommandOu</strong>t class for command with output
parameter but without input parameter</li>
<li>The <strong>TemplCommandInOut</strong> class for all the remaining commands</li>
</ol>
</li>
</ol>
</li>
<li>Classes necessary to implement TANGO device attributes. All these
classes are part of the TANGO core classes. These classes are the
<strong>MultiAttribute</strong>, <strong>Attribute</strong>, <strong>WAttribute</strong>, <strong>Attr</strong>,
<strong>SpectrumAttr</strong> and <strong>ImageAttr</strong> classes. The last three are used
to create user attribute. Each attribute supported by a device is
implemented by a separate class. The Attr class is the root class for
each of these classes. According to the attribute data format, the
user class implementing the attribute must inherit from the Attr,
SpectrumAttr or ImageAtttr class. SpectrumAttr class inherits from
Attr class and Image Attr class inherits from the SpectrumAttr class.
The Attr base class defined three methods called <em>is_allowed</em>,
<em>read</em> and <em>write</em>. These methods may be redefined in sub-classes in
order to implement the attribute specific behaviour.</li>
<li>The other are device specific. For stepper motor device, they are
named StepperMotor, StepperMotorClass and DevReadPosition.</li>
</ul>
<div class="section" id="the-tango-base-class-deviceimpl-class">
<h4>The Tango base class (DeviceImpl class)</h4>
<div class="section" id="description">
<h5>Description</h5>
<p>This class is the device root class and is the link between the Device
pattern and CORBA. It inherits from CORBA classes and implements all the
methods needed to execute CORBA operations and attributes. For instance,
its method <em>command_inout</em> is executed when a client requests a
command_inout operation. The method <em>name</em> of the DeviceImpl class is
executed when a client requests the name CORBA attribute. This class
also encapsulates some key device data like its name, its state, its
status, its black box.... This class is an abstract class and cannot be
instantiated as is.</p>
</div>
<div class="section" id="id16">
<h5>Contents</h5>
<p>The contents of this class can be summarized as :</p>
<ul class="simple">
<li>Different constructors and one destructor</li>
<li>Methods to access instance data members outside the class or its
derivate classes. These methods are necessary because data members
are declared as protected.</li>
<li>Methods triggered by CORBA attribute request</li>
<li>Methods triggered by CORBA operation request</li>
<li>The <em>init_device()</em> method. This method makes the class abstract. It
should be implemented by a sub-class. It is used by the inherited
classes constructors.</li>
<li>Methods triggered by the automatically added State and Status
commands. These methods are declared virtual and therefore can be
redefined in sub-classes. These two commands are automatically added
to the list of commands defined for a class of devices. They are
discussed in chapter [Auto_cmd]</li>
<li>A method called <em>always_executed_hook()</em> always executed for each
command before the device state is tested for command execution. This
method gives the programmer a hook where he(she) can program some
mandatory action which must be done before any command execution. An
example of the such action is an hardware access to the device to
read its real hardware state.</li>
<li>A method called <em>read_attr_hardware()</em> triggered by the
read_attributes CORBA operation. This method is called once for each
read_attributes call. This method is virtual and may be redefined in
sub-classes.</li>
<li>A method called <em>write_attr_hardware()</em> triggered by the
write_attributes CORBA operation. This method is called once for
each write_attributes call. This method is virtual and may be
redefined in sub-classes.</li>
<li>Methods for signal management (C++ specific)</li>
<li>Data members like the device name, the device status, the device
state</li>
<li>Some private methods and data members</li>
</ul>
</div>
</div>
<div class="section" id="the-dbdevice-class">
<h4>The DbDevice class</h4>
<p>Each DeviceImpl instance is an aggregate with one instance of the
DbDevice class. This DbDevice class can be used to query or modify
device properties. It provides an easy to use interface for device
objects in the database. The description of this class can be found in
the Tango API reference documentation available on the Tango WEB pages.</p>
</div>
<div class="section" id="the-command-class">
<h4>The Command class</h4>
<div class="section" id="description-of-the-inheritance-model">
<h5>Description of the inheritance model</h5>
<p>Within the TDSOM, each command supported by a device and implemented
using the inheritance model is implemented by a separate class. The
Command class is the root class for each of these classes. It is an
abstract class. It stores the command name, the command argument types
and description and mainly defines two methods which are the <em>execute</em>
and <em>is_allowed</em> methods. The <em>execute</em> method should be implemented in
each sub-class. A default <em>is_allowed</em> method exists for command always
allowed. A command also stores a parameter which is the command display
type. It is also used to select if the command must be displayed
according to the application mode (every day operation or expert mode).</p>
</div>
<div class="section" id="description-of-the-template-model">
<h5>Description of the template model</h5>
<p>Using this method, it is not necessary to create a separate class for
each device command. In this method, each command is represented by an
instance of one of the template command classes. They are four template
command classes. All these classes inherits from the Command class.
These four classes are :</p>
<ol class="arabic simple">
<li>The <strong>TemplCommand</strong> class. One object of this class must be created
for each command without input nor output parameters</li>
<li>The <strong>TemplCommandIn</strong> class. One object of this class must be
created for each command without output parameter but with input
parameter</li>
<li>The <strong>TemplCommandOut</strong> class. One object of this class must be
created for each command without input parameter but with output
parameter</li>
<li>The <strong>TemplCommandInOut</strong> class. One object of this class must be
created for each command with input and output parameters</li>
</ol>
<p>These four classes redefine the <em>execute</em> and <em>is_allowed</em> method of
the Command class. These classes provides constructors which allow the
user to :</p>
<ul class="simple">
<li>specify which method must be executed by these classes <em>execute</em>
method</li>
<li>optionally specify which method must be executed by these classes
<em>is_allowed</em> method.</li>
</ul>
<p>The method specification is done via pointer to method.</p>
<p>Remember that it is possible to mix command implementation method within
the same device pattern.</p>
</div>
<div class="section" id="id17">
<h5>Contents</h5>
<p>The content of this class can be summarizes as :</p>
<ul class="simple">
<li>Class constructors and destructor</li>
<li>Declaration of the <em>execute</em> method</li>
<li>Declaration of the <em>is_allowed</em> method</li>
<li>Methods to read/set class data members</li>
<li>Methods to extract data from the object used to transfer data on the
network</li>
<li>Methods to insert data into the object used to transfer data on the
network</li>
<li>Class data members like command name, command input data type,
command input data description...</li>
</ul>
</div>
</div>
<div class="section" id="the-deviceclass-class">
<h4>The DeviceClass class</h4>
<div class="section" id="id18">
<h5>Description</h5>
<p>This class implements all what is specific for a controlled object
class. For instance, every device of the same class supports the same
list of commands and therefore, this list of available commands is
stored in this DeviceClass. The structure returned by the info operation
contains a documentation URL <a class="footnote-reference" href="#id143" id="id19">[9]</a>. This documentation URL is the same
for every device of the same class. Therefore, the documentation URL is
a data member of this class. There should have only one instance of this
class per device pattern implementation. The device list is also stored
in this class. It is an abstract class because the two methods
<em>device_factory()</em> and <em>command_factory()</em> are declared as pure
virtual. The rule of the <em>device_factory()</em> method is to create all the
devices belonging to the device class. The rule of the
<em>command_factory()</em> method is to create one instance of all the classes
needed to support device commands. This class also stored the
<em>attribute_factory</em> method. The rule of this method is to store in a
vector of strings, the name of all the device attributes. This method
has a default implementation which is an empty body for device without
attribute.</p>
</div>
<div class="section" id="id20">
<h5>Contents</h5>
<p>The contents of this class can be summarize as :</p>
<ul class="simple">
<li>The <em>command_handler</em> method</li>
<li>Methods to access data members.</li>
<li>Signal related method (C++ specific)</li>
<li>Class constructor. It is protected to implements the Singleton
pattern</li>
<li>Class data members like the class command list, the device list...</li>
</ul>
</div>
</div>
<div class="section" id="the-dbclass-class">
<h4>The DbClass class</h4>
<p>Each DeviceClass instance is an aggregate with one instance of the
DbClass class. This DbClass class can be used to query or modify class
properties. It provides an easy to use interface for device objects in
the database. The description of this class can be found in the
reference Tango C++ API documentation available in the Tango WEB pages.</p>
</div>
<div class="section" id="the-multiattribute-class">
<h4>The MultiAttribute class</h4>
<div class="section" id="id21">
<h5>Description</h5>
<p>This class is a container for all the TANGO attributes defined for the
device. There is one instance of this class for each device. This class
is mainly an aggregate of Attribute object(s). It has been developed to
ease TANGO attribute management.</p>
</div>
<div class="section" id="id22">
<h5>Contents</h5>
<p>The class contents could be summarizes as :</p>
<ul class="simple">
<li>Miscellaneous methods to retrieve one attribute object in the
aggregate</li>
<li>Method to retrieve a list of attribute with an alarm level defined</li>
<li>Get attribute number method</li>
<li>Miscellaneous methods to check if an attribute value is outside the
authorized limits</li>
<li>Method to add messages for all attribute with an alarm set</li>
<li>Data members with the attribute list</li>
</ul>
</div>
</div>
<div class="section" id="the-attribute-class">
<h4>The Attribute class</h4>
<div class="section" id="id23">
<h5>Description</h5>
<p>There is one object of this class for each device attribute. This class
is used to store all the attribute properties, the attribute value and
all the alarm related data. Like commands, this class also stores th
attribute display type. It is foreseen to be used by future Tango
graphical application toolkit to select if the attribute must be
displayed according to the application mode (every day operation or
expert mode).</p>
</div>
<div class="section" id="id24">
<h5>Contents</h5>
<ul class="simple">
<li>Miscellaneous method to get boolean attribute information</li>
<li>Methods to access some data members</li>
<li>Methods to get/set attribute properties</li>
<li>Method to check if the attribute is in alarm condition</li>
<li>Methods related to attribute data</li>
<li>Friend function to print attribute properties</li>
<li>Data members (properties value and attribute data)</li>
</ul>
</div>
</div>
<div class="section" id="the-wattribute-class">
<h4>The WAttribute class</h4>
<div class="section" id="id25">
<h5>Description</h5>
<p>This class inherits from the Attribute class. There is one instance of
this class for each writable device attribute. On top of all the data
already managed by the Attribute class, this class stores the attribute
set value.</p>
</div>
<div class="section" id="id26">
<h5>Contents</h5>
<p>Within this class, you will mainly find methods related to attribute set
value storage and some data members.</p>
</div>
</div>
<div class="section" id="the-attr-class">
<h4>The Attr class</h4>
<p>Within the TDSOM, each attribute supported by a device is implemented by
a separate class. The Attr class is the root class for each of these
classes. It is used in conjonction with the Attribute and Wattribute
classes to implement Tango attribute behaviour. It defines three methods
which are the <em>is_allowed, read</em> and <em>write</em> methods. A default
<em>is_allowed</em> method exists for attribute always allowed. Default <em>read</em>
and <em>write</em> empty methods are defined. For readable attribute, it is
necessary to overwrite the <em>read</em> method. For writable attribute, it is
necessary to overwrite the <em>write</em> method and for read and write
attribute, both methods must be overwritten.</p>
</div>
<div class="section" id="the-spectrumattr-class">
<h4>The SpectrumAttr class</h4>
<p>This class inherits from the Attr class. It is the base class for user
spectrum attribute. It is used in conjonction with the Attribute and
WAttribute class to implement Tango spectrum attribute behaviour. From
the Attr class, it inherits the Attr <em>is_allowed</em>, <em>read</em> and <em>write</em>
methods.</p>
</div>
<div class="section" id="the-imageattr-class">
<h4>The ImageAttr class</h4>
<p>This class inherits from the SpectrumAttr class. It is the base class
for user image attribute. It is used in conjonction with the Attribute
and WAttribute class to implement Tango image attribute behaviour. From
the Attr class, it inherits the Attr <em>is_allowed</em>, <em>read</em> and <em>write</em>
methods.</p>
</div>
<div class="section" id="the-steppermotor-class">
<h4>The StepperMotor class</h4>
<div class="section" id="id27">
<h5>Description</h5>
<p>This class inherits from the DeviceImpl class and is the class
implementing the controlled object behavior. Each command will trigger a
method in this class written by the device server programmer and
specific to the object to be controlled. This class also stores all the
device specific data.</p>
</div>
<div class="section" id="definition">
<h5>Definition</h5>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="keyword">class</span> <span class="name class">StepperMotor</span><span class="operator">:</span> <span class="keyword">public</span> <span class="name">TANGO_BASE_CLASS</span>
<span class="ln"> 2 </span> <span class="punctuation">{</span>
<span class="ln"> 3 </span> <span class="keyword">public</span> <span class="operator">:</span>
<span class="ln"> 4 </span>    <span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="punctuation">,</span><span class="name">string</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>    <span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>    <span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>    <span class="operator">~</span><span class="name">StepperMotor</span><span class="punctuation">()</span> <span class="punctuation">{};</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>    <span class="name">DevLong</span> <span class="name function">dev_read_position</span><span class="punctuation">(</span><span class="name">DevLong</span><span class="punctuation">);</span>
<span class="ln">10 </span>   <span class="name">DevLong</span> <span class="name function">dev_read_direction</span><span class="punctuation">(</span><span class="name">DevLong</span><span class="punctuation">);</span>
<span class="ln">11 </span>   <span class="keyword type">bool</span> <span class="name function">direct_cmd_allowed</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>   <span class="keyword">virtual</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevState</span> <span class="name">dev_state</span><span class="punctuation">();</span>
<span class="ln">14 </span>   <span class="keyword">virtual</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">ConstDevString</span> <span class="name">dev_status</span><span class="punctuation">();</span>
<span class="ln">15 </span>
<span class="ln">16 </span>   <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">always_executed_hook</span><span class="punctuation">();</span>
<span class="ln">17 </span>
<span class="ln">18 </span>   <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">read_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">);</span>
<span class="ln">19 </span>   <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">write_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">);</span>
<span class="ln">20 </span>
<span class="ln">21 </span>   <span class="keyword type">void</span> <span class="name function">read_position</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">22 </span>   <span class="keyword type">bool</span> <span class="name function">is_Position_allowed</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">AttReqType</span> <span class="name">req</span><span class="punctuation">);</span>
<span class="ln">23 </span>   <span class="keyword type">void</span> <span class="name function">write_SetPosition</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">WAttribute</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">24 </span>   <span class="keyword type">void</span> <span class="name function">read_Direction</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">25 </span>
<span class="ln">26 </span>   <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">init_device</span><span class="punctuation">();</span>
<span class="ln">27 </span>   <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">delete_device</span><span class="punctuation">();</span>
<span class="ln">28 </span>
<span class="ln">29 </span>   <span class="keyword type">void</span> <span class="name function">get_device_properties</span><span class="punctuation">();</span>
<span class="ln">30 </span>
<span class="ln">31 </span> <span class="keyword">protected</span> <span class="operator">:</span>
<span class="ln">32 </span>   <span class="keyword type">long</span> <span class="name">axis</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">33 </span>   <span class="name">DevLong</span> <span class="name">position</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">34 </span>   <span class="name">DevLong</span> <span class="name">direction</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">35 </span>   <span class="keyword type">long</span> <span class="name">state</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">36 </span>
<span class="ln">37 </span>   <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="operator">*</span><span class="name">attr_Position_read</span><span class="punctuation">;</span>
<span class="ln">38 </span>   <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="operator">*</span><span class="name">attr_Direction_read</span><span class="punctuation">;</span>
<span class="ln">39 </span>   <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">attr_SetPosition_write</span><span class="punctuation">;</span>
<span class="ln">40 </span>
<span class="ln">41 </span>   <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">min</span><span class="punctuation">;</span>
<span class="ln">42 </span>   <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">max</span><span class="punctuation">;</span>
<span class="ln">43 </span>
<span class="ln">44 </span>   <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="operator">*</span><span class="name">ptr</span><span class="punctuation">;</span>
<span class="ln">45 </span> <span class="punctuation">};</span>
<span class="ln">46 </span>
<span class="ln">47 </span> <span class="punctuation">}</span> <span class="comment multiline">/* End of StepperMotor namespace */</span>
</pre>
<p>Line 1 : The StepperMotor class inherits from the DeviceImpl class</p>
<p>Line 4-7 : Class constructors and destructor</p>
<p>Line 9 : Method triggered by the DevReadPosition command</p>
<p>Line 10-11 : Methods triggered by the DevReadDirection command</p>
<p>Line 13 : Redefinition of the <em>dev_state</em> method of the DeviceImpl
class. This method will be triggered by the State command</p>
<p>Line 14 : Redefinition of the <em>dev_statu</em>s method of the DeviceImpl
class. This method will be triggered by the Status command</p>
<p>Line 16 : Redefinition of the <em>always_executed_hook</em> method.</p>
<p>Line 26 : Definition of the <em>init_device</em> method (declared as pure
virtual by the DeviceImpl class)</p>
<p>Line 27 : Definition of the <em>delete_device</em> method</p>
<p>Line 31-45 : Device data</p>
</div>
</div>
<div class="section" id="the-steppermotorclass-class">
<h4>The StepperMotorClass class</h4>
<div class="section" id="id28">
<h5>Description</h5>
<p>This class inherits from the DeviceClass class. Like the DeviceClass
class, there should be only one instance of the StepperMotorClass. This
is ensured because this class is written following the Singleton pattern
as defined in . All controlled object class
data which should be defined only once per class must be stored in this
object.</p>
</div>
<div class="section" id="id29">
<h5>Definition</h5>
<p>1 class StepperMotorClass : public DeviceClass</p>
<p>2 {</p>
<p>3 public:</p>
<p>4 static StepperMotorClass *init(const char *);</p>
<p>5 static StepperMotorClass *instance();</p>
<p>6 ~StepperMotorClass() {_instance = NULL;}</p>
<p>7</p>
<p>8 protected:</p>
<p>9 StepperMotorClass(string &amp;);</p>
<p>10 static StepperMotorClass *_instance;</p>
<p>11 void command_factory();</p>
<p>12</p>
<p>13 private:</p>
<p>14 void device_factory(Tango_DevVarStringArray *);</p>
<p>15 };</p>
<p>Line 1 : This class is a sub-class of the DeviceClass class</p>
<p>Line 4-5 and 9-10: Methods and data member necessary for the Singleton
pattern</p>
<p>Line 6 : Class destructor</p>
<p>Line 11 : Definition of the <em>command_factory</em> method declared as pure
virtual in the DeviceClass call</p>
<p>Line 13-14 : Definition of the <em>device_factory</em> method declared as pure
virtual in the DeviceClass class</p>
</div>
</div>
<div class="section" id="the-devreadposition-class">
<h4>The DevReadPosition class</h4>
<div class="section" id="id30">
<h5>Description</h5>
<p>This is the class for the DevReadPosition command. This class implements
the <em>execute</em> and <em>is_allowed</em> methods defined by the Command class.
This class is necessary because this command is implemented using the
inheritance model.</p>
</div>
<div class="section" id="id31">
<h5>Definition</h5>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">DevReadPositionCmd</span> <span class="operator">:</span> <span class="keyword">public</span> <span class="name">Command</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln"> 4 </span>      <span class="name">DevReadPositionCmd</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">,</span><span class="name">Tango_CmdArgType</span><span class="punctuation">,</span> <span class="name">Tango_CmdArgType</span><span class="punctuation">,</span> <span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">,</span> <span class="keyword">const</span> <span class="keyword type">char</span><span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>      <span class="operator">~</span><span class="name">DevReadPositionCmd</span><span class="punctuation">()</span> <span class="punctuation">{};</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>      <span class="keyword">virtual</span> <span class="keyword type">bool</span> <span class="name function">is_allowed</span> <span class="punctuation">(</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="punctuation">,</span> <span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>      <span class="keyword">virtual</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">execute</span> <span class="punctuation">(</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="punctuation">,</span> <span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>  <span class="punctuation">};</span>
</pre>
<p>Line 1 : The class is a sub class of the Command class</p>
<p>Line 4-5 : Class constructor and destructor</p>
<p>Line 7-8 : Definition of the <em>is_allowed</em> and <em>execute</em> method declared
as pure virtual in the Command class.</p>
</div>
</div>
<div class="section" id="the-positionattr-class">
<h4>The PositionAttr class</h4>
<div class="section" id="id32">
<h5>Description</h5>
<p>This is the class for the Position attribute. This attribute is a scalar
attribute and therefore inherits from the Attr base class. This class
implements the <em>read</em> and <em>is_allowed</em> methods defined by the Attr
class.</p>
</div>
<div class="section" id="id33">
<h5>Definition</h5>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">PositionAttr</span><span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln"> 4 </span>     <span class="name">PositionAttr</span><span class="punctuation">()</span><span class="operator">:</span><span class="name">Attr</span><span class="punctuation">(</span><span class="literal string">&quot;Position&quot;</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DEV_LONG</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">READ</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>     <span class="operator">~</span><span class="name">PositionAttr</span><span class="punctuation">()</span> <span class="punctuation">{};</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>     <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">read</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">dev</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>     <span class="punctuation">{(</span><span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="name">StepperMotor</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="name">dev</span><span class="punctuation">))</span><span class="operator">-&gt;</span><span class="name">read_Position</span><span class="punctuation">(</span><span class="name">att</span><span class="punctuation">);}</span>
<span class="ln"> 9 </span>     <span class="keyword">virtual</span> <span class="keyword type">bool</span> <span class="name function">is_allowed</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">dev</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">AttReqType</span> <span class="name">ty</span><span class="punctuation">)</span>
<span class="ln">10 </span>     <span class="punctuation">{</span><span class="keyword">return</span> <span class="punctuation">(</span><span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="name">StepperMotor</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="name">dev</span><span class="punctuation">))</span><span class="operator">-&gt;</span><span class="name">is_Position_allowed</span><span class="punctuation">(</span><span class="name">ty</span><span class="punctuation">);}</span>
<span class="ln">11 </span>  <span class="punctuation">};</span>
</pre>
<p>Line 1 : The class is a sub class of the Attr class</p>
<p>Line 4-5 : Class constructor and destructor</p>
<p>Line 7 : Re-definition of the <em>read</em> method defined in the Attr class.
This is simply a forward to the <em>read_Position</em> method of the
StepperMotor class</p>
<p>Line 9 : Re-definition of the <em>is_allowed</em> method defined in the Attr
class. This is also a forward to the <em>is_Position_allowed</em> method of
the StepperMotor class</p>
</div>
</div>
</div>
<div class="section" id="startup-of-a-device-pattern">
<h3><a class="toc-backref" href="#id226">Startup of a device pattern</a></h3>
<p>To start the device pattern implementation for stepper motor device,
four methods of the StepperMotorClass class must be executed. These
methods are :</p>
<ol class="arabic simple">
<li>The creation of the StepperMethodClass singleton via its <em>init</em>()
method</li>
<li>The <em>command_factory</em>() method of the StepperMotorClass class</li>
<li>The <em>attribute_factory</em>() method of the StepperMotorClass class.
This method has a default empty body for device class without
attributes.</li>
<li>The <em>device_factory</em>() method of the StepperMotorClass class</li>
</ol>
<p>This startup procedure is described in figure [pattern_startup_fig]</p>
<div class="figure">
<img alt="Device pattern startup sequence" src="ds_writing/startup" style="width: 14.00000cm; height: 10.00000cm;" />
<p class="caption">Device pattern startup sequence</p>
</div>
<p>. The creation of the StepperMotorClass will automatically create an
instance of the DeviceClass class. The constructor of the DeviceClass
class will create the Status, State and Init command objects and store
them in its command list.</p>
<p>The <em>command_factory</em>() method will simply create all the user
defined commands and add them in the command list.</p>
<p>The <em>attribute_factory</em>() method will simply build a list of device
attribute names.</p>
<p>The <em>device_factory</em>() method will create each StepperMotor object
and store them in the StepperMotorClass instance device list. The list
of devices to be created and their names is passed to the
<em>device_factory</em> method in its input argument. StepperMotor is a
sub-class of DeviceImpl class. Therefore, when a StepperMotor object is
created, a DeviceImpl object is also created. The DeviceImpl constructor
builds all the device attribute object(s) from the attribute list built
by the <em>attribute_factory()</em> method.</p>
</div>
<div class="section" id="command-execution-sequence">
<h3><a class="toc-backref" href="#id227">Command execution sequence</a></h3>
<p>The figure [command_timing_fig]</p>
<div class="figure">
<img alt="Command execution timing" src="ds_writing/command" style="width: 14.00000cm; height: 8.00000cm;" />
<p class="caption">Command execution timing</p>
</div>
<p>described how the method implementing a command is executed when a
command_inout CORBA operation is requested by a client. The
<em>command_inout</em> method of the StepperMotor object (inherited from the
DeviceImpl class) is triggered by an instance of a class generated by
the CORBA IDL compiler. This method calls the <em>command_handler</em>()
method of the StepperMotorClass object (inherited from the DeviceClass
class). The <em>command_handler</em> method searches in its command list for
the wanted command (using its name). If the command is found, the
<em>always_executed_hook</em> method of the StepperMotor object is called.
Then, the <em>is_allowed</em> method of the wanted command is executed. If the
<em>is_allowed</em> method returns correctly, the <em>execute</em> method is
executed. The <em>execute</em> method extracts the incoming data from the CORBA
object use to transmit data over the network and calls the user written
method which implements the command.</p>
</div>
<div class="section" id="the-automatically-added-commands">
<h3><a class="toc-backref" href="#id228">The automatically added commands</a></h3>
<p>In order to increase the common behavior of every kind of devices in a
TANGO control system, three commands are automatically added to each
class of devices. These commands are :</p>
<ul class="simple">
<li>State</li>
<li>Status</li>
<li>Init</li>
</ul>
<p>The default behavior of the method called by the State command depends
on the device state. If the device state is ON or ALARM, the method will
:</p>
<ul class="simple">
<li>read the attribute(s) with an alarm level defined</li>
<li>check if the read value is above/below the alarm level and eventually
change the device state to ALARM.</li>
<li>returns the device state.</li>
</ul>
<p>For all the other device state, the method simply returns the device
state stored in the DeviceImpl class. Nevertheless, the method used to
return this state (called <em>dev_state</em>) is defined as virtual and can be
redefined in DeviceImpl sub-class. The difference between the default
State command and the state CORBA attribute is the ability of the State
command to signal an error to the caller by throwing an exception.</p>
<p>The default behavior of the method called by the Status command depends
on the device state. If the device state is ON or ALARM, the method
returns the device status stored in the DeviceImpl class plus additional
message(s) for all the attributes which are in alarm condition. For all
the other device state, the method simply returns the device status as
it is stored in the DeviceImpl class. Nevertheless, the method used to
return this status (called <em>dev_status</em>) is defined as virtual and can
be redefined in DeviceImpl sub-class. The difference between the default
Status command and the status CORBA attribute is the ability of the
Status command to signal an error to the caller by throwing an
exception.</p>
<p>The Init command is used to re-initialize a device without changing its
network connection. This command calls the device <em>delete_device</em>
method and the device <em>init_device</em> method. The rule of the
<em>delete_device</em> method is to free memory allocated in the
<em>init_device</em> method in order to avoid memory leak.</p>
</div>
<div class="section" id="reading-writing-attributes">
<h3><a class="toc-backref" href="#id229">Reading/Writing attributes</a></h3>
<div class="section" id="reading-attributes">
<h4>Reading attributes</h4>
<p>A Tango client is able to read Tango attribute(s) with the CORBA
read_attributes call. Inside the device server, this call will trigger
several methods of the device class (StepperMotor in our example) :</p>
<ol class="arabic simple">
<li>The <em>always_executed_hook()</em> method.</li>
<li>A method call <em>read_attr_hardware()</em>. This method is called one
time per read_attributes CORBA call. The aim of this method is to
read the device hardware and to store the result in a device class
data member.</li>
<li>For each attribute to be read<ol class="arabic">
<li>A method called <em>is_&lt;att name&gt;_allowed()</em>. The rule of this
method is to allow (or disallow) the next method to be executed.
It is usefull for device with some attributes which can be read
only in some precise conditions. It has one parameter which is the
request type (read or write)</li>
<li>A method called <em>read_&lt;att name&gt;()</em>. The aim of this method is to
extract the real attribute value from the hardware read-out and to
store the attribute value into the attribute object. It has one
parameter which is a reference to the Attribute object to be read.</li>
</ol>
</li>
</ol>
<p>The figure [r_attribute_timing_fig] is a drawing of these method
calls sequencing. For attribute always readable, a default <em>is_allowed</em>
method is provided. This method always returns true.</p>
<div class="figure">
<img alt="Read attribute sequencing" src="ds_writing/r_attribute" />
<p class="caption">Read attribute sequencing</p>
</div>
</div>
<div class="section" id="writing-attributes">
<h4>Writing attributes</h4>
<p>A Tango client is able to write Tango attribute(s) with the CORBA
write_attributes call. Inside a device server, this call will trigger
several methods of the device class (StepperMotor in our example)</p>
<ol class="arabic simple">
<li>The <em>always_executed_hook()</em> method.</li>
<li>For each attribute to be written<ol class="arabic">
<li>A method called <em>is_&lt;att name&gt;_allowed()</em>. The rule of this
method is to allow (or disallow) the next method to be executed.
It is usefull for device with some attributes which can be written
only in some precise conditions. It has one parameter which is the
request type (read or write)</li>
<li>A method called <em>write_&lt;att name&gt;()</em>. It has one parameter which
is a reference to the WAttribute object to be written. The aim of
this method is to get the data to be written from the WAttribute
object and to write this value into the corresponding hardware. If
the hardware support writing several data in one go, code the
hardware access in the <em>write_attr_harware()</em> method.</li>
</ol>
</li>
<li>The write_attr_hardware() method. The rule of this method is to
effectively write the hardware in case it is able to support writing
several data in one go. If this is not the case, don’t code this
method (a default implementation is coded in the Tango base class)
and code the real hardware access in each <em>write_&lt;att name&gt;()</em>
method.</li>
</ol>
<p>The figure [w_attribute_timing_fig] is a drawing of these method
calls sequencing. For attribute always writeable, a default is_allowed
method is provided. This method always allways returns true.</p>
<div class="figure">
<img alt="Write attribute sequencing" src="ds_writing/w_attribute" />
<p class="caption">Write attribute sequencing</p>
</div>
</div>
</div>
<div class="section" id="id34">
<h3><a class="toc-backref" href="#id230">The device server framework</a></h3>
<div class="section" id="vocabulary">
<h4>Vocabulary</h4>
<p>A device server pattern implementation is embedded in a process called a
<strong>device server</strong>. Several instances of the same device server process
can be used in a TANGO control system. To identify instances, a device
server process is started with an <strong>instance name</strong> which is different
for each instance. The device server name is the couple device server
executable name/device server instance name. For instance, a device
server started with the following command</p>
<p>Perkin id11</p>
<p>starts a device server process with an instance name id11, an executable
name Perkin and a device server name Perkin/id11.</p>
</div>
<div class="section" id="the-dserver-class">
<h4>The DServer class</h4>
<p>In order to simplify device server process administration, a device of
the DServer class is automatically added to each device server process.
Thus, every device server process supports the same set of
administration commands. The implementation of this DServer class
follows the device pattern and therefore, its device behaves like any
other devices. The device name is</p>
<p>dserver/device server executable name/device server instance name</p>
<p>For instance, for the device server process described in chapter [Voc],
the dserver device name is dserver/perkin/id11. This name is returned by
the adm_name CORBA attribute available for every device. On top of the
three automatically added commands, this device supports the following
commands :</p>
<ul class="simple">
<li>DevRestart</li>
<li>RestartServer</li>
<li>QueryClass</li>
<li>QueryDevice</li>
<li>Kill</li>
<li>AddLoggingTarget (C++ server only)</li>
<li>RemoveLoggingTarget (C++ server only)</li>
<li>GetLoggingTarget (C++ server only)</li>
<li>GetLoggingLevel (C++ server only)</li>
<li>SetLoggingLevel (C++ server only)</li>
<li>StopLogging (C++ server only)</li>
<li>StartLogging (C++ server only)</li>
<li>PolledDevice</li>
<li>DevPollStatus</li>
<li>AddObjPolling</li>
<li>RemObjPolling</li>
<li>UpdObjPollingPeriod</li>
<li>StartPolling</li>
<li>StopPolling</li>
<li>EventSubscriptionChange</li>
<li>ZmqEventSubscriptionChange</li>
<li>LockDevice</li>
<li>UnLockDevice</li>
<li>ReLockDevices</li>
<li>DevLockStatus</li>
</ul>
<p>These commands will be fully described later in this document.</p>
<p>Several controlled object classes can be embedded within the same device
server process and it is the rule of this device to create all these
device server patterns and to call their command and device factories as
described in [Pattern startup]. The name and number of all the classes
to be created is known to this device after the execution of a method
called <em>class_factory</em>. It is the user responsibility to write this
method.</p>
</div>
<div class="section" id="the-tango-util-class">
<h4>The Tango::Util class</h4>
<div class="section" id="id35">
<h5>Description</h5>
<p>This class merges a complete set of utilities in the same class. It is
implemented as a singleton and there is only one instance of this class
per device server process. It is mandatory to create this instance in
order to run a device server. The description of all the methods
implemented in this class can be found in
.</p>
</div>
<div class="section" id="id36">
<h5>Contents</h5>
<p>Within this class, you can find :</p>
<ul class="simple">
<li>Static method to create/retrieve the singleton object</li>
<li>Miscellaneous utility methods like getting the server output trace
level, getting the CORBA ORB pointer, retrieving device server
instance name, getting the server PID and more. Please, refer to
 to get a complete list of all these
utility methods.</li>
<li>Method to create the device pattern implementing the DServer class
(<em>server_init()</em>)</li>
<li>Method to start the server (<em>server_run()</em>)</li>
<li>TANGO database related methods</li>
</ul>
</div>
</div>
<div class="section" id="a-complete-device-server">
<h4>A complete device server</h4>
<p>Within a complete device server, at least two implementations of the
device server pattern are created (one for the dserver object and the
other for the class of devices to control). On top of that, one instance
of the Tango::Util class must also be created.</p>
<div class="figure">
<img alt="A complete device server" src="ds_writing/complete_server" style="width: 14.00000cm; height: 10.00000cm;" />
<p class="caption">A complete device server</p>
</div>
<p>A drawing of a complete device server is in figure [completeDS]</p>
</div>
<div class="section" id="device-server-startup-sequence">
<h4>Device server startup sequence</h4>
<p>The device server startup sequence is the following :</p>
<ol class="arabic simple">
<li>Create an instance of the Tango::Util class. This will initialize the
CORBA Object Request Broker</li>
<li>Called the <em>server_init</em> method of the Tango::Util instance The call
to this method will :<ol class="arabic">
<li>Create the DServerClass object of the device pattern implementing
the DServer class. This will create the dserver object which
during its construction will :<ol class="arabic">
<li>Called the <em>class_factory</em> method of the DServer object. This
method must create all the xxxClass instance for all the device
pattern implementation embedded in the device server process.</li>
<li>Call the <em>command_factory</em> and <em>device_factory</em> of all the
classes previously created. The list of devices passed to each
call to the <em>device_factory</em> method is retrieved from the
TANGO database.</li>
</ol>
</li>
</ol>
</li>
<li>Wait for incoming request with the <em>server_run()</em> method of the
Tango::Util class.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="exchanging-data-between-client-and-server">
<h2><a class="toc-backref" href="#id231">Exchanging data between client and server</a></h2>
<p>Exchanging data between clients and server means most of the time
passing data between processes running on different computer using the
network. Tango limits the type of data exchanged between client and
server and defines a way to exchange these data. This chapter details
these features. Memory allocation and error reporting are also
discussed.</p>
<p><strong>All the rules described in this chapter are valid only for data
exchanged between client and server. For device server internal data,
classical C++ types can be used.</strong></p>
<div class="section" id="command-attribute-data-types">
<h3><a class="toc-backref" href="#id232">Command / Attribute data types</a></h3>
<p>Commands have a fixed calling syntax - consisting of one input argument
and one output argument. Arguments type must be chosen out of a fixed
set of 24 data types. Attributes support a sub-set of these data types
(those are the data type with the (1) note) plus the DevEnum data type.
The following table details type name, code and the corresponding CORBA
IDL types.</p>
<p>The type name used in the type name column of this table is the C++
name. In the IDL file, all the Tango definition are grouped in a IDL
module named Tango. The IDL module maps to C++ namespace. Therefore, all
the data type are parts of a namespace called Tango.</p>
<dl class="docutils">
<dt>|c|l| Type name &amp; IDL type</dt>
<dd>Tango::DevBoolean (1) &amp; boolean
Tango::DevShort (1) &amp; short
Tango::DevEnum (2) &amp; short (See chapter on advanced features)
Tango::DevLong (1) &amp; long
Tango::DevLong64 (1) &amp; long long
Tango::DevFloat (1) &amp; float
Tango::DevDouble (1) &amp; double
Tango::DevUShort (1) &amp; unsigned short
Tango::DevULong (1) &amp; unsigned long
Tango::DevULong64 (1) &amp; unsigned long long
Tango::DevString (1) &amp; string
Tango::DevVarCharArray &amp; sequence of unsigned char
Tango::DevVarShortArray &amp; sequence of short
Tango::DevVarLongArray &amp; sequence of long
Tango::DevVarLong64Array &amp; sequence of long long
Tango::DevVarFloatArray &amp; sequence of float
Tango::DevVarDoubleArray &amp; sequence of double
Tango::DevVarUShortArray &amp; sequence of unsigned short
Tango::DevVarULongArray &amp; sequence of unsigned long
Tango::DevVarULong64Array &amp; sequence of unsigned long long
Tango::DevVarStringArray &amp; sequence of string
Tango::DevVarLongStringArray &amp; structure with a sequence of long and a</dd>
<dt>sequence of string</dt>
<dd>Tango::DevVarDoubleStringArray &amp; structure with a sequence of double</dd>
<dt>and a sequence of string</dt>
<dd>Tango::DevState (1) &amp; enumeration
Tango::DevEncoded (1) &amp; structure with a string and a sequence of char</dd>
</dl>
<p>The CORBA Interface Definition Language uses a type called <strong>sequence</strong>
for variable length array. The Tango::DevUxxx types are used for
unsigned types. The Tango::DevVarxxxxArray must be used when the data to
be transferred are variable length array. The
Tango::DevVarLongStringArray and Tango::DevVarDoubleStringArray are
structures with two fields which are variable length array of Tango long
(32 bits) and variable length array of strings for the
Tango::DevVarLongStringArray and variable length array of double and
variable length array of string for the Tango::DevVarDoubleStringArray.
The Tango::State type is used by the State command to return the device
state.</p>
<div class="section" id="using-data-types-with-c">
<h4>Using data types with C++</h4>
<p>Unfortunately, the mapping between IDL and C++ was defined before the
C++ class library had been standardized. This explains why the standard
C++ string class or vector classes are not used in the IDL to C++
mapping.</p>
<p>TANGO commands/attributes argument types can be grouped on five groups
depending on the IDL data type used. These groups are :</p>
<ol class="arabic simple">
<li>Data type using basic types (Tango::DevBoolean, Tango::DevShort,
Tango::DevEnum, Tango::DevLong, Tango::DevFloat, Tango::DevDouble,
Tango::DevUshort and Tango::DevULong)</li>
<li>Data type using strings (Tango::DevString type)</li>
<li>Data types using sequences (Tango::DevVarxxxArray types except
Tango::DevVarLongStringArray and Tango::DevVarDoubleStringArray)</li>
<li>Data types using structures (Tango::DevVarLongStringArray and
Tango::DevVarDoubleStringArray types)</li>
<li>Data type using IDL enumeration (Tango::DevState type)</li>
</ol>
<p>In the following sub chapters, only summaries of the IDL to C++ mapping
are given. For a full description of the C++ mapping, please refer to
</p>
<div class="section" id="basic-types">
<h5>Basic types</h5>
<p>For these types, the mapping between IDL and C++ is obvious and defined
in the following table.</p>
<dl class="docutils">
<dt>|c|c|c|c| Tango type name &amp; IDL type &amp; C++ &amp; typedef</dt>
<dd>Tango::DevBoolean &amp; boolean &amp; CORBA::Boolean &amp; unsigned char
Tango::DevShort &amp; short &amp; CORBA::Short &amp; short
Tango::DevEnum &amp; short &amp; CORBA::Short &amp;
Tango::DevLong &amp; long &amp; CORBA::Long &amp; int
Tango::DevLong64 &amp; long long &amp; CORBA::LongLong &amp; long long or long (64</dd>
<dt>bits chip)</dt>
<dd>Tango::DevFloat &amp; float &amp; CORBA::Float &amp; float
Tango::DevDouble &amp; double &amp; CORBA::Double &amp; double
Tango::DevUShort &amp; unsigned short &amp; CORBA::UShort &amp; unsigned short
Tango::DevULong &amp; unsigned long &amp; CORBA::ULong &amp; unsigned long
Tango::DevULong64 &amp; unsigned long long &amp; CORBA:ULongLong &amp; unsigned</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 5602)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>long long or unsigned long (64 bits chip)</p>
<p>The types defined in the column named C++ should be used for a better
portability. All these types are defined in the CORBA namespace and
therefore their qualified names is CORBA::xxx. The Tango data type
DevEnum is a special case described in detail in the chapter about
advanced features.</p>
</div>
<div class="section" id="strings">
<h5>Strings</h5>
<p>Strings are mapped to <strong>char *</strong>. The use of <em>new</em> and <em>delete</em> for
dynamic allocation of strings is not portable. Instead, you must use
helper functions defined by CORBA (in the CORBA namespace). These
functions are :</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>      <span class="keyword type">char</span> <span class="operator">*</span><span class="name">CORBA</span><span class="operator">::</span><span class="name">string_alloc</span><span class="punctuation">(</span><span class="keyword type">unsigned</span> <span class="keyword type">long</span> <span class="name">len</span><span class="punctuation">);</span>
<span class="ln">2 </span>      <span class="keyword type">char</span> <span class="operator">*</span><span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">3 </span>      <span class="keyword type">void</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_free</span><span class="punctuation">(</span><span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
</pre>
<p>These functions handle dynamic memory for strings. The <em>string_alloc</em>
function allocates one more byte than requested by the len parameter
(for the trailing 0). The function <em>string_dup</em> combines the allocation
and copy. Both <em>string_alloc</em> and <em>string_dup</em> return a null pointer
if allocation fails. The <em>string_free</em> function must be used to free
memory allocated with <em>string_alloc</em> and <em>string_dup</em>. Calling
<em>string_free</em> for a null pointer is safe and does nothing. The
following code fragment is an example of the Tango::DevString type usage</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">str</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_alloc</span><span class="punctuation">(</span><span class="literal number integer">5</span><span class="punctuation">);</span>
<span class="ln">2 </span>     <span class="name">strcpy</span><span class="punctuation">(</span><span class="name">str</span><span class="punctuation">,</span><span class="literal string">&quot;TANGO&quot;</span><span class="punctuation">);</span>
<span class="ln">3 </span>
<span class="ln">4 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">str1</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Do you want to danse TANGO?&quot;</span><span class="punctuation">);</span>
<span class="ln">5 </span>
<span class="ln">6 </span>     <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_free</span><span class="punctuation">(</span><span class="name">str</span><span class="punctuation">);</span>
<span class="ln">7 </span>     <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_free</span><span class="punctuation">(</span><span class="name">str1</span><span class="punctuation">);</span>
</pre>
<p>Line 1-2 : TANGO is a five letters string. The CORBA::string_alloc
function parameter is 5 but the function allocates 6 bytes</p>
<p>Line 4 : Example of the CORBA::string_dup function</p>
<p>Line 6-7 : Memory deallocation</p>
</div>
<div class="section" id="sequences">
<h5>Sequences</h5>
<p>IDL sequences are mapped to C++ classes that behave like vectors with a
variable number of elements. Each IDL sequence type results in a
separate C++ class. Within each class representing a IDL sequence types,
you find the following method (only the main methods are related here) :</p>
<ol class="arabic simple">
<li>Four constructors.<ol class="arabic">
<li>A default constructor which creates an empty sequence.</li>
<li>The maximum constructor which creates a sequence with memory
allocated for at least the number of elements passed as argument.
This does not limit the number of element in the sequence but only
the way how memory is allocated to store element</li>
<li>A sophisticated constructor where it is possible to assign the
memory used by the sequence with a preallocated buffer.</li>
<li>A copy constructor which does a deep copy</li>
</ol>
</li>
<li>An assignment operator which does a deep copy</li>
<li>A <em>length</em> accessor which simply returns the current number of
elements in the sequence</li>
<li>A <em>length</em> modifier which changes the length of the sequence (which
is different than the number of elements in the sequence)</li>
<li>Overloading of the [] operator. The subscript operator [] provides
access to the sequence element. For a sequence containing elements of
type T, the [] operator is overloaded twice to return value of type T
&amp; and const T &amp;. Insertion into a sequence using the [] operator for
the const T &amp; make a deep copy. Sequence are numbered between 0 and
<em>length</em>() -1.</li>
</ol>
<p>Note that using the maximum constructor will not prevent you from
setting the length of the sequence with a call to the length modifier.
The following code fragment is an example of how to use a
Tango::DevVarLongArray type</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="operator">*</span><span class="name">mylongseq_ptr</span><span class="punctuation">;</span>
<span class="ln"> 2 </span>     <span class="name">mylongseq_ptr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span><span class="punctuation">();</span>
<span class="ln"> 3 </span>     <span class="name">mylongseq_ptr</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">4</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">mylongseq_ptr</span><span class="punctuation">)[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">1</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">mylongseq_ptr</span><span class="punctuation">)[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">2</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">mylongseq_ptr</span><span class="punctuation">)[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">3</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">mylongseq_ptr</span><span class="punctuation">)[</span><span class="literal number integer">3</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">4</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>     <span class="comment single">// (*mylongseq_ptr)[4] = 5;
</span><span class="ln">11 </span><span class="comment single"></span>
<span class="ln">12 </span>     <span class="name">CORBA</span><span class="operator">::</span><span class="name">Long</span> <span class="name">nb_elt</span> <span class="operator">=</span> <span class="name">mylongseq_ptr</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">();</span>
<span class="ln">13 </span>
<span class="ln">14 </span>     <span class="name">mylongseq_ptr</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">5</span><span class="punctuation">);</span>
<span class="ln">15 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">mylongseq_ptr</span><span class="punctuation">)[</span><span class="literal number integer">4</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">5</span><span class="punctuation">;</span>
<span class="ln">16 </span>
<span class="ln">17 </span>     <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">mylongseq_ptr</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">();</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">18 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Sequence elt &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">i</span> <span class="operator">+</span> <span class="literal number integer">1</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; = &quot;</span> <span class="operator">&lt;&lt;</span> <span class="punctuation">(</span><span class="operator">*</span><span class="name">mylongseq_ptr</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
</pre>
<p>Line 1 : Declare a pointer to Tango::DevVarLongArray type which is a
sequence of long</p>
<p>Line 2 : Create an empty sequence</p>
<p>Line 3 : Change the length of the sequence to 4</p>
<p>Line 5 - 8 : Initialize sequence elements</p>
<p>Line 10 ; Oups !!! The length of the sequence is 4. The behavior of this
line is undefined and may be a core can be dumped at run time</p>
<p>Line 12 : Get the number of element actually stored in the sequence</p>
<p>Line 14-15 : Grow the sequence to five elements and initialize element
number 5</p>
<p>Line 17-18 : Print sequence element</p>
<p>Another example for the Tango::DevVarStringArray type is given</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="name">mystrseq</span><span class="punctuation">(</span><span class="literal number integer">4</span><span class="punctuation">);</span>
<span class="ln"> 2 </span>     <span class="name">mystrseq</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">4</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>     <span class="name">mystrseq</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Rock and Roll&quot;</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>     <span class="name">mystrseq</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Bossa Nova&quot;</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>     <span class="name">mystrseq</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Waltz&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>     <span class="name">mystrseq</span><span class="punctuation">[</span><span class="literal number integer">3</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Tango&quot;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>     <span class="name">CORBA</span><span class="operator">::</span><span class="name">Long</span> <span class="name">nb_elt</span> <span class="operator">=</span> <span class="name">mystrseq</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">();</span>
<span class="ln">10 </span>
<span class="ln">11 </span>     <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">mystrseq</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">();</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">12 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Sequence elt &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">i</span> <span class="operator">+</span> <span class="literal number integer">1</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; = &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">mystrseq</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
</pre>
<p>Line 1 : Create a sequence using the maximum constructor</p>
<p>Line 2 : Set the sequence length to 4. This is mandatory even if you
used the maximum constructor.</p>
<p>Line 4-7 : Populate the sequence</p>
<p>Line 9 : Get how many strings are stored into the sequence</p>
<p>Line 11-12 : Print sequence elements.</p>
</div>
<div class="section" id="structures">
<h5>Structures</h5>
<p>Only three TANGO types are defined as structures. These types are the
Tango::DevVarLongStringArray, the Tango::DevVarDoubleStringArray and the
Tango::DevEncoded data type. IDL structures map to C++ structures with
corresponding members. For the Tango::DevVarLongStringArray, the two
members are named <em>svalue</em> for the sequence of strings and <em>lvalue</em> for
the sequence of longs. For the Tango::DevVarDoubleStringArray, the two
structure members are called <em>svalue</em> for the sequence of strings and
<em>dvalue</em> for the sequence of double. For the Tango::DevEncoded, the two
structure members are called <em>encoded_format</em> for a string describing
the data coding and <em>encoded_data</em> for the data themselves. The
encoded_data field type is a Tango::DevVarCharArray. An example of the
usage of the Tango::DevVarLongStringArray type is detailed below.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongStringArray</span> <span class="name">my_vl</span><span class="punctuation">;</span>
<span class="ln">2 </span>
<span class="ln">3 </span>     <span class="name">myvl</span><span class="punctuation">.</span><span class="name">svalue</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln">4 </span>     <span class="name">myvl</span><span class="punctuation">.</span><span class="name">svalue</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA_string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Samba&quot;</span><span class="punctuation">);</span>
<span class="ln">5 </span>     <span class="name">myvl</span><span class="punctuation">.</span><span class="name">svalue</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA_string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Rumba&quot;</span><span class="punctuation">);</span>
<span class="ln">6 </span>
<span class="ln">7 </span>     <span class="name">myvl</span><span class="punctuation">.</span><span class="name">lvalue</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">1</span><span class="punctuation">);</span>
<span class="ln">8 </span>     <span class="name">myvl</span><span class="punctuation">.</span><span class="name">lvalue</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">10</span><span class="punctuation">;</span>
</pre>
<p>Line 1 : Declaration of the structure</p>
<p>Line 3-5 : Initialization of two strings in the sequence of string
member</p>
<p>Line 7-8 : Initialization of one long in the sequence of long member</p>
</div>
<div class="section" id="the-devstate-data-type">
<h5>The DevState data type</h5>
<p>The Tango::DevState data type is used to transfer device state between
client and server. It is a IDL enumeration. IDL enumerated types map to
C++ enumerations (amazing no!) with a trailing dummy enumerator to force
enumeration to be a 32 bit type. The first enumerator will have the
value 0, the next one will have the value 1 and so on.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevState</span> <span class="name">state</span><span class="punctuation">;</span>
<span class="ln">2 </span>
<span class="ln">3 </span>     <span class="name">state</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">ON</span><span class="punctuation">;</span>
<span class="ln">4 </span>     <span class="name">state</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">FAULT</span><span class="punctuation">;</span>
</pre>
</div>
</div>
</div>
<div class="section" id="passing-data-between-client-and-server">
<h3><a class="toc-backref" href="#id233">Passing data between client and server</a></h3>
<p>In order to have one definition of the CORBA operation used to send a
command to a device whatever the command data type is, TANGO uses CORBA
IDL <strong>any</strong> object. The IDL type <em>any</em> provides a universal type that
can hold a value of arbitrary IDL types. Type <em>any</em> therefore allows you
to send and receive values whose types are not fixed at compile time.</p>
<p>Type <em>any</em> is often compared to a void * in C. Like a pointer to void,
an <em>any</em> value can denote a datum of any type. However, there is an
important difference; whereas a void * denotes a completely untyped
value that can be interpreted only with advance knowledge of its type,
values of type <em>any</em> maintain type safety. For example, if a sender
places a string value into an <em>any</em>, the receiver cannot extract the
string as a value of the wrong type. Attempt to read the contents of an
<em>any</em> as the wrong type cause a run-time error.</p>
<p>Internally, a value of type <em>any</em> consists of a pair of values. One
member of the pair is the actual value contained inside the <em>any</em> and
the other member of the pair is the type code. The type code is a
description of the value’s type. The type description is used to enforce
type safety when the receiver extracts the value. Extraction of the
value succeeds only if the receiver extracts the value as a type that
matches the information in the type code.</p>
<p>Within TANGO, the command input and output parameters are objects of the
IDL <em>any</em> type. Only insertion/extraction of all types defined as
command data types is possible into/from these <em>any</em> objects.</p>
<div class="section" id="c-mapping-for-idl-any-type">
<h4>C++ mapping for IDL any type</h4>
<p>The IDL any maps to the C++ class <strong>CORBA::Any</strong>. This class contains a
large number of methods with mainly methods to insert/extract data
into/from the any. It provides a default constructor which builds an any
which contains no value and a type code that indicates “no value”. Such
an any must be used for command which does not need input or output
parameter. The operator <strong>&lt;&lt;=</strong> is overloaded many times to insert data
into an any object. The operator <strong>&gt;&gt;=</strong> is overloaded many times to
extract data from an any object.</p>
<div class="section" id="inserting-extracting-tango-basic-types">
<h5>Inserting/Extracting TANGO basic types</h5>
<p>The insertion or extraction of TANGO basic types is straight forward
using the &lt;&lt;= or &gt;&gt;= operators. Nevertheless, the Tango::DevBoolean type
is mapped to a unsigned char and other IDL types are also mapped to char
C++ type (The unsigned is not taken into account in the C++ overloading
algorithm). Therefore, it is not possible to use operator overloading
for these IDL types which map to C++ char. For the Tango::DevBoolean
type, you must use the <em>CORBA::Any::from_boolean</em> or
<em>CORBA::Any::to_boolean</em> intermediate objects defined in the CORBA::Any
class.</p>
</div>
<div class="section" id="inserting-extracting-tango-strings">
<h5>Inserting/Extracting TANGO strings</h5>
<p>The &lt;&lt;= operator is overloaded for const char * and always makes a deep
copy. This deep copy is done using the CORBA::<em>string_dup</em> function.
The extraction of strings uses the &gt;&gt;= overloaded operator. The main
point is that the Any object retains ownership of the string, so the
returned pointer points at memory inside the Any. This means that you
must not deallocate the extracted string and you must treat the
extracted string as read-only.</p>
</div>
<div class="section" id="inserting-extracting-tango-sequences">
<h5>Inserting/Extracting TANGO sequences</h5>
<p>Insertion and extraction of sequences also uses the overloaded &lt;&lt;= and
&gt;&gt;= operators. The insertion operator is overloaded twice: once for
insertion by reference and once for insertion by pointer. If you insert
a value by reference, the insertion makes a deep copy. If you insert a
value by pointer, the Any assumes the ownership of the pointed-to
memory.</p>
<p>Extraction is always by pointer. As with strings, you must treat the
extracted pointer as read-only and must not deallocate it because the
pointer points at memory internal to the Any.</p>
</div>
<div class="section" id="inserting-extracting-tango-structures">
<h5>Inserting/Extracting TANGO structures</h5>
<p>This is identical to inserting/extracting sequences.</p>
</div>
<div class="section" id="inserting-extracting-tango-enumeration">
<h5>Inserting/Extracting TANGO enumeration</h5>
<p>This is identical to inserting/extracting basic types</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="name">a</span><span class="punctuation">;</span>
<span class="ln"> 2 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">l1</span><span class="punctuation">,</span><span class="name">l2</span><span class="punctuation">;</span>
<span class="ln"> 3 </span>    <span class="name">l1</span> <span class="operator">=</span> <span class="literal number integer">2</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>    <span class="name">a</span> <span class="operator">&lt;&lt;=</span> <span class="name">l1</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>    <span class="name">a</span> <span class="operator">&gt;&gt;=</span> <span class="name">l2</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="name">b</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevBoolean</span> <span class="name">b1</span><span class="punctuation">,</span><span class="name">b2</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>    <span class="name">b1</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln">10 </span>    <span class="name">b</span> <span class="operator">&lt;&lt;=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span><span class="operator">::</span><span class="name">from_boolean</span><span class="punctuation">(</span><span class="name">b1</span><span class="punctuation">);</span>
<span class="ln">11 </span>    <span class="name">b</span> <span class="operator">&gt;&gt;=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span><span class="operator">::</span><span class="name">to_boolean</span><span class="punctuation">(</span><span class="name">b2</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="name">s</span><span class="punctuation">;</span>
<span class="ln">14 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">str1</span><span class="punctuation">,</span><span class="name">str2</span><span class="punctuation">;</span>
<span class="ln">15 </span>    <span class="name">str1</span> <span class="operator">=</span> <span class="literal string">&quot;I like dancing TANGO&quot;</span><span class="punctuation">;</span>
<span class="ln">16 </span>    <span class="name">s</span> <span class="operator">&lt;&lt;=</span> <span class="name">str1</span><span class="punctuation">;</span>
<span class="ln">17 </span>    <span class="name">s</span> <span class="operator">&gt;&gt;=</span> <span class="name">str2</span><span class="punctuation">;</span>
<span class="ln">18 </span>
<span class="ln">19 </span>  <span class="comment single">//   CORBA::string_free(str2);
</span><span class="ln">20 </span><span class="comment single"></span>  <span class="comment single">//   a &lt;&lt;= CORBA::string_dup(&quot;Oups&quot;);
</span><span class="ln">21 </span><span class="comment single"></span>
<span class="ln">22 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="name">seq</span><span class="punctuation">;</span>
<span class="ln">23 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarFloatArray</span> <span class="name">fl_arr1</span><span class="punctuation">;</span>
<span class="ln">24 </span>    <span class="name">fl_arr1</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln">25 </span>    <span class="name">fl_arr1</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">1.0</span><span class="punctuation">;</span>
<span class="ln">26 </span>    <span class="name">fl_arr1</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">2.0</span><span class="punctuation">;</span>
<span class="ln">27 </span>    <span class="name">seq</span> <span class="operator">&lt;&lt;=</span> <span class="name">fl_arr1</span><span class="punctuation">;</span>
<span class="ln">28 </span>    <span class="keyword">const</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarFloatArray</span> <span class="operator">*</span><span class="name">fl_arr_ptr</span><span class="punctuation">;</span>
<span class="ln">29 </span>    <span class="name">seq</span> <span class="operator">&gt;&gt;=</span> <span class="name">fl_arr_ptr</span><span class="punctuation">;</span>
<span class="ln">30 </span>
<span class="ln">31 </span>  <span class="comment single">//   delete fl_arr_ptr;</span>
</pre>
<p>Line 1-5 : Insertion and extraction of Tango::DevLong type</p>
<p>Line 7-11 Insertion and extraction of Tango::DevBoolean type using the
CORBA::Any::from_boolean and CORBA::Any::to_boolean intermediate
structure</p>
<p>Line 13-17 : Insertion and extraction of Tango::DevString type</p>
<p>Line 19 : Wrong ! You should not deallocate a string extracted from an
any</p>
<p>Line 20 : Wrong ! Memory leak because the &lt;&lt;= operator will do the copy.</p>
<p>Line 22-29 : Insertion and extraction of Tango::DevVarxxxArray types.
This is an insertion by reference and the use of the &lt;&lt;= operator makes
a deep copy of the sequence. Therefore, after line 27, it is possible to
deallocate the sequence</p>
<p>Line 31: Wrong.! You should not deallocate a sequence extracted from an
any</p>
</div>
</div>
<div class="section" id="the-insert-and-extract-methods-of-the-command-class">
<h4>The insert and extract methods of the Command class</h4>
<p>In order to simplify the insertion/extraction into/from Any objects,
small helper methods have been written in the Command class. The
signatures of these methods are :</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>          <span class="keyword type">void</span> <span class="name function">extractextract</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="punctuation">,</span><span class="operator">&lt;</span><span class="name">Tango</span> <span class="name">type</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">2 </span>          <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">insertinsert</span><span class="punctuation">(</span><span class="operator">&lt;</span><span class="name">Tango</span> <span class="name">type</span><span class="operator">&gt;</span><span class="punctuation">);</span>
</pre>
<p>An <em>extract</em> method has been written for all Tango types. These method
extract the data from the Any object passed as parameter and throw an
exception if the Any data type is incompatible with the awaiting type.
An <em>insert</em> method have been written for all Tango types. These method
create an Any object, insert the data into the Any and return a pointer
to the created Any. For Tango types mapped to sequences or structures,
two <em>insert</em> methods have been written: one for the insertion from
pointer and the other for the insertion from reference. For Tango
strings, two <em>insert</em> methods have been written: one for insertion from
a classical Tango::DevString type and the other from a const
Tango::DevString type. The first one deallocate the memory after the
insert into the Any object. The second one only inserts the string into
the Any object.</p>
<p>The previous example can be rewritten using the insert/extract helper
methods (We suppose that we can use the Command class insert/extract
methods)</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">l1</span><span class="punctuation">,</span><span class="name">l2</span><span class="punctuation">;</span>
<span class="ln"> 2 </span>    <span class="name">l1</span> <span class="operator">=</span> <span class="literal number integer">2</span><span class="punctuation">;</span>
<span class="ln"> 3 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">a_ptr</span> <span class="operator">=</span> <span class="name">insert</span><span class="punctuation">(</span><span class="name">l1</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>    <span class="name">extract</span><span class="punctuation">(</span><span class="operator">*</span><span class="name">a_ptr</span><span class="punctuation">,</span><span class="name">l2</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevBoolean</span> <span class="name">b1</span><span class="punctuation">,</span><span class="name">b2</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>    <span class="name">b1</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">b_ptr</span> <span class="operator">=</span> <span class="name">insert</span><span class="punctuation">(</span><span class="name">b1</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>    <span class="name">extract</span><span class="punctuation">(</span><span class="operator">*</span><span class="name">b_ptr</span><span class="punctuation">,</span><span class="name">b2</span><span class="punctuation">);</span>
<span class="ln">10 </span>
<span class="ln">11 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">str1</span><span class="punctuation">,</span><span class="name">str2</span><span class="punctuation">;</span>
<span class="ln">12 </span>    <span class="name">str1</span> <span class="operator">=</span> <span class="literal string">&quot;I like dancing TANGO&quot;</span><span class="punctuation">;</span>
<span class="ln">13 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">s_ptr</span> <span class="operator">=</span> <span class="name">insert</span><span class="punctuation">(</span><span class="name">str1</span><span class="punctuation">);</span>
<span class="ln">14 </span>    <span class="name">extract</span><span class="punctuation">(</span><span class="operator">*</span><span class="name">s_ptr</span><span class="punctuation">,</span><span class="name">str2</span><span class="punctuation">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarFloatArray</span> <span class="name">fl_arr1</span><span class="punctuation">;</span>
<span class="ln">17 </span>    <span class="name">fl_arr1</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln">18 </span>    <span class="name">fl_arr1</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">1.0</span><span class="punctuation">;</span>
<span class="ln">19 </span>    <span class="name">fl_arr1</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">2.0</span><span class="punctuation">;</span>
<span class="ln">20 </span>    <span class="name">insert</span><span class="punctuation">(</span><span class="name">fl_arr1</span><span class="punctuation">);</span>
<span class="ln">21 </span>    <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">seq_ptr</span> <span class="operator">=</span> <span class="name">insert</span><span class="punctuation">(</span><span class="name">fl_arr1</span><span class="punctuation">);</span>
<span class="ln">22 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarFloatArray</span> <span class="operator">*</span><span class="name">fl_arr_ptr</span><span class="punctuation">;</span>
<span class="ln">23 </span>    <span class="name">extract</span><span class="punctuation">(</span><span class="operator">*</span><span class="name">seq_ptr</span><span class="punctuation">,</span><span class="name">fl_arr_ptr</span><span class="punctuation">);</span>
</pre>
<p>Line 1-4 : Insertion and extraction of Tango::DevLong type</p>
<p>Line 6-9 : Insertion and extraction of Tango::DevBoolean type</p>
<p>Line 11-14 : Insertion and extraction of Tango::DevString type</p>
<p>Line 16-23 : Insertion and extraction of Tango::DevVarxxxArray types.
This is an insertion by reference which makes a deep copy of the
sequence. Therefore, after line 20, it is possible to deallocate the
sequence</p>
</div>
</div>
<div class="section" id="c-memory-management">
<h3><a class="toc-backref" href="#id234">C++ memory management</a></h3>
<p>The rule described here are valid for variable length command data types
like Tango::DevString or all the Tango:: DevVarxxxxArray types.</p>
<p>The method executing the command must allocate the memory used to pass
data back to the client or use static memory (like buffer declares as
object data member. If necessary, the ORB will deallocate this memory
after the data have been sent to the caller. Fortunately, for incoming
data, the method have no memory management responsibilities. The details
about memory management given in this chapter assume that the
insert/extract methods of the Tango::Command class are used and only the
method in the device object is discussed.</p>
<div class="section" id="for-string">
<h4>For string</h4>
<p>Example of a method receiving a Tango::DevString and returning a
Tango::DevString is detailed just below</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">MyDev</span><span class="operator">::</span><span class="name">dev_string</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span>        <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>      <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;the received string is &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">argin</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>      <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Am I a good Tango dancer ?&quot;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>      <span class="name">argout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword type">char</span><span class="punctuation">[</span><span class="name">str</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">()</span> <span class="operator">+</span> <span class="literal number integer">1</span><span class="punctuation">];</span>
<span class="ln"> 9 </span>      <span class="name">strcpy</span><span class="punctuation">(</span><span class="name">argout</span><span class="punctuation">,</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">10 </span>
<span class="ln">11 </span>      <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">12 </span>  <span class="punctuation">}</span>
</pre>
<p>Note that there is no need to deallocate the memory used by the incoming
string. Memory for the outgoing string is allocated at line 8, then it
is initialized at the following line. The memory allocated at line 8
will be automatically freed by the usage of the <em>Command::insert()</em>
method. Using this schema, memory is allocated/freed each time the
command is executed. For constant string length, a statically allocated
buffer can be used.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">ConstDevString</span> <span class="name">MyDev</span><span class="operator">::</span><span class="name">dev_string</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">ConstDevString</span>   <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>      <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;the received string is &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">argin</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>      <span class="name">argout</span> <span class="operator">=</span> <span class="literal string">&quot;Hello world&quot;</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>      <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
</pre>
<p>A Tango::ConstDevString data type is used. It is not a new data Tango
data type. It has been introduced only to allows <em>Command::insert()</em>
method overloading. The argout pointer is initialized at line 7 with
memory statically allocated. In this case, no memory will be freed by
the <em>Command::insert()</em> method. There is also no memory copy in the
contrary of the previous example. A buffer defined as object data member
can also be used to set the argout pointer.</p>
</div>
<div class="section" id="for-array-sequence">
<h4>For array/sequence</h4>
<p>Example of a method returning a Tango::DevVarLongArray is detailed just
below</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="operator">*</span><span class="name">MyDev</span><span class="operator">::</span><span class="name">dev_array</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span>  <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span><span class="punctuation">();</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>      <span class="keyword type">long</span> <span class="name">output_array_length</span> <span class="operator">=</span> <span class="punctuation">...;</span>
<span class="ln"> 6 </span>      <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="name">output_array_length</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>      <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">output_array_length</span><span class="punctuation">;</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>          <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">i</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>      <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="punctuation">}</span>
</pre>
<p>In this case, memory is allocated at line 3 and 6. Then, the sequence is
populated. The sequence is created and returned using pointer. The
<em>Command::insert()</em> method will insert the sequence into the CORBA::Any
object using this pointer. Therefore, the CORBA::Any object will take
ownership of the allocated memory. It will free it when it will be
destroyed by the CORBA ORB after the data have been sent away. It is
also possible to use a statically allocated memory and to avoid copying
in the sequence used to returned the data. This is explained in the
following example assuming a buffer of long data is declared as device
data member and named buffer.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="operator">*</span><span class="name">MyDev</span><span class="operator">::</span><span class="name">dev_array</span><span class="punctuation">()</span>
<span class="ln">2 </span>  <span class="punctuation">{</span>
<span class="ln">3 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span>  <span class="operator">*</span><span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">4 </span>
<span class="ln">5 </span>      <span class="keyword type">long</span> <span class="name">output_array_length</span> <span class="operator">=</span> <span class="punctuation">...;</span>
<span class="ln">6 </span>      <span class="name">argout</span> <span class="operator">=</span> <span class="name">create_DevVarLongArray</span><span class="punctuation">(</span><span class="name">buffer</span><span class="punctuation">,</span><span class="name">output_array_length</span><span class="punctuation">);</span>
<span class="ln">7 </span>      <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">8 </span>  <span class="punctuation">}</span>
</pre>
<p>At line 3 only a pointer to a DevVarLongArray is defined. This pointer
is set at line 6 using the <em>create_DevVarLongArray()</em> method. This
method will create a sequence using this buffer without memory
allocation and with minimum copying. The <em>Command::insert()</em> method used
here is the same than the one used in the previous example. The sequence
is created in a way that the destruction of the CORBA::Any object in
which the sequence will be inserted will not destroy the buffer. The
following create_xxx methods are defined in the DeviceImpl class :</p>
<dl class="docutils">
<dt>|c|c| Method name &amp; data type</dt>
<dd>create_DevVarCharArray() &amp; unsigned char
create_DevVarShortArray() &amp; short
create_DevVarLongArray() &amp; DevLong
create_DevVarLong64Array() &amp; DevLong64
create_DevVarFloatArray() &amp; float
create_DevVarDoubleArray() &amp; double
create_DevVarUShortArray() &amp; unsigned short
create_DevVarULongArray() &amp; DevULong
create_DevVarULong64Array() &amp; DevULong64</dd>
</dl>
</div>
<div class="section" id="for-string-array-sequence">
<h4>For string array/sequence</h4>
<p>Example of a method returning a Tango::DevVarStringArray is detailed
just below</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="operator">*</span><span class="name">MyDev</span><span class="operator">::</span><span class="name">dev_str_array</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span><span class="punctuation">();</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>     <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Rumba&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Waltz&quot;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>     <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Jerck&quot;</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>     <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">10 </span>     <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="punctuation">}</span>
</pre>
<p>Memory is allocated at line 3 and 5. Then, the sequence is populated at
lines 6,7 and 9. The usage of the <em>CORBA::string_dup</em> function also
allocates memory. The sequence is created and returned using pointer.
The <em>Command::insert()</em> method will insert the sequence into the
CORBA::Any object using this pointer. Therefore, the CORBA::Any object
will take ownership of the allocated memory. It will free it when it
will be destroyed by the CORBA ORB after the data have been sent away.
For portability reason, the ORB uses the <em>CORBA::string_free</em> function
to free the memory allocated for each string. This is why the
corresponding <em>CORBA::string_du</em>p or <em>CORBA::string_alloc</em> function
must be used to reserve this memory.It is also possible to use a
statically allocated memory and to avoid copying in the sequence used to
returned the data. This is explained in the following example assuming a
buffer of pointer to char is declared as device data member and named
int_buffer.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="operator">*</span><span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_str_array</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">int_buffer</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal string">&quot;first&quot;</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>     <span class="name">int_buffer</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal string">&quot;second&quot;</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="operator">*</span><span class="name">argout</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="name">argout</span> <span class="operator">=</span> <span class="name">create_DevVarStringArray</span><span class="punctuation">(</span><span class="name">int_buffer</span><span class="punctuation">,</span><span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>     <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
</pre>
<p>The intermediate buffer is initialized with statically allocated memory
at lines 3 and 4. The returned sequence is created at line 7 with the
<em>create_DevVarStringArray()</em> method. Like for classical array, the
sequence is created in a way that the destruction of the CORBA::Any
object in which the sequence will be inserted will not destroy the
buffer.</p>
</div>
<div class="section" id="for-tango-composed-types">
<h4>For Tango composed types</h4>
<p>Tango supports only two composed types which are
Tango::DevVarLongStringArray and Tango::DevVarDoubleStringArray. These
types are translated to C++ structure with two sequences. It is not
possible to use memory statically allocated for these types. Each
structure element must be initialized as described in the previous
sub-chapters using the dynamically allocated memory case.</p>
</div>
</div>
<div class="section" id="reporting-errors">
<h3><a class="toc-backref" href="#id235">Reporting errors</a></h3>
<p>Tango uses the C++ try/catch plus exception mechanism to report errors.
Two kind of errors can be transmitted between client and server :</p>
<ol class="arabic simple">
<li>CORBA system error. These exceptions are raised by the ORB and
indicates major failures (A communication failure, An invalid object
reference...)</li>
<li>CORBA user exception. These kind of exceptions are defined in the IDL
file. This allows an exception to contain an arbitrary amount of
error information of arbitrary type.</li>
</ol>
<p>TANGO defines one user exception called <strong>DevFailed</strong>. This exception is
a variable length array of <strong>DevError</strong> type (a sequence of DevError).
The DevError type is a four fields structure. These fields are :</p>
<ol class="arabic simple">
<li>A string describing the type of the error. This string replaces an
error code and allows a more easy management of include files.</li>
<li>The error severity. It is an enumeration with the three values which
are WARN, ERR or PANIC.</li>
<li>A string describing in plain text the reason of the error</li>
<li>A string describing the origin of the error</li>
</ol>
<p>The Tango::DevFailed type is a sequence of DevError structures in order
to transmit to the client what is the primary error reason when several
classes are used within a command. The sequence element 0 must be the
DevError structure describing the primary error. A method called
<em>print_exception</em>() defined in the Tango::Except class prints the
content of exception (CORBA system exception or Tango::DevFailed
exception). Some static methods of the Tango::Except class called
<em>throw_exception</em>() can be used to throw Tango::DevFailed exception.
Some other static methods called <em>re_throw_exception()</em> may also be
used when the user want to add a new element in the exception sequence
and re-throw the exception. Details on these methods can be found in
.</p>
<div class="section" id="example-of-throwing-exception">
<h4>Example of throwing exception</h4>
<p>This example is a piece of code from the <em>command_handler</em>() method
of the DeviceImpl class. An exception is thrown to the client to
indicate that the requested command is not defined in the command list.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>    <span class="name">TangoSys_OMemStream</span> <span class="name">o</span><span class="punctuation">;</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>    <span class="name">o</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Command &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">command</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; not found&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">ends</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">Except</span><span class="operator">::</span><span class="name">throw_exception</span><span class="punctuation">(</span><span class="literal string">&quot;API_CommandNotFound&quot;</span><span class="punctuation">,</span>
<span class="ln"> 5 </span>                                <span class="name">o</span><span class="punctuation">.</span><span class="name">str</span><span class="punctuation">(),</span>
<span class="ln"> 6 </span>                                <span class="literal string">&quot;DeviceClass::command_handler&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>    <span class="name">try</span>
<span class="ln">10 </span>    <span class="punctuation">{</span>
<span class="ln">11 </span>        <span class="punctuation">.....</span>
<span class="ln">12 </span>    <span class="punctuation">}</span>
<span class="ln">13 </span>    <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevFailed</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">14 </span>    <span class="punctuation">{</span>
<span class="ln">15 </span>        <span class="name">TangoSys_OMemStream</span> <span class="name">o</span><span class="punctuation">;</span>
<span class="ln">16 </span>
<span class="ln">17 </span>        <span class="name">o</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Command &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">command</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; not found&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">ends</span><span class="punctuation">;</span>
<span class="ln">18 </span>        <span class="name">Tango</span><span class="operator">::</span><span class="name">Except</span><span class="operator">::</span><span class="name">re_throw_exception</span><span class="punctuation">(</span><span class="name">e</span><span class="punctuation">,</span>
<span class="ln">19 </span>                                  <span class="literal string">&quot;API_CommandNotFound&quot;</span><span class="punctuation">,</span>
<span class="ln">20 </span>                                  <span class="name">o</span><span class="punctuation">.</span><span class="name">str</span><span class="punctuation">(),</span>
<span class="ln">21 </span>                                  <span class="literal string">&quot;DeviceClass::command_handler&quot;</span><span class="punctuation">);</span>
<span class="ln">22 </span>    <span class="punctuation">}</span>
</pre>
<p>Line 1 : Build a memory stream. Use the TangoSys_MemStream because
memory streams are not managed the same way between Windows and Unix</p>
<p>Line 3 : Build the reason string in the memory stream</p>
<p>Line 4-5 : Throw the exception to client using one of the
<em>throw_exception</em> static method of the Except class. This
throw_exception method used here allows the definition of the error
type string, the reason string and the origin string of the DevError
structure. The remaining DevError field (the error severity) will be set
to its default value. Note that the first and third parameters are
casted to a <em>const char *</em>. Standard C++ defines that such a string is
already a <em>const char *</em> but the GNU C++ compiler (release 2.95) does
not use this type inside its function overloading but rather uses a
<em>char *</em> which leads to calling the wrong function.</p>
<p>Line 13-22 : Re-throw an already catched tango::DevFailed exception with
one more element in the exception sequence.</p>
</div>
</div>
</div>
<div class="section" id="id37">
<h2><a class="toc-backref" href="#id236">The Tango Logging Service</a></h2>
<p>A first introduction about this logging service has been done in chapter
[sec:The-Tango-Logging]</p>
<p>The TANGO Logging Service (TLS) gives the user the control over how much
information is actually generated and to where it goes. In practice, the
TLS allows to select both the logging level and targets of any device
within the control system.</p>
<div class="section" id="logging-targets">
<h3><a class="toc-backref" href="#id237">Logging Targets</a></h3>
<p>The TLS implementation allows each device logging requests to print
simultaneously to multiple destinations. In the TANGO terminology, an
output destination is called a <strong>logging target</strong>. Currently, targets
exist for console, file and log consumer device.</p>
<p>CONSOLE: logs are printed to the console (i.e. the standard output),</p>
<p>FILE: logs are stored in a XML file. A rolling mechanism is used to
backup the log file when it reaches a certain size (see below),</p>
<p>DEVICE: logs are sent to a device implementing a well known TANGO
interface (see section [sec:Tango-log-consumer] for a definition of the
log consumer interface). One implementation of a log consumer associated
to a graphical user interface is available within the Tango package. It
is called the LogViewer.</p>
<p>The device’s logging behavior can be control by adding and/or removing
targets.</p>
<p>Note : When the size of a log file (for file logging target) reaches the
so-called rolling-file-threshold (rft), it is backuped as
current_log_file_name + _1 and a new current_log_file_name is
opened. Obviously, there is only one backup file at a time (i.e. any
existing backup is destroyed before the current log file is backuped).
The default threshold is 20 Mb, the minimum is 500 Kb and the maximum is
1000 Mb.</p>
</div>
<div class="section" id="logging-levels">
<h3><a class="toc-backref" href="#id238">Logging Levels</a></h3>
<p>Devices can be assigned a logging level. It acts as a filter to control
the kind of information sent to the targets. Since, there are (usually)
much more low level log statements than high level statements, the
logging level also control the amount of information produced by the
device. The TLS provides the following levels (semantic is just given to
be indicative of what could be log at each level):</p>
<p>OFF: Nothing is logged</p>
<p>FATAL: A fatal error occurred. The process is about to abort</p>
<p>ERROR: An (unrecoverable) error occurred but the process is still alive</p>
<p>WARN: An error occurred but could be recovered locally</p>
<p>INFO: Provides information on important actions performed</p>
<p>DEBUG: Generates detailed information describing the internal behavior
of a device</p>
<p>Levels are ordered the following way:</p>
<p>DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL &lt; OFF</p>
<p>For a given device, a level is said to be enabled if it is greater or
equal to the logging level assigned to this device. In other words, any
logging request which level is lower than the device’s logging level is
ignored.</p>
<p>Note: The logging level can’t be controlled at target level. The
device’s targets shared the same device logging level.</p>
</div>
<div class="section" id="sending-tango-logging-messages">
<h3><a class="toc-backref" href="#id239">Sending TANGO Logging Messages</a></h3>
<div class="section" id="logging-macros-in-c">
<h4>Logging macros in C++</h4>
<p>The TLS provides the user with easy to use C++ macros with <em>printf</em> and
<em>stream</em> like syntax. For each logging level, a macro is defined in both
styles:</p>
<ul class="simple">
<li>LOG_{FATAL, ERROR, WARN, INFO or DEBUG}</li>
<li>{FATAL, ERROR, WARN, INFO or DEBUG}_STREAM</li>
</ul>
<p>These macros are supposed to be used within the device’s main
implementation class (i.e. the class that inherits (directly or
indirectly) from the Tango::DeviceImpl class). In this context, they
produce logging messages containing the device name. In other words,
they automatically identify the log source. Section [sub:C++-logging-in]
gives a trick to log in the name of device outside its main
implementation class. Printf like example:</p>
<p>LOG_DEBUG((Msg#%d - Hello world, i++));</p>
<p>Stream like example:</p>
<p>DEBUG_STREAM &lt;&lt; Msg# &lt;&lt; i++ &lt;&lt; - Hello world &lt;&lt; endl;</p>
<p>These two logging requests are equivalent. Note the double parenthesis
in the printf version.</p>
</div>
<div class="section" id="c-logging-in-the-name-of-a-device">
<h4>C++ logging in the name of a device</h4>
<p>A device implementation is sometimes spread over several classes. Since
all these classes implement the same device, their logging requests
should be associated with this device name. Unfortunately, the C++
logging macros can’t be used because they are outside the device’s main
implementation class. The Tango::LogAdapter class is a workaround for
this limitation.</p>
<p>Any method not member of the device’s main implementation class, which
send log messages associated to a device must be a member of a class
inheriting from the Tango::LogAdapter class. Here is an example:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="keyword">class</span> <span class="name class">MyDeviceActualImpl</span><span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">LogAdapter</span>
<span class="ln"> 2 </span> <span class="punctuation">{</span>
<span class="ln"> 3 </span> <span class="keyword">public</span> <span class="operator">:</span>
<span class="ln"> 4 </span>    <span class="name">MyDeviceActualImpl</span><span class="punctuation">(...,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">device</span><span class="punctuation">,...)</span>
<span class="ln"> 5 </span>    <span class="operator">:</span><span class="name">Tango</span><span class="operator">::</span><span class="name">LogAdpater</span><span class="punctuation">(</span><span class="name">device</span><span class="punctuation">)</span>
<span class="ln"> 6 </span>    <span class="punctuation">{</span>
<span class="ln"> 7 </span>          <span class="punctuation">....</span>
<span class="ln"> 8 </span> <span class="comment single">//
</span><span class="ln"> 9 </span><span class="comment single"></span> <span class="comment single">// The following log is associated to the device passed to the constructor
</span><span class="ln">10 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">11 </span><span class="comment single"></span>         <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;In MyDeviceActualImpl constructor&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">12 </span>
<span class="ln">13 </span>         <span class="punctuation">....</span>
<span class="ln">14 </span>    <span class="punctuation">}</span>
<span class="ln">15 </span> <span class="punctuation">};</span>
</pre>
</div>
</div>
</div>
<div class="section" id="writing-a-device-server-process">
<h2><a class="toc-backref" href="#id240">Writing a device server process</a></h2>
<p>Writing a device server can be made easier by adopting the correct
approach. This chapter will describe how to write a device server
process. It is divided into the following parts : understanding the
device, defining device commands/attributes/pipes, choosing device state
and writing the necessary classes. All along this chapter, examples will
be given using the stepper motor device server. Writing a device server
for our stepper motor example device means writing :</p>
<ul class="simple">
<li>The <em>main</em> function</li>
<li>The <em>class_factory</em> method (only for C++ device server)</li>
<li>The <em>StepperMotorClass</em> class</li>
<li>The <em>DevReadPositionCmd</em> and <em>DevReadDirectionCmd</em> classes</li>
<li>The <em>PositionAttr</em>, <em>SetPositionAttr</em> and <em>DirectionAttr</em> classes</li>
<li>The <em>StepperMotor</em> class.</li>
</ul>
<p>All these functions and classes will be detailed. The stepper motor
device server described in this chapter supports 2 commands and 3
attributes which are :</p>
<ul class="simple">
<li>Command DevReadPosition implemented using the inheritance model</li>
<li>Command DevReadDirection implemented using the template command model</li>
<li>Attribute Position (position of the first motor). This attribute is
readable and is linked with a writable attribute (called
SetPosition). When the value of this attribute is requested by the
client, the value of the associated writable attribute is also
returned.</li>
<li>Attribute SetPosition (writable attribute linked with the Position
attribute). This attribute has some properties with user defined
default value.</li>
<li>Attribute Direction (direction of the first motor)</li>
</ul>
<p>As the reader will understand during the reading of the following
sub-chapters, the command and attributes classes (<em>DevReadPositionCmd</em>,
<em>DevReadDirectionCmd</em>, <em>PositionAttr</em>, <em>SetPositionAttr</em> and
<em>DirectionAttr</em>) are very simple classes. A tool called <strong>Pogo</strong> has
been developped to automatically generate/maintain these classes and to
write part of the code needed in the remaining one. See xx to know more
on this Pogo tool.</p>
<p>In order to also gives an example of how the database objects part of
the Tango device pattern could be used, our device have two properties.
These properties are of the Tango long data types and are named “Max”
and “Min”.</p>
<div class="section" id="understanding-the-device">
<h3><a class="toc-backref" href="#id241">Understanding the device</a></h3>
<p>The first step before writing a device server is to develop an
understanding of the hardware to be programmed. The Equipment
Responsible should have description of the hardware and its operating
modes (manuals, spec sheets etc.). The Equipment Responsible must also
provide specifications of what the device server should do. The Device
Server Programmer should demand an exact description of the registers,
alarms, interlocks and any timing constraints which have to be kept. It
is very important to have a good understanding of the device interfacing
before starting designing a new class.</p>
<p>Once the Device Server Programmer has understood the hardware the next
important step is to define what is a logical device i.e. what part of
the hardware will be abstracted out and treated as a logical device. In
doing so the following points of the TDSOM should be kept in mind</p>
<ul class="simple">
<li>Each device is known and accessed by its ascii name.</li>
<li>The device is exported onto the network to be imported by
applications.</li>
<li>Each device belongs to a class.</li>
<li>A list of commands exists per device.</li>
<li>Applications use the device server api to execute commands on a
device.</li>
</ul>
<p>The above points have to be taken into account when designing the level
of device abstraction. The definition of what is a device for a certain
hardware is primarily the job of the Device Server Programmer and the
Applications Programmer but can also involve the Equipment Responsible.
The Device Server Programmer should make sure that the Applications
Programmer agrees with her definition of what is a device.</p>
<p>Here are some guidelines to follow while defining the level of device
abstraction -</p>
<ul class="simple">
<li><strong>efficiency</strong>, make sure that not a too fine level of device
abstraction has been chosen. If possible group as many attributes
together to form a device. Discuss this with the Applications
Programmer to find out what is efficient for her application.</li>
<li><strong>hardware independency</strong>, one of the main reasons for writing device
servers is to provide the Applications Programmer with a <em>software</em>
interface as opposed to a <em>hardware</em> interface. Hide the hardware
structure of the device. For example if the user is only interested
in a single channel of a multichannel device then define each channel
to be a logical device. The user should not be aware of hardware
addresses or cabling details. The user is very often a scientist who
has a physics-oriented world view and not a hardware-oriented world
view. Hardware independency also has the advantage that applications
are immune to hardware changes to the device</li>
<li><strong>object oriented world view</strong>, another <em>raison d’etre</em> behind the
device server model is to build up an object oriented view of the
world. The device should resemble the user’s view of the object as
closely as possible. In the case of the ESRF’s beam lines for
example, the devices should resemble beam line scientist’s view of
the machine.</li>
<li><strong>atomism</strong>, each device can be considered like an atom - is a
independent object. It should appear independent to the client even
if behind the scenes it shares some hardware or software with other
objects. This is often the case with multichannel devices where the
user would like to see each channel as a device but it is obvious
that the channels cannot be programmed completely independently. The
logical device is there to hide or make transparent this fact. If it
is impossible to send commands to one device without modifying
another device then a single device should be made out the two
devices.</li>
<li><strong>tailored</strong> <em>vs</em> <strong>general</strong>, one of the philosophies of the TDSOM
is to provide tailored solutions. For example instead of writing one
<em>serial line</em> class which treats the general case of a serial line
device and leaving the device protocol to be implemented in the
client the TDSOM advocates implementing a device class which handles
the protocol of the device. This way the client only has to know the
commands of the class and not the details of the protocol. Nothing
prevents the device class from using a general purpose serial line
class if it exists of course.</li>
</ul>
</div>
<div class="section" id="defining-device-commands">
<h3><a class="toc-backref" href="#id242">Defining device commands</a></h3>
<p>Each device has a list of commands which can be executed by the
application across the network or locally. These commands are the
Application Programmer’s network knobs and dials for interacting with
the device.</p>
<p>The list of commands to be implemented depends on the capabilities of
the hardware, the list of sensible functions which can be executed at a
distance and of course the functionality required by the application.
This implies a close collaboration between the Equipment Responsible,
Device Server Programmer and the Application Programmer.</p>
<p>When drawing up the list of commands particular attention should be paid
to the following points</p>
<ul class="simple">
<li><strong>performance</strong>, no single command should monopolize the device
server for a long time (a nominal value for long is one second).
Commands should be implemented in such a way that it executes
immediately returning with a response. At best try to keep command
execution time down to less than the typical overhead of an rpc call
i.e. som milliseconds. This of course is not always possible e.g. a
serial line device could require 100 milliseconds of protocol
exchange. The Device Server Programmer should find the best trade-off
between the users requirements and the devices capabilities. If a
command implies a sequence of events which could last for a long time
then implement the sequence of events in another thread - don’t block
the device server.</li>
<li><strong>robustness</strong>, should be provided which allow the client to recover
from error conditions and or do a warm startup.</li>
</ul>
<div class="section" id="standard-commands">
<h4>Standard commands</h4>
<p>A minimum set of three commands exist for all devices. These commands
are</p>
<ul class="simple">
<li>State which returns the state of a device</li>
<li>Status which returns the status of the device as a formatted ascii
string</li>
<li>Init which re-initialize a device without changing its network
connection</li>
</ul>
<p>These commands have already been discussed in [Auto_cmd]</p>
</div>
</div>
<div class="section" id="choosing-device-state">
<h3><a class="toc-backref" href="#id243">Choosing device state</a></h3>
<p>The device state is a number which reflects the availability of the
device. To simplify the coding for generic application, a predefined set
of states are supported by TANGO. This list has 14 members which are</p>
<dl class="docutils">
<dt>|c| State name</dt>
<dd>ON
OFF
CLOSE
OPEN
INSERT
EXTRACT
MOVING
STANDBY
FAULT
INIT
RUNNING
ALARM
DISABLE
UNKNOWN</dd>
</dl>
<p>The names used here have obvious meaning.</p>
</div>
<div class="section" id="device-server-utilities-to-ease-coding-debugging">
<h3><a class="toc-backref" href="#id244">Device server utilities to ease coding/debugging</a></h3>
<p>The device server framework supports one set of utilities to ease the
process of coding and debugging device server code. This utility is :</p>
<ol class="arabic simple">
<li>The device server verbose option</li>
</ol>
<p>Using this facility avoids the usage of the classical “#ifdef DEBUG”
style which makes code less readable.</p>
<div class="section" id="the-device-server-verbose-option">
<h4>The device server verbose option</h4>
<p>Each device server supports a verbose option called <strong>-v</strong>. Four verbose
levels are defined from 1 to 4. Level 4 is the most talkative one. If
you use the -v option without specifying level, level 4 will be assumed.</p>
<p>Since Tango release 3, a Tango Logging Service has been introduced
(detailed in chapter [The-Tango-Logging chapter]). This -v option set-up
the logging service. If it used, it will automatically add a <em>console</em>
target to all devices embedded within the device server process. Level 1
and 2 will set the logging level to all devices embedded within the
device server to INFO. Level 3 and 4 will set the logging level to all
devices embedded within the device server to DEBUG. All messages sent by
the API layer are associated to the administration device.</p>
</div>
<div class="section" id="c-utilities-to-ease-device-server-coding">
<h4>C++ utilities to ease device server coding</h4>
<p>Some utilities functions have been added in the C++ release to ease
Tango device server development. These utilities allow the user to</p>
<ul class="simple">
<li>Init a C++ vector from a data of one of the Tango DevVarXXXArray data
types</li>
<li>Init a data of one of the Tango::DevVarxxxArray data type from a C++
vector</li>
<li>Print a data of one of Tango::DevVarxxxArray data type</li>
</ul>
<p>They mainly used the “&lt;&lt;” operator overloading features. The following
code lines are an example of usage of these utilities.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>    <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">v1</span><span class="punctuation">;</span>
<span class="ln"> 2 </span>    <span class="name">v1</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;one&quot;</span><span class="punctuation">);</span>
<span class="ln"> 3 </span>    <span class="name">v1</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;two&quot;</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>    <span class="name">v1</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;three&quot;</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="name">s</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>    <span class="name">s</span> <span class="operator">&lt;&lt;</span> <span class="name">v1</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>    <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="name">s</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>    <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">v2</span><span class="punctuation">;</span>
<span class="ln">11 </span>    <span class="name">v2</span> <span class="operator">&lt;&lt;</span> <span class="name">s</span><span class="punctuation">;</span>
<span class="ln">12 </span>
<span class="ln">13 </span>    <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">v2</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">14 </span>       <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;vector element = &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">v2</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
</pre>
<p>Line 1-4 : Create and Init a C++ string vector</p>
<p>Line 7 : Init a Tango::DevVarStringArray data from the C++ vector</p>
<p>Line 8 : Print all the Tango::DevVarStringArray element in one line of
code.</p>
<p>Line 11 : Init a second empty C++ string vector with the content of the
Tango::DevVarStringArray</p>
<div class="line-block">
<div class="line">Line 13-14 : Print vector element</div>
<div class="line"><strong>Warning</strong>: Note that due to a strange behavior of the Windows VC++
compiler compared to other compilers, to use these utilities with the
Windows VC++ compiler, you must add the line “using namespace tango”
at the beginning of your source file.</div>
</div>
</div>
</div>
<div class="section" id="avoiding-name-conflicts">
<h3><a class="toc-backref" href="#id245">Avoiding name conflicts</a></h3>
<p>Namespace are used to avoid name conflicts. Each device pattern
implementation is defined within its own namespace. The name of the
namespace is the device pattern class name. In our example, the
namespace name is <em>StepperMotor.</em></p>
</div>
<div class="section" id="the-device-server-main-function">
<h3><a class="toc-backref" href="#id246">The device server main function</a></h3>
<p>A device server main function (or method) always follows the same
framework. It exactly implements all the action described in chapter
[Server_startup]. Even if it could be always the same, it has not been
included in the library because some linkers are perturbed by the
presence of two main functions.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>
<span class="ln"> 3 </span>  <span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">*</span><span class="name">argv</span><span class="punctuation">[])</span>
<span class="ln"> 4 </span>  <span class="punctuation">{</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>      <span class="name">try</span>
<span class="ln"> 9 </span>      <span class="punctuation">{</span>
<span class="ln">10 </span>
<span class="ln">11 </span>          <span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>          <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_init</span><span class="punctuation">();</span>
<span class="ln">14 </span>
<span class="ln">15 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Ready to accept request&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">16 </span>          <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_run</span><span class="punctuation">();</span>
<span class="ln">17 </span>      <span class="punctuation">}</span>
<span class="ln">18 </span>      <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">19 </span>      <span class="punctuation">{</span>
<span class="ln">20 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Can't allocate memory!!!&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">21 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Exiting&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">22 </span>      <span class="punctuation">}</span>
<span class="ln">23 </span>      <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">CORBA</span><span class="operator">::</span><span class="name">Exception</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">24 </span>      <span class="punctuation">{</span>
<span class="ln">25 </span>           <span class="name">Tango</span><span class="operator">::</span><span class="name">Except</span><span class="operator">::</span><span class="name">print_exception</span><span class="punctuation">(</span><span class="name">e</span><span class="punctuation">);</span>
<span class="ln">26 </span>
<span class="ln">27 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Received a CORBA::Exception&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">28 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Exiting&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">29 </span>      <span class="punctuation">}</span>
<span class="ln">30 </span>
<span class="ln">31 </span>      <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_cleanup</span><span class="punctuation">();</span>
<span class="ln">32 </span>
<span class="ln">33 </span>      <span class="keyword">return</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">);</span>
<span class="ln">34 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 1 : Include the <strong>tango.h</strong> file. This file is a master include
file. It includes several other files. The list of files included by
tango.h can be found in </p>
<p>Line 11 : Create the instance of the Tango::Util class (a singleton).
Passing argc,argv to this method is mandatory because the device server
command line is checked when the Tango::Util object is constructed.</p>
<p>Line 13 : Start all the device pattern creation and initialization with
the <em>server_init()</em> method</p>
<p>Line 16 : Put the server in a endless waiting loop with the
<em>server_run()</em> method. In normal case, the process should never returns
from this line.</p>
<p>Line 18-22 : Catch all exceptions due to memory allocation error,
display a message to the user and exit</p>
<p>Line 23 : Catch all standard TANGO exception which could occur during
device pattern creation and initialization</p>
<p>Line 25 : Print exception parameters</p>
<p>Line 27-28 : Print an additional message</p>
<p>Line 31 : Cleanup the server before exiting by calling the
<em>server_cleanup()</em> method.</p>
</div>
<div class="section" id="the-dserver-class-factory-method">
<h3><a class="toc-backref" href="#id247">The DServer::class_factory method</a></h3>
<p>As described in chapter [DServer_class], C++ device server needs a
<em>class_factory</em>() method. This method creates all the device pattern
implemented in the device server by calling their <em>init</em>() method. The
following is an example of a <em>class_factory</em> method for a device server
with one implementation of the device server pattern for stepper motor
device.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>  <span class="comment preproc">#include &lt;steppermotorclass.h&gt;
</span><span class="ln"> 3 </span><span class="comment preproc"></span>
<span class="ln"> 4 </span>  <span class="keyword type">void</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DServer</span><span class="operator">::</span><span class="name">class_factory</span><span class="punctuation">()</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>     <span class="name">add_class</span><span class="punctuation">(</span><span class="name">StepperMotor</span><span class="operator">::</span><span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="literal string">&quot;StepperMotor&quot;</span><span class="punctuation">));</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 1 : Include the Tango master include file</p>
<p>Line 2 : Include the steppermotorclass class definition file</p>
<p>Line 7 : Create the StepperMotorClass singleton by calling its <em>init</em>
method and stores the returned pointer into the DServer object. Remember
that all classes for the device pattern implementation for the stepper
motor class is defined within a namespace called <em>StepperMotor</em>.</p>
</div>
<div class="section" id="writing-the-steppermotorclass-class">
<h3><a class="toc-backref" href="#id248">Writing the StepperMotorClass class</a></h3>
<div class="section" id="the-class-declaration-file">
<h4>The class declaration file</h4>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>
<span class="ln"> 3 </span>  <span class="keyword">namespace</span> <span class="name">StepperMotor</span>
<span class="ln"> 4 </span>  <span class="punctuation">{</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="keyword">class</span> <span class="name class">StepperMotorClass</span> <span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span>
<span class="ln"> 7 </span>  <span class="punctuation">{</span>
<span class="ln"> 8 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln"> 9 </span>      <span class="keyword">static</span> <span class="name">StepperMotorClass</span> <span class="operator">*</span><span class="name">init</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">10 </span>      <span class="keyword">static</span> <span class="name">StepperMotorClass</span> <span class="operator">*</span><span class="name function">instance</span><span class="punctuation">();</span>
<span class="ln">11 </span>      <span class="operator">~</span><span class="name">StepperMotorClass</span><span class="punctuation">()</span> <span class="punctuation">{</span><span class="name">_instance</span> <span class="operator">=</span> <span class="name builtin">NULL</span><span class="punctuation">;}</span>
<span class="ln">12 </span>
<span class="ln">13 </span>  <span class="keyword">protected</span><span class="operator">:</span>
<span class="ln">14 </span>      <span class="name">StepperMotorClass</span><span class="punctuation">(</span><span class="name">string</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">15 </span>      <span class="keyword">static</span> <span class="name">StepperMotorClass</span> <span class="operator">*</span><span class="name">_instance</span><span class="punctuation">;</span>
<span class="ln">16 </span>      <span class="keyword type">void</span> <span class="name function">command_factory</span><span class="punctuation">();</span>
<span class="ln">17 </span>      <span class="keyword type">void</span> <span class="name function">attribute_factory</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span> <span class="operator">*&gt;</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">18 </span>
<span class="ln">19 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln">20 </span>      <span class="keyword type">void</span> <span class="name">device_factory</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">21 </span>  <span class="punctuation">};</span>
<span class="ln">22 </span>
<span class="ln">23 </span>  <span class="punctuation">}</span> <span class="comment multiline">/* End of StepperMotor namespace */</span>
</pre>
<p>Line 1 : Include the Tango master include file</p>
<p>Line 3 : This class is defined within the <em>StepperMotor</em> namespace</p>
<p>Line 6 : Class StepperMotorClass inherits from Tango::DeviceClass</p>
<p>Line 9-10 : Definition of the <em>init</em> and <em>instance</em> methods. These
methods are static and can be called even if the object is not already
constructed.</p>
<p>Line 11: The destructor</p>
<p>Line 14 : The class constructor. It is protected and can’t be called
from outside the class. Only the <em>init</em> method allows a user to create
an instance of this class. See  to get
details about the singleton design pattern.</p>
<p>Line 15 : The instance pointer. It is static in order to set it to NULL
during process initialization phase</p>
<p>Line 16 : Definition of the <em>command_factory</em> method</p>
<p>Line 17 : Definition of the <em>attribute_factory</em> method</p>
<p>Line 20 : Definition of the <em>device_factory</em> method</p>
</div>
<div class="section" id="the-singleton-related-methods">
<h4>The singleton related methods</h4>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>
<span class="ln"> 3 </span>  <span class="comment preproc">#include &lt;steppermotor.h&gt;
</span><span class="ln"> 4 </span><span class="comment preproc"></span>  <span class="comment preproc">#include &lt;steppermotorclass.h&gt;
</span><span class="ln"> 5 </span><span class="comment preproc"></span>
<span class="ln"> 6 </span>  <span class="keyword">namespace</span> <span class="name">StepperMotor</span>
<span class="ln"> 7 </span>  <span class="punctuation">{</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="name">StepperMotorClass</span> <span class="operator">*</span><span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">_instance</span> <span class="operator">=</span> <span class="name builtin">NULL</span><span class="punctuation">;</span>
<span class="ln">10 </span>
<span class="ln">11 </span>  <span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">StepperMotorClass</span><span class="punctuation">(</span><span class="name">string</span> <span class="operator">&amp;</span><span class="name">s</span><span class="punctuation">)</span><span class="operator">:</span>
<span class="ln">12 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span><span class="punctuation">(</span><span class="name">s</span><span class="punctuation">)</span>
<span class="ln">13 </span>  <span class="punctuation">{</span>
<span class="ln">14 </span>      <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Entering StepperMotorClass constructor&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">15 </span>
<span class="ln">16 </span>      <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Leaving StepperMotorClass constructor&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">17 </span>  <span class="punctuation">}</span>
<span class="ln">18 </span>
<span class="ln">19 </span>
<span class="ln">20 </span>  <span class="name">StepperMotorClass</span> <span class="operator">*</span><span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="name">name</span><span class="punctuation">)</span>
<span class="ln">21 </span>  <span class="punctuation">{</span>
<span class="ln">22 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">_instance</span> <span class="operator">==</span> <span class="name builtin">NULL</span><span class="punctuation">)</span>
<span class="ln">23 </span>      <span class="punctuation">{</span>
<span class="ln">24 </span>            <span class="name">try</span>
<span class="ln">25 </span>            <span class="punctuation">{</span>
<span class="ln">26 </span>                 <span class="name">string</span> <span class="name">s</span><span class="punctuation">(</span><span class="name">name</span><span class="punctuation">);</span>
<span class="ln">27 </span>                 <span class="name">_instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">StepperMotorClass</span><span class="punctuation">(</span><span class="name">s</span><span class="punctuation">);</span>
<span class="ln">28 </span>            <span class="punctuation">}</span>
<span class="ln">29 </span>            <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">30 </span>            <span class="punctuation">{</span>
<span class="ln">31 </span>                 <span class="keyword">throw</span><span class="punctuation">;</span>
<span class="ln">32 </span>            <span class="punctuation">}</span>
<span class="ln">33 </span>      <span class="punctuation">}</span>
<span class="ln">34 </span>      <span class="keyword">return</span> <span class="name">_instance</span><span class="punctuation">;</span>
<span class="ln">35 </span>  <span class="punctuation">}</span>
<span class="ln">36 </span>
<span class="ln">37 </span>  <span class="name">StepperMotorClass</span> <span class="operator">*</span><span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">instance</span><span class="punctuation">()</span>
<span class="ln">38 </span>  <span class="punctuation">{</span>
<span class="ln">39 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">_instance</span> <span class="operator">==</span> <span class="name builtin">NULL</span><span class="punctuation">)</span>
<span class="ln">40 </span>      <span class="punctuation">{</span>
<span class="ln">41 </span>            <span class="name">cerr</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Class is not initialised !!&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">42 </span>            <span class="name">exit</span><span class="punctuation">(</span><span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">);</span>
<span class="ln">43 </span>      <span class="punctuation">}</span>
<span class="ln">44 </span>      <span class="keyword">return</span> <span class="name">_instance</span><span class="punctuation">;</span>
<span class="ln">45 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 1-4 : include files: the Tango master include file (tango.h), the
StepperMotorClass class definition file (steppermotorclass.h) and the
StepperMotor class definition file (steppermotor.h)</p>
<p>Line 6 : Open the <em>StepperMotor</em> namespace.</p>
<p>Line 9 : Initialize the static _instance field of the StepperMotorClass
class to NULL</p>
<p>Line 11-18 : The class constructor. It takes an input parameter which is
the controlled device class name. This parameter is passed to the
constructor of the DeviceClass class. Otherwise, the constructor does
nothing except printing a message</p>
<p>Line 20-35 : The <em>init</em> method. This method needs an input parameter
which is the controlled device class name (StepperMotor in this case).
This method checks is the instance is already constructed by testing the
_instance data member. If the instance is not constructed, it creates
one. If the instance is already constructed, the method simply returns a
pointer to it.</p>
<p>Line 37-45 : The <em>instance</em> method. This method is very similar to the
<em>init</em> method except that if the instance is not already constructed.
the method print a message and abort the process.</p>
<p>As you can understand, it is not possible to construct more than one
instance of the StepperMotorClass (it is a singleton) and the <em>init</em>
method must be called prior to any other method.</p>
</div>
<div class="section" id="the-command-factory-method">
<h4>The command_factory method</h4>
<p>Within our example, the stepper motor device supports two commands which
are called DevReadPosition and DevReadDirection. These two command takes
a Tango::DevLong argument as input and output parameter. The first
command is created using the inheritance model and the second command is
created using the template command model.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">command_factory</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="name">command_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">DevReadPositionCmd</span><span class="punctuation">(</span><span class="literal string">&quot;DevReadPosition&quot;</span><span class="punctuation">,</span>
<span class="ln"> 4 </span>                                                        <span class="name">Tango</span><span class="operator">::</span><span class="name">DEV_LONG</span><span class="punctuation">,</span>
<span class="ln"> 5 </span>                                                        <span class="name">Tango</span><span class="operator">::</span><span class="name">DEV_LONG</span><span class="punctuation">,</span>
<span class="ln"> 6 </span>                                                        <span class="literal string">&quot;Motor number (0-7)&quot;</span><span class="punctuation">,</span>
<span class="ln"> 7 </span>                                                        <span class="literal string">&quot;Motor position&quot;</span><span class="punctuation">));</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>          <span class="name">command_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span>
<span class="ln">10 </span>              <span class="keyword">new</span> <span class="name">TemplCommandInOut</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span><span class="operator">&gt;</span>
<span class="ln">11 </span>                  <span class="punctuation">((</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">)</span><span class="literal string">&quot;DevReadDirection&quot;</span><span class="punctuation">,</span>
<span class="ln">12 </span>                   <span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Lg_CmdMethPtr_Lg</span><span class="operator">&gt;</span>
<span class="ln">13 </span>                          <span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">StepperMotor</span><span class="operator">::</span><span class="name">dev_read_direction</span><span class="punctuation">),</span>
<span class="ln">14 </span>                   <span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">StateMethPtr</span><span class="operator">&gt;</span>
<span class="ln">15 </span>                          <span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">StepperMotor</span><span class="operator">::</span><span class="name">direct_cmd_allowed</span><span class="punctuation">))</span>
<span class="ln">16 </span>                                <span class="punctuation">);</span>
<span class="ln">17 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 4 : Creation of one instance of the DevReadPositionCmd class. The
class is created with five arguments which are the command name, the
command type code for its input and output parameters and two strings
which are the command input and output parameters description. The
pointer returned by the new C++ keyword is added to the vector of
available command.</p>
<p>Line 10-14 : Creation of the object used for the DevReadDirection
command. This command has one input and output parameter. Therefore the
created object is an instance of the TemplCommandInOut class. This class
is a C++ template class. The first template parameter is the command
input parameter type, the second template parameter is the command
output parameter type. The second TemplCommandInOut class constructor
parameter (set at line 13) is a pointer to the method to be executed
when the command is requested. A casting is necessary to store this
pointer as a pointer to a method of the DeviceImpl class <a class="footnote-reference" href="#id144" id="id38">[10]</a>. The
third TemplCommandInOut class constructor parameter (set at line 15) is
a pointer to the method to be executed to check if the command is
allowed. This is necessary only if the default behavior (command always
allowed) does not fulfill the needs. A casting is necessary to store
this pointer as a pointer to a method of the DeviceImpl class. When a
command is created using the template command method, the input and
output parameters type are determined from the template C++ class
parameters.</p>
</div>
<div class="section" id="the-device-factory-method">
<h4>The device_factory method</h4>
<p>The <em>device_factory</em> method has one input parameter. It is a pointer to
Tango::DevVarStringArray data which is the device name list for this
class and the instance of the device server process. This list is fetch
from the Tango database.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">device_factory</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">_DevVarStringArray</span> <span class="operator">*</span><span class="name">devlist_ptr</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>      <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">long</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">devlist_ptr</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">();</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 5 </span>      <span class="punctuation">{</span>
<span class="ln"> 6 </span>           <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Device name : &quot;</span> <span class="operator">&lt;&lt;</span> <span class="punctuation">(</span><span class="operator">*</span><span class="name">devlist_ptr</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>           <span class="name">device_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">StepperMotor</span><span class="punctuation">(</span><span class="keyword">this</span><span class="punctuation">,(</span><span class="operator">*</span><span class="name">devlist_ptr</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]));</span>       <span class="literal number integer">9</span>
<span class="ln"> 9 </span>           <span class="name function">if</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">_UseDb</span> <span class="operator">==</span> <span class="name builtin">true</span><span class="punctuation">)</span>
<span class="ln">10 </span>                <span class="name">export_device</span><span class="punctuation">(</span><span class="name">device_list</span><span class="punctuation">.</span><span class="name">back</span><span class="punctuation">());</span>
<span class="ln">11 </span>           <span class="keyword">else</span>
<span class="ln">12 </span>                <span class="name function">export_device</span><span class="punctuation">(</span><span class="name">device_list</span><span class="punctuation">.</span><span class="name">back</span><span class="punctuation">(),(</span><span class="operator">*</span><span class="name">devlist_ptr</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]));</span>
<span class="ln">13 </span>      <span class="punctuation">}</span>
<span class="ln">14 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 4 : A loop for each device</p>
<p>Line 8 : Create the device object using a StepperMotor class constructor
which needs two arguments. These two arguments are a pointer to the
StepperMotorClass instance and the device name. The pointer to the
constructed object is then added to the device list vector</p>
<p>Line 10-13 : Export device to the outside world using the
<em>export_device</em> method of the DeviceClass class.</p>
</div>
<div class="section" id="the-attribute-factory-method">
<h4>The attribute_factory method</h4>
<p>The rule of this method is to fulfill a vector of pointer to attributes.
A reference to this vector is passed as argument to this method.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">attribute_factory</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span> <span class="operator">*&gt;</span> <span class="operator">&amp;</span><span class="name">att_list</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">PositionAttr</span><span class="punctuation">());</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">UserDefaultAttrProp</span> <span class="name">def_prop</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>      <span class="name">def_prop</span><span class="punctuation">.</span><span class="name">set_label</span><span class="punctuation">(</span><span class="literal string">&quot;Set the motor position&quot;</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>      <span class="name">def_prop</span><span class="punctuation">.</span><span class="name">set_format</span><span class="punctuation">(</span><span class="literal string">&quot;scientific;setprecision(4)&quot;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span> <span class="operator">*</span><span class="name">at</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">SetPositionAttr</span><span class="punctuation">();</span>
<span class="ln"> 9 </span>      <span class="name">at</span><span class="operator">-&gt;</span><span class="name">set_default_properties</span><span class="punctuation">(</span><span class="name">def_prop</span><span class="punctuation">);</span>
<span class="ln">10 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="name">at</span><span class="punctuation">);</span>
<span class="ln">11 </span>
<span class="ln">12 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">DirectcionAttr</span><span class="punctuation">());</span>
<span class="ln">13 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 3 : Create the PositionAttr class and store the pointer to this
object into the attribute pointer vector.</p>
<p>Line 5-7 : Create a Tango::UserDefaultAttrProp instance and set the
label and format properties default values in this object</p>
<p>Line 8 : Create the SetPositionAttr attribute.</p>
<p>Line 9 : Set attribute user default value with the
<em>set_default_properties()</em> method of the Tango::Attr class.</p>
<p>Line 10 : Store the pointer to this object into the attribute pointer
vector.</p>
<p>Line 12 : Create the DirectionAttr class and store the pointer to this
object into the attribute pointer vector.</p>
<p>Please, note that in some rare case, it is necessary to add attribute to
this list during the device server life cycle. This
<em>attribute_factory()</em> method is called once during device server
start-up. A method <em>add_attribute()</em> of the DeviceImpl class allows the
user to add a new attribute to the attribute list outside of this
<em>attribute_factory()</em> method. See  for
more information on this method.</p>
</div>
</div>
<div class="section" id="the-devreadpositioncmd-class">
<h3><a class="toc-backref" href="#id249">The DevReadPositionCmd class</a></h3>
<div class="section" id="id39">
<h4>The class declaration file</h4>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>
<span class="ln"> 3 </span>  <span class="keyword">namespace</span> <span class="name">StepperMotor</span>
<span class="ln"> 4 </span>  <span class="punctuation">{</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="keyword">class</span> <span class="name class">DevReadPositionCmd</span> <span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Command</span>
<span class="ln"> 7 </span>  <span class="punctuation">{</span>
<span class="ln"> 8 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln"> 9 </span>      <span class="name">DevReadPositionCmd</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">CmdArgType</span><span class="punctuation">,</span>
<span class="ln">10 </span>                             <span class="name">Tango</span><span class="operator">::</span><span class="name">CmdArgType</span><span class="punctuation">,</span>
<span class="ln">11 </span>                             <span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">12 </span>      <span class="operator">~</span><span class="name">DevReadPositionCmd</span><span class="punctuation">()</span> <span class="punctuation">{};</span>
<span class="ln">13 </span>
<span class="ln">14 </span>      <span class="keyword">virtual</span> <span class="keyword type">bool</span> <span class="name function">is_allowed</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="punctuation">,</span> <span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">15 </span>      <span class="keyword">virtual</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">execute</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="punctuation">,</span> <span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">16 </span>  <span class="punctuation">};</span>
<span class="ln">17 </span>
<span class="ln">18 </span>  <span class="punctuation">}</span> <span class="comment multiline">/* End of StepperMotor namespace */</span>
</pre>
<p>Line 1 : Include the tango master include file</p>
<p>Line 3 : Open the <em>StepperMotor</em> namespace.</p>
<p>Line 6 : The DevReadPositionCmd class inherits from the Tango::Command
class</p>
<p>Line 9 : The constructor</p>
<p>Line 12 : The destructor</p>
<p>Line 14 : The definition of the <em>is_allowed</em> method. This method is not
necessary if the default behavior implemented by the default
<em>is_allowed</em> method fulfill the requirements. The default behavior is
to always allows the command execution (always return true).</p>
<p>Line 15: The definition of the <em>execute</em> method</p>
</div>
<div class="section" id="the-class-constructor">
<h4>The class constructor</h4>
<p>The class constructor does nothing. It simply invoke the Command
constructor by passing it its five arguments which are:</p>
<ol class="arabic simple">
<li>The command name</li>
<li>The command input type code</li>
<li>The command output type code</li>
<li>The command input parameter description</li>
<li>The command output parameter description</li>
</ol>
<p>With this 5 parameters command class constructor, the command display
level is not specified. Therefore it is set to its default value
(OPERATOR). If the command does not have input or output parameter, it
is not possible to use the Command class constructor defined with five
parameters. In this case, the command constructor execute the Command
class constructor with three elements (class name, input type, output
type) and set the input or output parameter description fields with the
<em>set_in_type_desc</em> or <em>set_out_type_desc</em> Command class methods.
To set the command display level, it is possible to use a 6 parameters
constructor or it is also possible to set it in the constructor code
with the <em>set_disp_level</em> method. Many Command class constructors are
defined. See :raw-latex:<a href="#id40"><span class="problematic" id="id41">`</span></a>cite{TANGO_ref_man}`for a complete list.</p>
<div class="system-message" id="id40">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 7212); <em><a href="#id41">backlink</a></em></p>
Inline interpreted text or phrase reference start-string without end-string.</div>
</div>
<div class="section" id="the-is-allowed-method">
<h4>The is_allowed method</h4>
<p>In our example, the DevReadPosition command is allowed only if the
device is in the ON state. This method receives two argument which are a
pointer to the device object on which the command must be executed and a
reference to the command input Any object. This method returns a boolean
which must be set to true if the command is allowed. If this boolean is
set to false, the DeviceClass <em>command_handle</em>r method will
automatically send an exception to the caller.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword type">bool</span> <span class="name">DevReadPositionCmd</span><span class="operator">::</span><span class="name">is_allowed</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">device</span><span class="punctuation">,</span>
<span class="ln">2 </span>                                      <span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="name">in_any</span><span class="punctuation">)</span>
<span class="ln">3 </span>  <span class="punctuation">{</span>
<span class="ln">4 </span>       <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">device</span><span class="operator">-&gt;</span><span class="name">get_state</span><span class="punctuation">()</span> <span class="operator">==</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">ON</span><span class="punctuation">)</span>
<span class="ln">5 </span>            <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln">6 </span>       <span class="keyword">else</span>
<span class="ln">7 </span>            <span class="keyword">return</span> <span class="name builtin">false</span><span class="punctuation">;</span>
<span class="ln">8 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 4 : Call the <em>get_state</em> method of the DeviceImpl class which
simply returns the device state</p>
<p>Line 5 : Authorize command if the device state is ON</p>
<p>Line 7 : Refuse command execution in all other cases.</p>
</div>
<div class="section" id="the-execute-method">
<h4>The execute method</h4>
<p>This method receives two arguments which are a pointer to the device
object on which the command must be executed and a reference to the
command input Any object. This method returns a pointer to an any object
which must be initialized with the data to be returned to the caller.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">*</span><span class="name">DevReadPositionCmd</span><span class="operator">::</span><span class="name">execute</span><span class="punctuation">(</span>
<span class="ln"> 2 </span>                          <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">device</span><span class="punctuation">,</span>
<span class="ln"> 3 </span>                          <span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="name">in_any</span><span class="punctuation">)</span>
<span class="ln"> 4 </span>  <span class="punctuation">{</span>
<span class="ln"> 5 </span>       <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DevReadPositionCmd::execute(): arrived&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>       <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">motor</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>       <span class="name">extract</span><span class="punctuation">(</span><span class="name">in_any</span><span class="punctuation">,</span><span class="name">motor</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>       <span class="keyword">return</span> <span class="name function">insert</span><span class="punctuation">(</span>
<span class="ln">10 </span>          <span class="punctuation">(</span><span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="name">StepperMotor</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="name">device</span><span class="punctuation">))</span><span class="operator">-&gt;</span><span class="name">dev_read_position</span><span class="punctuation">(</span><span class="name">motor</span><span class="punctuation">));</span>
<span class="ln">11 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 8 : Extract incoming data from the input any object using a Command
class <em>extract</em> helper method. If the type of the data in the Any object
is not a Tango::DevLong, the <em>extract</em> method will throw an exception to
the client.</p>
<p>Line 9 : Call the stepper motor object method which execute the
DevReadPosition command and insert the returned value into an allocated
Any object. The Any object allocation is done by the <em>insert</em> method
which return a pointer to this Any.</p>
</div>
</div>
<div class="section" id="id42">
<h3><a class="toc-backref" href="#id250">The PositionAttr class</a></h3>
<div class="section" id="id43">
<h4>The class declaration file</h4>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>  <span class="comment preproc">#include &lt;steppermotor.h&gt;
</span><span class="ln"> 3 </span><span class="comment preproc"></span>
<span class="ln"> 4 </span>  <span class="keyword">namespace</span> <span class="name">StepperMotor</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>  <span class="keyword">class</span> <span class="name class">PositionAttr</span><span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span>
<span class="ln"> 9 </span>  <span class="punctuation">{</span>
<span class="ln">10 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln">11 </span>      <span class="name">PositionAttr</span><span class="punctuation">()</span><span class="operator">:</span><span class="name">Attr</span><span class="punctuation">(</span><span class="literal string">&quot;Position&quot;</span><span class="punctuation">,</span>
<span class="ln">12 </span>                          <span class="name">Tango</span><span class="operator">::</span><span class="name">DEV_LONG</span><span class="punctuation">,</span>
<span class="ln">13 </span>                          <span class="name">Tango</span><span class="operator">::</span><span class="name">READ_WITH_WRITE</span><span class="punctuation">,</span>
<span class="ln">14 </span>                          <span class="literal string">&quot;SetPosition&quot;</span><span class="punctuation">)</span> <span class="punctuation">{};</span>
<span class="ln">15 </span>      <span class="operator">~</span><span class="name">PositionAttr</span><span class="punctuation">()</span> <span class="punctuation">{};</span>
<span class="ln">16 </span>
<span class="ln">17 </span>      <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">read</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">dev</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
<span class="ln">18 </span>      <span class="punctuation">{(</span><span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="name">StepperMotor</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="name">dev</span><span class="punctuation">))</span><span class="operator">-&gt;</span><span class="name">read_Position</span><span class="punctuation">(</span><span class="name">att</span><span class="punctuation">);}</span>
<span class="ln">19 </span>      <span class="keyword">virtual</span> <span class="keyword type">bool</span> <span class="name function">is_allowed</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">dev</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">AttReqType</span> <span class="name">ty</span><span class="punctuation">)</span>
<span class="ln">20 </span>      <span class="punctuation">{</span><span class="keyword">return</span> <span class="punctuation">(</span><span class="keyword">static_cast</span><span class="operator">&lt;</span><span class="name">StepperMotor</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="name">dev</span><span class="punctuation">))</span><span class="operator">-&gt;</span><span class="name">is_Position_allowed</span><span class="punctuation">(</span><span class="name">ty</span><span class="punctuation">);}</span>
<span class="ln">21 </span>  <span class="punctuation">};</span>
<span class="ln">22 </span>
<span class="ln">23 </span>  <span class="punctuation">}</span> <span class="comment multiline">/* End of StepperMotor namespace */</span>
<span class="ln">24 </span>
<span class="ln">25 </span>  <span class="comment preproc">#endif </span><span class="comment single">// _STEPPERMOTORCLASS_H</span>
</pre>
<p>Line 1-2 : Include the tango master include file and the steppermotor
class definition include file</p>
<p>Line 4 : Open the <em>StepperMotor</em> namespace.</p>
<p>Line 8 : The PosiitionAttr class inherits from the Tango::Attr class</p>
<p>Line 11-14 : The constructor with 4 arguments</p>
<p>Line 15 : The destructor</p>
<p>Line 17 : The definition of the <em>read</em> method. This method forwards the
call to a StepperMotor class method called <em>read_Position()</em></p>
<p>Line 19 : The definition of the <em>is_allowed</em> method. This method is not
necessary if the default behaviour implemented by the default
<em>is_allowed</em> method fulfills the requirements. The default behaviour is
to always allows the attribute reading (always return true). This method
forwards the call to a StepperMotor class method called
<em>is_Position_allowed()</em></p>
</div>
<div class="section" id="id44">
<h4>The class constructor</h4>
<p>The class constructor does nothing. It simply invoke the Attr
constructor by passing it its four arguments which are:</p>
<ol class="arabic simple">
<li>The attribute name</li>
<li>The attribute data type code</li>
<li>The attribute writable type code</li>
<li>The name of the associated write attribute</li>
</ol>
<p>With this 4 parameters Attr class constructor, the attribute display
level is not specified. Therefore it is set to its default value
(OPERATOR). To set the attribute display level, it is possible to use in
the constructor code the <em>set_disp_level</em> method. Many Attr class
constructors are defined. See :raw-latex:<a href="#id45"><span class="problematic" id="id46">`</span></a>cite{TANGO_ref_man}`for a
complete list.</p>
<div class="system-message" id="id45">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 7358); <em><a href="#id46">backlink</a></em></p>
Inline interpreted text or phrase reference start-string without end-string.</div>
<p>This Position attribute is a scalar attribute. For spectrum attribute,
instead of inheriting from the Attr class, the class must inherits from
the SpectrumAttr class. Many SpectrumAttr class constructors are
defined. See :raw-latex:<a href="#id47"><span class="problematic" id="id48">`</span></a>cite{TANGO_ref_man}`for a complete list.</p>
<div class="system-message" id="id47">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 7365); <em><a href="#id48">backlink</a></em></p>
Inline interpreted text or phrase reference start-string without end-string.</div>
<p>For Image attribute, instead of inheriting from the Attr class, the
class must inherits from the ImageAttr class. Many ImageAttr class
constructors are defined. See :raw-latex:<a href="#id49"><span class="problematic" id="id50">`</span></a>cite{TANGO_ref_man}`for a
complete list.</p>
<div class="system-message" id="id49">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 7370); <em><a href="#id50">backlink</a></em></p>
Inline interpreted text or phrase reference start-string without end-string.</div>
</div>
<div class="section" id="id51">
<h4>The is_allowed method</h4>
<p>This method receives two argument which are a pointer to the device
object to which the attribute belongs to and the type of request (read
or write). In the PositionAttr class, this method simply forwards the
request to a method of the StepperMotor class called
<em>is_Position_allowed()</em> passing the request type to this method. This
method returns a boolean which must be set to true if the attribute is
allowed. If this boolean is set to false, the DeviceImpl read_attribute
method will automatically send an exception to the caller.</p>
</div>
<div class="section" id="the-read-method">
<h4>The read method</h4>
<p>This method receives two arguments which are a pointer to the device
object to which the attribute belongs to and a reference to the
corresponding attribute object. This method forwards the request to a
StepperMotor class called <em>read_Position()</em> passing it the reference on
the attribute object.</p>
</div>
</div>
<div class="section" id="id52">
<h3><a class="toc-backref" href="#id251">The StepperMotor class</a></h3>
<div class="section" id="id53">
<h4>The class declaration file</h4>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>
<span class="ln"> 3 </span> <span class="comment preproc">#define AGSM_MAX_MOTORS 8 </span><span class="comment single">// maximum number of motors per device
</span><span class="ln"> 4 </span><span class="comment single"></span>
<span class="ln"> 5 </span> <span class="keyword">namespace</span> <span class="name">StepperMotor</span>
<span class="ln"> 6 </span> <span class="punctuation">{</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span> <span class="keyword">class</span> <span class="name class">StepperMotor</span><span class="operator">:</span> <span class="keyword">public</span> <span class="name">TANGO_BASE_CLASS</span>
<span class="ln"> 9 </span> <span class="punctuation">{</span>
<span class="ln">10 </span> <span class="keyword">public</span> <span class="operator">:</span>
<span class="ln">11 </span>    <span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="punctuation">,</span><span class="name">string</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">12 </span>    <span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">13 </span>    <span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">14 </span>    <span class="operator">~</span><span class="name">StepperMotor</span><span class="punctuation">()</span> <span class="punctuation">{};</span>
<span class="ln">15 </span>
<span class="ln">16 </span>    <span class="name">DevLong</span> <span class="name function">dev_read_position</span><span class="punctuation">(</span><span class="name">DevLong</span><span class="punctuation">);</span>
<span class="ln">17 </span>    <span class="name">DevLong</span> <span class="name function">dev_read_direction</span><span class="punctuation">(</span><span class="name">DevLong</span><span class="punctuation">);</span>
<span class="ln">18 </span>    <span class="keyword type">bool</span> <span class="name function">direct_cmd_allowed</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">19 </span>
<span class="ln">20 </span>    <span class="keyword">virtual</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevState</span> <span class="name">dev_state</span><span class="punctuation">();</span>
<span class="ln">21 </span>    <span class="keyword">virtual</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">ConstDevString</span> <span class="name">dev_status</span><span class="punctuation">();</span>
<span class="ln">22 </span>
<span class="ln">23 </span>    <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">always_executed_hook</span><span class="punctuation">();</span>
<span class="ln">24 </span>
<span class="ln">25 </span>    <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">read_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">);</span>
<span class="ln">26 </span>    <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">write_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">);</span>
<span class="ln">27 </span>
<span class="ln">28 </span>    <span class="keyword type">void</span> <span class="name function">read_position</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">29 </span>    <span class="keyword type">bool</span> <span class="name function">is_Position_allowed</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">AttReqType</span> <span class="name">req</span><span class="punctuation">);</span>
<span class="ln">30 </span>    <span class="keyword type">void</span> <span class="name function">write_SetPosition</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">WAttribute</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">31 </span>    <span class="keyword type">void</span> <span class="name function">read_Direction</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="punctuation">);</span>
<span class="ln">32 </span>
<span class="ln">33 </span>    <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">init_device</span><span class="punctuation">();</span>
<span class="ln">34 </span>    <span class="keyword">virtual</span> <span class="keyword type">void</span> <span class="name function">delete_device</span><span class="punctuation">();</span>
<span class="ln">35 </span>
<span class="ln">36 </span>    <span class="keyword type">void</span> <span class="name function">get_device_properties</span><span class="punctuation">();</span>
<span class="ln">37 </span>
<span class="ln">38 </span> <span class="keyword">protected</span> <span class="operator">:</span>
<span class="ln">39 </span>    <span class="keyword type">long</span> <span class="name">axis</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">40 </span>    <span class="name">DevLong</span> <span class="name">position</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">41 </span>    <span class="name">DevLong</span> <span class="name">direction</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">42 </span>    <span class="keyword type">long</span> <span class="name">state</span><span class="punctuation">[</span><span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">];</span>
<span class="ln">43 </span>
<span class="ln">44 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="operator">*</span><span class="name">attr_Position_read</span><span class="punctuation">;</span>
<span class="ln">45 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="operator">*</span><span class="name">attr_Direction_read</span><span class="punctuation">;</span>
<span class="ln">46 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">attr_SetPosition_write</span><span class="punctuation">;</span>
<span class="ln">47 </span>
<span class="ln">48 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">min</span><span class="punctuation">;</span>
<span class="ln">49 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">max</span><span class="punctuation">;</span>
<span class="ln">50 </span>
<span class="ln">51 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="operator">*</span><span class="name">ptr</span><span class="punctuation">;</span>
<span class="ln">52 </span> <span class="punctuation">};</span>
<span class="ln">53 </span>
<span class="ln">54 </span> <span class="punctuation">}</span> <span class="comment multiline">/* End of StepperMotor namespace */</span>
</pre>
<p>Line 1 : Include the Tango master include file</p>
<p>Line 5 : Open the <em>StepperMotor</em> namespace.</p>
<p>Line 8 : The StepperMotor class inherits from a Tango base class</p>
<p>Line 11-13 : Three different object constructors</p>
<p>Line 14 : The destructor which calls the <em>delete_device()</em> method</p>
<p>Line 16 : The method to be called for the execution of the
DevReadPosition command. This method must be declared as virtual if it
is needed to redefine it in a class inheriting from StepperMotor. See
chapter [Inheriting] for more details about inheriting.</p>
<p>Line 17 : The method to be called for the execution of the
DevReadDirection command</p>
<p>Line 18 : The method called to check if the execution of the
DevReadDirection command is allowed. This method is necessary because
the DevReadDirection command is created using the template command
method and the default behavior is not acceptable</p>
<p>Line 20 : Redefinition of the <em>dev_state</em>. This method is used by the
State command</p>
<p>Line 21 : Redefinition of the <em>dev_status</em>. This method is used by the
Status command</p>
<p>Line 23 : Redefinition of the <em>always_executed_hook</em> method. This
method is the place to code mandatory action which must be executed
prior to any command.</p>
<p>Line 25-31 : Attribute related methods</p>
<p>Line 32 : Definition of the <em>init_device</em> method.</p>
<p>Line 33 : Definition of the <em>delete_device</em> method</p>
<p>Line 35 : Definition of the <em>get_device_properties</em> method</p>
<p>Line 38-50 : Data members.</p>
<p>Line 43-44 : Pointers to data for readable attributes Position and
Direction</p>
<p>Line 45 : Data for the SetPosition attribute</p>
<p>Line 47-48 : Data members for the two device properties</p>
</div>
<div class="section" id="the-constructors">
<h4>The constructors</h4>
<p>Three constructors are defined here. It is not mandatory to defined
three constructors. But at least one is mandatory. The three
constructors take a pointer to the StepperMotorClass instance as first
parameter <a class="footnote-reference" href="#id145" id="id54">[11]</a>. The second parameter is the device name as a C++ string
or as a classical pointer to char array. The third parameter necessary
only for the third form of constructor is the device description string
passed as a classical pointer to a char array.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>  <span class="comment preproc">#include &lt;steppermotor.h&gt;
</span><span class="ln"> 3 </span><span class="comment preproc"></span>
<span class="ln"> 4 </span>  <span class="keyword">namespace</span> <span class="name">StepperMotor</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>  <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="name">cl</span><span class="punctuation">,</span><span class="name">string</span> <span class="operator">&amp;</span><span class="name">s</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>  <span class="operator">:</span><span class="name">TANGO_BASE_CLASS</span><span class="punctuation">(</span><span class="name">cl</span><span class="punctuation">,</span><span class="name">s</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">())</span>
<span class="ln"> 9 </span>  <span class="punctuation">{</span>
<span class="ln">10 </span>    <span class="name">init_device</span><span class="punctuation">();</span>
<span class="ln">11 </span> <span class="punctuation">}</span>
<span class="ln">12 </span>
<span class="ln">13 </span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="name">cl</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="name">s</span><span class="punctuation">)</span>
<span class="ln">14 </span> <span class="operator">:</span><span class="name">TANGO_BASE_CLASS</span><span class="punctuation">(</span><span class="name">cl</span><span class="punctuation">,</span><span class="name">s</span><span class="punctuation">)</span>
<span class="ln">15 </span> <span class="punctuation">{</span>
<span class="ln">16 </span>    <span class="name">init_device</span><span class="punctuation">();</span>
<span class="ln">17 </span> <span class="punctuation">}</span>
<span class="ln">18 </span>
<span class="ln">19 </span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">StepperMotor</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="name">cl</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="name">s</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="name">d</span><span class="punctuation">)</span>
<span class="ln">20 </span> <span class="operator">:</span><span class="name">TANGO_BASE_CLASS</span><span class="punctuation">(</span><span class="name">cl</span><span class="punctuation">,</span><span class="name">s</span><span class="punctuation">,</span><span class="name">d</span><span class="punctuation">)</span>
<span class="ln">21 </span> <span class="punctuation">{</span>
<span class="ln">22 </span>    <span class="name">init_device</span><span class="punctuation">();</span>
<span class="ln">23 </span> <span class="punctuation">}</span>
<span class="ln">24 </span>
<span class="ln">25 </span> <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">init_device</span><span class="punctuation">()</span>
<span class="ln">26 </span> <span class="punctuation">{</span>
<span class="ln">27 </span>    <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;StepperMotor::StepperMotor() create &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">device_name</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">28 </span>
<span class="ln">29 </span>    <span class="keyword type">long</span> <span class="name">i</span><span class="punctuation">;</span>
<span class="ln">30 </span>
<span class="ln">31 </span>    <span class="keyword">for</span> <span class="punctuation">(</span><span class="name">i</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">i</span><span class="operator">&lt;</span> <span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">;</span> <span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">32 </span>    <span class="punctuation">{</span>
<span class="ln">33 </span>       <span class="name">axis</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">34 </span>       <span class="name">position</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">35 </span>       <span class="name">direction</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">36 </span>    <span class="punctuation">}</span>
<span class="ln">37 </span>
<span class="ln">38 </span>    <span class="name">ptr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span><span class="punctuation">[</span><span class="literal number integer">10</span><span class="punctuation">];</span>
<span class="ln">39 </span>
<span class="ln">40 </span>    <span class="name">get_device_properties</span><span class="punctuation">();</span>
<span class="ln">41 </span> <span class="punctuation">}</span>
<span class="ln">42 </span>
<span class="ln">43 </span> <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">delete_device</span><span class="punctuation">()</span>
<span class="ln">44 </span> <span class="punctuation">{</span>
<span class="ln">45 </span>    <span class="keyword">delete</span> <span class="punctuation">[]</span> <span class="name">ptr</span><span class="punctuation">;</span>
<span class="ln">46 </span> <span class="punctuation">}</span>
</pre>
<p>Line 1-2 : Include the Tango master include file (tango.h) and the
StepperMotor class definition file (steppermotor.h)</p>
<p>Line 4 : Open the <em>StepperMotor</em> namespace</p>
<p>Line 7-11 : The first form of the class constructor. It execute the
Tango base class constructor with the two parameters. Note that the
device name passed to this constructor as a C++ string is passed to the
Tango::DeviceImpl constructor as a classical C string. Then the
<em>init_device</em> method is executed.</p>
<p>Line 13-17 : The second form of the class constructor. It execute the
Tango base class constructor with its two parameters. Then the
<em>init_device</em> method is executed.</p>
<p>Line 19-23: The third form of constructor. Again, it execute the Tango
base class constructor with its three parameters. Then the
<em>init_device</em> method is executed.</p>
<p>Line 25-41 : The <em>init_device</em> method. All the device data
initialization is done in this method. The device properties are also
retrieved from database with a call to the <em>get_device_properties</em>
method at line 40. The device data member called <em>ptr</em> is initialized
with allocated memory at line 38. It is not needed to have this pointer,
it has been added only for educational purpose.</p>
<p>Line 43-46 : The <em>delete_device</em> method. The rule of this method is to
free memory allocated in the <em>init_device</em> method. In our case , only
the device data member <em>ptr</em> is allocated in the <em>init_device</em> method.
Therefore, its memory is freed at line 45. This method is called by the
automatically added Init command before it calls the <em>init_device</em>
method. It is also called by the device destructor.</p>
</div>
<div class="section" id="the-methods-used-for-the-devreaddirection-command">
<h4>The methods used for the DevReadDirection command</h4>
<p>The DevReadDirection command is created using the template command
method. Therefore, there is no specific class needed for this command
but only one object of the TemplCommandInOut class. This command needs
two methods which are the <em>dev_read_direction</em> method and the
<em>direct_cmd_allowed</em> method. The <em>direct_cmd_allowed</em> method defines
here implements exactly the same behavior than the default one. This
method has been used only for pedagogic issue. The
<em>dev_read_direction</em> method will be executed by the <em>execute</em> method
of the TemplCommandInOut class. The <em>direct_cmd_allowed</em> method will
be executed by the <em>is_allowed</em> method of the TemplCommandInOut class.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DevLong</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">dev_read_direction</span><span class="punctuation">(</span><span class="name">DevLong</span> <span class="name">axis</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">axis</span> <span class="operator">&lt;</span> <span class="literal number integer">0</span> <span class="operator">||</span> <span class="name">axis</span> <span class="operator">&gt;</span> <span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">)</span>
<span class="ln"> 4 </span>     <span class="punctuation">{</span>
<span class="ln"> 5 </span>         <span class="name">WARNING_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Steppermotor::dev_read_direction(): axis out of range !&quot;</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>         <span class="name">WARNING_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>         <span class="name">TangoSys_OMemStream</span> <span class="name">o</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>         <span class="name">o</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Axis number &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">axis</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; out of range&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">ends</span><span class="punctuation">;</span>
<span class="ln">10 </span>         <span class="name">throw_exception</span><span class="punctuation">(</span><span class="literal string">&quot;StepperMotor_OutOfRange&quot;</span><span class="punctuation">,</span>
<span class="ln">11 </span>                         <span class="name">o</span><span class="punctuation">.</span><span class="name">str</span><span class="punctuation">(),</span>
<span class="ln">12 </span>                         <span class="literal string">&quot;StepperMotor::dev_read_direction&quot;</span><span class="punctuation">);</span>
<span class="ln">13 </span>      <span class="punctuation">}</span>
<span class="ln">14 </span>
<span class="ln">15 </span>      <span class="keyword">return</span> <span class="name">direction</span><span class="punctuation">[</span><span class="name">axis</span><span class="punctuation">];</span>
<span class="ln">16 </span>  <span class="punctuation">}</span>
<span class="ln">17 </span>
<span class="ln">18 </span>
<span class="ln">19 </span>  <span class="keyword type">bool</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">direct_cmd_allowed</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">Any</span> <span class="operator">&amp;</span><span class="name">in_data</span><span class="punctuation">)</span>
<span class="ln">20 </span>  <span class="punctuation">{</span>
<span class="ln">21 </span>      <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;In direct_cmd_allowed() method&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">22 </span>
<span class="ln">23 </span>      <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln">24 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 1-16 : The <em>dev_read_direction</em> method</p>
<p>Line 5-12 : Throw exception to client if the received axis number is out
of range</p>
<p>Line 7 : A TangoSys_OMemStream is used as stream. The
TangoSys_OMemStream has been defined in improve portability across
platform. For Unix like operating system, it is a ostrtream type. For
operating system with a full implementation of the standard library, it
is a ostringstream type.</p>
<p>Line 19-24 : The <em>direct_cmd_allowed</em> method. The command input data
is passed to this method in case of it is needed to take the decision.
This data is still packed into the CORBA Any object.</p>
</div>
<div class="section" id="the-methods-used-for-the-position-attribute">
<h4>The methods used for the Position attribute</h4>
<div class="line-block">
<div class="line">To enable reading of attributes, the StepperMotor class must re-define
two or three methods called <em>read_attr_hardware(),
read_&lt;Attribute_name&gt;()</em> and if necessary a method called</div>
<div class="line"><em>is_&lt;Attribute_name&gt;_allowed().</em> The aim of the first one is to
read the hardware. It will be called only once at the beginning of
each read_attribute CORBA call. The second method aim is to build the
exact data for the wanted attribute and to store this value into the
Attribute object. Special care has been taken in order to minimize the
number of data copy and allocation. The data passed to the Attribute
object as attribute value is passed using pointers. It must be
allocated by the method <a class="footnote-reference" href="#id146" id="id55">[12]</a> and the Attribute object will not free
this memory. Data members called attr_&lt;Attribute_name&gt;_read are
foreseen for this usage. The <em>read_attr_hardware()</em> method receives
a vector of long which are indexes into the main attributes vector of
the attributes to be read. The <em>read_Position()</em> method receives a
reference to the Attribute object. The third method
(<em>is_Position_allowed()</em>) aim is to allow or dis-allow, the
attribute reading. In some cases, some attributes can be read only if
some conditions are met. If this method returns true, the
<em>read_&lt;Attribute_name&gt;()</em> method will be called. Otherwise, an error
will be generated for the attribute. This method receives one argument
which is an emumeration describing the attribute request type (read or
write). In our example, the reading of the Position attribute is
allowed only if the device state is ON.</div>
</div>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">read_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;In read_attr_hardware for &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">attr_list</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span>
<span class="ln"> 4 </span>     <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; attribute(s)&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>     <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">long</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">attr_list</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 7 </span>     <span class="punctuation">{</span>
<span class="ln"> 8 </span>        <span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>        <span class="name">attr_name</span> <span class="operator">=</span> <span class="name">dev_attr</span><span class="operator">-&gt;</span><span class="name">get_attr_by_ind</span><span class="punctuation">(</span><span class="name">attr_list</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]).</span><span class="name">get_name</span><span class="punctuation">();</span>
<span class="ln">10 </span>
<span class="ln">11 </span>        <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">attr_name</span> <span class="operator">==</span> <span class="literal string">&quot;Position&quot;</span><span class="punctuation">)</span>
<span class="ln">12 </span>        <span class="punctuation">{</span>
<span class="ln">13 </span>           <span class="name">attr_Position_read</span> <span class="operator">=</span> <span class="operator">&amp;</span><span class="punctuation">(</span><span class="name">position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]);</span>
<span class="ln">14 </span>        <span class="punctuation">}</span>
<span class="ln">15 </span>        <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">attr_name</span> <span class="operator">==</span> <span class="literal string">&quot;Direction&quot;</span><span class="punctuation">)</span>
<span class="ln">16 </span>        <span class="punctuation">{</span>
<span class="ln">17 </span>           <span class="name">attr_Direction_read</span> <span class="operator">=</span> <span class="operator">&amp;</span><span class="punctuation">(</span><span class="name">direction</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]);</span>
<span class="ln">18 </span>        <span class="punctuation">}</span>
<span class="ln">19 </span>     <span class="punctuation">}</span>
<span class="ln">20 </span>  <span class="punctuation">}</span>
<span class="ln">21 </span>
<span class="ln">22 </span>  <span class="keyword type">void</span> <span class="name">read_Position</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
<span class="ln">23 </span>  <span class="punctuation">{</span>
<span class="ln">24 </span>     <span class="name">att</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="name">attr_Position_read</span><span class="punctuation">);</span>
<span class="ln">25 </span>  <span class="punctuation">}</span>
<span class="ln">26 </span>
<span class="ln">27 </span>  <span class="keyword type">bool</span> <span class="name">is_Position_allowed</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">AttReqType</span> <span class="name">req</span><span class="punctuation">)</span>
<span class="ln">28 </span>  <span class="punctuation">{</span>
<span class="ln">29 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">req</span> <span class="operator">==</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">WRITE_REQ</span><span class="punctuation">)</span>
<span class="ln">30 </span>        <span class="keyword">return</span> <span class="name builtin">false</span><span class="punctuation">;</span>
<span class="ln">31 </span>     <span class="keyword">else</span>
<span class="ln">32 </span>     <span class="punctuation">{</span>
<span class="ln">33 </span>        <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">get_state</span><span class="punctuation">()</span> <span class="operator">==</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">ON</span><span class="punctuation">)</span>
<span class="ln">34 </span>           <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln">35 </span>        <span class="keyword">else</span>
<span class="ln">36 </span>           <span class="keyword">return</span> <span class="name builtin">false</span><span class="punctuation">;</span>
<span class="ln">37 </span>     <span class="punctuation">}</span>
<span class="ln">38 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 6 : A loop on each attribute to be read</p>
<p>Line 9 : Get attribute name</p>
<p>Line 11 : Test on attribute name</p>
<p>Line 13 : Read hardware (pretty simple in our case)</p>
<p>Line 24 : Set attribute value in Attribute object using the
<em>set_value()</em> method. This method will also initializes the attribute
quality factor to Tango::ATTR_VALID if no alarm level are defined and
will set the attribute returned date. It is also possible to use a
method called <em>set_value_date_quality()</em> which allows the user to set
the attribute quality factor as well as the attribute date.</p>
<p>Line 33 : Test on device state</p>
</div>
<div class="section" id="the-methods-used-for-the-setposition-attribute">
<h4>The methods used for the SetPosition attribute</h4>
<p>To enable writing of attributes, the StepperMotor class must re-define
one or two methods called <em>write_&lt;Attribute_name&gt;()</em> and if necessary
a method called <em>is_&lt;Attribute_name&gt;_allowed().</em> The aim of the first
one is to write the hardware. The <em>write_Position()</em> method receives a
reference to the WAttribute object. The value to write is in this
WAttribute object. The third method (<em>is_Position_allowed()</em>) aim is
to allow or dis-allow, the attribute writing. In some cases, some
attributes can be write only if some conditions are met. If this method
returns true, the <em>write_&lt;Attribute_name&gt;()</em> method will be called.
Otherwise, an error will be generated for the attribute. This method
receives one argument which is an emumeration describing the attribute
request type (read or write). For read/write attribute, this method is
the same for reading and writing. The input argument value makes the
difference.</p>
<p>For our example, it is always possible to write the SetPosition
attribute. Therefore, the StepperMotor class only defines a
<em>write_SetPosition()</em> method.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">write_SetPosition</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">WAttribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
<span class="ln"> 2 </span> <span class="punctuation">{</span>
<span class="ln"> 3 </span>    <span class="name">att</span><span class="punctuation">.</span><span class="name">get_write_value</span><span class="punctuation">(</span><span class="name">sttr_SetPosition_write</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>    <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Attribute SetPosition value = &quot;</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>    <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="name">attr_SetPosition_write</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>    <span class="name">position</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">attr_SetPosition_write</span><span class="punctuation">;</span>
<span class="ln"> 9 </span> <span class="punctuation">}</span>
<span class="ln">10 </span>
<span class="ln">11 </span> <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">write_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">)</span>
<span class="ln">12 </span> <span class="punctuation">{</span>
<span class="ln">13 </span>
<span class="ln">14 </span> <span class="punctuation">}</span>
</pre>
<p>Line 3 : Retrieve new attribute value</p>
<p>Line 5-6 : Send some messages using Tango Logging system</p>
<p>Line 8 : Set the hardware (pretty simple in our case)</p>
<div class="line-block">
<div class="line">Line 11 - 14: The write_attr_hardware() method.</div>
<div class="line">In our case, we don’t have to do anything in the
<em>write_attr_hardware()</em> method. It is coded here just for
educational purpose. When its not needed, this method has a default
implementation in the Tango base class and it is not mandatory to
declare and defin it in your own Tango class</div>
</div>
</div>
<div class="section" id="retrieving-device-properties">
<h4>Retrieving device properties</h4>
<p>Retrieving properties is fairly simple with the use of the database
object. Each Tango device is an aggregate with a DbDevice object (see
figure [Dvice pattern figure]). This has been grouped in a method called
<em>get_device_properties</em>(). The classes and methods of the Dbxxx
objects are described in the Tango API documentation.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">get_device_property</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">DbData</span>   <span class="name">data</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>     <span class="name">data</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="name">DbDatum</span><span class="punctuation">(</span><span class="literal string">&quot;Max&quot;</span><span class="punctuation">));</span>
<span class="ln"> 5 </span>     <span class="name">data</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="name">DbDatum</span><span class="punctuation">(</span><span class="literal string">&quot;Min&quot;</span><span class="punctuation">));</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>     <span class="name">get_db_device</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">get_property</span><span class="punctuation">(</span><span class="name">data</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">data</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">].</span><span class="name">is_empty</span><span class="punctuation">()</span><span class="operator">==</span><span class="name builtin">false</span><span class="punctuation">)</span>
<span class="ln">10 </span>        <span class="name">data</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span>  <span class="operator">&gt;&gt;</span>  <span class="name">max</span><span class="punctuation">;</span>
<span class="ln">11 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">data</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">].</span><span class="name">is_empty</span><span class="punctuation">()</span><span class="operator">==</span><span class="name builtin">false</span><span class="punctuation">)</span>
<span class="ln">12 </span>        <span class="name">data</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span>  <span class="operator">&gt;&gt;</span>  <span class="name">min</span><span class="punctuation">;</span>
<span class="ln">13 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 4-5 : Two DbDatum (one per property) are stored into a DbData
object</p>
<p>Line 7 : Call the database to retrieve properties value</p>
<p>Line 9-10 : If the Max property is defined in the database, extract its
value from the DbDatum object and store it in a device data member</p>
<p>Line 11-12 : If the Min property is defined in the database, extract its
value from the DbDatum object and store it in a device data member</p>
</div>
<div class="section" id="the-remaining-methods">
<h4>The remaining methods</h4>
<p>The remaining methods are the <em>dev_state, dev_status,
always_executed_hook</em>, <em>dev_read_position</em> and <em>read_Direction()</em>
methods. The <em>dev_state</em> method parameters are fixed. It does not
receive any input parameter and must return a Tango_DevState data type.
The <em>dev_status</em> parameters are also fixed. It does not receive any
input parameter and must return a Tango string. The
<em>always_executed_hook</em> receives nothing and return nothing. The
<em>dev_read_position</em> method input parameter is the motor number as a
long and the returned parameter is the motor position also as a long
data type. The <em>read_Direction()</em> method is the method for reading the
Direction attribute.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">DevLong</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">dev_read_position</span><span class="punctuation">(</span><span class="name">DevLong</span> <span class="name">axis</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">axis</span> <span class="operator">&lt;</span> <span class="literal number integer">0</span> <span class="operator">||</span> <span class="name">axis</span> <span class="operator">&gt;</span> <span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">)</span>
<span class="ln"> 5 </span>     <span class="punctuation">{</span>
<span class="ln"> 6 </span>          <span class="name">WARNING_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Steppermotor::dev_read_position(): axis out of range !&quot;</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>          <span class="name">WARNING_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>          <span class="name">TangoSys_OMemStream</span> <span class="name">o</span><span class="punctuation">;</span>
<span class="ln">10 </span>
<span class="ln">11 </span>          <span class="name">o</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Axis number &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">axis</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot; out of range&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">ends</span><span class="punctuation">;</span>
<span class="ln">12 </span>          <span class="name">throw_exception</span><span class="punctuation">(</span><span class="literal string">&quot;StepperMotor_OutOfRange&quot;</span><span class="punctuation">,</span>
<span class="ln">13 </span>                          <span class="name">o</span><span class="punctuation">.</span><span class="name">str</span><span class="punctuation">(),</span>
<span class="ln">14 </span>                          <span class="literal string">&quot;StepperMotor::dev_read_position&quot;</span><span class="punctuation">);</span>
<span class="ln">15 </span>     <span class="punctuation">}</span>
<span class="ln">16 </span>
<span class="ln">17 </span>     <span class="keyword">return</span> <span class="name">position</span><span class="punctuation">[</span><span class="name">axis</span><span class="punctuation">];</span>
<span class="ln">18 </span>  <span class="punctuation">}</span>
<span class="ln">19 </span>
<span class="ln">20 </span>  <span class="keyword type">void</span> <span class="name">always_executed_hook</span><span class="punctuation">()</span>
<span class="ln">21 </span>  <span class="punctuation">{</span>
<span class="ln">22 </span>     <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;In the always_executed_hook method &lt;&lt; endl;</span>
<span class="ln">23 </span>  <span class="punctuation">}</span>
<span class="ln">24 </span>
<span class="ln">25 </span>  <span class="name">Tango_DevState</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">dev_state</span><span class="punctuation">()</span>
<span class="ln">26 </span>  <span class="punctuation">{</span>
<span class="ln">27 </span>     <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;In StepperMotor state command&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">28 </span>     <span class="keyword">return</span> <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">dev_state</span><span class="punctuation">();</span>
<span class="ln">29 </span>  <span class="punctuation">}</span>
<span class="ln">30 </span>
<span class="ln">31 </span>  <span class="name">Tango_DevString</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">dev_status</span><span class="punctuation">()</span>
<span class="ln">32 </span>  <span class="punctuation">{</span>
<span class="ln">33 </span>     <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;In StepperMotor status command&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">34 </span>     <span class="keyword">return</span> <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">dev_status</span><span class="punctuation">();</span>
<span class="ln">35 </span>  <span class="punctuation">}</span>
<span class="ln">36 </span>
<span class="ln">37 </span>  <span class="keyword type">void</span> <span class="name">read_Direction</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="name">att</span><span class="punctuation">)</span>
<span class="ln">38 </span>  <span class="punctuation">{</span>
<span class="ln">39 </span>     <span class="name">att</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="name">attr_Direction_read</span><span class="punctuation">);</span>
<span class="ln">40 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 1-18 : The <em>dev_read_position</em> method</p>
<p>Line 6-14 : Throw exception to client if the received axis number is out
of range</p>
<p>Line 9 : A TangoSys_OMemStream is used as stream. The
TangoSys_OMemStream has been defined in improve portability across
platform. For Unix like operating system, it is a ostrtream type. For
operating system with a full implementation of the standard library, it
is a ostringstream type.</p>
<p>Line 20-23 : The <em>always_executed_hook</em> method. It does nothing. It
has been included here only as pedagogic usage.</p>
<p>Line 25-29 : The <em>dev_state</em> method. It does exactly what the default
<em>dev_state</em> does. It has been included here only as pedagogic usage</p>
<p>Line 31-35 : The <em>dev_status</em> method. It does exactly what the default
<em>dev_statu</em>s does. It has been included here only as pedagogic usage</p>
<p>Line 37-40 : The <em>read_Direction</em> method. Simply set the Attribute
object internal value</p>
</div>
</div>
</div>
<div class="section" id="device-server-under-windows">
<h2><a class="toc-backref" href="#id252">Device server under Windows</a></h2>
<p>Two kind of programs are available under Windows. These kinds of
programs are called console application or Windows application. A
console application is started from a MS-DOS window and is very similar
to classical UNIX program. A Windows application is most of the time not
started from a MS-DOS window and is generally a graphical application
without standard input/output. Writing a device server in a console
application is straight forward following the rules described in the
previous sub-chapters. Writing a device server in a Windows application
needs some changes detailed in the following sub-chapters.</p>
<div class="section" id="the-tango-device-server-graphical-interface">
<h3><a class="toc-backref" href="#id253">The Tango device server graphical interface</a></h3>
<p>Within the Windows operating system, most of the running application has
a window user interface. This is also true for the Windows Tango device
server. Using or not this interface is up to the device server
programmer. The choice is done with an argument to the <em>server_init()</em>
method of the Tango::Util class. This interface is pretty simple and is
based on three windows which are :</p>
<ul class="simple">
<li>The device server main window</li>
<li>The device server console window</li>
<li>The device server help window</li>
</ul>
<div class="section" id="the-device-server-main-window">
<h4>The device server main window</h4>
<p>This window looks like :</p>
<div class="figure">
<img alt="Tango device server main window" src="ds_writing/nt_server/main" style="width: 10.00000cm;" />
<p class="caption">Tango device server main window</p>
</div>
<p>Four menus are available in this window. The File menu allows the user
to exit the device server. The View menu allows you to display/hide the
device server console window. The Debug menu allows the user to change
the server output verbose level. All the outputs goes to the console
window even if it is hidden. The Help menu displays the help window. The
device server name is displayed in the window title. The text displayed
at the bottom of the window has a default value (the one displayed in
this window dump) but may be changed by the device server programmer
using the <em>set_main_window_text()</em> method of the Tango::Util class.
If used, this method must be called prior to the call of the
<em>server_init()</em> method. Refer to  for
a complete description of this method.</p>
</div>
<div class="section" id="the-console-window">
<h4>The console window</h4>
<p>This window looks like :</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>It simply displays all the logging** message when a console target is
used in the device server.</p>
</div>
<div class="section" id="the-help-window">
<h4>The help window</h4>
<p>This window looks like :</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>This window displays</p>
<ul class="simple">
<li>The device server name</li>
<li>The Tango library release</li>
<li>The Tango IDL definition release</li>
<li>The device server release. The device server programmer may set this
release number using the <em>set_server_version()</em> method of the
Tango::Util class. If used, this must be done prior to the call of
the <em>server_init()</em> method. If the <em>set_server_version()</em> method
is not used, x.y is displays as version number. Refer to
 for a complete description of this
method.</li>
</ul>
</div>
</div>
<div class="section" id="mfc-device-server">
<h3><a class="toc-backref" href="#id254">MFC device server</a></h3>
<p>There is no <em>main</em> function within a classical MFC program. Most of the
time, your application is represented by one instance of a C++ class
which inherits from the MFC CWinApp class. This CWinApp class has
several methods that you may overload in your application class. For a
device server to run correctly, you must overload two methods of the
CWinApp class. These methods are the <em>InitInstance()</em> and
<em>ExitInstance()</em> methods. The rule of these methods is obvious following
their names.</p>
<p><strong>Remember that if the Tango device server graphical user interface is
used, you must link your device server with the Tango windows resource
file</strong>. This is done by adding the Tango resource file to the Project
Settings/Link/Input/Object, library modules window in VC++.</p>
<div class="section" id="the-initinstance-method">
<h4>The InitInstance method</h4>
<p>The code to be added here is the equivalent of the code written in a
classical <em>main()</em> function. Don’t forget to add the <em>tango.h</em> file in
the list of included files.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="name">BOOL</span> <span class="name">FluidsApp</span><span class="operator">::</span><span class="name">InitInstance</span><span class="punctuation">()</span>
<span class="ln"> 2 </span> <span class="punctuation">{</span>
<span class="ln"> 3 </span>    <span class="name">AfxEnableControlContainer</span><span class="punctuation">();</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span> <span class="comment single">// Standard initialization
</span><span class="ln"> 6 </span><span class="comment single"></span> <span class="comment single">// If you are not using these features and wish to reduce the size
</span><span class="ln"> 7 </span><span class="comment single"></span> <span class="comment single">//  of your final executable, you should remove from the following
</span><span class="ln"> 8 </span><span class="comment single"></span> <span class="comment single">//  the specific initialization routines you do not need.
</span><span class="ln"> 9 </span><span class="comment single"></span>
<span class="ln">10 </span>  <span class="comment preproc">#ifdef _AFXDLL
</span><span class="ln">11 </span><span class="comment preproc"></span>    <span class="name">Enable3dControls</span><span class="punctuation">();</span>          <span class="comment single">// Call this when using MFC in a shared DLL
</span><span class="ln">12 </span><span class="comment single"></span>  <span class="comment preproc">#else
</span><span class="ln">13 </span><span class="comment preproc"></span>    <span class="name">Enable3dControlsStatic</span><span class="punctuation">();</span>    <span class="comment single">// Call this when linking to MFC statically
</span><span class="ln">14 </span><span class="comment single"></span>  <span class="comment preproc">#endif
</span><span class="ln">15 </span><span class="comment preproc"></span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span><span class="punctuation">;</span>
<span class="ln">16 </span>    <span class="name">try</span>
<span class="ln">17 </span>    <span class="punctuation">{</span>
<span class="ln">18 </span>
<span class="ln">19 </span>        <span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="name">m_hInstance</span><span class="punctuation">,</span><span class="name">m_nCmdShow</span><span class="punctuation">);</span>
<span class="ln">20 </span>
<span class="ln">21 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_init</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">22 </span>
<span class="ln">23 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_run</span><span class="punctuation">();</span>
<span class="ln">24 </span>
<span class="ln">25 </span>    <span class="punctuation">}</span>
<span class="ln">26 </span>    <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">27 </span>    <span class="punctuation">{</span>
<span class="ln">28 </span>        <span class="name">MessageBox</span><span class="punctuation">((</span><span class="name">HWND</span><span class="punctuation">)</span><span class="name builtin">NULL</span><span class="punctuation">,</span><span class="literal string">&quot;Memory error&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;Command line&quot;</span><span class="punctuation">,</span><span class="name">MB_ICONSTOP</span><span class="punctuation">);</span>
<span class="ln">29 </span>        <span class="keyword">return</span><span class="punctuation">(</span><span class="name">FALSE</span><span class="punctuation">);</span>
<span class="ln">30 </span>    <span class="punctuation">}</span>
<span class="ln">31 </span>    <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevFailed</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">32 </span>    <span class="punctuation">{</span>
<span class="ln">33 </span>        <span class="name">MessageBox</span><span class="punctuation">((</span><span class="name">HWND</span><span class="punctuation">)</span><span class="name builtin">NULL</span><span class="punctuation">,,</span><span class="name">e</span><span class="punctuation">.</span><span class="name">errors</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">].</span><span class="name">desc</span><span class="punctuation">.</span><span class="name">in</span><span class="punctuation">(),</span><span class="literal string">&quot;Command line&quot;</span><span class="punctuation">,</span><span class="name">MB_ICONSTOP</span><span class="punctuation">);</span>
<span class="ln">34 </span>        <span class="keyword">return</span><span class="punctuation">(</span><span class="name">FALSE</span><span class="punctuation">);</span>
<span class="ln">35 </span>    <span class="punctuation">}</span>
<span class="ln">36 </span>    <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">CORBA</span><span class="operator">::</span><span class="name">Exception</span> <span class="operator">&amp;</span><span class="punctuation">)</span>
<span class="ln">37 </span>    <span class="punctuation">{</span>
<span class="ln">38 </span>        <span class="name">MessageBox</span><span class="punctuation">((</span><span class="name">HWND</span><span class="punctuation">)</span><span class="name builtin">NULL</span><span class="punctuation">,</span><span class="literal string">&quot;Exception CORBA&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;Command line&quot;</span><span class="punctuation">,</span><span class="name">MB_ICONSTOP</span><span class="punctuation">);</span>
<span class="ln">39 </span>        <span class="keyword">return</span><span class="punctuation">(</span><span class="name">FALSE</span><span class="punctuation">);</span>
<span class="ln">40 </span>    <span class="punctuation">}</span>
<span class="ln">41 </span>
<span class="ln">42 </span>    <span class="name">m_pMainWnd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">CWnd</span><span class="punctuation">;</span>
<span class="ln">43 </span>    <span class="name">m_pMainWnd</span><span class="operator">-&gt;</span><span class="name">Attach</span><span class="punctuation">(</span><span class="name">tg</span><span class="operator">-&gt;</span><span class="name">get_ds_main_window</span><span class="punctuation">());</span>
<span class="ln">44 </span>
<span class="ln">45 </span>    <span class="keyword">return</span> <span class="name">TRUE</span><span class="punctuation">;</span>
<span class="ln">46 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 19 : Initialise Tango system. This method also analises the
argument used in command line.</p>
<p>Line 21 : Create Tango classes requesting the Tango Windows graphical
interface to be used</p>
<p>Line 23 : Start Network listener. Note that under NT, this call returns
in the contrary of UNIX like operating system.</p>
<p>Line 26-30 : Display a message box in case of memory allocation error
and leave method with a return value set to false in order to stop the
process</p>
<p>Line 31-35 : Display a message box in case of error during server
initialization phase.</p>
<p>Line 36-40 : Display a message box in case of error other than memory
allocation. Leave method with a return value set to false in order to
stop the process.</p>
<p>Line 37-38 : Create a MFC main window and attach the Tango graphical
interface main window to this MFC window.</p>
</div>
<div class="section" id="the-exitinstance-method">
<h4>The ExitInstance method</h4>
<p>This method is called when the application is stopped. For Tango device
server, its rule is to destroy the Tango::Util singleton if this one has
been correctly constructed.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">int</span> <span class="name">FluidsApp</span><span class="operator">::</span><span class="name">ExitInstance</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="keyword type">bool</span> <span class="name">del</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>     <span class="name">try</span>
<span class="ln"> 6 </span>     <span class="punctuation">{</span>
<span class="ln"> 7 </span>         <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">instance</span><span class="punctuation">();</span>
<span class="ln"> 8 </span>     <span class="punctuation">}</span>
<span class="ln"> 9 </span>     <span class="keyword">catch</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevFailed</span><span class="punctuation">)</span>
<span class="ln">10 </span>     <span class="punctuation">{</span>
<span class="ln">11 </span>         <span class="name">del</span> <span class="operator">=</span> <span class="name builtin">false</span><span class="punctuation">;</span>
<span class="ln">12 </span>     <span class="punctuation">}</span>
<span class="ln">13 </span>
<span class="ln">14 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">del</span> <span class="operator">==</span> <span class="name builtin">true</span><span class="punctuation">)</span>
<span class="ln">15 </span>         <span class="keyword">delete</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">instance</span><span class="punctuation">());</span>
<span class="ln">16 </span>
<span class="ln">17 </span>     <span class="keyword">return</span> <span class="name">CWinApp</span><span class="operator">::</span><span class="name">ExitInstance</span><span class="punctuation">();</span>
<span class="ln">18 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 7 : Try to retrieve the Tango::Util singleton. If this one has not
been constructed correctly, this call will throw an exception.</p>
<p>Line 9-12 : Catch the exception in case of incomplete Tango::Util
singleton construction</p>
<p>Line 14-15 : Delete the Tango::Util singleton. This will unregister the
Tango device server from the Tango database.</p>
<p>Line 17 : Execute the <em>ExitInstance</em> method of the CWinApp class.</p>
<p>If you don’t want to use the Tango device server graphical interface, do
not pass any parameter to the <em>server_init()</em> method and instead of the
code display in lines 37 and 38 in the previous example of the
<em>InitInstance()</em> method, use your own code to initialize your own
application.</p>
</div>
<div class="section" id="example-of-how-to-build-a-windows-device-server-mfc-based">
<h4>Example of how to build a Windows device server MFC based</h4>
<p>This sub-chapter gives an example of what it is needed to do to build a
MFC Windows device server. Rather than being a list of actions to
strictly follow, this is some general rules of how using VC++ to build a
Tango device server using MFC.</p>
<ol class="arabic simple">
<li>Create your device server using Pogo. For a class named MyMotor, the
following files will be needed : <em>class_factory.cpp</em>,
<em>MyMotorClass.h</em>, <em>MyMotorClass.cpp</em>, <em>MyMotor.h</em> and <em>MyMotor.cpp.</em></li>
<li>On a Windows computer running VC++, create a new project of type “MFC
app Wizard (exe)” using static MFC libs. Ask for a dialog based
project without ActiveX controls.</li>
<li>Copy the five files generated by Pogo to the Windows computer and add
them to your project</li>
<li>Remove the dialog window files (xxxDlg.cpp and xxxDlg.h), the
Resource include file and the resource script file from your project</li>
<li>Add #include &lt;stdafx.h&gt; as first line of the include files list in
<em>class_factory.cpp</em>, <em>MyMotorClass.cpp</em> and <em>MyMotor.cpp</em> file. Also
add your own directory and the Tango include directory to the project
pre-compiler include directories list.</li>
<li>Enable RTTI in your project settings (see chapter [Compiling NT])</li>
<li>Change your application class:<ol class="arabic">
<li>Add the definition of an <em>ExitInstance</em> method in the declaration
file. (xxx.h file)</li>
<li>Remove the include of the dialog window file in the xxx.cpp file
and add an include of the Tango master include files (tango.h)</li>
<li>Replace the <em>InitInstance</em>() method as described in previous
sub-chapter. (xx.cpp file)</li>
<li>Add an <em>ExitInstance()</em> method as described in previous
sub-chapter (xxx.cpp file)</li>
</ol>
</li>
<li>Add all the libraries needed to compile a Tango device server (see
chapter [Compiling NT]) and the Tango resource file to the linker
Object/Libraries modules.</li>
</ol>
</div>
</div>
<div class="section" id="win32-application">
<h3><a class="toc-backref" href="#id255">Win32 application</a></h3>
<p>Even if it is more natural to use the C++ structure of the MFC class to
write a Tango device server, it is possible to write a device server as
a Win32 application. Instead of having a <em>main()</em> function as the
application entry point, the operating system, provides a <em>WinMain()</em>
function as the application entry point. Some code must be added to this
<em>WinMain</em> function in order to support Tango device server. Don’t forget
to add the <em>tango</em>.<em>h</em> file in the list of included files. If you are
using the project files generated by Pogo, don’t forget to change the
linker SUBSYSTEM option to Windows (Under Linker/System in the project
properties window).</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">int</span> <span class="name">APIENTRY</span> <span class="name function">WinMain</span><span class="punctuation">(</span><span class="name">HINSTANCE</span> <span class="name">hInstance</span><span class="punctuation">,</span>
<span class="ln"> 2 </span>                       <span class="name">HINSTANCE</span> <span class="name">hPrevInstance</span><span class="punctuation">,</span>
<span class="ln"> 3 </span>                       <span class="name">LPSTR</span>     <span class="name">lpCmdLine</span><span class="punctuation">,</span>
<span class="ln"> 4 </span>                       <span class="keyword type">int</span>       <span class="name">nCmdShow</span><span class="punctuation">)</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>     <span class="name">MSG</span> <span class="name">msg</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span><span class="punctuation">;</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>     <span class="name">try</span>
<span class="ln">10 </span>     <span class="punctuation">{</span>
<span class="ln">11 </span>         <span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="name">hInstance</span><span class="punctuation">,</span><span class="name">nCmdShow</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>         <span class="name">string</span> <span class="name">txt</span><span class="punctuation">;</span>
<span class="ln">14 </span>         <span class="name">txt</span> <span class="operator">=</span> <span class="literal string">&quot;Blabla first line</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span><span class="punctuation">;</span>
<span class="ln">15 </span>         <span class="name">txt</span> <span class="operator">=</span> <span class="name">txt</span> <span class="operator">+</span> <span class="literal string">&quot;Blabla second line</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span><span class="punctuation">;</span>
<span class="ln">16 </span>         <span class="name">txt</span> <span class="operator">=</span> <span class="name">txt</span> <span class="operator">+</span> <span class="literal string">&quot;Blabla third line</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span><span class="punctuation">;</span>
<span class="ln">17 </span>         <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">set_main_window_text</span><span class="punctuation">(</span><span class="name">txt</span><span class="punctuation">);</span>
<span class="ln">18 </span>         <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">set_server_version</span><span class="punctuation">(</span><span class="literal string">&quot;2.2&quot;</span><span class="punctuation">);</span>
<span class="ln">19 </span>
<span class="ln">20 </span>         <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_init</span><span class="punctuation">(</span><span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">21 </span>
<span class="ln">22 </span>         <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_run</span><span class="punctuation">();</span>
<span class="ln">23 </span>
<span class="ln">24 </span>     <span class="punctuation">}</span>
<span class="ln">25 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">26 </span>     <span class="punctuation">{</span>
<span class="ln">27 </span>         <span class="name">MessageBox</span><span class="punctuation">((</span><span class="name">HWND</span><span class="punctuation">)</span><span class="name builtin">NULL</span><span class="punctuation">,</span><span class="literal string">&quot;Memory error&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;Command line&quot;</span><span class="punctuation">,</span><span class="name">MB_ICONSTOP</span><span class="punctuation">);</span>
<span class="ln">28 </span>         <span class="keyword">return</span> <span class="punctuation">(</span><span class="name">FALSE</span><span class="punctuation">);</span>
<span class="ln">29 </span>     <span class="punctuation">}</span>
<span class="ln">30 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevFailed</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">31 </span>     <span class="punctuation">{</span>
<span class="ln">32 </span>         <span class="name">MessageBox</span><span class="punctuation">((</span><span class="name">HWND</span><span class="punctuation">)</span><span class="name builtin">NULL</span><span class="punctuation">,</span><span class="name">e</span><span class="punctuation">.</span><span class="name">errors</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">].</span><span class="name">desc</span><span class="punctuation">.</span><span class="name">in</span><span class="punctuation">(),</span><span class="literal string">&quot;Command line&quot;</span><span class="punctuation">,</span><span class="name">MB_ICONSTOP</span><span class="punctuation">);</span>
<span class="ln">33 </span>         <span class="keyword">return</span> <span class="punctuation">(</span><span class="name">FALSE</span><span class="punctuation">);</span>
<span class="ln">34 </span>     <span class="punctuation">}</span>
<span class="ln">35 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">CORBA</span><span class="operator">::</span><span class="name">Exception</span> <span class="operator">&amp;</span><span class="punctuation">)</span>
<span class="ln">36 </span>     <span class="punctuation">{</span>
<span class="ln">37 </span>         <span class="name">MessageBox</span><span class="punctuation">((</span><span class="name">HWND</span><span class="punctuation">)</span><span class="name builtin">NULL</span><span class="punctuation">,</span><span class="literal string">&quot;Exception CORBA&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;Command line&quot;</span><span class="punctuation">,</span><span class="name">MB_ICONSTOP</span><span class="punctuation">);</span>
<span class="ln">38 </span>         <span class="keyword">return</span><span class="punctuation">(</span><span class="name">FALSE</span><span class="punctuation">);</span>
<span class="ln">39 </span>     <span class="punctuation">}</span>
<span class="ln">40 </span>
<span class="ln">41 </span>     <span class="keyword">while</span> <span class="punctuation">(</span><span class="name">GetMessage</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">msg</span><span class="punctuation">,</span> <span class="name builtin">NULL</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">))</span>
<span class="ln">42 </span>     <span class="punctuation">{</span>
<span class="ln">43 </span>         <span class="name">TranslateMessage</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">msg</span><span class="punctuation">);</span>
<span class="ln">44 </span>         <span class="name">DispatchMessage</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">msg</span><span class="punctuation">);</span>
<span class="ln">45 </span>     <span class="punctuation">}</span>
<span class="ln">46 </span>
<span class="ln">47 </span>     <span class="keyword">delete</span> <span class="name">tg</span><span class="punctuation">;</span>
<span class="ln">48 </span>
<span class="ln">49 </span>     <span class="keyword">return</span> <span class="name">msg</span><span class="punctuation">.</span><span class="name">wParam</span><span class="punctuation">;</span>
<span class="ln">50 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 11 : Create the Tango::Util singleton</p>
<p>Line 13-18 : Set parameters for the graphical interface</p>
<p>Line 20 : Initialize Tango device server requesting the display of the
graphical interface</p>
<p>Line 22 : Run the device server</p>
<p>Line 25-39 : Display a message box for all the kinds of error during
Tango device server initialization phase and exit WinMain function.</p>
<p>Line 41-45 : The Windows message loop</p>
<p>Line 47 : Delete the Tango::Util singleton. This class destructor
unregisters the device server from the Tango database.</p>
<p><strong>Remember that if the Tango device server graphical user interface is
used, you must add the Tango windows resource file</strong> <strong>to your
project</strong>.</p>
<p>If you don’t want to use the tango device server graphical user
interface, do not use any parameter in the call of the <em>server_init()</em>
method and do not link your device server with the Tango Windows
resource file.</p>
</div>
<div class="section" id="device-server-as-service">
<h3><a class="toc-backref" href="#id256">Device server as service</a></h3>
<p>With Windows, if you want to have processes which survive to logoff
sequence and/or are automatically started during computer startup
sequence, you have to write them as service. It is possible to write
Tango device server as service. You need to</p>
<ol class="arabic simple">
<li>Write a class which inherits from a pre-written Tango class called
NTService. This class must have a <em>start</em> method.</li>
<li>Write a main function following a predefined skeleton.</li>
</ol>
<div class="section" id="the-service-class">
<h4>The service class</h4>
<p>It must inherits from the <em>NTService</em> class and defines a <em>start</em>
method. The NTService class must be constructed with one argument which
is the device server executable name. The <em>start</em> method has three
arguments which are the number of arguments passed to the method, the
argument list and a reference to an object used to log info in the NT
event system. The first two args must be passed to the Tango::Util::init
method and the last one is used to log error or info messages. The class
definition file looks like</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>  <span class="comment preproc">#include &lt;ntservice.h&gt;
</span><span class="ln"> 3 </span><span class="comment preproc"></span>
<span class="ln"> 4 </span>  <span class="keyword">class</span> <span class="name class">MYService</span><span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">NTService</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln"> 7 </span>     <span class="name">MYService</span><span class="punctuation">(</span><span class="keyword type">char</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>     <span class="keyword type">void</span> <span class="name function">start</span><span class="punctuation">(</span><span class="keyword type">int</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">**</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">NTEventLogger</span> <span class="operator">*</span><span class="punctuation">);</span>
<span class="ln">10 </span>  <span class="punctuation">};</span>
</pre>
<p>Line 1-2 : Some include files</p>
<p>Line 4 : The MYService class inherits from <em>Tango::NTService</em> class</p>
<p>Line 7 : Constructor with one parameter</p>
<div class="line-block">
<div class="line">Line 9 : The <em>start()</em> method</div>
<div class="line">The class source code looks like</div>
</div>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;myservice.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 3 </span><span class="comment preproc"></span>
<span class="ln"> 4 </span>  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="name">std</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="name">MYService</span><span class="operator">::</span><span class="name">MYService</span><span class="punctuation">(</span><span class="keyword type">char</span> <span class="operator">*</span><span class="name">exec_name</span><span class="punctuation">)</span><span class="operator">:</span><span class="name">NTService</span><span class="punctuation">(</span><span class="name">exec_name</span><span class="punctuation">)</span>
<span class="ln"> 7 </span>  <span class="punctuation">{</span>
<span class="ln"> 8 </span>  <span class="punctuation">}</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>  <span class="keyword type">void</span> <span class="name">MYService</span><span class="operator">::</span><span class="name">start</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">**</span><span class="name">argv</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">NTEventLogger</span> <span class="operator">*</span><span class="name">logger</span><span class="punctuation">)</span>
<span class="ln">11 </span>  <span class="punctuation">{</span>
<span class="ln">12 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span><span class="punctuation">;</span>
<span class="ln">13 </span>     <span class="name">try</span>
<span class="ln">14 </span>     <span class="punctuation">{</span>
<span class="ln">15 </span>        <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">_service</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln">16 </span>
<span class="ln">17 </span>        <span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">);</span>
<span class="ln">18 </span>
<span class="ln">19 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_init</span><span class="punctuation">();</span>
<span class="ln">20 </span>
<span class="ln">21 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_run</span><span class="punctuation">();</span>
<span class="ln">22 </span>     <span class="punctuation">}</span>
<span class="ln">23 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">24 </span>     <span class="punctuation">{</span>
<span class="ln">25 </span>        <span class="name">logger</span><span class="operator">-&gt;</span><span class="name">error</span><span class="punctuation">(</span><span class="literal string">&quot;Can't allocate memory to store device object&quot;</span><span class="punctuation">);</span>
<span class="ln">26 </span>     <span class="punctuation">}</span>
<span class="ln">27 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevFailed</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">28 </span>     <span class="punctuation">{</span>
<span class="ln">29 </span>        <span class="name">logger</span><span class="operator">-&gt;</span><span class="name">error</span><span class="punctuation">(</span><span class="name">e</span><span class="punctuation">.</span><span class="name">errors</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">].</span><span class="name">desc</span><span class="punctuation">.</span><span class="name">in</span><span class="punctuation">());</span>
<span class="ln">30 </span>     <span class="punctuation">}</span>
<span class="ln">31 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">CORBA</span><span class="operator">::</span><span class="name">Exception</span> <span class="operator">&amp;</span><span class="punctuation">)</span>
<span class="ln">32 </span>     <span class="punctuation">{</span>
<span class="ln">33 </span>        <span class="name">logger</span><span class="operator">-&gt;</span><span class="name">error</span><span class="punctuation">(</span><span class="literal string">&quot;CORBA Exception&quot;</span><span class="punctuation">);</span>
<span class="ln">34 </span>     <span class="punctuation">}</span>
<span class="ln">35 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 6-8 : The MYService class constructor code.</p>
<p>Line 15 : Set to true the <em>_service</em> static variable of the
<em>Tango::Util</em> class.</p>
<p>Line 17-21 : Classical Tango device server startup code</p>
<p>Line 23-34 : Exception management. Please, note that within a service.
it is not possible to print data on a console. This method receives a
reference to a logger object. This object sends all its output to the
Windows event system. It is used to send messages when an exception has
occurred.</p>
</div>
<div class="section" id="the-main-function">
<h4>The main function</h4>
<p>The main function is used to create one instance of the class describing
the service, to check the service option and to run the service. The
code looks like :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>  <span class="comment preproc">#include &lt;MYService.h&gt;
</span><span class="ln"> 3 </span><span class="comment preproc"></span>
<span class="ln"> 4 </span>  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="name">std</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>  <span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">*</span><span class="name">argv</span><span class="punctuation">[])</span>
<span class="ln"> 8 </span>  <span class="punctuation">{</span>
<span class="ln"> 9 </span>     <span class="name">MYService</span> <span class="name">service</span><span class="punctuation">(</span><span class="name">argv</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]);</span>
<span class="ln">10 </span>
<span class="ln">11 </span>     <span class="keyword type">int</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln">12 </span>     <span class="keyword">if</span> <span class="punctuation">((</span><span class="name">ret</span> <span class="operator">=</span> <span class="name">service</span><span class="punctuation">.</span><span class="name">options</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">))</span> <span class="operator">&lt;=</span> <span class="literal number integer">0</span><span class="punctuation">)</span>
<span class="ln">13 </span>         <span class="keyword">return</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln">14 </span>
<span class="ln">15 </span>     <span class="name">service</span><span class="punctuation">.</span><span class="name">run</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">);</span>
<span class="ln">16 </span>
<span class="ln">17 </span>     <span class="keyword">return</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">18 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 9 : Create one instance of the MYService class with the executable
name as parameter</p>
<p>Line 12 : Check service option with the <em>options()</em> method inherited
from the NTService class.</p>
<p>Line 15 : Run the service. The <em>run()</em> method is inherited from the
NTService class. This method will after some NT initialization sequence
execute the user <em>start()</em> method.</p>
</div>
<div class="section" id="service-options-and-messages">
<h4>Service options and messages</h4>
<p>When a Tango device server is written as a Windows service, it supports
several new options. These option are linked to Windows service usage.</p>
<p>Before it can be used, a service must be installed. A name and a title
is associated to each service. For Tango device server used as service,
the service name is build from the executable name followed by the
underscore character and the instance name. For example, a device server
service executable file named “opc” and started with “fluids” as
instance name, will be named “opc_fluids”. The title string is built
from the service executable name followed by the sentence “Tango device
server” and the instance name between parenthesis. In the previous
example, the service title will be “opc Tango device server (fluids)”.
Once a service is installed, you can configure it with the “Services”
application of the control panel. Services title are displayed by this
application and allow the user to select one specific service. Once a
service is selected, it is possible to start/stop it and to configure
its startup type as manual (with the Services application) or as
automatic. When the automatic mode is chosen, the service starts when
the computer is started. In this case, the service executable code must
resides on the computer local disk.</p>
<p>Tango device server logs message in the Windows event system when the
service is started or stopped. You can see these messages with the
“Event Viewer” application (Start-&gt;Programs-&gt;Administrative tools-&gt;Event
Viewer) and choose the Application events.</p>
<p>The new options are -i, -s, -u, -h and -d.</p>
<ul class="simple">
<li>-i : Install the service</li>
<li>-s : Install the service and choose the automatic startup mode</li>
<li>-u : Un-install the service</li>
<li>-dbg : Run in console mode to debug service. The service must have
been installed prior to used it. The classical -v device server
option can be used with the -d option.</li>
</ul>
<p>On the command line, all these options must be used after the device
server instance name (“opc fluids -i” to install the service, “opc
fluids -u” to un-install the service, “opc fluids -v -d” to debug the
service)</p>
</div>
<div class="section" id="tango-device-server-using-mfc-as-windows-service">
<h4>Tango device server using MFC as Windows service</h4>
<p>If your Tango device server uses MFC and must be written as a Windows NT
service, follow these rules :</p>
<ul class="simple">
<li>Don’t forget to add the <em>stdafx.h</em> file as the first file included in
all the source files making the project.</li>
<li>Comment out the definition of VC_EXTRALEAN in the <em>stdafx.h</em> file.</li>
<li>Change the pre-processor definitions, replace _WINDOWS by _CONSOLE</li>
<li>Add the /SUBSYSTEM:CONSOLE option in the linker options window of the
project settings.</li>
<li>Add a call to initialize the MFC (<em>AfxWinInit()</em>) in the service main
function</li>
</ul>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">*</span><span class="name">argv</span><span class="punctuation">[])</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span><span class="name">AfxWinInit</span><span class="punctuation">(</span><span class="operator">::</span><span class="name">GetModuleHandle</span><span class="punctuation">(</span><span class="name builtin">NULL</span><span class="punctuation">),</span><span class="name builtin">NULL</span><span class="punctuation">,</span><span class="operator">::</span><span class="name">GetCommandLine</span><span class="punctuation">(),</span><span class="literal number integer">0</span><span class="punctuation">))</span>
<span class="ln"> 4 </span>     <span class="punctuation">{</span>
<span class="ln"> 5 </span>        <span class="name">cerr</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Can't initialise MFC !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>        <span class="keyword">return</span> <span class="operator">-</span><span class="literal number integer">1</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="punctuation">}</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>     <span class="name">service</span> <span class="name">serv</span><span class="punctuation">(</span><span class="name">argv</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]);</span>
<span class="ln">10 </span>
<span class="ln">11 </span>     <span class="keyword type">int</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln">12 </span>     <span class="keyword">if</span> <span class="punctuation">((</span><span class="name">ret</span> <span class="operator">=</span> <span class="name">serv</span><span class="punctuation">.</span><span class="name">options</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">))</span> <span class="operator">&lt;=</span> <span class="literal number integer">0</span><span class="punctuation">)</span>
<span class="ln">13 </span>          <span class="keyword">return</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln">14 </span>
<span class="ln">15 </span>     <span class="name">serv</span><span class="punctuation">.</span><span class="name">run</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">);</span>
<span class="ln">16 </span>
<span class="ln">17 </span>     <span class="keyword">return</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">18 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 3 : The MFC classes are initialized with the <em>AfxWinInit()</em>
function call.</p>
</div>
</div>
</div>
<div class="section" id="compiling-linking-and-executing-a-tango-device-server-process">
<h2><a class="toc-backref" href="#id257">Compiling, linking and executing a TANGO device server process</a></h2>
<div class="section" id="compiling-and-linking-a-c-device-server">
<h3><a class="toc-backref" href="#id258">Compiling and linking a C++ device server</a></h3>
<div class="section" id="on-unix-like-operating-system">
<h4>On UNIX like operating system</h4>
<div class="section" id="supported-development-tools">
<h5>Supported development tools</h5>
<p>The supported compiler for Linux is <strong>gcc</strong> release 3.3 and above.
Please, note that to debug a Tango device server running under Linux,
<strong>gdb</strong> release 7 and above is needed in order to correctly handle
threads.</p>
</div>
<div class="section" id="compiling">
<h5>Compiling</h5>
<p>TANGO for C++ uses omniORB (release 4) as underlying CORBA Object
Request Broker  and starting with Tango 8,
the ZMQ library. To compile a TANGO device server, your include search
path must be set to :</p>
<ul class="simple">
<li>The omniORB include directory</li>
<li>The ZMQ include directory</li>
<li>The Tango include directory</li>
<li>Your development directory</li>
</ul>
</div>
<div class="section" id="linking">
<h5>Linking</h5>
<p>To build a running device server process, you need to link your code
with several libraries. Nine of them are always the same whatever the
operating system used is. These nine libraries are:</p>
<ul class="simple">
<li>The Tango libraries (called <strong>libtango</strong> and <strong>liblog4tango</strong>)</li>
<li>Three omniORB package libraries (called <strong>libomniORB4</strong>,
<strong>libomniDynamic4</strong> and <strong>libCOS4)</strong></li>
<li>The omniORB threading library (called <strong>libomnithread</strong>)</li>
<li>The ZMQ library (callled <strong>libzmq</strong>)</li>
</ul>
<p>On top of that, you need additional libraries depending on the operating
system :</p>
<ul class="simple">
<li>For Linux, add the posix thread library (<strong>libpthread</strong>)</li>
</ul>
<p>The following table summarizes the necessary options to compile a Tango
C++ device server. Please, note that starting with Tango 8 and for gcc
release 4.3 and later, some C++11 code has been used. This requires the
compiler option -std=c++0x. Obviously, the options -I and -L must be
updated to reflect your file system organization.</p>
<dl class="docutils">
<dt>|c|c|m70mm| Operating system &amp; Compiling option &amp; Linking option</dt>
<dd>Linux gcc &amp; -D_REENTRANT -std=c++0x -I.. &amp; -L.. -ltango -llog4tango</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 8582)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>-lomniORB4 -lomniDynamic4 -lCOS4 -lomnithread -lzmq -lpthread</p>
<p>The following is an example of a Makefile for Linux. Obviously, all the
paths are set to the ESRF file system structure.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="comment preproc">#
</span><span class="ln"> 2 </span><span class="comment preproc"></span> <span class="comment preproc"># Makefile to generate a Tango server
</span><span class="ln"> 3 </span><span class="comment preproc"></span> <span class="comment preproc">#
</span><span class="ln"> 4 </span><span class="comment preproc"></span>
<span class="ln"> 5 </span> <span class="name">CC</span> <span class="operator">=</span> <span class="name">c</span><span class="operator">++</span>
<span class="ln"> 6 </span> <span class="name">BIN_DIR</span> <span class="operator">=</span> <span class="name">ubuntu1104</span>
<span class="ln"> 7 </span> <span class="name">TANGO_HOME</span> <span class="operator">=</span> <span class="operator">/</span><span class="name">segfs</span><span class="operator">/</span><span class="name">tango</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span> <span class="name">INCLUDE_DIRS</span> <span class="operator">=</span> <span class="operator">-</span><span class="name">I</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">TANGO_HOME</span><span class="punctuation">)</span><span class="operator">/</span><span class="name">include</span><span class="operator">/</span><span class="error">$</span><span class="punctuation">(</span><span class="name">BIN_DIR</span><span class="punctuation">)</span> <span class="operator">-</span><span class="name">I</span> <span class="punctuation">.</span>
<span class="ln">10 </span>
<span class="ln">11 </span>
<span class="ln">12 </span> <span class="name">LIB_DIRS</span> <span class="operator">=</span> <span class="operator">-</span><span class="name">L</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">TANGO_HOME</span><span class="punctuation">)</span><span class="operator">/</span><span class="name">lib</span><span class="operator">/</span><span class="error">$</span><span class="punctuation">(</span><span class="name">BIN_DIR</span><span class="punctuation">)</span>
<span class="ln">13 </span>
<span class="ln">14 </span>
<span class="ln">15 </span> <span class="name">CXXFLAGS</span> <span class="operator">=</span> <span class="operator">-</span><span class="name">D_REENTRANT</span> <span class="operator">-</span><span class="name">std</span><span class="operator">=</span><span class="name">c</span><span class="operator">++</span><span class="literal number integer">0</span><span class="name">x</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">INCLUDE_DIRS</span><span class="punctuation">)</span>
<span class="ln">16 </span> <span class="name">LFLAGS</span> <span class="operator">=</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">LIB_DIRS</span><span class="punctuation">)</span> <span class="operator">-</span><span class="name">ltango</span> \
<span class="ln">17 </span>                      <span class="operator">-</span><span class="name">llog4tango</span> \
<span class="ln">18 </span>                      <span class="operator">-</span><span class="name">lomniORB4</span> \
<span class="ln">19 </span>                      <span class="operator">-</span><span class="name">lomniDynamic4</span> \
<span class="ln">20 </span>                      <span class="operator">-</span><span class="name">lCOS4</span> \
<span class="ln">21 </span>                      <span class="operator">-</span><span class="name">lomnithread</span> \
<span class="ln">22 </span>                      <span class="operator">-</span><span class="name">lzmq</span> \
<span class="ln">23 </span>                      <span class="operator">-</span><span class="name">lpthread</span>
<span class="ln">24 </span>
<span class="ln">25 </span>
<span class="ln">26 </span> <span class="name">SVC_OBJS</span> <span class="operator">=</span> <span class="name">main</span><span class="punctuation">.</span><span class="name">o</span> \
<span class="ln">27 </span>            <span class="name">ClassFactory</span><span class="punctuation">.</span><span class="name">o</span> \
<span class="ln">28 </span>            <span class="name">SteppermotorClass</span><span class="punctuation">.</span><span class="name">o</span> \
<span class="ln">29 </span>            <span class="name">Steppermotor</span><span class="punctuation">.</span><span class="name">o</span> \
<span class="ln">30 </span>            <span class="name">SteppermotorStateMachine</span><span class="punctuation">.</span><span class="name">o</span>
<span class="ln">31 </span>
<span class="ln">32 </span>
<span class="ln">33 </span> <span class="punctuation">.</span><span class="name label">SUFFIXES</span><span class="punctuation">:</span> <span class="punctuation">.</span><span class="name">o</span> <span class="punctuation">.</span><span class="name">cpp</span>
<span class="ln">34 </span> <span class="punctuation">.</span><span class="name">cpp</span><span class="punctuation">.</span><span class="name label">o</span><span class="punctuation">:</span>
<span class="ln">35 </span>     <span class="error">$</span><span class="punctuation">(</span><span class="name">CC</span><span class="punctuation">)</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">CXXFLAGS</span><span class="punctuation">)</span> <span class="operator">-</span><span class="name">c</span> <span class="error">$</span><span class="operator">&lt;</span>
<span class="ln">36 </span>
<span class="ln">37 </span>
<span class="ln">38 </span> <span class="name label">all</span><span class="punctuation">:</span> <span class="name">StepperMotor</span>
<span class="ln">39 </span>
<span class="ln">40 </span> <span class="name label">StepperMotor</span><span class="punctuation">:</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">SVC_OBJS</span><span class="punctuation">)</span>
<span class="ln">41 </span>     <span class="error">$</span><span class="punctuation">(</span><span class="name">CC</span><span class="punctuation">)</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">SVC_OBJS</span><span class="punctuation">)</span> <span class="operator">-</span><span class="name">o</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">BIN_DIR</span><span class="punctuation">)</span><span class="operator">/</span><span class="name">StepperMotor</span> <span class="error">$</span><span class="punctuation">(</span><span class="name">LFLAGS</span><span class="punctuation">)</span>
<span class="ln">42 </span>
<span class="ln">43 </span> <span class="name label">clean</span><span class="punctuation">:</span>
<span class="ln">44 </span>     <span class="name">rm</span> <span class="operator">-</span><span class="name">f</span> <span class="operator">*</span><span class="punctuation">.</span><span class="name">o</span> <span class="name">core</span>
</pre>
<p>Line 5-7 : Define Makefile macros</p>
<p>Line 9-10 : Set the include file search path</p>
<p>Line 12 : Set the linker library search path</p>
<p>Line 15 : The compiler option setting</p>
<p>Line 16-23 : The linker option setting</p>
<p>Line 26-30 : All the object files needed to build the executable</p>
<p>Line 33-35 : Define rules to generate object files</p>
<p>Line 38 : Define a “all” dependency</p>
<p>Line 40-41 : How to generate the StepperMotor device server executable</p>
<p>Line 43-44 : Define a “clean” dependency</p>
</div>
</div>
<div class="section" id="on-windows-using-visual-studio">
<h4>On Windows using Visual Studio</h4>
<p>Supported Windows compiler for Tango is Visual Studio 2008 (VC 9),
Visual Studio 2010 (VC10) and Visual Studio 2013 (VC12). Most problems
in building a Windows device server revolve around the /M compiler
switch family. This switch family controls which run-time library names
are embedded in the object files, and consequently which libraries are
used during linking. Attempt to mix and match compiler settings and
libraries can cause link error and even if successful, may produce
undefined run-time behavior.</p>
<p>Selecting the correct /M switch in Visual Studio is done through a
dialog box. To open this dialog box, click on the “Project” menu (once
the correct project is selected in the Solution Explorer window) and
select the “Properties” option. To change the compiler switch open the
“C/C++” tree and select “Code Generation”. The following options are
supported.</p>
<ul class="simple">
<li>Multithreaded = /MT</li>
<li>Multithreaded DLL = /MD</li>
<li>Debug Multithreaded = /MTd</li>
<li>Debug Multithreaded DLL = /MDd</li>
</ul>
<p>Compiling a file with a value of the /M switch family will impose at
link phase the use of libraries also compiled with the same value of the
/M switch family. If you compiled your source code with the /MT option
(Multithreaded), you must link it with libraries also compiled with the
/MT option.</p>
<p>On both 32 or 64 bits computer, omniORB and TANGO relies on the
preprocessor identifier <strong>WIN32</strong> being defined in order to configure
itself. If you build an application using static libraries (option /MT
or /MTd), you must add <strong>_WINSTATIC</strong> to the list of the preprocessor
identifiers. If you build an application using DLL (option /MD or /MDd),
you must add <strong>LOG4TANGO_HAS_DLL</strong> and <strong>TANGO_HAS_DLL</strong> to the list
of preprocessor identifiers.</p>
<p>To build a running device server process, you need to link your code
with several libraries on top of the Windows libraries. These libraries
are:</p>
<ul>
<li><p class="first">The Tango libraries (called <strong>tango.lib</strong> and <strong>log4tango.lib</strong> or
<strong>tangod.lib</strong> and <strong>log4tangod.lib</strong> for debug mode)</p>
</li>
<li><div class="first line-block">
<div class="line">The omniORB package libraries (see next table)</div>
</div>
</li>
</ul>
<dl class="docutils">
<dt>|c|c| Compile mode &amp; Libraries</dt>
<dd>Debug Multithreaded &amp; omniORB4d.lib, omniDynamic4d.lib, omnithreadd.lib</dd>
<dt>and COS4d.lib</dt>
<dd>Multithreaded &amp; omniORB4.lib, omniDynamic4.lib, omnithread.lib and</dd>
<dt>COS4.lib</dt>
<dd>Debug Multithreaded DLL &amp; omniORB420_rtd.lib, omniDynamic420_rtd.lib,</dd>
<dt>omnithread40_rtd.lib,</dt>
<dd>&amp; and COS420_rtd.lib
Multithreaded DLL &amp; omniORB420_rt.lib, omniDynamic420_rt.lib,</dd>
<dt>omnithread40_rt.lib</dt>
<dd>&amp; and COS420_rt.lib</dd>
</dl>
<ul class="simple">
<li>The ZMQ library (<strong>zmq.lib</strong> or <strong>zmqd.lib</strong> for debug mode)</li>
<li>Windows network libraries (<strong>mswsock.lib</strong> and <strong>ws2_32.lib</strong>)</li>
<li>Windows graphic library (<strong>comctl32.lib</strong>)</li>
</ul>
<p>To add these libraries in Visual Studio, open the project property pages
dialog box and open the “Link” tree. Select “Input” and add these
library names to the list of library in the “Additional Dependencies”
box.</p>
<p>The “Win32 Debug” or “Win32 Release” configuration that you change
within the Configuration Manager window changes the /M switch compiler.
For instance, if you select a “Win32 Debug” configuration in a non-DLL
project, use the omniORB4d.lib, omniDynamic4d.lib and omnithreadd.lib
libraries plus the tangod.lib, log4tangod.lib and zmqd.lib libraries. If
you select the “Win32 Release” configuration, use the omniORB4.lib,
omniDynamic4.lib and omnithread.lib libraries plus the tango.lib,
log4tango.lib and zmq.lib libraries.</p>
<p><strong>WARNING</strong>: In some cases, the Microsoft Visual Studio wizard used
during project creation generates one include file called <em>Stdafx.h</em>. If
this file itself includes windows.h file, you have to add the
preprocessor macro _WIN32_WINNT and set it to 0x0500.</p>
</div>
</div>
<div class="section" id="running-a-c-device-server">
<h3><a class="toc-backref" href="#id259">Running a C++ device server</a></h3>
<p>To run a C++ Tango device server, you must set an environment variable.
This environment variable is called <strong>TANGO_HOST</strong> and has a fixed
syntax which is</p>
<p>TANGO_HOST=&lt;host&gt;:&lt;port&gt;</p>
<p>The host field is the host name where the TANGO database device server
is running. The port field is the port number on which this server is
listening. For instance, a valid syntax is TANGO_HOST=dumela:10000. For
UNIX like operating system, setting environment variable is possible
with the <em>export</em> or <em>setenv</em> command depending on the shell used. For
Windows, setting environment variable is possible with the “Environment”
tab of the “System” application in the control panel.</p>
<p>If you need to start a Tango device server on a pre-defined port (For
Tango database device server or device server without database usage),
you must use one of the underlying ORB option <em>endPoint</em> like</p>
<p>myserver myinstance_name -ORBendPoint giop:tcp::&lt;port number&gt;</p>
</div>
</div>
<div class="section" id="advanced-programming-techniques">
<h2><a class="toc-backref" href="#id260">Advanced programming techniques</a></h2>
<p>The basic techniques for implementing device server pattern are required
by each device server programmer. In certain situations, it is however
necessary to do things out of the ordinary. This chapter will look into
programming techniques which permit the device server serve more than
simply the network.</p>
<div class="section" id="receiving-signal">
<h3><a class="toc-backref" href="#id261">Receiving signal</a></h3>
<p>It is <strong>UNSAFE</strong> to use any CORBA call in a signal handler. It is also
UNSAFE to use some system calls in a signal handler. Tango device server
solved this problem by using threads. A specific thread is started to
handle signals. Therefore, every Tango device server is automatically a
threaded process. This allows the programmer to write the code which
must be executed when a signal is received as ordinary code. All device
server threads masks all signals except the specific signal thread which
is permanently waiting for signal. If a signal is sent to a device
server process, only the signal thread will receive it because it is the
single thread which does not mask signals.</p>
<p>Nevertheless, signal management is not trivial and some care have to be
taken. The signal management differs from operating system to operating
system. It is not recommended that you install your own signal routine
using any of the signal routines provided by the operating system calls
or library.</p>
<div class="section" id="using-signal">
<h4>Using signal</h4>
<p>It is possible for C++ device server to receive signals from drivers or
other processes. The TDSOM supports receiving signal at two levels: the
device level and the class level. Supporting signal at the device level
means that it is possible to specify interest into receiving signal on a
device basis. This feature is supported via three methods defined in the
DeviceImpl class. These methods are called <em>register_signal</em>,
<em>unregister_signal</em> and s<em>ignal_handler</em>.</p>
<p>The <strong>*register_signal*</strong> method has one parameter which is the signal
number. This method informs the device server signal system that the
device want to be informed when the signal passed as parameter is
received by the process. There is a special case for Linux as explained
in the previous sub-chapter. It is possible to register a signal to be
executed in the a signal handler context (with all its restrictions).
This is done with a second parameter to this <em>register_signal</em> method.
This second parameter is simply a boolean data. If it is true, the
signal_handler will be executed in a signal handler context in the
device server main thread. A default value (false) has been defined for
this parameter.</p>
<p>The <strong>*unregister_signal*</strong> method also have an input parameter which
is the signal number. This method removes the device from the list of
object which should be warned when the signal is received by the
process.</p>
<p>The <strong>*signal_handler*</strong> method is the method which is triggered when a
signal is received if the corresponding <em>register_signal</em> has been
executed. This method is defined as virtual and can be redefined by the
user. It has one input argument which is the signal number.</p>
<p>The same three methods also exist in the DeviceClass class. Their action
and their usage are similar to the DeviceImpl class methods. Installing
a signal at the class level does not mean that all the device belonging
to this class will receive the signal. This only means that the
<em>signal_handler</em> method of the DeviceClass instance will be executed.
This is useful if an action has to be executed once for a class of
devices when a signal is received.</p>
<p>The following code is an example with our stepper motor device server
configured via the database to serve three motors. These motors have the
following names : id04/motor/01, id04/motor/02 and id04/motor/03. The
signal SIGALRM (alarm signal) must be propagated only to the motor
number 2 (id04/motor/02)</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">init_device</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;StepperMotor::StepperMotor() create motor &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">dev_name</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>      <span class="keyword type">long</span> <span class="name">i</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>      <span class="keyword">for</span> <span class="punctuation">(</span><span class="name">i</span><span class="operator">=</span><span class="literal number integer">0</span><span class="punctuation">;</span> <span class="name">i</span><span class="operator">&lt;</span> <span class="name">AGSM_MAX_MOTORS</span><span class="punctuation">;</span> <span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>      <span class="punctuation">{</span>
<span class="ln"> 9 </span>          <span class="name">axis</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">10 </span>          <span class="name">position</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">11 </span>          <span class="name">direction</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span>
<span class="ln">12 </span>      <span class="punctuation">}</span>
<span class="ln">13 </span>
<span class="ln">14 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">dev_name</span> <span class="operator">==</span> <span class="literal string">&quot;id04/motor/02&quot;</span><span class="punctuation">)</span>
<span class="ln">15 </span>          <span class="name">register_signal</span><span class="punctuation">(</span><span class="name">SIGALRM</span><span class="punctuation">);</span>
<span class="ln">16 </span>  <span class="punctuation">}</span>
<span class="ln">17 </span>
<span class="ln">18 </span>  <span class="name">StepperMotor</span><span class="operator">::~</span><span class="name">StepperMotor</span><span class="punctuation">()</span>
<span class="ln">19 </span>  <span class="punctuation">{</span>
<span class="ln">20 </span>      <span class="name">unregister_signal</span><span class="punctuation">(</span><span class="name">SIGALRM</span><span class="punctuation">);</span>
<span class="ln">21 </span>  <span class="punctuation">}</span>
<span class="ln">22 </span>
<span class="ln">23 </span>  <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">signal_handler</span><span class="punctuation">(</span><span class="keyword type">long</span> <span class="name">signo</span><span class="punctuation">)</span>
<span class="ln">24 </span>  <span class="punctuation">{</span>
<span class="ln">25 </span>      <span class="name">INFO_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Inside signal handler for signal &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">signo</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">26 </span>
<span class="ln">27 </span>  <span class="comment single">//  Do what you want here
</span><span class="ln">28 </span><span class="comment single"></span>
<span class="ln">29 </span>  <span class="punctuation">}</span>
</pre>
<p>The <em>init_device</em> method is modified.</p>
<p>Line 14-15 : The device name is checked and if it is the correct name,
the device is registered in the list of device wanted to receive the
SIGALARM signal.</p>
<p>The destructor is also modified</p>
<p>Line 20 : Unregister the device from the list of devices which should
receives the SIGALRM signal. Note that unregister a signal for a device
which has not previously registered its interest for this signal does
nothing.</p>
<p>The <em>signal_handler</em> method is redefined</p>
<p>Line 25 : Print signal number</p>
<p>Line 27 : Do what you have to do when the signal SIGALRM is received.</p>
<p>If all devices must be warned when the device server process receives
the signal SIGALRM, removes line 14 in the <em>init_device</em> method.</p>
</div>
<div class="section" id="exiting-a-device-server-gracefully">
<h4>Exiting a device server gracefully</h4>
<p>A device server has to exit gracefully by unregistering itself from the
database. The necessary action to gracefully exit are automatically
executed on reception of the following signal :</p>
<ul class="simple">
<li>SIGINT, SIGTERM and SIGQUIT for device server running on Linux</li>
<li>SIGINT, SIGTERM, SIGABRT and SIGBREAK for device server running on
Windows</li>
</ul>
<p>This does not prevents device server to also register interest at device
or class levels for those signals. The user installed <em>signal_handler</em>
method will first be called before the graceful exit.</p>
</div>
</div>
<div class="section" id="inheriting">
<h3><a class="toc-backref" href="#id262">Inheriting</a></h3>
<p>This sub-chapter details how it is possible to inherit from an existing
device pattern implementation. As the device pattern includes more than
a single class, inheriting from an existing device pattern needs some
explanations.</p>
<p>Let us suppose that the existing device pattern implementation is for
devices of class A. This means that classes A and AClass already exists
plus classes for all commands offered by device of class A. One new
device pattern implementation for device of class B must be written with
all the features offered by class A plus some new one. This is easily
done with the inheritance. Writing a device pattern implementation for
device of class B which inherits from device of class A means :</p>
<ul class="simple">
<li>Write the BClass class</li>
<li>Write the B class</li>
<li>Write B class specific commands</li>
<li>Eventually redefine A class commands</li>
</ul>
<p>The miscellaneous code fragments given below detail only what has to be
updated to support device pattern inheritance</p>
<div class="section" id="writing-the-bclass">
<h4>Writing the BClass</h4>
<p>As you can guess, BClass has to inherit from AClass. The
<em>command_factory</em> method must also be adapted.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">namespace</span> <span class="name">B</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>  <span class="keyword">class</span> <span class="name class">BClass</span> <span class="operator">:</span> <span class="keyword">public</span> <span class="name">A</span><span class="operator">::</span><span class="name">AClass</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>  <span class="punctuation">.....</span>
<span class="ln"> 7 </span>  <span class="punctuation">}</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="name">BClass</span><span class="operator">::</span><span class="name">command_factory</span><span class="punctuation">()</span>
<span class="ln">10 </span>  <span class="punctuation">{</span>
<span class="ln">11 </span>      <span class="name">A</span><span class="operator">::</span><span class="name">AClass</span><span class="operator">::</span><span class="name">command_factory</span><span class="punctuation">();</span>
<span class="ln">12 </span>
<span class="ln">13 </span>      <span class="name">command_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(....);</span>
<span class="ln">14 </span>  <span class="punctuation">}</span>
<span class="ln">15 </span>
<span class="ln">16 </span>  <span class="punctuation">}</span> <span class="comment multiline">/* End of B namespace */</span>
</pre>
<p>Line 1 : Open the B namespace</p>
<p>Line 4 : BClass inherits from AClass which is defined in the A
namespace.</p>
<p>Line 11 : Only the <em>command_factory</em> method of the BClass will be
called at start-up. To create the AClass commands, the
<em>command_factory</em> method of the AClass must also be executed. This is
the reason of the line</p>
<p>Line 13 : Create BClass commands</p>
</div>
<div class="section" id="writing-the-b-class">
<h4>Writing the B class</h4>
<p>As you can guess, B has to inherits from A.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">namespace</span> <span class="name">B</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>  <span class="keyword">class</span> <span class="name class">B</span> <span class="operator">:</span> <span class="keyword">public</span> <span class="name label">A</span><span class="punctuation">:</span><span class="name">A</span>
<span class="ln"> 5 </span>  <span class="punctuation">{</span>
<span class="ln"> 6 </span>     <span class="punctuation">.....</span>
<span class="ln"> 7 </span>  <span class="punctuation">};</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="name">B</span><span class="operator">::</span><span class="name">B</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceClass</span> <span class="operator">*</span><span class="name">cl</span><span class="punctuation">,</span><span class="keyword">const</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="name">s</span><span class="punctuation">)</span><span class="operator">:</span><span class="name">A</span><span class="operator">::</span><span class="name">A</span><span class="punctuation">(</span><span class="name">cl</span><span class="punctuation">,</span><span class="name">s</span><span class="punctuation">)</span>
<span class="ln">10 </span>  <span class="punctuation">{</span>
<span class="ln">11 </span>     <span class="punctuation">....</span>
<span class="ln">12 </span>     <span class="name">init_device</span><span class="punctuation">();</span>
<span class="ln">13 </span>  <span class="punctuation">}</span>
<span class="ln">14 </span>
<span class="ln">15 </span>  <span class="keyword type">void</span> <span class="name">B</span><span class="operator">::</span><span class="name">init_device</span><span class="punctuation">()</span>
<span class="ln">16 </span>  <span class="punctuation">{</span>
<span class="ln">17 </span>     <span class="punctuation">....</span>
<span class="ln">18 </span>  <span class="punctuation">}</span>
<span class="ln">19 </span>
<span class="ln">20 </span>  <span class="punctuation">}</span> <span class="comment multiline">/* End of B namespace */</span>
</pre>
<p>Line 1 : Open the B namespace.</p>
<p>Line 4 : B inherits from A which is defined in the A namespace</p>
<p>Line 9 : The B constructor calls the right A constructor</p>
</div>
<div class="section" id="writing-b-class-specific-command">
<h4>Writing B class specific command</h4>
<p>Noting special here. Write these classes as usual</p>
</div>
<div class="section" id="redefining-a-class-command">
<h4>Redefining A class command</h4>
<p>It is possible to redefine a command which already exist in class A
<strong>only if the command is created</strong> <strong>using the inheritance model</strong> (but
keeping its input and output argument types). The method which really
execute the class A command is a method implemented in the A class. This
method must be defined as <strong>virtual.</strong> In class B, you can redefine the
method executing the command and implement it following the needs of the
B class.</p>
</div>
</div>
<div class="section" id="using-another-device-pattern-implementation-within-the-same-server">
<h3><a class="toc-backref" href="#id263">Using another device pattern implementation within the same server</a></h3>
<p>It is often necessary that inside the same device server, a method
executing a command needs a command of another class to be executed. For
instance, a device pattern implementation for a device driven by a
serial line class can use the command offered by a serial line class
embedded within the same device server process. To execute one of the
command (or any other CORBA operations/attributes) of the serial line
class, just call it as a normal client will do by using one instance of
the DeviceProxy class<em>.</em> The ORB will recognize that all the devices
are inside the same process and will execute calls as a local calls. To
create the DeviceProxy class instance, the only thing you need to know
is the name of the device you gave to the serial line device. Retrieving
this could be easily done by a Tango device property. The DeviceProxy
class is fully described in Tango Application Programming Interface
(API) reference WEB pages</p>
</div>
<div class="section" id="device-pipe">
<h3><a class="toc-backref" href="#id264">Device pipe</a></h3>
<p>What a Tango device pipe is has been defined in the Chapter 3 about
device server model. How you read or write a pipe in a client software
is documented in chapter 4 about the Tango API. In this section, we
describe how you can read/write into/from a device pipe on the server
side (In a Tango class with pipe).</p>
<div class="section" id="client-reading-a-pipe">
<h4>Client reading a pipe</h4>
<p>When a client reads a pipe, the following methods are executed in the
Tango class:</p>
<ol class="arabic simple">
<li>The <em>always_executed_hook()</em> method.</li>
<li>A method called <em>is_&lt;pipe_name&gt;_allowed()</em>. The rule of this
method is to allow (or disallow) the next method to be executed. It
is usefull for device with some pipes which can be read only in some
precise conditions. It has one parameter which is the request type
(read or write)</li>
<li>A method called <em>read_&lt;pipe_name&gt;()</em>. The aim of this method is to
store the pipe data in the pipe object. It has one parameter which is
a reference to the Pipe object to be read.</li>
</ol>
<p>The figure [r_pipe_timing_fig-1] is a drawing of these method calls
sequencing for our class StepperMotor with one pipe named DynData.</p>
<div class="figure">
<img alt="Read pipe sequencing" src="ds_writing/r_pipe" />
<p class="caption">Read pipe sequencing</p>
</div>
<p>The class DynDataPipe is a simple class which follow the same skeleton
from one Tango class to another. Therefore, this class is generated by
the Tango code generator Pogo and the Tango class developper does not
have to modify it. The method <em>is_DynData_allowed()</em> is relatively
simple and in most cases the default code generated by Pogo is enough.
The method <em>read_DynData()</em> is the method on which the Tango class
developper has to concentrate on. The following code is one example of
these two methods.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">bool</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">is_DynData_allowed</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">PipeReqType</span> <span class="name">req</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">get_state</span><span class="punctuation">()</span> <span class="operator">==</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">ON</span><span class="punctuation">)</span>
<span class="ln"> 4 </span>          <span class="keyword">return</span> <span class="name builtin">true</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>      <span class="keyword">else</span>
<span class="ln"> 6 </span>          <span class="keyword">return</span> <span class="name builtin">false</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>  <span class="punctuation">}</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">read_DynData</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Pipe</span> <span class="operator">&amp;</span><span class="name">pipe</span><span class="punctuation">)</span>
<span class="ln">10 </span>  <span class="punctuation">{</span>
<span class="ln">11 </span>      <span class="name">nb_call</span><span class="operator">++</span><span class="punctuation">;</span>
<span class="ln">12 </span>      <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">nb_call</span> <span class="operator">%</span> <span class="literal number integer">2</span> <span class="operator">==</span> <span class="literal number integer">0</span><span class="punctuation">)</span>
<span class="ln">13 </span>      <span class="punctuation">{</span>
<span class="ln">14 </span>          <span class="name">pipe</span><span class="punctuation">.</span><span class="name">set_root_blob_name</span><span class="punctuation">(</span><span class="literal string">&quot;BlobCaseEven&quot;</span><span class="punctuation">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>          <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">de_names</span> <span class="punctuation">{</span><span class="literal string">&quot;EvenFirstDE&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;EvenSecondDE&quot;</span><span class="punctuation">};</span>
<span class="ln">17 </span>          <span class="name">pipe</span><span class="punctuation">.</span><span class="name">set_data_elt_names</span><span class="punctuation">(</span><span class="name">de_names</span><span class="punctuation">);</span>
<span class="ln">18 </span>
<span class="ln">19 </span>          <span class="name">dl</span> <span class="operator">=</span> <span class="literal number integer">666</span><span class="punctuation">;</span>
<span class="ln">20 </span>          <span class="name">v_db</span><span class="punctuation">.</span><span class="name">clear</span><span class="punctuation">();</span>
<span class="ln">21 </span>          <span class="name">v_db</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal number float">1.11</span><span class="punctuation">);</span>
<span class="ln">22 </span>          <span class="name">v_db</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal number float">2.22</span><span class="punctuation">);</span>
<span class="ln">23 </span>
<span class="ln">24 </span>          <span class="name">pipe</span> <span class="operator">&lt;&lt;</span> <span class="name">dl</span> <span class="operator">&lt;&lt;</span> <span class="name">v_db</span><span class="punctuation">;</span>
<span class="ln">25 </span>      <span class="punctuation">}</span>
<span class="ln">26 </span>      <span class="keyword">else</span>
<span class="ln">27 </span>      <span class="punctuation">{</span>
<span class="ln">28 </span>          <span class="name">pipe</span><span class="punctuation">.</span><span class="name">set_root_blob_name</span><span class="punctuation">(</span><span class="literal string">&quot;BlobCaseOdd&quot;</span><span class="punctuation">);</span>
<span class="ln">29 </span>
<span class="ln">30 </span>          <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">de_names</span> <span class="punctuation">{</span><span class="literal string">&quot;OddFirstDE&quot;</span><span class="punctuation">};</span>
<span class="ln">31 </span>          <span class="name">pipe</span><span class="punctuation">.</span><span class="name">set_data_elt_names</span><span class="punctuation">(</span><span class="name">de_names</span><span class="punctuation">);</span>
<span class="ln">32 </span>
<span class="ln">33 </span>          <span class="name">v_str</span><span class="punctuation">.</span><span class="name">clear</span><span class="punctuation">();</span>
<span class="ln">34 </span>          <span class="name">v_str</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;Hola&quot;</span><span class="punctuation">);</span>
<span class="ln">35 </span>          <span class="name">v_str</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;Salut&quot;</span><span class="punctuation">);</span>
<span class="ln">36 </span>          <span class="name">v_str</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;Hi&quot;</span><span class="punctuation">);</span>
<span class="ln">37 </span>
<span class="ln">38 </span>          <span class="name">pipe</span> <span class="operator">&lt;&lt;</span> <span class="name">v_str</span><span class="punctuation">;</span>
<span class="ln">39 </span>      <span class="punctuation">}</span>
<span class="ln">40 </span>  <span class="punctuation">}</span>
</pre>
<p>The <em>is_DynData_allowed</em> method is defined between lines 1 and 7. It
is allowed to read or write the pipe only is the device state is ON.
Note that the input parameter req is not used. The parameter allows the
user to know the type of request. The data type PipeReqType is one
enumeration with two possible values which are READ_REQ and WRITE_REQ.</p>
<p>The <em>read_DynData</em> method is defined between lines 9 and 40. If the
number of times this method has been called is even, the pipe contains
two data elements. The first one is named EvenFirstDE and its data is a
long. The second one is named EvenSecondDE and its data is an array of
double. If the number of call is odd, the pipe contains only one data
element. Its name is OddFirstDe and its data is an array of strings.
Data are inserted into the pipe at lines 24 and 38. The variables
nb_call, dl, v_db and v_str are device data member and therefore
declare in the .h file. Refer to pipe section in chapter 3 and to the
API reference documentation (in Tango WEB pages) to learn more on how
you can insert data into a pipe and to know how data are organized
within a pipe.</p>
</div>
<div class="section" id="client-writing-a-pipe">
<h4>Client writing a pipe</h4>
<p>When a client writes a pipe, the following methods are executed in the
Tango class:</p>
<ol class="arabic simple">
<li>The <em>always_executed_hook()</em> method.</li>
<li>A method called <em>is_&lt;pipe_name&gt;_allowed()</em>. The rule of this
method is to allow (or disallow) the next method to be executed. It
is usefull for device with some pipes which can be read only in some
precise conditions. It has one parameter which is the request type
(read or write)</li>
<li>A method called <em>write_&lt;pipe_name&gt;()</em>. It has one parameter which
is a reference to the WPipe object to be written. The aim of this
method is to get the data to be written from the WPipe oject and to
write them into the corresponding Tango class objects.</li>
</ol>
<p>The figure [w_pipe_timing_fig-1-1] is a drawing of these method calls
sequencing for our class StepperMotor with one pipe named DynData.</p>
<div class="figure">
<img alt="Write pipe sequencing" src="ds_writing/w_pipe" />
<p class="caption">Write pipe sequencing</p>
</div>
<p>The class DynDataPipe is a simple class which follow the same skeleton
from one Tango class to another. Therefore, this class is generated by
the Tango code generator Pogo and the Tango class developper does not
have to modify it. The method <em>is_DynData_allowed()</em> is relatively
simple and in most cases the default code generated by Pogo is enough.
The method <em>write_DynData()</em> is the method on which the Tango class
developper has to concentrate on. The following code is one example of
the <em>write_DynData()</em> method.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword type">void</span> <span class="name">StepperMotor</span><span class="operator">::</span><span class="name">write_DynData</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">WPipe</span> <span class="operator">&amp;</span><span class="name">w_pipe</span><span class="punctuation">)</span>
<span class="ln">2 </span>  <span class="punctuation">{</span>
<span class="ln">3 </span>     <span class="name">string</span> <span class="name">str</span><span class="punctuation">;</span>
<span class="ln">4 </span>     <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">float</span><span class="operator">&gt;</span> <span class="name">v_fl</span><span class="punctuation">;</span>
<span class="ln">5 </span>
<span class="ln">6 </span>     <span class="name">w_pipe</span> <span class="operator">&gt;&gt;</span> <span class="name">str</span> <span class="operator">&gt;&gt;</span> <span class="name">v_fl</span><span class="punctuation">;</span>
<span class="ln">7 </span>     <span class="punctuation">.....</span>
<span class="ln">8 </span>  <span class="punctuation">}</span>
</pre>
<p>In this example, we know that the pipe will always contain a srting
followed by one array of float. On top of that, we are not niterested by
the</p>
<p>data element names. Data are extracted from the pipe at line 6 and are
available for further use starting at line 7. If the content of the pipe
is not a string followed by one array of float, the data extraction line
(6) will throw one exception which will be reported to the client who
has tried to write the pipe. Refer to pipe section in chapter 3 and to
the API reference documentation (in Tango WEB pages) to learn more on
how you can insert data into a pipe and to know how data are organized
within a pipe.</p>
<p>[BlackPicture]|image|</p>
</div>
</div>
</div>
</div>
<div class="section" id="advanced-features">
<h1><a class="toc-backref" href="#id265">Advanced features</a></h1>
<div class="section" id="attribute-alarms">
<h2><a class="toc-backref" href="#id266">Attribute alarms</a></h2>
<p>Each Tango attribute two several alarms. These alarms are :</p>
<ul class="simple">
<li>A four thresholds level alarm</li>
<li>The read different than set (RDS) alarm</li>
</ul>
<div class="section" id="the-level-alarms">
<h3><a class="toc-backref" href="#id267">The level alarms</a></h3>
<p>This alarm is defined for all Tango attribute read type and for
numerical data type. The action of this alarm depend on the attribute
value when it is read :</p>
<ul class="simple">
<li>If the attribute value is below or equal the attribute configuration
<strong>min_alarm</strong> parameter, the attribute quality factor is switched to
Tango::ATTR_ALARM and if the device state is Tango::ON, it is
switched to Tango::ALARM.</li>
<li>If the attribute value is below or equal the attribute configuration
<strong>min_warning</strong> parameter, the attribute quality factor is switched
to Tango::ATTR_WARNING and if the device state is Tango::ON, it is
switched to Tango::ALARM.</li>
<li>If the attribute value is above or equal the attribute configuration
<strong>max_warning</strong> parameter, the attribute quality factor is switched
to Tango::ATTR_WARNING and if the device state is Tango::ON, it is
switched to Tango::ALARM.</li>
<li>If the attribute value is above or equal the attribute configuration
<strong>max_alarm</strong> parameter, the attribute quality factor is switched to
Tango::ATTR_ALARM and if the device state is Tango::ON, it is
switched to Tango::ALARM.</li>
</ul>
<p>If the attribute is a spectrum or an image, then the alarm is set if any
one of the attribute value satisfies the above criterium. By default,
these four parameters are not defined and no check will be done.</p>
<p>The following figure is a drawing of attribute quality factor and device
state values function of the the attribute value.</p>
<div class="figure">
<img alt="Level alarm" src="advanced/alarm" />
<p class="caption">Level alarm</p>
</div>
<p>If the min_warning and max_warning parameters are not set, the
attribute quality factor will simply change between Tango::ATTR_ALARM
and Tango::ATTR_VALID function of the attribute value.</p>
</div>
<div class="section" id="the-read-different-than-set-rds-alarm">
<h3><a class="toc-backref" href="#id268">The Read Different than Set (RDS) alarm</a></h3>
<p>This alarm is defined only for attribute of the Tango::READ_WRITE and
Tango::READ_WITH_WRITE read/write type and for numerical data type.
When the attribute is read (or when the device state is requested), if
the difference between its read value and the last written value is
something more than or equal to an authorized delta and if at least a
certain amount of milli seconds occurs since the last write operation,
the attribute quality factor will be set to Tango::ATTR_ALARM and if
the device state is Tango::ON, it is switched to Tango::ALARM. If the
attribute is a spectrum or an image, then the alarm is set if any one of
the attribute value’s satisfies the above criterium. This alarm
configuration is done with two attribute configuration parameters called
<strong>delta_val</strong> and <strong>delta_t</strong>. By default, these two parameters are
not defined and no check will be done.</p>
</div>
</div>
<div class="section" id="enumerated-attribute">
<h2><a class="toc-backref" href="#id269">Enumerated attribute</a></h2>
<p>Since Tango release 9, enumerated attribute is supported using the new
data type DevEnum. This data type is not a real C++ enumeration because:</p>
<ol class="arabic simple">
<li>The enumerated value allways start with 0</li>
<li>Values are consecutive</li>
<li>It is transferred on the network as DevShort data type</li>
</ol>
<p>One enumeration label is associated to each enumeration value. For the
Tango kernel, it is this list of enumeration labels which will define
the possible enumeration values. For instance if the enumeration has 3
labels, its value must be between 0 and 2. There are two ways to define
the enumeration labels:</p>
<ol class="arabic simple">
<li>At attribute creation time. This is the most common case when the
list of possible enumeration values and labels are known at compile
time. The Tango code generator Pogo generates for you the code needed
to pass the enumeration labels to the Tango kernel.</li>
<li>In the user code when the enumeration values and labels are not known
at compile time but retrieved during device startup phase. The user
gives the possible enumeration values to the Tango kernel using the
Attribute class <em>set_properties()</em> method.</li>
</ol>
<p>A Tango client is able to retrieve the enumeration labels in the
attribute configuration returned by instance by a call to the
<em>DeviceProxy::get_attribute_config()</em> method. Using the
<em>DeviceProxy::set_attribute_config()</em> call, a user may change the
enumeration labels but not their number.</p>
<div class="section" id="usage-in-a-tango-class">
<h3><a class="toc-backref" href="#id270">Usage in a Tango class</a></h3>
<p>Within a Tango class, you set the attribute value with a C++ enum or a
DevShort variable. In case a DevShort variable is used, its value will
be checked according to the enumeration labels list given to Tango
kernel.</p>
<div class="section" id="setting-the-labels-with-enumeration-compile-time-knowledge">
<h4>Setting the labels with enumeration compile time knowledge</h4>
<p>In such a case, the enumeration labels are given to Tango at the
attribute creation time in the <em>attribute_factory</em> method of the
XXXClass class. Let us take one example</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">enum</span> <span class="keyword">class</span> <span class="name class">Card</span><span class="operator">:</span> <span class="keyword type">short</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="name">NORTH</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">,</span>
<span class="ln"> 4 </span>      <span class="name">SOUTH</span><span class="punctuation">,</span>
<span class="ln"> 5 </span>      <span class="name">EAST</span><span class="punctuation">,</span>
<span class="ln"> 6 </span>      <span class="name">WEST</span>
<span class="ln"> 7 </span>  <span class="punctuation">};</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>  <span class="keyword type">void</span> <span class="name">XXXClass</span><span class="operator">::</span><span class="name">attribute_factory</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span> <span class="operator">*&gt;</span> <span class="operator">&amp;</span><span class="name">att_list</span><span class="punctuation">)</span>
<span class="ln">10 </span>  <span class="punctuation">{</span>
<span class="ln">11 </span>      <span class="punctuation">.....</span>
<span class="ln">12 </span>      <span class="name">TheEnumAttrib</span>   <span class="operator">*</span><span class="name">theenum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">TheEnumAttrib</span><span class="punctuation">();</span>
<span class="ln">13 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">UserDefaultAttrProp</span> <span class="name">theenum_prop</span><span class="punctuation">;</span>
<span class="ln">14 </span>      <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">labels</span> <span class="operator">=</span> <span class="punctuation">{</span><span class="literal string">&quot;North&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;South&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;East&quot;</span><span class="punctuation">,</span><span class="literal string">&quot;West&quot;</span><span class="punctuation">};</span>
<span class="ln">15 </span>      <span class="name">theenum_prop</span><span class="punctuation">.</span><span class="name">set_enum_labels</span><span class="punctuation">(</span><span class="name">labels</span><span class="punctuation">);</span>
<span class="ln">16 </span>      <span class="name">theenum</span><span class="operator">-&gt;</span><span class="name">set_default_properties</span><span class="punctuation">(</span><span class="name">theenum_prop</span><span class="punctuation">);</span>
<span class="ln">17 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="name">theenum</span><span class="punctuation">);</span>
<span class="ln">18 </span>      <span class="punctuation">.....</span>
<span class="ln">19 </span>   <span class="punctuation">}</span>
</pre>
<p>line 1-7 : The definition of the enumeration (C++11 in this example)</p>
<p>line 14 : A vector of strings with the enumeration labels is created.
Because there is no way to get the labels from the enumeration
definition, they are re-defined here.</p>
<p>line 15 : This vector is given to the theenum_prop object which
contains the user default properties</p>
<div class="line-block">
<div class="line">line 16 : The user default properties are associated to the attribute</div>
<div class="line">In most cases, all this code will be automatically generated by the
Tango code generator Pogo. It is given here for completness.</div>
</div>
</div>
<div class="section" id="setting-the-labels-without-enumeration-compile-time-knowledge">
<h4>Setting the labels without enumeration compile time knowledge</h4>
<p>In such a case, the enumeration labels are retrieved by the user in a
way specific to the device and passed to Tango using the Attribute class
<em>set_properties()</em> method. Let us take one example</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">MyDev</span><span class="operator">::</span><span class="name">init_device</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>      <span class="punctuation">...</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>      <span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span> <span class="operator">=</span> <span class="name">get_device_attr</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">get_attr_by_name</span><span class="punctuation">(</span><span class="literal string">&quot;TheEnumAtt&quot;</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>      <span class="name">MultiAttrProp</span><span class="operator">&lt;</span><span class="name">DevEnum</span><span class="operator">&gt;</span> <span class="name">multi_prop</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>      <span class="name">att</span><span class="punctuation">.</span><span class="name">get_properties</span><span class="punctuation">(</span><span class="name">multi_prop</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>      <span class="name">multi_prop</span><span class="punctuation">.</span><span class="name">enum_labels</span> <span class="operator">=</span> <span class="punctuation">{....};</span>
<span class="ln">10 </span>      <span class="name">att</span><span class="punctuation">.</span><span class="name">set_properties</span><span class="punctuation">(</span><span class="name">multi_prop</span><span class="punctuation">);</span>
<span class="ln">11 </span>      <span class="punctuation">....</span>
<span class="ln">12 </span>   <span class="punctuation">}</span>
</pre>
<p>line 5 : Get a reference to the attribute object</p>
<p>line 7 : Retrieve the attribute properties</p>
<p>line 9 : Initialise the attribute labels in the set of attribute
properties</p>
<p>line 10 : Set the attribute properties</p>
</div>
<div class="section" id="setting-the-attribute-value">
<h4>Setting the attribute value</h4>
<p>It is possible to set the attribute value using either a classical
DevShort variable or using a variable of the C++ enumeration. The
following example is when you have compile time knowledge of the
enumeration definition. We assume that the enumeration is the same than
the one defined above (Card enumeration)</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword">enum</span> <span class="name">Card</span> <span class="name">points</span><span class="punctuation">;</span>
<span class="ln">2 </span>
<span class="ln">3 </span>  <span class="keyword type">void</span> <span class="name">MyDev</span><span class="operator">::</span><span class="name">read_TheEnum</span><span class="punctuation">(</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
<span class="ln">4 </span>  <span class="punctuation">{</span>
<span class="ln">5 </span>      <span class="punctuation">...</span>
<span class="ln">6 </span>      <span class="name">points</span> <span class="operator">=</span> <span class="name">SOUTH</span><span class="punctuation">;</span>
<span class="ln">7 </span>      <span class="name">att</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">points</span><span class="punctuation">);</span>
<span class="ln">8 </span>  <span class="punctuation">}</span>
</pre>
<p>line 1 : One instance of the Card enum is created (named points)</p>
<p>line 6 : The enumeration is initialized</p>
<div class="line-block">
<div class="line">line 7 : The value of the attribute object is set using the
enumeration (by pointer)</div>
<div class="line">To get the same result using a classical DevShort variable, the code
looks like</div>
</div>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DevShort</span> <span class="name">sh</span><span class="punctuation">;</span>
<span class="ln">2 </span>
<span class="ln">3 </span>  <span class="keyword type">void</span> <span class="name">MyDev</span><span class="operator">::</span><span class="name">read_TheEnum</span><span class="punctuation">(</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
<span class="ln">4 </span>  <span class="punctuation">{</span>
<span class="ln">5 </span>      <span class="punctuation">...</span>
<span class="ln">6 </span>      <span class="name">sh</span> <span class="operator">=</span> <span class="literal number integer">1</span><span class="punctuation">;</span>
<span class="ln">7 </span>      <span class="name">att</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">sh</span><span class="punctuation">);</span>
<span class="ln">8 </span>  <span class="punctuation">}</span>
</pre>
<p>line 1 : A DevShort variable is created (named sh)</p>
<p>line 6 : The variable is initialized</p>
<p>line 7 : The value of the attribute object is set using the DevShort
variable (by pointer)</p>
</div>
</div>
<div class="section" id="usage-in-a-tango-client">
<h3><a class="toc-backref" href="#id271">Usage in a Tango client</a></h3>
<p>Within a Tango client, you insert/extract enumerated attribute value
in/from DeviceAttribute object with a C++ enum or a DevShort variable.
The later case is for generic client which do not have compile time
knowledge of the enumeration. The code looks like</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DeviceAttribute</span> <span class="name">da</span> <span class="operator">=</span> <span class="name">the_dev</span><span class="punctuation">.</span><span class="name">read_attribute</span><span class="punctuation">(</span><span class="literal string">&quot;TheEnumAtt&quot;</span><span class="punctuation">);</span>
<span class="ln">2 </span>  <span class="name">Card</span> <span class="name">ca</span><span class="punctuation">;</span>
<span class="ln">3 </span>  <span class="name">da</span> <span class="operator">&gt;&gt;</span> <span class="name">ca</span><span class="punctuation">;</span>
<span class="ln">4 </span>
<span class="ln">5 </span>  <span class="name">DeviceAttribute</span> <span class="name">db</span> <span class="operator">=</span> <span class="name">the_dev</span><span class="punctuation">.</span><span class="name">read_attribute</span><span class="punctuation">(</span><span class="literal string">&quot;TheEnumAtt&quot;</span><span class="punctuation">);</span>
<span class="ln">6 </span>  <span class="name">DevShort</span> <span class="name">sh</span><span class="punctuation">;</span>
<span class="ln">7 </span>  <span class="name">da</span> <span class="operator">&gt;&gt;</span> <span class="name">sh</span><span class="punctuation">;</span>
</pre>
<p>line 2-3 : The attribute value is extracted in a C++ enumeration
variable</p>
<p>line 6-7 : The attribute value is extracted in a DevShort variable</p>
</div>
</div>
<div class="section" id="device-polling">
<h2><a class="toc-backref" href="#id272">Device polling</a></h2>
<div class="section" id="id56">
<h3><a class="toc-backref" href="#id273">Introduction</a></h3>
<p>Each tango device server automatically have a separate polling thread
pool. Polling a device means periodically executing command on a device
(or reading device attribute) and storing the results (or the thrown
exception) in a polling buffer. The aim of this polling is threefold :</p>
<ul class="simple">
<li>Speed-up response time for slow device</li>
<li>Get a first-level history of device command output or attribute value</li>
<li>Be the data source for the Tango event system</li>
</ul>
<p>Speeding-up response time is achieved because the command_inout or
read_attribute CORBA operation is able to get its data from the polling
buffer or from the a real access to the device. For “slow” device,
getting the data from the buffer is much faster than accessing the
device. Returning a first-level command output history (or attribute
value history) to a client is possible due to the polling buffer which
is managed as a circular buffer. The history is the contents of this
circular buffer. Obviously, the history depth is limited to the depth of
the circular buffer. The polling is also the data source for the event
system because detecting an event means being able to regularly read the
data, memorize it and declaring that it is an event after some
comparison with older values.</p>
<p>Starting with Tango 9, the default polling algorithm has been modifed.
However, it is still possible to use the polling as it was in Tango
releases prior to release 9. See chaper on polling configuration to get
details on this.</p>
</div>
<div class="section" id="configuring-the-polling-system">
<h3><a class="toc-backref" href="#id274">Configuring the polling system</a></h3>
<div class="section" id="configuring-what-has-to-be-polled-and-how">
<h4>Configuring what has to be polled and how</h4>
<p>It is possible to configure the polling in order to poll :</p>
<ul class="simple">
<li>Any command which does not need input parameter</li>
<li>Any attribute</li>
</ul>
<p>Configuring the polling is done by sending command to the device server
administration device automatically implemented in every device server
process. Seven commands are dedicated to this feature. These commands
are</p>
<dl class="docutils">
<dt>AddObjPolling</dt>
<dd>It add a new object (command or attribute) to the list of object(s)
to be polled. It is also with this command that the polling period
is specified.</dd>
<dt>RemObjPolling</dt>
<dd>To remove one object (command or attribute) from the polled
object(s) list</dd>
<dt>UpdObjPollingPeriod</dt>
<dd>Change one object polling period</dd>
<dt>StartPolling</dt>
<dd>Starts polling for the whole process</dd>
<dt>StopPolling</dt>
<dd>Stops polling for the whole process</dd>
<dt>PolledDevice</dt>
<dd>Allow a client to know which device are polled</dd>
<dt>DevPollStatus</dt>
<dd>Allow a client to precisely knows the polling status for a device</dd>
</dl>
<p>All the necessary parameters for the polling configuration are stored in
the Tango database. Therefore, the polling configuration is not lost
after a device server process stop and restart (or after a device server
process crash!!).</p>
<p>It is also possible to automatically poll a command (or an attribute)
without sending command to the device server administration device. This
request some coding (a method call) in the device server software during
the command or attribute creation. In this case, for every devices
supporting this command or this attribute, polling configuration will be
automatically updated in the database and the polling will start
automatically at each device server process startup. It is possible to
stop this behavior on a device basis by sending a RemObjPolling command
to the device server administration device. The following piece of code
shows how the source code should be written.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">DevTestClass</span><span class="operator">::</span><span class="name">command_factory</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>  <span class="punctuation">...</span>
<span class="ln"> 4 </span>      <span class="name">command_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">IOStartPoll</span><span class="punctuation">(</span><span class="literal string">&quot;IOStartPoll&quot;</span><span class="punctuation">,</span>
<span class="ln"> 5 </span>                                              <span class="name">Tango</span><span class="operator">::</span><span class="name">DEV_VOID</span><span class="punctuation">,</span>
<span class="ln"> 6 </span>                                              <span class="name">Tango</span><span class="operator">::</span><span class="name">DEV_LONG</span><span class="punctuation">,</span>
<span class="ln"> 7 </span>                                              <span class="literal string">&quot;Void&quot;</span><span class="punctuation">,</span>
<span class="ln"> 8 </span>                                              <span class="literal string">&quot;Constant number&quot;</span><span class="punctuation">));</span>
<span class="ln"> 9 </span>      <span class="name">command_list</span><span class="punctuation">.</span><span class="name">back</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">set_polling_period</span><span class="punctuation">(</span><span class="literal number integer">400</span><span class="punctuation">);</span>
<span class="ln">10 </span>  <span class="punctuation">...</span>
<span class="ln">11 </span>  <span class="punctuation">}</span>
<span class="ln">12 </span>
<span class="ln">13 </span>
<span class="ln">14 </span>  <span class="keyword type">void</span> <span class="name">DevTestClass</span><span class="operator">::</span><span class="name">attribute_factory</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span> <span class="operator">*&gt;</span> <span class="operator">&amp;</span><span class="name">att_list</span><span class="punctuation">)</span>
<span class="ln">15 </span>  <span class="punctuation">{</span>
<span class="ln">16 </span>  <span class="punctuation">...</span>
<span class="ln">17 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span><span class="punctuation">(</span><span class="literal string">&quot;String_attr&quot;</span><span class="punctuation">,</span>
<span class="ln">18 </span>                                          <span class="name">Tango</span><span class="operator">::</span><span class="name">DEV_STRING</span><span class="punctuation">,</span>
<span class="ln">19 </span>                                          <span class="name">Tango</span><span class="operator">::</span><span class="name">READ</span><span class="punctuation">));</span>
<span class="ln">20 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">back</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">set_polling_period</span><span class="punctuation">(</span><span class="literal number integer">250</span><span class="punctuation">);</span>
<span class="ln">21 </span>  <span class="punctuation">...</span>
<span class="ln">22 </span>  <span class="punctuation">}</span>
</pre>
<p>A polling period of 400 mS is set for the command called “IOStartPoll”
at line 10 with the <em>set_polling_period</em> method of the Command class.
Therefore, for a device of this class, the polling thread will start
polling its IOStartPoll command at process start-up except if a
RemObjPolling indicating this device and the IOStartPoll command has
already been received by the device server administration device. This
is exactly the same behavior for attribute. The polling period for
attribute called “String_attr” is defined at line 20.</p>
<p>Configuring the polling means defining device attribute/command polling
period. The polling period has to be chosen with care. If reading an
attribute needs 200 mS, there is no point to poll this attribute with a
polling period equal or even below 200 mS. You should also take into
account that some free time has to be foreseen for external request(s)
on the device. On average, for one attribute needing X mS as reading
time, define a polling period which is equal to 1.4 X (280 mS for our
example of one attribute needing 200 mS as reading time). In case the
polling tuning is given to external user, Tango provides a way to define
polling period minimun threshold. This is done using device properties.
These properties are named <em>min_poll_period</em>, <em>cmd_min_poll_period</em>
and <em>attr_min_poll_period</em>. The property min_poll_period (mS)
defined a minimun polling period for the device. The property
cmd_min_poll_period allows the definition of a minimun polling period
for a specific device command. The property attr_min_poll_period
allows the definition of a minimun polling period for one device
attribute. In case these properties are defined, it is not possible to
poll the device command/attribute with a polling period below those
defined by these properties. See Appendix A on device parameter to get a
precise syntax description for these properties.</p>
<p>The Jive:raw-latex:<cite>cite{Jive doc}</cite> tool also allows a graphical device
polling configuration.</p>
</div>
<div class="section" id="configuring-the-polling-threads-pool">
<h4>Configuring the polling threads pool</h4>
<p>Starting with Tango release 7, a Tango device server process may have
several polling threads managed as a pool. For instance, this could be
usefull in case of devices within the same device server process but
accessed by different hardware channel when one of the channel is not
responding (Thus generating long timeout and de-synchronising the
polling thread). By default, the polling threads pool size is set to 1
and all the polled object(s) are managed by the same thread (idem
polling system in Tango releases older than release 7) . The
configuration of the polling thread pool is done using two properties
associated to the device server administration device. These properties
are named:</p>
<ul class="simple">
<li><em>polling_threads_pool_size</em> defining the maximun number of threads
that you can have in the pool</li>
<li><em>polling_threads_pool_conf</em> defining which threads in the pool
manages which device</li>
</ul>
<p>The granularity of the polling threads pool tuning is the device. You
cannot ask the polling threads pool to have thread number 1 in charge of
attribute <em>att1</em> of device <em>dev1</em> and thread number 2 to be in charge of
<em>att2</em> of the same device <em>dev1</em>.</p>
<p>When you require a new object (command or attribute) to be polled, two
main cases may arrive:</p>
<ol class="arabic simple">
<li>Some polled object(s) belonging to the device are already polled by
one of the polling threads in the pool: There is no new thread
created. The object is simply added to the list of objects to be
polled for the existing thread</li>
<li>There is no thread already created for the device. We have two
sub-cases:<ol class="arabic">
<li>The number of polling threads is less than the
polling_threads_pool_size: A new thread is created and started
to poll the object (command or attribute)</li>
<li>The number of polling threads is already equal to the
polling_threads_pool_size: The software search for the thread
with the smallest number of polled objects and add the new polled
object to this thread</li>
</ol>
</li>
</ol>
<p>Each time the polling threads pool configuration is changed, it is
written in the database using the polling_threads_pool_conf property.
If the behaviour previously described does not fulfill your needs, it is
possible to update the polling_threads_pool_conf property in a
graphical way using the Tango Astor  tool
or manually using the Jive tool . These
changes will be taken into account at the next device server process
start-up. At start-up, the polling threads pool will allways be
configured as required by the polling_threads_pool_conf property. The
syntax used for this property is described in the Reference part of the
Appendix [cha:Reference-part]. The following window dump is the Astor
tool window which allows polling threads pool management.</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>In this example, the polling threads pool size to set to 9 but only 4
polling threads are running. Thread 1 is in charge of all polled objects
related to device pv/thread-pool/test-1 and pv/thread-pool/test-2.
Thread 2 is in charge of all polled objects related to device
pv/thread-pool/test-3. Thread 3 is in charge of all polled objects
related to device pv/thread-pool/test-5 anf finally, thread 4 is in
charge of all polled objects for devices pv/thread-pool/test-4,
pv/thread-pool/test-6 and pv/thread-pool/test-7.</p>
<p>It’s also possible to define the polling threads pool size
programmatically in the main function of a device server process using
the <em>Util::set_polling_threads_pool_size()</em> method before the call
to the <em>Util::server_init()</em> method</p>
</div>
<div class="section" id="choosing-polling-algorithm">
<h4>Choosing polling algorithm</h4>
<p>Starting with Tango 9, you can choose between two different polling
algorithm:</p>
<ul class="simple">
<li>The polling as it was in Tango since it has been introduced. This
means:<ul>
<li>For one device, always poll attribute one at a time even if the
polling period is the same (use of read_attribute instead of
read_attributes)</li>
<li>Do not allow the polling thread to be late: If it is the case
(because at the end of polling object 1, the time is greater than
the polling date of object 2), discard polling object and inform
event user by sending one event with error (Polling thread is late
and discard....)</li>
</ul>
</li>
<li>New polling algorithm introduced in Tango 9 as the default one. This
means:<ul>
<li>For one device, poll all attributes with the same polling period
using a single device call (read_attributes)</li>
<li>Allow the polling thread to be late but only if number of late
objects decreases.</li>
</ul>
</li>
</ul>
<p>The advantages of new polling algorithm are</p>
<ol class="arabic simple">
<li>In case of several attributes polled on the same device at the same
period a lower device occupation time by the polling thread (due to a
single read_attributes() call instead of several single
read_attribute() calls)</li>
<li>Less “Polling thread late” errors in the event system in case of
device with non constant response time</li>
</ol>
<p>The drawback is</p>
<ol class="arabic simple">
<li>The loss of attribute individual timing data reported in the polling
thread status</li>
</ol>
<p>It is still possible to return to pre-release 9 polling algorithm. To do
so, you can use the device server process administration device
<em>polling_before_9</em> property by setting it to true. It is also possible
to choose this pre-release 9 algorithm in device server process code in
the main function of the process using the
<em>Util::set_polling_before_9()</em> method.</p>
</div>
</div>
<div class="section" id="reading-data-from-the-polling-buffer">
<h3><a class="toc-backref" href="#id275">Reading data from the polling buffer</a></h3>
<p>For a polled command or a polled attribute, a client has three
possibilities to get command result or attribute value (or the thrown
exception) :</p>
<ul class="simple">
<li>From the device itself</li>
<li>From the polling buffer</li>
<li>From the polling buffer first and from the device if data in the
polling buffer are invalid or if the polling is badly configured.</li>
</ul>
<p>The choice is done during the command_inout CORBA operation by
positioning one of the operation parameter. When reading data from the
polling buffer, several error cases are possible</p>
<ul class="simple">
<li>The data in the buffer are not valid any more. Every time data are
requested from the polling buffer, a check is done between the client
request date and the date when the data were stored in the buffer. An
exception is thrown if the delta is greater than the polling period
multiplied by a “too old” factor. This factor has a default value and
is up-datable via a device property. This is detailed in the
reference part of this manual.</li>
<li>The polling is correctly configured but there is no data yet in the
polling buffer.</li>
</ul>
</div>
<div class="section" id="retrieving-command-attribute-result-history">
<h3><a class="toc-backref" href="#id276">Retrieving command/attribute result history</a></h3>
<p>The polling thread stores the command result or attribute value in
circular buffers. It is possible to retrieve an history of the command
result (or attribute value) from these polling buffers. Obviously the
history is limited by the depth of the circular buffer. For commands, a
CORBA operation called <em>command_inout_history_2</em> allows this
retrieval. The client specifies the command name and the record number
he want to retrieve. For each record, the call returns the date when the
command was executed, the command result or the exception stack in case
of the command failed when it was executed by the polling thread. In
such a case, the exception stack is sent as a structure member and not
as an exception. The same thing is available for attribute. The CORBA
operation name is <em>read_attribute_history_2.</em> For these two calls,
there is no check done between the call date and the record date in
contrary of the call to retrieve the last command result (or attribute
value).</p>
</div>
<div class="section" id="externally-triggered-polling">
<h3><a class="toc-backref" href="#id277">Externally triggered polling</a></h3>
<p>Sometimes, rather than polling a command or an attribute regulary with a
fixed period, it is more interesting to manually decides when the
polling must occurs. The Tango polling system also supports this kind of
usage. This is called <em>externally triggered polling</em>. To define one
attribute (or command) as externally triggered, simply set its polling
period to 0. This can be done with the device server administration
device AddObjPolling or UpdObjPollingPeriod command. Once in this mode,
the attribute (or command) polling is triggered with the
<em>trigger_cmd_polling()</em> method (or <em>trigger_attr_polling()</em> method)
of the Util class. The following piece of code shows how this method
could be used for one externally triggered command.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="punctuation">.....</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="name">string</span> <span class="name">ext_polled_cmd</span><span class="punctuation">(</span><span class="literal string">&quot;MyCmd&quot;</span><span class="punctuation">);</span>
<span class="ln"> 4 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">device</span> <span class="operator">=</span> <span class="punctuation">.....;</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">instance</span><span class="punctuation">();</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>  <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">trigger_cmd_polling</span><span class="punctuation">(</span><span class="name">device</span><span class="punctuation">,</span><span class="name">ext_polled_cmd</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>  <span class="punctuation">.....</span>
</pre>
<p>line 3 : The externally polled command name</p>
<p>line 4 : The device object</p>
<p>line 8 : Trigger polling of command MyCmd</p>
</div>
<div class="section" id="filling-polling-buffer">
<h3><a class="toc-backref" href="#id278">Filling polling buffer</a></h3>
<p>Some hardware to be interfaced already returned an array of pair value,
timestamp. In order to be read with the <em>command_inout_history</em> or
<em>read_attribute_history</em> calls, this array has to be transferred in
the attribute or command polling buffer. This is possible only for
attribute or command configured in the externally triggered polling
mode. Once in externally triggered polling mode, the attribute (or
command) polling buffer is filled with the
<em>fill_cmd_polling_buffer()</em> method (or
<em>fill_attr_polling_buffer()</em> method) of the Util class. For command,
the user uses a template class called <em>TimedCmdData</em> for each element of
the command history. Each element is stored in a stack in one instance
of a template class called <em>CmdHistoryStack.</em> This object is one of the
argument of the fill_cmd_polling_buffer() method. Obviously, the
stack depth cannot be larger than the polling buffer depth. See
[sub:The-device-polling-prop] to learn how the polling buffer depth is
defined. The same way is used for attribute with the <em>TimedAttrData</em> and
<em>AttrHistoryStack</em> template classes. These classes are documented in
. The following piece of code fills the
polling buffer for a command called MyCmd which is already in externally
triggered mode. It returns a DevVarLongArray data type with three
elements. This example is not really something you will find in a real
hardware interface. It is only to demonstrate the
fill_cmd_polling_buffer() method usage. Error management has also
been removed.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="punctuation">....</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="name">dvla_array</span><span class="punctuation">[</span><span class="literal number integer">4</span><span class="punctuation">];</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>  <span class="keyword">for</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="literal number integer">4</span><span class="punctuation">;</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 6 </span>  <span class="punctuation">{</span>
<span class="ln"> 7 </span>      <span class="name">dvla_array</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">].</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>      <span class="name">dvla_array</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">][</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">10</span> <span class="operator">+</span> <span class="name">i</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>      <span class="name">dvla_array</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">][</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">11</span> <span class="operator">+</span> <span class="name">i</span><span class="punctuation">;</span>
<span class="ln">10 </span>      <span class="name">dvla_array</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">][</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number integer">12</span> <span class="operator">+</span> <span class="name">i</span><span class="punctuation">;</span>
<span class="ln">11 </span>  <span class="punctuation">}</span>
<span class="ln">12 </span>
<span class="ln">13 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">CmdHistoryStack</span><span class="operator">&lt;</span><span class="name">DevVarLongArray</span><span class="operator">&gt;</span> <span class="name">chs</span><span class="punctuation">;</span>
<span class="ln">14 </span>  <span class="name">chs</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">4</span><span class="punctuation">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">k</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">k</span> <span class="operator">&lt;</span> <span class="literal number integer">4</span><span class="punctuation">;</span><span class="name">k</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">17 </span>  <span class="punctuation">{</span>
<span class="ln">18 </span>      <span class="keyword type">time_t</span> <span class="name">when</span> <span class="operator">=</span> <span class="name">time</span><span class="punctuation">(</span><span class="name builtin">NULL</span><span class="punctuation">);</span>
<span class="ln">19 </span>
<span class="ln">20 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">TimedCmdData</span><span class="operator">&lt;</span><span class="name">DevVarLongArray</span><span class="operator">&gt;</span> <span class="name">tcd</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">dvla_array</span><span class="punctuation">[</span><span class="name">k</span><span class="punctuation">],</span><span class="name">when</span><span class="punctuation">);</span>
<span class="ln">21 </span>      <span class="name">chs</span><span class="punctuation">.</span><span class="name">push</span><span class="punctuation">(</span><span class="name">tcd</span><span class="punctuation">);</span>
<span class="ln">22 </span>  <span class="punctuation">}</span>
<span class="ln">23 </span>
<span class="ln">24 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">instance</span><span class="punctuation">();</span>
<span class="ln">25 </span>  <span class="name">string</span> <span class="name function">cmd_name</span><span class="punctuation">(</span><span class="literal string">&quot;MyCmd&quot;</span><span class="punctuation">);</span>
<span class="ln">26 </span>  <span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">dev</span> <span class="operator">=</span> <span class="punctuation">....;</span>
<span class="ln">27 </span>
<span class="ln">28 </span>  <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">fill_cmd_polling_buffer</span><span class="punctuation">(</span><span class="name">dev</span><span class="punctuation">,</span><span class="name">cmd_name</span><span class="punctuation">,</span><span class="name">chs</span><span class="punctuation">);</span>
<span class="ln">29 </span>
<span class="ln">30 </span>  <span class="punctuation">.....</span>
</pre>
<p>Line 3-11 : Simulate data coming from hardware</p>
<p>Line 13-14 : Create one instance of the CmdHistoryStack class and
reserve space for one history of 4 elements</p>
<p>Line 16-17 : A loop on each history element</p>
<p>Line 18 : Get date (hardware simulation)</p>
<p>Line 20 : Create one instance of the TimedCmdData class with data and
date</p>
<p>Line 21 : Store this command history element in the history stack. The
element order will be the insertion order whatever the element date is.</p>
<p>Line 28 : Fill command polling buffer</p>
<p>After one execution of this code, a command_inout_history() call will
return one history with 4 elements. The first array element of the
oldest history record will have the value 10. The first array element of
the newest history record will have the value 13. A command_inout()
call with the data source parameter set to CACHE will return the newest
history record (ie an array with values 13,14 and 15). A
command_inout() call with the data source parameter set to DEVICE will
return what is coded is the command method. If you execute this code a
second time, a command_inout_history() call will return an history of
8 elements.</p>
<p>The next example fills the polling buffer for an attribute called MyAttr
which is already in externally triggered mode. It is a scalar attribute
of the DevString data type. This example is not really something you
will find in a real hardware interface. It is only to demonstrate the
fill_attr_polling_buffer() method usage with memory management issue.
Error management has also been removed.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="punctuation">....</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span>  <span class="name">AttrHistoryStack</span><span class="operator">&lt;</span><span class="name">DevString</span><span class="operator">&gt;</span> <span class="name">ahs</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>  <span class="name">ahs</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>  <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">k</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">k</span> <span class="operator">&lt;</span> <span class="literal number integer">3</span><span class="punctuation">;</span><span class="name">k</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 7 </span>  <span class="punctuation">{</span>
<span class="ln"> 8 </span>      <span class="keyword type">time_t</span> <span class="name">when</span> <span class="operator">=</span> <span class="name">time</span><span class="punctuation">(</span><span class="name builtin">NULL</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>      <span class="name">DevString</span> <span class="operator">*</span><span class="name">ptr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">DevString</span> <span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">];</span>
<span class="ln">11 </span>      <span class="name">ptr</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Attr history data&quot;</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>      <span class="name">TimedAttrData</span><span class="operator">&lt;</span><span class="name">DevString</span><span class="operator">&gt;</span> <span class="name">tad</span><span class="punctuation">(</span><span class="name">ptr</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">ATTR_VALID</span><span class="punctuation">,</span><span class="name builtin">true</span><span class="punctuation">,</span><span class="name">when</span><span class="punctuation">);</span>
<span class="ln">14 </span>      <span class="name">ahs</span><span class="punctuation">.</span><span class="name">push</span><span class="punctuation">(</span><span class="name">tad</span><span class="punctuation">);</span>
<span class="ln">15 </span>  <span class="punctuation">}</span>
<span class="ln">16 </span>
<span class="ln">17 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">instance</span><span class="punctuation">();</span>
<span class="ln">18 </span>  <span class="name">string</span> <span class="name function">attr_name</span><span class="punctuation">(</span><span class="literal string">&quot;MyAttr&quot;</span><span class="punctuation">);</span>
<span class="ln">19 </span>  <span class="name">DeviceImpl</span> <span class="operator">*</span><span class="name">dev</span> <span class="operator">=</span> <span class="punctuation">....;</span>
<span class="ln">20 </span>
<span class="ln">21 </span>  <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">fill_attr_polling_buffer</span><span class="punctuation">(</span><span class="name">dev</span><span class="punctuation">,</span><span class="name">attr_name</span><span class="punctuation">,</span><span class="name">ahs</span><span class="punctuation">);</span>
<span class="ln">22 </span>
<span class="ln">23 </span>  <span class="punctuation">.....</span>
</pre>
<p>Line 3-4 : Create one instance of the AttrHistoryStack class and reserve
space for an history with 3 elements</p>
<p>Line 6-7 : A loop on each history element</p>
<p>Line 8 : Get date (hardware simulation)</p>
<p>Line 10-11 : Create a string. Note that the DevString object is created
on the heap</p>
<p>Line 13 : Create one instance of the TimedAttrData class with data and
date requesting the memory to be released.</p>
<p>Line 14 : Store this attribute history element in the history stack. The
element order will be the insertion order whatever the element date is.</p>
<p>Line 21 : Fill command polling buffer</p>
<p>It is not necessary to return the memory allocated at line 10. The
<em>fill_attr_polling_buffer()</em> method will do it for you.</p>
</div>
<div class="section" id="setting-and-tuning-the-polling-in-a-tango-class">
<h3><a class="toc-backref" href="#id279">Setting and tuning the polling in a Tango class</a></h3>
<p>Even if the polling is normally set and tuned with external tool like
Jive, it is possible to set it directly into the code of a Tango class.
A set of methods belonging to the <em>DeviceImpl</em> class allows the user to
deal with polling. These methods are:</p>
<ul class="simple">
<li><em>is_attribute_polled()</em> and <em>is_command_polled()</em> to check if one
command/attribute is polled</li>
<li><em>get_attribute_poll_period()</em> and <em>get_command_poll_period()</em>
to get polled object polling period</li>
<li><em>poll_attribute()</em> and <em>poll_command()</em> to poll command or
attribute</li>
<li><em>stop_poll_attribute()</em> and <em>stop_poll_command()</em> to stop polling
a command or an attribute</li>
</ul>
<p>The following code snippet is just an exmaple of how these methods could
be used. They are documented in </p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>       <span class="punctuation">[</span><span class="name">Program</span> <span class="name label">Listing</span><span class="punctuation">:</span> <span class="name">poll_in_ds</span><span class="punctuation">.</span><span class="name">cpp</span><span class="punctuation">.</span><span class="name">lines</span>
<span class="ln"> 2 </span>      <span class="keyword type">void</span> <span class="name">MyClass</span><span class="operator">::</span><span class="name">read_attr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln"> 3 </span>      <span class="punctuation">{</span>
<span class="ln"> 4 </span>          <span class="punctuation">...</span>
<span class="ln"> 5 </span>          <span class="punctuation">...</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>          <span class="name">string</span> <span class="name">att_name</span><span class="punctuation">(</span><span class="literal string">&quot;SomeAttribute&quot;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>          <span class="name">string</span> <span class="name function">another_att_name</span><span class="punctuation">(</span><span class="literal string">&quot;AnotherAttribute&quot;</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>          <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">is_attribute_polled</span><span class="punctuation">(</span><span class="name">att_name</span><span class="punctuation">)</span> <span class="operator">==</span> <span class="name builtin">true</span><span class="punctuation">)</span>
<span class="ln">11 </span>              <span class="name">stop_poll_attribute</span><span class="punctuation">(</span><span class="name">att_name</span><span class="punctuation">);</span>
<span class="ln">12 </span>          <span class="keyword">else</span>
<span class="ln">13 </span>              <span class="name function">poll_attribute</span><span class="punctuation">(</span><span class="name">another_att_name</span><span class="punctuation">,</span><span class="literal number integer">500</span><span class="punctuation">);</span>
<span class="ln">14 </span>
<span class="ln">15 </span>          <span class="punctuation">....</span>
<span class="ln">16 </span>          <span class="punctuation">....</span>
<span class="ln">17 </span>
<span class="ln">18 </span>      <span class="punctuation">}</span>
<span class="ln">19 </span>
<span class="ln">20 </span>  <span class="punctuation">]</span>
</pre>
</div>
</div>
<div class="section" id="threading">
<h2><a class="toc-backref" href="#id280">Threading</a></h2>
<p>When used with C++, Tango used omniORB as underlying ORB. This CORBA
implementation is a threaded implementation and therefore a C++ Tango
device server or client are multi-threaded processes.</p>
<div class="section" id="device-server-process">
<h3><a class="toc-backref" href="#id281">Device server process</a></h3>
<p>A classical Tango device server without any connected clients has eight
threads. These threads are :</p>
<ul class="simple">
<li>The main thread waiting in the ORB main loop</li>
<li>Two ORB implementation threads (the POA thread)</li>
<li>The ORB scavanger thread</li>
<li>The signal thread</li>
<li>The heartbeat thread (needed by the Tango event system)</li>
<li>Two Zmq implementation threads</li>
</ul>
<p>On top of these eight threads, you have to add the thread(s) used by the
polling threads pool. This number depends on the polling thread pool
configuration and could be between 0 (no polling at all) and the maximun
number of threads in the pool.</p>
<p>A new thread is started for each connected client. Device server are
mostly used to interface hardware which most of the time does not
support multi-threaded access. Therefore, all remote calls executed from
a client are serialized within the device server code by using mutual
exclusion. See chapter [sub:Serialization-model-within] on which
serialization model are available. In order to limit thread number, the
underlying ORB (omniORB) is configured to shutdown threads dedicated to
client if the connection is inactive for more than 3 minutes. To also
limit thread number, the ORB is configured to create one thread per
connection up to 55 threads. When this level is reached, the threading
model is automatically switch to a thread pool model with up to 100
threads. If the number of threads decrease down to 50, the threading
model will return to thread per connection model.</p>
<p>If you are using event, the event system for its internal heartbeat
system periodically (every 200 seconds) sends a command to the device
server administration device. As explained above, a thread is created to
execute these command. The omniORB scavanger will terminate this thread
before the next event system heartbeat command arrives. For example, if
you have a device server with three connected clients using only event,
the process thread number will permanently change between 8 and 11
threads.</p>
<p>In summary, the number of threads in a device server process can be
evaluated with the following formula:</p>
<p><strong>8 + k + m</strong></p>
<p>k is the number of polling threads used from the polling threads pool
and m is the number of threads used for connected clients.</p>
<div class="section" id="serialization-model-within-a-device-server">
<h4>Serialization model within a device server</h4>
<p>Four serialization models are available within a device server. These
models protect all requests coming from the network but also requests
coming from the polling thread. These models are:</p>
<ol class="arabic simple">
<li>Serialization by device. All access to the same device are
serialized. As an example, let’s take a device server implementing
one class of device with two instances (dev1 and dev2). Two clients
are connected to these devices (client1 and client2). Client2 will
not be able to access dev1 if client1 is using it. Nevertheless,
client2 is able to access dev2 while client1 access dev1 (There is
one mutual exclusion object by device)</li>
<li>Serialization by class. With non multi-threaded legacy software, the
preceding scenario could generate problem. In this mode of
serialization, client2 is not able to access dev2 while client1
access dev1 because dev2 and dev1 are instances of the same class
(There is one mutual exclusion object by class)</li>
<li>Serialization by process. This is one step further than the previous
case. In this mode, only one client can access any device embedded
within the device server at a time. There is only one mutual
exclusion object for the whole process)</li>
<li>No serialization. This is an exotic kind of serialization and
<strong>should be used with extreme care</strong> only with device which are fully
thread safe. In this model, most of the device access are not
serialized at all. Due to Tango internal structure, the
<em>get_attribute_config</em>, <em>set_attribute_config</em>,
<em>read_attributes</em> and <em>write_attributes</em> CORBA calls are still
protected. Reading the device state and status via commands or via
CORBA attribute is also protected.</li>
</ol>
<p>By default, every Tango device server is in serialization by device
mode. A method of the Tango::Util class allows to change this default
behavior.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="comment preproc">#include &lt;tango.h&gt;
</span><span class="ln"> 2 </span><span class="comment preproc"></span>
<span class="ln"> 3 </span>  <span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">*</span><span class="name">argv</span><span class="punctuation">[])</span>
<span class="ln"> 4 </span>  <span class="punctuation">{</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>      <span class="name">try</span>
<span class="ln"> 7 </span>      <span class="punctuation">{</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">);</span>
<span class="ln">10 </span>
<span class="ln">11 </span>          <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">set_serial_model</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">BY_CLASS</span><span class="punctuation">);</span>
<span class="ln">12 </span>
<span class="ln">13 </span>          <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_init</span><span class="punctuation">();</span>
<span class="ln">14 </span>
<span class="ln">15 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Ready to accept request&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">16 </span>          <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_run</span><span class="punctuation">();</span>
<span class="ln">17 </span>      <span class="punctuation">}</span>
<span class="ln">18 </span>      <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">19 </span>      <span class="punctuation">{</span>
<span class="ln">20 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Can't allocate memory!!!&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">21 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Exiting&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">22 </span>      <span class="punctuation">}</span>
<span class="ln">23 </span>      <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">CORBA</span><span class="operator">::</span><span class="name">Exception</span> <span class="operator">&amp;</span><span class="name">e</span><span class="punctuation">)</span>
<span class="ln">24 </span>      <span class="punctuation">{</span>
<span class="ln">25 </span>           <span class="name">Tango</span><span class="operator">::</span><span class="name">Except</span><span class="operator">::</span><span class="name">print_exception</span><span class="punctuation">(</span><span class="name">e</span><span class="punctuation">);</span>
<span class="ln">26 </span>
<span class="ln">27 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Received a CORBA::Exception&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">28 </span>           <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Exiting&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">29 </span>      <span class="punctuation">}</span>
<span class="ln">30 </span>
<span class="ln">31 </span>      <span class="keyword">return</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">);</span>
<span class="ln">32 </span>  <span class="punctuation">}</span>
</pre>
<p>The serialization model is set at line 11 before the server is
initialized and the infinite loop is started. See
 for all details on the methods to
set/get serialization model.</p>
</div>
<div class="section" id="attribute-serialization-model">
<h4>Attribute Serialization model</h4>
<p>Even with the serialization model described previously, in case of
attributes carrying a large number of data and several clients reading
this attribute, a device attribute serialization has to be followed.
Without this level of serialization, for attribute using a shared
buffer, a thread scheduling may happens while the device server process
is in the CORBA layer transferring the attribute data on the network.
Three serialization models are available for attribute serialization.
The default is well adapted to nearly all cases. Nevertheless, if the
user code manages several attributes data buffer or if it manages its
own buffer protection by one way or another, it could be interesting to
tune this serialization level. The available models are:</p>
<ol class="arabic simple">
<li>Serialization by kernel. This is the default case. The kernel is
managing the serialization</li>
<li>Serialization by user. The user code is in charge of the
serialization. This serialization is done by the use of a omni_mutex
object. An omni_mutex is an object provided by the omniORB package.
It is the user responsability to lock this mutex when appropriate and
to give this mutex to the Tango kernel before leaving the attribute
read method</li>
<li>No serialization.</li>
</ol>
<p>By default, every Tango device attribute is in serialization by kernel.
Methods of the Tango::Attribute class allow to change the attribute
serialization behavior and to give the user omni_mutex object to the
kernel.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="keyword type">void</span> <span class="name">MyClass</span><span class="operator">::</span><span class="name">init_device</span><span class="punctuation">()</span>
<span class="ln"> 2 </span> <span class="punctuation">{</span>
<span class="ln"> 3 </span>    <span class="punctuation">...</span>
<span class="ln"> 4 </span>    <span class="punctuation">...</span>
<span class="ln"> 5 </span>    <span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span> <span class="operator">=</span> <span class="name">dev_attr</span><span class="operator">-&gt;</span><span class="name">get_attr_by_name</span><span class="punctuation">(</span><span class="literal string">&quot;TheAttribute&quot;</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>    <span class="name">att</span><span class="punctuation">.</span><span class="name">set_attr_serial_model</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">ATTR_BY_USER</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>    <span class="punctuation">....</span>
<span class="ln"> 8 </span>    <span class="punctuation">....</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span> <span class="punctuation">}</span>
<span class="ln">11 </span>
<span class="ln">12 </span>
<span class="ln">13 </span> <span class="keyword type">void</span> <span class="name">MyClass</span><span class="operator">::</span><span class="name">read_TheAttribute</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">14 </span> <span class="punctuation">{</span>
<span class="ln">15 </span>    <span class="punctuation">....</span>
<span class="ln">16 </span>    <span class="punctuation">....</span>
<span class="ln">17 </span>    <span class="name">the_mutex</span><span class="punctuation">.</span><span class="name">lock</span><span class="punctuation">();</span>
<span class="ln">18 </span>    <span class="punctuation">....</span>
<span class="ln">19 </span>    <span class="comment single">// Fill the attribute buffer
</span><span class="ln">20 </span><span class="comment single"></span>    <span class="punctuation">....</span>
<span class="ln">21 </span>    <span class="name">attr</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="name">buffer</span><span class="punctuation">,....);</span>
<span class="ln">22 </span>    <span class="name">attr</span><span class="operator">-&gt;</span><span class="name">set_user_attr_mutex</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">the_mutex</span><span class="punctuation">);</span>
<span class="ln">23 </span> <span class="punctuation">}</span>
</pre>
<p>The serialization model is set at line 6 in the init_device() method.
The user omni_mutex is passed to the Tango kernel at line 22. This
omni_mutex object is a device data member. See
 for all details on the methods to set
attribute serialization model.</p>
</div>
</div>
<div class="section" id="client-process">
<h3><a class="toc-backref" href="#id282">Client process</a></h3>
<p>Clients are also multi threaded processes. The underlying C++ ORB
(omniORB) try to keep system resources to a minimum. To decrease process
file descriptors usage, each connection to server is automatically
closed if it is idle for more than 2 minutes and automatically re-opened
when needed. A dedicated thread is spawned by the ORB to manage this
automatic closing connection (the ORB scavenger thread).</p>
<p>Threrefore, a Tango client has two threads which are:</p>
<ol class="arabic simple">
<li>The main thread</li>
<li>The ORB scavanger thread</li>
</ol>
<p>If the client is using the event system and as Tango is using the event
push-push model, it has to be a server for receiving the events. This
increases the number of threads. The client now has 6 threads which are:</p>
<ul class="simple">
<li>The main thread</li>
<li>The ORB scavenger thread</li>
<li>Two Zmq implementation threads</li>
<li>Two Tango event system related threads (the KeepAliveThread and the
EventConsumer thread)</li>
</ul>
</div>
</div>
<div class="section" id="generating-events-in-a-device-server">
<h2><a class="toc-backref" href="#id283">Generating events in a device server</a></h2>
<p>The server is at the origin of events. It will fire events as soon as
they occur. Standard events (<em>change</em>, <em>periodic</em> and <em>archive</em>) are
detected automatically in the polling thread and fired as soon as they
are detected. The <em>periodic</em> events can only be handled by the polling
thread. <em>Change, Data ready</em> and <em>archive</em> events can also be pushed
from the device server code. To allow a client to subscribe to events of
non polled attributes the server has to declare that events are pushed
from the code. Three methods are available for this purpose:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">Attr</span><span class="operator">::</span><span class="name">set_change_event</span><span class="punctuation">(</span><span class="keyword type">bool</span> <span class="name">implemented</span><span class="punctuation">,</span> <span class="keyword type">bool</span> <span class="name">detect</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">2 </span>  <span class="name">Attr</span><span class="operator">::</span><span class="name">set_archive_event</span><span class="punctuation">(</span><span class="keyword type">bool</span> <span class="name">implemented</span><span class="punctuation">,</span> <span class="keyword type">bool</span> <span class="name">detect</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">3 </span>  <span class="name">Attr</span><span class="operator">::</span><span class="name">set_data_ready_event</span><span class="punctuation">(</span> <span class="keyword type">bool</span> <span class="name">implemented</span><span class="punctuation">);</span>
</pre>
<p>where <em>implemented</em>=true indicates that events are pushed manually
from the code and <em>detect</em>=true (when used) triggers the verification
of the same event properties as for events send by the polling thread.
When setting <em>detect</em>=false, no value checking is done on the pushed
value! The class DeviceImpl also supports the first two methods with an
addictional parameter attr_name defining the attribute name.</p>
<p>To push events manually from the code a set of data type dependent
methods can be used:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_change_event</span> <span class="punctuation">(</span><span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span> <span class="punctuation">....);</span>
<span class="ln">2 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_archive_event</span><span class="punctuation">(</span><span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span> <span class="punctuation">....);</span>
</pre>
<p>For the data ready event, a DeviceImpl class method has to be used to
push the event.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_data_ready_event</span><span class="punctuation">(</span><span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">ctr</span><span class="punctuation">);</span>
</pre>
<p>See the class documentation for all available interfaces.</p>
<p>For non-standard events a single call exists for pushing the data to the
CORBA Notification Service (omniNotify). Clients who are subscribed to
this event have to know what data type is in the DeviceAttribute and
unpack it accordingly.</p>
<p>To push non-standard events, use the following api call is available to
all device servers :</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_event</span><span class="punctuation">(</span> <span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span>
<span class="ln">2 </span>               <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">filterable_names</span><span class="punctuation">,</span>
<span class="ln">3 </span>               <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">filterable_vals</span><span class="punctuation">,</span>
<span class="ln">4 </span>               <span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
</pre>
<p>where <em>attr_name</em> is the name of the attribute<em>. Filterable_names</em>
and <em>filterable_vals</em> represent any filterable data which can be used
by clients to filter on. Here is a typical example of what a server will
need to do to send its own events. We are in the read method of the
Sinusoide attribute. This attribute is readable as any other attribute
but an event is sent if its value is positive when it is read. On top of
that, this event is sent with one filterable field called value which is
set to the attribute value.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">MyClass</span><span class="operator">::</span><span class="name">read_Sinusoide</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>    <span class="punctuation">...</span>
<span class="ln"> 4 </span>       <span class="keyword">struct</span> <span class="name">timeval</span> <span class="name">tv</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>       <span class="name">gettimeofday</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">tv</span><span class="punctuation">,</span> <span class="name builtin">NULL</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>       <span class="name">sinusoide</span> <span class="operator">=</span> <span class="literal number integer">100</span> <span class="operator">*</span> <span class="name">sin</span><span class="punctuation">(</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number float">3.14</span> <span class="operator">*</span> <span class="name">frequency</span> <span class="operator">*</span> <span class="name">tv</span><span class="punctuation">.</span><span class="name">tv_sec</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>       <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">sinusoide</span> <span class="operator">&gt;=</span> <span class="literal number integer">0</span><span class="punctuation">)</span>
<span class="ln"> 9 </span>       <span class="punctuation">{</span>
<span class="ln">10 </span>          <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">filterable_names</span><span class="punctuation">;</span>
<span class="ln">11 </span>          <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">filterable_value</span><span class="punctuation">;</span>
<span class="ln">12 </span>
<span class="ln">13 </span>          <span class="name">filterable_names</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;value&quot;</span><span class="punctuation">);</span>
<span class="ln">14 </span>          <span class="name">filterable_value</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">((</span><span class="keyword type">double</span><span class="punctuation">)</span><span class="name">sinusoide</span><span class="punctuation">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>          <span class="name">push_event</span><span class="punctuation">(</span> <span class="name">attr</span><span class="punctuation">.</span><span class="name">get_name</span><span class="punctuation">(),</span>
<span class="ln">17 </span>                      <span class="name">filterable_names</span><span class="punctuation">,</span> <span class="name">filterable_value</span><span class="punctuation">,</span>
<span class="ln">18 </span>                      <span class="operator">&amp;</span><span class="name">sinusoide</span><span class="punctuation">);</span>
<span class="ln">19 </span>       <span class="punctuation">}</span>
<span class="ln">20 </span>    <span class="punctuation">....</span>
<span class="ln">21 </span>    <span class="punctuation">....</span>
<span class="ln">22 </span>
<span class="ln">23 </span> <span class="punctuation">}</span>
</pre>
<p>line 13-14 : The filter pair name/value is initialised</p>
<p>line 16-18 : The event is pushed</p>
</div>
<div class="section" id="using-multicast-protocol-to-transfer-events">
<h2><a class="toc-backref" href="#id284">Using multicast protocol to transfer events</a></h2>
<p>This feature is available starting with Tango 8.1. Transferring events
using a multicast protocol means delivering the events to a group of
clients simultaneously in a single transmission from the event source.
Tango, through ZMQ, uses the OpenPGM multicating protocol. This is one
implementation of the PGM protocol defined by the RFC 3208 (Reliable
multicasting protocol). Nevertheless, the default event communication
mode is unicast and propagating events via multicasting requires some
specific configuration.</p>
<div class="section" id="configuring-events-to-use-multicast-transport">
<h3><a class="toc-backref" href="#id285">Configuring events to use multicast transport</a></h3>
<p>Before using multicasting transport for event(s), you have to choose
which address and port have to be used. In a IP V4 network, only a
limited set of addresses are associated with multicasting. These are the
IP V4 addresses between</p>
<p>224.0.1.0 and 238.255.255.255</p>
<p>Once the address is selected, you have to choose a port number. Together
with the event name, these are the two minimum configuration
informations which have to be provided to Tango to get multicast
transport. This configuration is done using the <strong>MulticastEvent</strong> free
property associated to the <strong>CtrlSystem</strong> object.</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>In the above window dump of the Jive tool, the <em>change</em> event on the
<em>state</em> attribute of the <em>dev/test/11</em> device has to be transferred
using multicasting with the address <em>226.20.21.22</em> and the port number
<em>2222</em>. The exact definition of this CtrlSystem/MulticastEvent property
for one event propagated using multicast is</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span> <span class="name">CtrlSystem</span><span class="operator">-&gt;</span><span class="name label">MulticastEvent</span><span class="punctuation">:</span>   <span class="name">Multicast</span> <span class="name">address</span><span class="punctuation">,</span>
<span class="ln">2 </span>                               <span class="name">port</span> <span class="name">number</span><span class="punctuation">,</span>
<span class="ln">3 </span>                               <span class="punctuation">[</span><span class="name">rate</span> <span class="name">in</span> <span class="name">Mbit</span><span class="operator">/</span><span class="name">sec</span><span class="punctuation">],</span>
<span class="ln">4 </span>                               <span class="punctuation">[</span><span class="name">ivl</span> <span class="name">in</span> <span class="name">seconds</span><span class="punctuation">],</span>
<span class="ln">5 </span>                               <span class="name">event</span> <span class="name">name</span>
</pre>
<p>Rate and Ivl are optional properties. In case several events have to be
transferred using multicasting, simply extend the MulicastEvent property
with the configuration parameters related to the other events. There is
only one MultiCastEvent property per Tango control system. The
underlying multicast protocol (PGM) is rate limited. This means that it
limits its network bandwidth usage to a user defined value. The optional
third configuration parameter is the maximum rate (in Mbit/sec) that the
protocol will use to transfert this event. Because PGM is a reliable
protocol, data has to be buffered for re-transmission in case a receiver
signal some lost data. The optional forth configuration parameter
specify the maximum amount of time (in seconds) that a receiver can be
absent for a multicast group before unrecoverable data loss will occur.
Exercise care when setting large recovery interval as the data needed
for recovery will be held in memory. For example, a 60 seconds (1
minute) recovery interval at a data rate of 1 Gbit/sec requires a 7
GBytes in-memory buffer. Whan any of these two optional parameters are
not set, the default value (defined in next sub-chapter) are used. Here
is another example of events using multicasting configuration</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>In this example, there are 5 events which are transmitted using
multicasting:</p>
<ol class="arabic simple">
<li>Event <em>change</em> for attribute <em>state</em> on device <em>dev/test/11</em> which
uses multicasting address <em>226.20.21.22</em> and port number <em>2222</em></li>
<li>Event <em>periodic</em> for attribute <em>state</em> on device <em>dev/test/10</em> which
uses multicasting address <em>226.20.21.22</em> and port number <em>3333</em></li>
<li>Event <em>change</em> for attribute <em>ImaAttr</em> on device <em>et/ev/01</em> which
uses multicasting address <em>226.30.31.32</em> and port number <em>4444</em>. Note
that this event uses a rate set to <em>40 Mbit/sec</em> and a ivl set to <em>20
seconds</em>.</li>
<li>Event <em>change</em> for attribute <em>event_change_tst</em> on device
<em>dev/test/12</em> which uses multicasting address <em>226.20.21.22</em> and port
number <em>2233</em></li>
<li>Event <em>archive</em> for attribute <em>event_change_tst</em> on device
<em>dev/tomasz/3</em> which uses multicasting address <em>226.20.21.22</em> and
port number <em>2234</em></li>
</ol>
</div>
<div class="section" id="default-multicast-related-properties">
<h3><a class="toc-backref" href="#id286">Default multicast related properties</a></h3>
<p>On top of the MulticastEvent property previously described, Tango
supports three properties to defined default value for multicast
transport tuning. These properties are:</p>
<ul class="simple">
<li><strong>MulticastRate</strong> associated to the CtrlSystem object. This defines
the maximum rate will will be used by the multicast protocol when
transferring event. The unit is Mbit/sec. In case this property is
not defined, the Tango library used a value of 80 Mbit/sec.</li>
<li><strong>MulticastIvl</strong> associated to the CtrlSystem object. It specifies
the maximum time (in sec) during which data has to be buffered for
re-transmission in case a receiver signals some lost data. The unit
is seconds. In case this property is not defined, the Tango library
takes a value of 20 seconds.</li>
<li><strong>MulticastHops</strong> associated to the CtrlSystem object. This property
defines the maximum number of element (router), the multicast packet
is able to cross. Each time one element is crossed, the value is
decremented. When it reaches 0, the packet is not transferred any
more. In case this property is not defined, the Tango library uses a
value of 5.</li>
</ul>
</div>
</div>
<div class="section" id="memorized-attribute">
<h2><a class="toc-backref" href="#id287">Memorized attribute</a></h2>
<p>It is possible to ask Tango to store in its database the last written
value for attribute of the SCALAR data format and obviously only for
READ_WRITE or READ_WITH_WRITE attribute. This is fully automatic.
During device startup phase, for all device memorized attributes, the
value written in the database is fetched and applied. A write_attribute
call can be generated to apply the memorized value to the attribute or
only the attribute set point can be initialised. The following piece of
code shows how the source code should be written to set an attribute as
memorized and to initialise only the attribute set point.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span> <span class="keyword type">void</span> <span class="name">DevTestClass</span><span class="operator">::</span><span class="name">attribute_factory</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span> <span class="operator">*&gt;</span> <span class="operator">&amp;</span><span class="name">att_list</span><span class="punctuation">)</span>
<span class="ln">2 </span>  <span class="punctuation">{</span>
<span class="ln">3 </span>      <span class="punctuation">...</span>
<span class="ln">4 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="keyword">new</span> <span class="name">String_attrAttr</span><span class="punctuation">());</span>
<span class="ln">5 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">back</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">set_memorized</span><span class="punctuation">();</span>
<span class="ln">6 </span>      <span class="name">att_list</span><span class="punctuation">.</span><span class="name">back</span><span class="punctuation">()</span><span class="operator">-&gt;</span><span class="name">set_memorized_init</span><span class="punctuation">(</span><span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln">7 </span>      <span class="punctuation">...</span>
<span class="ln">8 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 4 : The attribute to be memorized is created and inserted in the
attribute vector.</p>
<p>Line 5 : The <em>set_memorized()</em> method of the attribute base class is
called to define the attribute as memorized.</p>
<p>Line 6 : The set_memorized_init() method is called with the parameter
false to define that only the set point should be initialsied.</p>
</div>
<div class="section" id="forwarded-attribute">
<h2><a class="toc-backref" href="#id288">Forwarded attribute</a></h2>
<div class="section" id="id57">
<h3><a class="toc-backref" href="#id289">Definition</a></h3>
<p>Let’s take an example to explain what is a forwarded attribute. We
assume we have to write a Tango class for a ski lift in a ski resort
somewhere in the Alps. Obviously, the ski lift has a motor for which we
already have a Tango class. This motor Tango class has one attribute
<em>speed</em>. But for the ski lift, the motor speed is not the only thing
which has to be controlled. For instance, you also want to give access
to the wind sensor data installed on the top of the ski lift. Therefore,
you write a ski-lift Tango class representing the whole ski-lift system.
This ski-lift class will have at least two attributes which are:</p>
<ol class="arabic simple">
<li>The wind speed at the top of the ski-lift</li>
<li>The motor speed</li>
</ol>
<p>The ski-lift Tango class motor speed attribute is nothing more than the
motor Tango class speed attribute. All the ski-lift class has to do for
this attribute is to forward the request (read/write) to the speed
attribute of the motor Tango class. The speed attribute of the ski-lift
Tango class is a <strong>forwarded attribute</strong> while the speed attribute of
the motor Tango class is its <strong>root attribute</strong>.</p>
<p>A forwarded attribute get its configuration from its root attribute and
it forwards to its root attribute</p>
<ul class="simple">
<li>Its read / write / write_read requests</li>
<li>Its configuration change</li>
<li>Its event subscription</li>
<li>Its locking behavior</li>
</ul>
<p>As stated above, a forwarded attribute has the same configuration than
its root attribute except its <em>name</em> and <em>label</em> which stays local. All
other attribute configuration parameters are forwarded to the root
attribute. If a root attribute configuration parameter is changed, the
forwarded attribute is informed (via event) and its local configuration
is also modified.</p>
<p>The association between the forwarded attribute and its root attribute
is done using a property named</p>
<p>__root_att</p>
<p>belonging to the forwarded attribute. This property value is simply the
name of the root attribute. Muti-control system is supported and this
__root_att attribute property value can be something like
<em>tango://my_tango_host:10000/my/favorite/dev/the_root_attribute</em>.
The name of the root attribute is included in attribute configuration.</p>
<p>It is forbidden to poll a forwarded attribute and one exception is
thrown if such a case happens. Polling has to be done on the root
attribute. Nevertheless, if the root attribute is polled, a request to
read the forwarded attribute with the DeviceProxy object source
parameter set to CACHE_DEVICE or CACHE will get its data from the root
attribute polling buffer.</p>
<p>If you subscribe to event(s) on a forwarded attribute, the subscription
is forwarded to the root attribute. When the event is received by the
forwarded attribute, the attribute name in the event data is modified to
reflect the forwarded attribute name and the event is pushed to the
original client(s).</p>
<p>When a device with forwarded attribute is locked, the device to which
the root attribute belongs is also locked.</p>
</div>
<div class="section" id="coding">
<h3><a class="toc-backref" href="#id290">Coding</a></h3>
<p>As explained in the chapter Writing a Tango device server, each Tango
class attribute is implemented via a C++ class which has to inherit from
either <em>Attr</em>, <em>SpectrumAttr</em> or <em>ImageAttr</em> according to the attribute
data format. For forwarded attribute, the related class has to inherit
from the <strong>FwdAttr</strong> class whatever its data format is. For classical
attribute, the programmer can define in the Tango class code default
value for the attribute properties using one instance of the
<em>UserDefaultAttrProp</em> class. For forwarded attribute, the programmer has
to create one instance of the <strong>UserDefaultFwdAttrProp</strong> class but only
the attribute label can be defined. One example of how to program a
forwarded attribute is given below</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword">class</span> <span class="name class">MyFwdAttr</span><span class="operator">:</span> <span class="keyword">public</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">FwdAttr</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>  <span class="keyword">public</span><span class="operator">:</span>
<span class="ln"> 4 </span>      <span class="name">MyFwdAttr</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">string</span> <span class="operator">&amp;</span><span class="name">_n</span><span class="punctuation">)</span><span class="operator">:</span><span class="name">FwdAttr</span><span class="punctuation">(</span><span class="name">_n</span><span class="punctuation">)</span> <span class="punctuation">{};</span>
<span class="ln"> 5 </span>      <span class="operator">~</span><span class="name">MyFwdAttr</span><span class="punctuation">()</span> <span class="punctuation">{};</span>
<span class="ln"> 6 </span>  <span class="punctuation">};</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>  <span class="keyword type">void</span> <span class="name">DevTestClass</span><span class="operator">::</span><span class="name">attribute_factory</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attr</span> <span class="operator">*&gt;</span> <span class="operator">&amp;</span><span class="name">att_list</span><span class="punctuation">)</span>
<span class="ln"> 9 </span>  <span class="punctuation">{</span>
<span class="ln">10 </span>     <span class="punctuation">...</span>
<span class="ln">11 </span>     <span class="name">MyFwdAttr</span> <span class="operator">*</span><span class="name">att1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">MyFwdAttr</span><span class="punctuation">(</span><span class="literal string">&quot;fwd_att_name&quot;</span><span class="punctuation">);</span>
<span class="ln">12 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">UserDefaultFwdAttrProp</span> <span class="name">att1_prop</span><span class="punctuation">;</span>
<span class="ln">13 </span>     <span class="name">att1_prop</span><span class="punctuation">.</span><span class="name">set_label</span><span class="punctuation">(</span><span class="literal string">&quot;Gasp a fwd attribute&quot;</span><span class="punctuation">);</span>
<span class="ln">14 </span>     <span class="name">att1</span><span class="operator">-&gt;</span><span class="name">set_default_properties</span><span class="punctuation">(</span><span class="name">att1_prop</span><span class="punctuation">);</span>
<span class="ln">15 </span>     <span class="name">att_list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="name">att1</span><span class="punctuation">);</span>
<span class="ln">16 </span>     <span class="punctuation">...</span>
<span class="ln">17 </span>  <span class="punctuation">}</span>
</pre>
<p>Line 1 : The forwarded attribute class inherits from FwdAttr class.</p>
<p>Line 4-5 : Only constructor and destructor methods are required</p>
<p>Line 11 : The attribute object is created</p>
<p>Line 12-14 : A default value for the forwarded attribute label is
defined.</p>
<p>Line 15: The forwarded attribute is added to the list of attribute</p>
<p>In case of error in the forwarded attribute configuration (for instance
missing __root_att property), the attribute is not created by the
Tango kernel and is therefore not visible for the external world. The
state of the device to which the forwarded attribute belongs to is set
to ALARM (if not already FAULT) and a detailed error report is available
in the device status. In case a device with forwarded attribute(s) is
started before the device(s) with the root attribute(s), the same
principle is used: forwarded attribute(s) are not created, device state
is set to ALARM and device status is reporting the error. When the
device(s) with the root attribute will start, the forwarded attributes
will automatically be created.</p>
</div>
</div>
<div class="section" id="transferring-images">
<h2><a class="toc-backref" href="#id291">Transferring images</a></h2>
<p>Some optimized methods have been written to optimize image transfer
between client and server using the attribute DevEncoded data type. All
these methods have been merged in a class called EncodedAttribute.
Within this class, you will find methods to:</p>
<ul class="simple">
<li>Encode an image in a compressed way (JPEG) for images coded on 8
(gray scale), 24 or 32 bits</li>
<li>Encode a grey scale image coded on 8 or 16 bits</li>
<li>Encode a color image coded on 24 bits</li>
<li>Decode images coded on 8 or 16 bits (gray scale) and returned a 8 or
bits grey scale image</li>
<li>Decode color images transmitted using a compressed format (JPEG) and
returns a 32 bits RGB image</li>
</ul>
<p>The following code snippets are examples of how these methods have to be
used in a server and in a client. On the server side, creates an
instance of the EncodedAttribute class within your object</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span> <span class="keyword">class</span> <span class="name class">MyDevice</span><span class="operator">::</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Device_4Impl</span>
<span class="ln">2 </span>  <span class="punctuation">{</span>
<span class="ln">3 </span>      <span class="punctuation">...</span>
<span class="ln">4 </span>      <span class="name">Tango</span><span class="operator">::</span><span class="name">EncodedAttribute</span> <span class="name">jpeg</span><span class="punctuation">;</span>
<span class="ln">5 </span>      <span class="punctuation">...</span>
<span class="ln">6 </span>  <span class="punctuation">}</span>
</pre>
<p>In the code of your device, use an encoding method of the
EncodedAttribute class</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span> <span class="keyword type">void</span> <span class="name">MyDevice</span><span class="operator">::</span><span class="name">read_Encoded_attr_image</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
<span class="ln">2 </span> <span class="punctuation">{</span>
<span class="ln">3 </span>      <span class="punctuation">....</span>
<span class="ln">4 </span>      <span class="name">jpeg</span><span class="punctuation">.</span><span class="name">encode_jpeg_gray8</span><span class="punctuation">(</span><span class="name">imageData</span><span class="punctuation">,</span><span class="literal number integer">256</span><span class="punctuation">,</span><span class="literal number integer">256</span><span class="punctuation">,</span><span class="literal number float">50.0</span><span class="punctuation">);</span>
<span class="ln">5 </span>      <span class="name">att</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">jpeg</span><span class="punctuation">);</span>
<span class="ln">6 </span> <span class="punctuation">}</span>
</pre>
<p>Line 4: Image encoding. The size of the image is 256 by 256. Each pixel
is coded using 8 bits. The encoding quality is defined to 50 in a scale
of 0 - 100. imageData is the pointer to the image data (pointer to
unsigned char)</p>
<p>Line 5: Set the value of the attribute using a <em>Attribute::set_value()</em>
method.</p>
<p>On the client side, the code is the following (without exception
management)</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>    <span class="punctuation">....</span>
<span class="ln"> 2 </span>    <span class="name">DeviceAttribute</span> <span class="name">da</span><span class="punctuation">;</span>
<span class="ln"> 3 </span>    <span class="name">EncodedAttribute</span> <span class="name">att</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>    <span class="keyword type">int</span> <span class="name">width</span><span class="punctuation">,</span><span class="name">height</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>    <span class="keyword type">unsigned</span> <span class="keyword type">char</span> <span class="operator">*</span><span class="name">gray8</span><span class="punctuation">;</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>    <span class="name">da</span> <span class="operator">=</span> <span class="name">device</span><span class="punctuation">.</span><span class="name">read_attribute</span><span class="punctuation">(</span><span class="literal string">&quot;Encoded_attr_image&quot;</span><span class="punctuation">);</span>
<span class="ln"> 8 </span>    <span class="name">att</span><span class="punctuation">.</span><span class="name">decode_gray8</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">da</span><span class="punctuation">,</span><span class="operator">&amp;</span><span class="name">width</span><span class="punctuation">,</span><span class="operator">&amp;</span><span class="name">height</span><span class="punctuation">,</span><span class="operator">&amp;</span><span class="name">gray8</span><span class="punctuation">);</span>
<span class="ln"> 9 </span>    <span class="punctuation">....</span>
<span class="ln">10 </span>   <span class="keyword">delete</span> <span class="punctuation">[]</span> <span class="name">gray8</span><span class="punctuation">;</span>
<span class="ln">11 </span>   <span class="punctuation">...</span>
</pre>
<p>The attribute named Encoded_attr_image is read at line7. The image is
decoded at line 8 in a 8 bits gray scale format. The image data are
stored in the buffer pointed to by gray8. The memory allocated by the
image decoding at line 8 is returned to the system at line 10.</p>
</div>
<div class="section" id="device-server-with-user-defined-event-loop">
<h2><a class="toc-backref" href="#id292">Device server with user defined event loop</a></h2>
<p>Sometimes, it could be usefull to write your own process event handling
loop. For instance, this feature can be used in a device server process
where the ORB is only one of several components that must perform event
handling. A device server with a graphical user interface must allow the
GUI to handle windowing events in addition to allowing the ORB to handle
incoming requests. These types of device server therefore perform
non-blocking event handling. They turn the main thread of control over
each of the vvarious event-handling sub-systems while not allowing any
of them to block for significants period of time. The <em>Tango::Util</em>
class has a method called <em>server_set_event_loop()</em> to deal with such
a case. This method has only one argument which is a function pointer.
This function does not receive any argument and returns a boolean. If
this boolean is true, the device server process exits. The device server
core will call this function in a loop without any sleeping time between
the call. It is the user responsability to implement in this function
some kind of sleeping mechanism in order not to make this loop too CPU
consuming. The code of this function is executed by the device server
main thread. The following piece of code is an example of how you can
use this feature.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">bool</span> <span class="name function">my_event_loop</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="keyword type">bool</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>     <span class="name">some_sleeping_time</span><span class="punctuation">();</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>     <span class="name">ret</span> <span class="operator">=</span> <span class="name">handle_gui_events</span><span class="punctuation">();</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>     <span class="keyword">return</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln">10 </span>  <span class="punctuation">}</span>
<span class="ln">11 </span>
<span class="ln">12 </span>  <span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">*</span><span class="name">argv</span><span class="punctuation">[])</span>
<span class="ln">13 </span>  <span class="punctuation">{</span>
<span class="ln">14 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span><span class="punctuation">;</span>
<span class="ln">15 </span>     <span class="name">try</span>
<span class="ln">16 </span>     <span class="punctuation">{</span>
<span class="ln">17 </span>        <span class="comment single">// Initialise the device server
</span><span class="ln">18 </span><span class="comment single"></span>        <span class="comment single">//----------------------------------------
</span><span class="ln">19 </span><span class="comment single"></span>        <span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">);</span>
<span class="ln">20 </span>
<span class="ln">21 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">set_polling_threads_pool_size</span><span class="punctuation">(</span><span class="literal number integer">5</span><span class="punctuation">);</span>
<span class="ln">22 </span>
<span class="ln">23 </span>        <span class="comment single">// Create the device server singleton
</span><span class="ln">24 </span><span class="comment single"></span>        <span class="comment single">//        which will create everything
</span><span class="ln">25 </span><span class="comment single"></span>        <span class="comment single">//----------------------------------------
</span><span class="ln">26 </span><span class="comment single"></span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_init</span><span class="punctuation">(</span><span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln">27 </span>
<span class="ln">28 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_set_event_loop</span><span class="punctuation">(</span><span class="name">my_event_loop</span><span class="punctuation">);</span>
<span class="ln">29 </span>
<span class="ln">30 </span>        <span class="comment single">// Run the endless loop
</span><span class="ln">31 </span><span class="comment single"></span>        <span class="comment single">//----------------------------------------
</span><span class="ln">32 </span><span class="comment single"></span>        <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Ready to accept request&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">33 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_run</span><span class="punctuation">();</span>
<span class="ln">34 </span>     <span class="punctuation">}</span>
<span class="ln">35 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">36 </span>     <span class="punctuation">{</span>
<span class="ln">37 </span>     <span class="punctuation">...</span>
</pre>
<p>The device server main event loop is set at line 29 before the call to
the Util::server_run() method. The function used as server loop is
defined between lines 2 and 11.</p>
</div>
<div class="section" id="device-server-using-file-as-database">
<h2><a class="toc-backref" href="#id293">Device server using file as database</a></h2>
<p>For device servers not able to access the Tango database (most of the
time due to network route or security reason), it is possible to start
them using file instead of a real database. This is done via the device
server</p>
<p>-file=&lt;file name&gt;</p>
<p>command line option. In this case,</p>
<ul class="simple">
<li>Getting, setting and deleting class properties</li>
<li>Getting, setting and deleting device properties</li>
<li>Getting, setting and deleting class attribute properties</li>
<li>Getting, setting and deleting device attribute properties</li>
</ul>
<p>are handled using the specified file instead of the Tango database. The
file is an ASCII file and follows a well-defined syntax with predefined
keywords. The simplest way to generate the file for a specific device
server is to use the Jive application. See 
to get Jive documentation. The Tango database is not only used to store
device configuration parameters, it is also used to store device network
access parameter (the CORBA IOR). To allow an application to connect to
a device hosted by a device server using file instead of database, you
need to start it on a pre-defined port, and you must use one of the
underlying ORB option called <em>endPoint</em> like</p>
<p>myserver myinstance_name -file=/tmp/MyServerFile -ORBendPoint
giop:tcp::&lt;port number&gt;</p>
<p>to start your device server. The device name passed to the client
application must also be modified in order to refect the non-database
usage. See [DeviceNaming] to learn about Tango device name syntax.
Nevertheless, using this Tango feature prevents some other features to
be used :</p>
<ul class="simple">
<li>No check that the same device server is running twice.</li>
<li>No device or attribute alias name.</li>
<li>In case of several device servers running on the same host, the user
must manually manage a list of already used network port.</li>
</ul>
</div>
<div class="section" id="device-server-without-database">
<h2><a class="toc-backref" href="#id294">Device server without database</a></h2>
<p>In some very specific cases (Running a device server within a lab during
hardware development...), it could be very useful to have a device
server able to run even if there is no database in the control system.
Obviously, running a Tango device server without a database means
loosing Tango features. The lost features are :</p>
<ul class="simple">
<li>No check that the same device server is running twice.</li>
<li>No device configuration via properties.</li>
<li>No event generated by the server.</li>
<li>No memorized attributes</li>
<li>No device attribute configuration via the database.</li>
<li>No check that the same device name is used twice within the same
control system.</li>
<li>In case of several device servers running on the same host, the user
must manually manage a list of already used network port.</li>
</ul>
<p>To run a device server without a database, the <strong>-nodb</strong> command line
option must be used. One problem when running a device server without
the database is to pass device name(s) to the device server. Within
Tango, it is possible to define these device names at two different
levels :</p>
<ol class="arabic simple">
<li>At the command line with the <strong>-dlist</strong> option: In case of device
server with several device pattern implementation, the device name
list given at command line is only for the last device pattern
created in the <em>class_factory()</em> method. In the device name list,
the device name separator is the comma character.</li>
<li>At the device pattern implementation level: In the class inherited
from the Tango::DeviceClass class via the re-definition of a well
defined method called <em>device_name_factory()</em></li>
</ol>
<p>If none of these two possibilities is used, the tango core classes
defined one default device name for each device pattern implementation.
This default device name is <em>NoName</em>. Device definition at the command
line has the highest priority.</p>
<div class="section" id="example-of-device-server-started-without-database-usage">
<h3><a class="toc-backref" href="#id295">Example of device server started without database usage</a></h3>
<p>Without database, you need to start a Tango device server on a
pre-defined port, and you must use one of the underlying ORB option
called <em>endPoint</em> like</p>
<p>myserver myinstance_name -ORBendPoint giop:tcp::&lt;port number&gt; -nodb
-dlist a/b/c</p>
<p>The following is two examples of starting a device server not using the
database when the <em>device_name_factory()</em> method is not re-defined.</p>
<ul>
<li><div class="first line-block">
<div class="line">StepperMotor et -nodb -dlist id11/motor/1,id11/motor/2</div>
<div class="line">This command line starts the device server with two devices named
<em>id11/motor/1</em> and <em>id11/motor/2</em></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">StepperMotor et -nodb</div>
<div class="line">This command line starts a device server with one device named
<em>NoName</em></div>
</div>
</li>
</ul>
<p>When the <em>device_name_factory()</em> method is re-defined within the
StepperMotorClass class.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="keyword type">void</span> <span class="name">StepperMotorClass</span><span class="operator">::</span><span class="name">device_name_factory</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">list</span><span class="punctuation">)</span>
<span class="ln">2 </span>  <span class="punctuation">{</span>
<span class="ln">3 </span>      <span class="name">list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;sr/cav-tuner/1&quot;</span><span class="punctuation">);</span>
<span class="ln">4 </span>      <span class="name">list</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;sr/cav-tuner/2&quot;</span><span class="punctuation">);</span>
<span class="ln">5 </span>  <span class="punctuation">}</span>
</pre>
<ul>
<li><div class="first line-block">
<div class="line">StepperMotor et -nodb</div>
<div class="line">This commands starts a device server with two devices named
<em>sr/cav-tuner/1</em> and <em>sr/cav-tuner/2</em>.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">StepperMotor et -nodb -dlist id12/motor/1</div>
<div class="line">Starts a device server with only one device named id12/motor/1</div>
</div>
</li>
</ul>
</div>
<div class="section" id="connecting-client-to-device-within-a-device-server-started-without-database">
<h3><a class="toc-backref" href="#id296">Connecting client to device within a device server started without database</a></h3>
<p>In this case, the host and port on which the device server is running
are part of the device name. If the device name is <em>a/b/c</em>, the host is
<em>mycomputer</em> and the port <em>1234</em>, the device name to be used by client
is</p>
<p>mycomputer:1234/a/b/c#dbase=no</p>
<p>See appendix [DeviceNaming] for all details about Tango object naming.</p>
</div>
</div>
<div class="section" id="multiple-database-servers-within-a-tango-control-system">
<h2><a class="toc-backref" href="#id297">Multiple database servers within a Tango control system</a></h2>
<p>Tango uses MySQL as database and allows access to this database via a
specific Tango device server. It is possible for the same Tango control
system to have several Tango database servers. The host name and port
number of the database server is known via the TANGO_HOST environment
variable. If you want to start several database servers in order to
prevent server crash, use the following TANGO_HOST syntax</p>
<p>TANGO_HOST=&lt;host_1&gt;:&lt;port_1&gt;,&lt;host_2&gt;:&lt;port_2&gt;,&lt;host_3&gt;:&lt;port_3&gt;</p>
<p>All calls to the database server will automatically switch to a running
servers in the given list if the one used dies.</p>
</div>
<div class="section" id="the-tango-controlled-access-system">
<h2><a class="toc-backref" href="#id298">The Tango controlled access system</a></h2>
<div class="section" id="user-rights-definition">
<h3><a class="toc-backref" href="#id299">User rights definition</a></h3>
<p>Within the Tango controlled system, you give rights to a user. User is
the name of the user used to log-in the computer where the application
trying to access a device is running. Two kind of users are defined:</p>
<ol class="arabic simple">
<li>Users with defined rights</li>
<li>Users without any rights defined in the controlled system. These
users will have the rights associated with the pseudo-user called All
Users</li>
</ol>
<p>The controlled system manages two kind of rights:</p>
<ul class="simple">
<li>Write access meaning that all type of requests are allowed on the
device</li>
<li>Read access meaning that only read-like access are allowed
(write_attribute, write_read_attribute and set_attribute_config
network calls are forbidden). Executing a command is also forbidden
except for commands defined as <strong>Allowed commands</strong>. Getting a device
state or status using the command_inout call is always allowed. The
definition of the allowed commands is done at the device class level.
Therefore, all devices belonging to the same class will have the
allowed commands set.</li>
</ul>
<p>The rights given to a user is the check result splitted in two levels:</p>
<ol class="arabic simple">
<li>At the host level: You define from which hosts the user may have
write access to the control system by specifying the host name. If
the request comes from a host which is not defined, the right will be
Read access. If nothing is defined at this level for the user, the
rights of the All Users user will be used. It is also possible to
specify the host by its IP address. You can define a host family
using wide-card in the IP address (eg. 160.103.11.* meaning any host
with IP address starting with 160.103.11). Only IP V4 is supported.</li>
<li>At the device level: You define on which device(s) request are
allowed using device name. Device family can be used using widecard
in device name like domin/family/*</li>
</ol>
<p>Therefore, the controlled system is doing the following checks when a
client try to access a device:</p>
<ul class="simple">
<li>Get the user name</li>
<li>Get the host IP address</li>
<li>If rights defined at host level for this specific user and this IP
address, gives user temporary write acccess to the control system</li>
<li>If nothing is specified for this specific user on this host, gives to
the user a temporary access right equal to the host access rights of
the All User user.</li>
<li>If the temporary right given to the user is write access to the
control system<ul>
<li>If something defined at device level for this specific user<ul>
<li>If there is a right defined for the device to be accessed (or
for the device family), give user the defined right</li>
<li>Else<ul>
<li>If rights defined for the All Users user for this device,
give this right to the user</li>
<li>Else, give user the Read Access for this device</li>
</ul>
</li>
</ul>
</li>
<li>Else<ul>
<li>If there is a right defined for the device to be accessed (or
for the device family) for the All User user, give user this
right</li>
<li>Else, give user the Read Access right for this device</li>
</ul>
</li>
</ul>
</li>
<li>Else, access right will be Read Access</li>
</ul>
<p>Then, when the client tries to access the device, the following
algorithm is used:</p>
<ul class="simple">
<li>If right is Read Access<ul>
<li>If the call is a write type call, refuse the call</li>
<li>If the call is a command execution<ul>
<li>If the command is one of the command defined in the Allowed
commands for the device class, send the call</li>
<li>Else, refuse the call</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>All these checks are done during the DeviceProxy instance constructor
except those related to the device class allowed commands which are
checked during the command_inout call.</p>
<p>To simplify the rights management, give the All Users user host access
right to all hosts (.*.*.*) and read access to all devices (/*/*).
With such a set-up for this user, each new user without any rights
defined in the controlled access will have only Read Access to all
devices on the control system but from any hosts. Then, on request,
gives Write Access to specific user on specific host (or family) and on
specific device (or family).</p>
<p>The rights managements are done using the Tango
Astor:raw-latex:<cite>cite{Astor_doc}</cite> tool which has some graphical windows
allowing to grant/revoke user rights and to define device class allowed
commands set. The following window dump shows this Astor window.</p>
<p><img alt="image" src="dance/AT97-65-size" /></p>
<p>In this example, the user taurel has Write Access to the device
sr/d-ct/1 and to all devices belonging to the domain fe but only from
the host pcantares He has read access to all other devices but always
only from the host pcantares. The user verdier has write access to the
device sys/dev/01 from any host on the network 160.103.5 and Read Access
to all the remaining devices from the same network. All the other users
has only Read Access but from any host.</p>
</div>
<div class="section" id="running-a-tango-control-system-with-the-controlled-access">
<h3><a class="toc-backref" href="#id300">Running a Tango control system with the controlled access</a></h3>
<p>All the users rights are stored in two tables of the Tango database. A
dedicated device server called <strong>TangoAccessControl</strong> access these
tables without using the classical Tango database server. This
TangoAccessControl device server must be configured with only one
device. The property <strong>Services</strong> belonging to the free object
<strong>CtrlSystem</strong> is used to run a Tango control system with its controlled
access. This property is an array of string with each string describing
the service(s) running in the control system. For controlled access, the
service name is AccessControl. The service instance name has to be
defined as tango. The device name associated with this service must be
the name of the TangoAccessControl server device. For instance, if the
TangoAccessControl device server device is named
<em>sys/access_control/1</em>, one element of the Services property of the
CtrlSystem object has to be set to</p>
<p>AccessControl/tango:sys/access_control/1</p>
<p>If the service is defined but without a valid device name corresponding
to the TangoAccessControl device server, all users from any host will
have write access (simulating a Tango control system without controlled
access). Note that this device server connects to the MySQL database and
therefore may need the MySQL connection related environment variables
MYSQL_USER and MYSQL_PASSWORD described in [sub:Db-Env-Variables]</p>
<p>Even if a controlled access system is running, it is possible to by-pass
it if, in the environment of the client application, the environment
variable SUPER_TANGO is defined to true. If for one reason or another,
the controlled access server is defined but not accessible, the device
right checked at that time will be Read Access.</p>
<p>[FourRicardo]|image|</p>
</div>
</div>
</div>
<div class="section" id="reference-part">
<h1><a class="toc-backref" href="#id301">Reference part</a></h1>
<p><strong>This chapter is only part of the TANGO device server reference guide.
To get reference documentation about the C++ library classes, see
:raw-latex:`cite{TANGO_ref_man}`. To get reference documentation about
the Java classes, also see :raw-latex:`cite{TANGO_ref_man}`.</strong></p>
<div class="section" id="device-parameter">
<h2><a class="toc-backref" href="#id302">Device parameter</a></h2>
<p>A black box, a device description field, a device state and status are
associated with each TANGO device.</p>
<div class="section" id="the-device-black-box">
<h3><a class="toc-backref" href="#id303">The device black box</a></h3>
<p>The device black box is managed as a circular buffer. It is possible to
tune the buffer depth via a device property. This property name is</p>
<p>device name-&gt;blackbox_depth</p>
<p>A default value is hard-coded to 50 if the property is not defined. This
black box depth property is retrieved from the Tango property database
during the device creation phase.</p>
</div>
<div class="section" id="the-device-description-field">
<h3><a class="toc-backref" href="#id304">The device description field</a></h3>
<p>There are two ways to intialise the device description field.</p>
<ul>
<li><p class="first">At device creation time. Some constructors of the DeviceImpl class
supports this field as parameter. If these constructor are not used,
the device description field is set to a default value which is <em>A
Tango device</em>.</p>
</li>
<li><p class="first">With a property. A description field defines with this method
overrides a device description defined at construction time. The
property name is</p>
<p>device name-&gt;description</p>
</li>
</ul>
</div>
<div class="section" id="the-device-state-and-status">
<h3><a class="toc-backref" href="#id305">The device state and status</a></h3>
<p>Some constructors of the DeviceImpl class allows the initialisation of
device state and/or status or device creation time. If these fields are
not defined, a default value is applied. The default state is
Tango::UNKOWN, the default status is <em>Not Initialised.</em></p>
</div>
<div class="section" id="id58">
<h3><a class="toc-backref" href="#id306">The device polling</a></h3>
<p>Seven device properties allow the polling tunning. These properties are
described in the following table</p>
<dl class="docutils">
<dt>|c|c|c| Property name &amp; property rule &amp; default value</dt>
<dd>poll_ring_depth &amp; Polling buffer depth &amp; 10
cmd_poll_ring_depth &amp; Cmd polling buffer depth &amp;
attr_poll_ring_depth &amp; Attr polling buffer depth &amp;
poll_old_factor &amp; Data too old factor &amp; 4
min_poll_period &amp; Minimun polling period &amp;
cmd_min_poll_period &amp; Min. polling period for cmd &amp;
attr_min_poll_period &amp; Min. polling period for attr &amp;</dd>
</dl>
<p>The rule of the poll_ring_depth property is obvious. It defines the
polling ring depth for all the device polled command(s) and
attribute(s). Nevertheless, when filling the polling buffer via the
fill_cmd_polling_buffer() (or fill_attr_polling_buffer()) method,
it could be helpfull to define specific polling ring depth for a command
(or an attribute). This is the rule of the cmd_poll_ring_depth and
attr_poll_ring_depth properties. For each polled object with specific
polling depth (command or attribute), the syntax of this property is the
object name followed by the ring depth (ie State,20,Status,15). If one
of these properties is defined, for the specific command or attribute,
it will overwrite the value set by the poll_ring_depth property. The
poll_old_factor property allows the user to tune how long the data
recorded in the polling buffer are valid. Each time some data are read
from the polling buffer, a check is done between the date when the data
were recorded in the polling buffer and the date when the user request
these data. If the interval is greater than the object polling period
multiply by the value of the poll_old_factor factory, an exception is
returned to the caller. These two properties are defined at device level
and therefore, it is not possible to tune this parameter for each polled
object (command or attribute). The last 3 properties are dedicated to
define a polling period minimum threshold. The property
min_poll_period defines in (mS) a device minimum polling period.
Property cmd_min_poll_period defines (in mS) a minimum polling period
for a specific command. The syntax of this property is the command name
followed by the minimum polling period (ie MyCmd,400). Property
attr_min_poll_period defines (in mS) a minimum polling period for a
specific attribute. The syntax of this property is the attribute name
followed by the minimum polling period (ie MyAttr,600). These two
properties has a higher priority than the min_poll_period property. By
default these three properties are not defined mening that there is no
minimun polling period.</p>
<p>Four other properties are used by the Tango core classes to manage the
polling thread. These properties are :</p>
<ul class="simple">
<li>polled_cmd to memorize the name of the device polled command</li>
<li>polled_attr to memorize the name of the device polled attribute</li>
<li>non_auto_polled_cmd to memorize the name of the command which
shoule not be polled automatically at the first request</li>
<li>non_auto_polled_attr to memorize the name of the attribute which
should not be polled automatically at the first request</li>
</ul>
<p>You don’t have to change these properties values by yourself. They are
automatically created/modified/deleted by Tango core classes.</p>
</div>
<div class="section" id="the-device-logging">
<h3><a class="toc-backref" href="#id307">The device logging</a></h3>
<p>The Tango Logging Service (TLS) uses device properties to control device
logging at startup (static configuration). These properties are
described in the following table</p>
<dl class="docutils">
<dt>|c|c|c| Property name &amp; property rule &amp; default value</dt>
<dd>logging_level &amp; Initial device logging level &amp; WARN
logging_target &amp; Initial device logging target &amp; No default
logging_rft &amp; Logging rolling file threshold &amp; 20 Mega bytes
logging_path &amp; Logging file path &amp;
&amp; &amp; C:/tango-&lt;logging name&gt; (Windows)</dd>
</dl>
<ul>
<li><p class="first">The logging_level property controls the initial logging level of a
device. Its set of possible values is: OFF, FATAL, ERROR, WARN, INFO
or DEBUG. This property is overwritten by the verbose command line
option (-v).</p>
</li>
<li><p class="first">The logging_target property is a multi-valued property containing
the initial target list. Each entry must have the following format:
target_type::target_name (where target_type is one of the
supported target types and target_name, the name of the target).
Supported target types are: <em>console</em>, <em>file</em> and <em>device</em>. For a
device target, target_name must contain the name of a log consumer
device (as defined in [sec:Tango-log-consumer]). For a file target,
target_name is the name of the file to log to. If omitted the
device’s name is used to build the file name
(domain_family_member.log). Finally, target_name is ignored in the
case of a console target. The TLS does not report any error occurred
while trying to setup the initial targets.</p>
<ul>
<li><div class="first line-block">
<div class="line">Logging_target property example :</div>
<div class="line">logging_target = [ console, file, <a class="reference external" href="file::/home/me/mydevice.log">file::/home/me/mydevice.log</a>,
device::tmp/log/1</div>
<div class="line">In this case, the device will automatically logs to the standard
output, to its default file (which is something like
domain_family_member.log), to a file named mydevice.log and
located in /home/me. Finally, the device logs are also sent to a
log consumer device named tmp/log/1.</div>
</div>
</li>
</ul>
</li>
<li><p class="first">The logging_rft property specifies the rolling file threshold (rft),
of the device’s file targets. This threshold is expressed in Kb. When
the size of a log file reaches the so-called rolling-file-threshold
(rft), it is backuped as <em>current_log_file_name</em> + <em>_1</em> and a new
current_log_file_name is opened. Obviously, there is only one
backup file at a time (i.e. any existing backup is destroyed before
the current log file is backuped). The default threshold is 20 Mb,
the minimum is 500 Kb and the maximum is 1000 Mb.</p>
</li>
<li><p class="first">The logging_path property overwrites the TANGO_LOG_PATH
environment variable. This property can only be applied to a DServer
class device and has no effect on other devices.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="device-attribute">
<h2><a class="toc-backref" href="#id308">Device attribute</a></h2>
<p>Attribute are configured with two kind of parameters: Parameters
hard-coded in source code and modifiable parameters</p>
<div class="section" id="hard-coded-device-attribute-parameters">
<h3><a class="toc-backref" href="#id309">Hard-coded device attribute parameters</a></h3>
<p>Seven attribute parameters are defined at attribute creation time in the
Tango class source code. Obviously, these parameters are not modifiable
except with a new source code compilation. These parameters are</p>
<dl class="docutils">
<dt>|c|c| Parameter name &amp; Parameter description</dt>
<dd>name &amp; Attribute name
data_type &amp; Attribute data type
data_format &amp; Attribute data format
writable &amp; Attribute read/write type
max_dim_x &amp; Maximum X dimension
max_dim_y &amp; Maximum Y dimension
writable_attr_name &amp; Associated write attribute
level &amp; Attribute display level
root_attr_name &amp; Root attribute name</dd>
</dl>
<div class="section" id="the-attribute-data-type">
<h4>The Attribute data type</h4>
<p>Thirteen data types are supported. These data types are</p>
<ul class="simple">
<li>Tango::DevBoolean</li>
<li>Tango::DevShort</li>
<li>Tango::DevLong</li>
<li>Tango::DevLong64</li>
<li>Tango::DevFloat</li>
<li>Tango::DevDouble</li>
<li>Tango::DevUChar</li>
<li>Tango::DevUShort</li>
<li>Tango::DevULong</li>
<li>Tango::DevULong64</li>
<li>Tango::DevString</li>
<li>Tango::DevState</li>
<li>Tango::DevEncoded</li>
</ul>
</div>
<div class="section" id="the-attribute-data-format">
<h4>The attribute data format</h4>
<p>Three data format are supported for attribute</p>
<dl class="docutils">
<dt>|c|c| Format &amp; Description</dt>
<dd>Tango::SCALAR &amp; The attribute value is a single number
Tango::SPECTRUM &amp; The attribute value is a one dimension number
Tango::IMAGE &amp; The attribute value is a two dimension number</dd>
</dl>
</div>
<div class="section" id="the-max-dim-x-and-max-dim-y-parameters">
<h4>The max_dim_x and max_dim_y parameters</h4>
<p>These two parameters defined the maximum size for attributes of the
SPECTRUM and IMAGE data format.</p>
<dl class="docutils">
<dt>|c|c|c| data format &amp; max_dim_x &amp; max_dim_y</dt>
<dd>Tango::SCALAR &amp; 1 &amp; 0
Tango::SPECTRUM &amp; User Defined &amp; 0
Tango::IMAGE &amp; User Defined &amp; User Defined</dd>
</dl>
<p>For attribute of the Tango::IMAGE data format, all the data are also
returned in a one dimension array. The first array is value[0],[0],
array element X is value[0],[X-1], array element X+1 is value[1][0] and
so forth.</p>
</div>
<div class="section" id="the-attribute-read-write-type">
<h4>The attribute read/write type</h4>
<p>Tango supports four kind of read/write attribute which are :</p>
<ul class="simple">
<li>Tango::READ for read only attribute</li>
<li>Tango::WRITE for writable attribute</li>
<li>Tango::READ_WRITE for attribute which can be read and write</li>
<li>Tango::READ_WITH_WRITE for a readable attribute associated to a
writable attribute (For a power supply device, the current really
generated is not the wanted current. To handle this, two attributes
are defined which are <em>generated_current</em> and <em>wanted_current</em>. The
<em>wanted_current</em> is a Tango::WRITE attribute. When the
<em>generated_current</em> attribute is read, it is very convenient to also
get the <em>wanted_current</em> attribute. This is exactly what the
Tango::READ_WITH_WRITE attribute is doing)</li>
</ul>
<p>When read, attribute values are always returned within an array even for
scalar attribute. The length of this array and the meaning of its
elements is detailed in the following table for scalar attribute.</p>
<dl class="docutils">
<dt>|c|c|c|c| Name &amp; Array length &amp; Array[0] &amp; Array[1]</dt>
<dd>Tango::READ &amp; 1 &amp; Read value &amp;
Tango::WRITE &amp; 1 &amp; Last write value &amp;
Tango::READ_WRITE &amp; 2 &amp; Read value &amp; Last write value
Tango::READ_WITH_WRITE &amp; 2 &amp; Read value &amp; Associated attributelast</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 11391)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>write value</p>
<p>When a spectrum or image attribute is read, it is possible to code the
device class in order to send only some part of the attribute data (For
instance only a Region Of Interest for an image) but never more than
what is defined by the attribute configuration parameters max_dim_x
and max_dim_y. The number of data sent is also transferred with the
data and is named <strong>dim_x</strong> and <strong>dim_y</strong>. When a spectrum or image
attribute is written, it is also possible to send only some of the
attribute data but always less than max_dim_x for spectrum and
max_dim_x * max_dim_y for image. The following table describe how
data are returned for spectrum attribute. dim_x is the data size sent
by the server when the attribute is read and dim_x_w is the data size
used during the last attribute write call.</p>
<p>|c|c|c|c| Name &amp; Array length &amp; Array[0-&gt;dim_x-1] &amp; Array[dim_x
-&gt; dim_x + dim_x_w -1]</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 11408)</p>
Unexpected indentation.</div>
<blockquote>
Tango::READ &amp; dim_x &amp; Read values &amp;
Tango::WRITE &amp; dim_x_w &amp; Last write values &amp;
Tango::READ_WRITE &amp; dim_x + dim_x_w &amp; Read value &amp; Last write</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 11411)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<dl class="docutils">
<dt>values</dt>
<dd>Tango::READ_WITH_WRITE &amp; dim_x + dim_x_w &amp; Read value &amp; Associated</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 11413)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>attributelast write values</p>
<p>The following table describe how data are returned for image attribute.
dim_r is the data size sent by the server when the attribute is read
(dim_x * dim_y) and dim_w is the data size used during the last
attribute write call (dim_x_w * dim_y_w).</p>
<p>|c|c|c|c| Name &amp; Array length &amp; Array[0-&gt;dim_r-1] &amp; Array[dim_r-&gt;
dim_r + dim_w -1]</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 11422)</p>
Unexpected indentation.</div>
<blockquote>
Tango::READ &amp; dim_r &amp; Read values &amp;
Tango::WRITE &amp; dim_w &amp; Last write values &amp;
Tango::READ_WRITE &amp; dim_r + dim_w &amp; Read value &amp; Last write values
Tango::READ_WITH_WRITE &amp; dim_r + dim_w &amp; Read value &amp; Associated</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 11426)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<p>attributelast write values</p>
<p>Until a write operation has been performed, the last write value is
initialized to <em>0</em> for scalar attribute of the numeriacal type, to <em>Not
Initialised</em> for scalar string attribute and to <em>true</em> for scalar
boolean attribute. For spectrum or image attribute, the last write value
is initialized to an array of one element set to <em>0</em> for numerical type,
to an array of one element set to <em>true</em> for boolean attribute and to an
array of one element set to <em>Not initialized</em> for string attribute</p>
</div>
<div class="section" id="the-associated-write-attribute-parameter">
<h4>The associated write attribute parameter</h4>
<p>This parameter has a meaning only for attribute with a
Tango::READ_WITH_WRITE read/write type. This is the name of the
associated write attribute.</p>
</div>
<div class="section" id="the-attribute-display-level-parameter">
<h4>The attribute display level parameter</h4>
<p>This parameter is only an help for graphical application. It is a C++
enumeration starting at 0. The code associated with each attribute
display level is defined in the following table (Tango::DispLevel).</p>
<dl class="docutils">
<dt>|c|c| name &amp; Value</dt>
<dd>Tango::OPERATOR &amp; 0
Tango::EXPERT &amp; 1</dd>
</dl>
<p>This parameter allows a graphical application to support two types of
operation :</p>
<ul class="simple">
<li>An operator mode for day to day operation</li>
<li>An expert mode when tuning is necessary</li>
</ul>
<p>According to this parameter, a graphical application knows if the
attribute is for the operator mode or for the expert mode.</p>
</div>
<div class="section" id="the-root-attribute-name-parameter">
<h4>The root attribute name parameter</h4>
<p>In case the attribute is a forwarded one, this parameter is the name of
the associated root attribute. In case of classical attribute, this
string is set to Not specified.</p>
</div>
</div>
<div class="section" id="modifiable-attribute-parameters">
<h3><a class="toc-backref" href="#id310">Modifiable attribute parameters</a></h3>
<p>Each attribute has a configuration set of 20 modifiable parameters.
These can be grouped in three different purposes:</p>
<ol class="arabic simple">
<li>General purpose parameters</li>
<li>Alarm related parameters</li>
<li>Event related parameters</li>
</ol>
<div class="section" id="general-purpose-parameters">
<h4>General purpose parameters</h4>
<p>Eight attribute parameters are modifiable at run-time via a device call
or via the property database.</p>
<dl class="docutils">
<dt>|c|c| Parameter name &amp; Parameter description</dt>
<dd>description &amp; Attribute description
label &amp; Attribute label
unit &amp; Attribute unit
standard_unit &amp; Conversion factor to MKSA unit
display_unit &amp; The attribute unit in a printable form
format &amp; How to print attribute value
min_value &amp; Attribute min value
max_value &amp; Attribute max value
enum_labels &amp; Enumerated labels
memorized &amp; Attribute memorization</dd>
</dl>
<p>The <strong>description</strong> parameter describes the attribute. The <strong>label</strong>
parameter is used by graphical application to display a label when this
attribute is used in a graphical application. The <strong>unit</strong> parameter is
the attribute value unit. The <strong>standard_unit</strong> parameter is the
conversion factor to get attribute value in MKSA units. Even if this
parameter is a number, it is returned as a string by the device
<em>get_attribute_config</em> call. The <strong>display_unit</strong> parameter is the
string used by graphical application to display attribute unit to
application user. The <strong>enum_labels</strong> parameter is defined only for
attribute of the DEV_ENUM data type. This is a vector of strings with
one string for each enumeration label. It is an ordered list.</p>
<div class="section" id="the-format-attribute-parameter">
<h5>The format attribute parameter</h5>
<p>This parameter specifies how the attribute value should be printed. It
is not valid for string attribute. This format is a string of C++
streams manipulators separated by the <strong>;</strong> character. The supported
manipulators are :</p>
<ul class="simple">
<li>fixed</li>
<li>scientific</li>
<li>uppercase</li>
<li>showpoint</li>
<li>showpos</li>
<li>setprecision()</li>
<li>setw()</li>
</ul>
<p>Their definition are the same than for C++ streams. An example of format
parameter is</p>
<p>scientific;uppercase;setprecision(3)</p>
<p>. A class called Tango::AttrManip has been written to handle this format
string. Once the attribute format string has been retrieved from the
device, its value can be printed with</p>
<p>cout &lt;&lt; Tango::AttrManip(format) &lt;&lt; value &lt;&lt; endl;</p>
<p>.</p>
</div>
<div class="section" id="the-min-value-and-max-value-parameters">
<h5>The min_value and max_value parameters</h5>
<p>These two parameters have a meaning only for attribute of the
Tango::WRITE read/write type and for numerical data types. Trying to set
the value of an attribute to something less than or equal to the
min_value parameter is an error. Trying to set the value of the
attribute to something more or equal to the max_value parameter is also
an error. Even if these parameters are numbers, they are returned as
strings by the device <em>get_attribute_config()</em> call.</p>
<p>These two parameters have no meaning for attribute with data type
DevString, DevBoolean or DevState. An exception is thrown in case the
user try to set them for attribute of these 3 data types.</p>
</div>
<div class="section" id="the-memorized-attribute-parameter">
<h5>The memorized attribute parameter</h5>
<p>This parameter describes the attribute memorization. It is an
enumeration with the following values:</p>
<ul class="simple">
<li>NOT_KNOWN : The device is too old to return this information.</li>
<li>NONE : The attribute is not memorized</li>
<li>MEMORIZED : The attribute is memorized</li>
<li>MEMORIZED_WRITE_INIT : The attribute is memorized and the memorized
value is applied at device initialization time.</li>
</ul>
</div>
</div>
<div class="section" id="the-alarm-related-configuration-parameters">
<h4>The alarm related configuration parameters</h4>
<p>Six alarm related attribute parameters are modifiable at run-time via a
device call or via the property database.</p>
<dl class="docutils">
<dt>|c|c| Parameter name &amp; Parameter description</dt>
<dd>min_alarm &amp; Attribute low level alarm
max_alarm &amp; Attribute high level alarm
min_warning &amp; Attribute low level warning
max_warning &amp; Attribute high level warning
delta_t &amp; delta time for RDS alarm (mS)
delta_val &amp; delta value for RDS alarm (absolute)</dd>
</dl>
<p>These parameters have no meaning for attribute with data type DevString,
DevBoolean or DevState. An exception is thrown in case the user try to
set them for attribute of these 3 data types.</p>
<div class="section" id="the-min-alarm-and-max-alarm-parameters">
<h5>The min_alarm and max_alarm parameters</h5>
<p>These two parameters have a meaning only for attribute of the
Tango::READ, Tango::READ_WRITE and Tango::READ_WITH_WRITE read/write
type and for numerical data type. When the attribute is read, if its
value is something less than or equal to the min_alarm parameter or if
it is something more or equal to the max_alarm parameter, the attribute
quality factor will be set to Tango::ATTR_ALARM and if the device state
is Tango::ON, it is switched to Tango::ALARM. Even if these parameters
are numbers, they are returned as strings by the device
<em>get_attribute_config()</em> call.</p>
</div>
<div class="section" id="the-min-warning-and-max-warning-parameters">
<h5>The min_warning and max_warning parameters</h5>
<p>These two parameters have a meaning only for attribute of the
Tango::READ, Tango::READ_WRITE and Tango::READ_WITH_WRITE read/write
type and for numerical data type. When the attribute is read, if its
value is something less than or equal to the min_warning parameter or
if it is something more or equal to the max_warning parameter, the
attribute quality factor will be set to Tango::ATTR_WARNING and if the
device state is Tango::ON, it is switched to Tango::ALARM. Even if these
parameters are numbers, they are returned as strings by the device
<em>get_attribute_config()</em> call.</p>
</div>
<div class="section" id="the-delta-t-and-delta-val-parameters">
<h5>The delta_t and delta_val parameters</h5>
<p>These two parameters have a meaning only for attribute of the
Tango::READ_WRITE and Tango::READ_WITH_WRITE read/write type and for
numerical data type. They specify if and how the RDS alarm is used. When
the attribute is read, if the difference between its read value and the
last written value is something more than or equal to the delta_val
parameter and if at least delta_val milli seconds occurs since the last
write operation, the attribute quality factor will be set to
Tango::ATTR_ALARM and if the device state is Tango::ON, it is switched
to Tango::ALARM. Even if these parameters are numbers, they are returned
as strings by the device <em>get_attribute_config()</em> call.</p>
</div>
</div>
<div class="section" id="the-event-related-configuration-parameters">
<h4>The event related configuration parameters</h4>
<p>Six event related attribute parameters are modifiable at run-time via a
device call or via the property database.</p>
<dl class="docutils">
<dt>|c|c| Parameter name &amp; Parameter description</dt>
<dd>rel_change &amp; Relative change triggering change event
abs_change &amp; Absolute change triggering change event
period &amp; Period for periodic event
archive_rel_change &amp; Relative change for archive event
archive_abs_change &amp; Absolute change for archive event
archive_period &amp; Period for change archive event</dd>
</dl>
<div class="section" id="the-rel-change-and-abs-change-parameters">
<h5>The rel_change and abs_change parameters</h5>
<p>Rel_change is a property with a maximum of 2 values (comma separated).
It specifies the increasing and decreasing relative change of the
attribute value (w.r.t. the value of the previous change event) which
will trigger the event. If the attribute is a spectrum or an image then
a change event is generated if any one of the attribute value’s
satisfies the above criterium. It’s the absolute value of these values
which is taken into account. If only one value is specified then it is
used for the increasing and decreasing change.</p>
<p>Abs_change is a property of maximum 2 values (comma separated). It
specifies the increasing and decreasing absolute change of the attribute
value (w.r.t the value of the previous change event) which will trigger
the event. If the attribute is a spectrum or an image then a change
event is generated if any one of the attribute value’s satisfies the
above criterium. If only one value is specified then it is used for the
increasing and decreasing change. If no values are specified then the
relative change is used.</p>
</div>
<div class="section" id="the-periodic-period-parameter">
<h5>The periodic period parameter</h5>
<p>The minimum time between events (in milliseconds). If no property is
specified then a default value of 1 second is used.</p>
</div>
<div class="section" id="the-archive-rel-change-archive-abs-change-and-archive-period-parameters">
<h5>The archive_rel_change, archive_abs_change and archive_period parameters</h5>
<p>archive_rel_change is an array property of maximum 2 values which
specifies the positive and negative relative change w.r.t. the previous
attribute value which will trigger the event. If the attribute is a
spectrum or an image then an archive event is generated if any one of
the attribute value’s satisfies the above criterium. If only one
property is specified then it is used for the positive and negative
change. If no properties are specified then a default fo +-10% is used</p>
<p>archive_abs_change is an array property of maximum 2 values which
specifies the positive and negative absolute change w.r.t the previous
attribute value which will trigger the event. If the attribute is a
spectrum or an image then an archive event is generated if any one of
the attribute value’s satisfies the above criterium. If only one
property is specified then it is used for the positive and negative
change. If no properties are specified then the relative change is used.</p>
<p>archive_period is the minimum time between archive events (in
milliseconds). If no property is specified, no periodic archiving events
are send.</p>
</div>
</div>
</div>
<div class="section" id="setting-modifiable-attribute-parameters">
<h3><a class="toc-backref" href="#id311">Setting modifiable attribute parameters</a></h3>
<p>A default value is given to all modifiable attribute parameters by the
Tango core classes. Nevertheless, it is possible to modify these values
in source code at attribute creation time or via the database. Values
retrieved from the database have a higher priority than values given at
attribute creation time. The attribute parameters are therefore
initialized from:</p>
<ol class="arabic simple">
<li>The Database</li>
<li>If nothing in database, from the Tango class default</li>
<li>If nothing in database nor in Tango class default, from the library
default value</li>
</ol>
<p>The default value set by the Tango core library are</p>
<dl class="docutils">
<dt>|c|c|c| Parameter type &amp; Parameter name &amp; Library default value</dt>
<dd>&amp; description &amp; No description
&amp; label &amp; attribute name
&amp; unit &amp; One empty string
&amp; standard_unit &amp; No standard unit
&amp; display_unit &amp; No display unit
&amp; format &amp; 6 characters with 2 decimal
&amp; min_value &amp; Not specified
&amp; max_value &amp; Not specified
&amp; min_alarm &amp; Not specified
&amp; max_alarm &amp; Not specified
&amp; min_warning &amp; Not specified
&amp; max_warning &amp; Not specified
&amp; delta_t &amp; Not specified
&amp; delta_val &amp; Not specified
&amp; rel_change &amp; Not specified
&amp; abs_change &amp; Not specified
&amp; period &amp; 1000 (mS)
&amp; archive_rel_change &amp; Not specified
&amp; archive_abs_change &amp; Not specified
&amp; archive_period &amp; Not specified</dd>
</dl>
<p>It is possible to set modifiable parameters via the database at two
levels :</p>
<ol class="arabic simple">
<li>At class level</li>
<li>At device level. Each device attribute have all its modifiable
parameters sets to the value defined at class level. If the setting
defined at class level is not correct for one device, it is possible
to re-define it.</li>
</ol>
<p>If we take the example of a class called <em>BumperPowerSupply</em> with three
devices called <em>sr/bump/1</em>, <em>sr/bump/2</em> and <em>sr/bump/3</em> and one
attribute called <em>wanted_current</em>. For the first two bumpers, the
max_value is equal to 500. For the third one, the max_value is only
400. If the max_value parameter is defined at class level with the
value 500, all devices will have 500 as max_value for the
<em>wanted_current</em> attribute. It is necessary to re-defined this
parameter at device level in order to have the max_value for device
sr/bump/3 set to 400.</p>
<p>For the description, label, unit, standard_unit, display_unit and
format parameters, it is possible to return them to their default value
by setting them to an empty string.</p>
</div>
<div class="section" id="resetting-modifiable-attribute-parameters">
<h3><a class="toc-backref" href="#id312">Resetting modifiable attribute parameters</a></h3>
<p>It is possible to reset attribute parameters to their default value at
any moment. This could be done via the network call available through
the DeviceProxy::set_attribute_config() method family. This call takes
attribute parameters as strings. The following table describes which
string has to be used to reset attribute parameters to their default
value. In this table, the user default are the values given within Pogo
in the Properties tab of the attribute edition window (or in in Tango
class code using the Tango::UserDefaultAttrProp class).</p>
<dl class="docutils">
<dt>|c|c| Input string &amp; Action</dt>
<dd>Not specified &amp; Reset to <strong>library</strong> default
&amp;
&amp;
&amp; Reset to Tango <strong>class</strong> default if any
&amp; Otherwise, reset to <strong>user</strong> default (if any) or to <strong>library</strong></dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 11783)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>default</p>
<p>Let’s take one exemple: For one attribute belonging to a device, we have
the following attribute parameters:</p>
<dl class="docutils">
<dt>|c|c|c|c| Parameter name &amp; Def. class &amp; Def. user &amp; Def. lib</dt>
<dd>standard_unit &amp; &amp; &amp; No standard unit
min_value &amp; &amp; 5 &amp; Not specified
max_value &amp; 50 &amp; &amp; Not specified
rel_change &amp; 5 &amp; 10 &amp; Not specified</dd>
</dl>
<p>The string Not specified sent to each attribute parameter will set
attribute parameter value to No standard unit for standard_unit, Not
specified for min_value, Not specified for max_value and Not specified
as well for rel_change. The empty string sent to each attribute
parameter will result with No stanadard unit for standard_unit, 5 for
min_value, Not specified for max_value and 10 for rel_change. The
string NaN will give No standard unit for standard_unit, 5 for
min_value, 50 for max_value and 5 for rel_change.</p>
<p>C++ specific: Instead of the string Not specified and NaN, the
preprocessor define <strong>AlrmValueNotSpec</strong> and <strong>NotANumber</strong> can be used.</p>
</div>
</div>
<div class="section" id="id59">
<h2><a class="toc-backref" href="#id313">Device pipe</a></h2>
<p>Pipe are configured with two kind of parameters: Parameters hard-coded
in source code and modifiable parameters</p>
<div class="section" id="hard-coded-device-pipe-parameters">
<h3><a class="toc-backref" href="#id314">Hard-coded device pipe parameters</a></h3>
<p>Three pipe parameters are defined at pipe creation time in the Tango
class source code. Obviously, these parameters are not modifiable except
with a new source code compilation. These parameters are</p>
<dl class="docutils">
<dt>|c|c| Parameter name &amp; Parameter description</dt>
<dd>name &amp; Pipe name
writable &amp; Pipe read/write type
disp_level &amp; Pipe display level</dd>
</dl>
<div class="section" id="the-pipe-read-write-type">
<h4>The pipe read/write type.</h4>
<p>Tango supports two kinds of read/write pipe which are :</p>
<ul class="simple">
<li>Tango::PIPE_READ for read only pipe</li>
<li>Tango::PIPE_READ_WRITE for pipe which can be read and written</li>
</ul>
</div>
<div class="section" id="the-pipe-display-level-parameter">
<h4>The pipe display level parameter</h4>
<p>This parameter is only an help for graphical application. It is a C++
enumeration starting at 0. The code associated with each pipe display
level is defined in the following table (Tango::DispLevel).</p>
<dl class="docutils">
<dt>|c|c| name &amp; Value</dt>
<dd>Tango::OPERATOR &amp; 0
Tango::EXPERT &amp; 1</dd>
</dl>
<p>This parameter allows a graphical application to support two types of
operation :</p>
<ul class="simple">
<li>An operator mode for day to day operation</li>
<li>An expert mode when tuning is necessary</li>
</ul>
<p>According to this parameter, a graphical application knows if the pipe
is for the operator mode or for the expert mode.</p>
</div>
</div>
<div class="section" id="modifiable-pipe-parameters">
<h3><a class="toc-backref" href="#id315">Modifiable pipe parameters</a></h3>
<p>Each pipe has a configuration set of 2 modifiable parameters. These
parameters are modifiable at run-time via a device call or via the
property database.</p>
<dl class="docutils">
<dt>|c|c| Parameter name &amp; Parameter description</dt>
<dd>description &amp; Pipe description
label &amp; Pipe label</dd>
</dl>
<p>The <strong>description</strong> parameter describes the pipe. The <strong>label</strong>
parameter is used by graphical application to display a label when this
pipe is used in a graphical application.</p>
</div>
<div class="section" id="setting-modifiable-pipe-parameters">
<h3><a class="toc-backref" href="#id316">Setting modifiable pipe parameters</a></h3>
<p>A default value is given to all modifiable pipe parameters by the Tango
core classes. Nevertheless, it is possible to modify these values in
source code at pipe creation time or via the database. Values retrieved
from the database have a higher priority than values given at pipe
creation time. The pipe parameters are therefore initialized from:</p>
<ol class="arabic simple">
<li>The Database</li>
<li>If nothing in database, from the Tango class default</li>
<li>If nothing in database nor in Tango class default, from the library
default value</li>
</ol>
<p>The default value set by the Tango core library are</p>
<dl class="docutils">
<dt>|c|c| Parameter name &amp; Library default value</dt>
<dd>description &amp; No description
label &amp; pipe name</dd>
</dl>
<p>It is possible to set modifiable parameters via the database at two
levels :</p>
<ol class="arabic simple">
<li>At class level</li>
<li>At device level. Each device pipe have all its modifiable parameters
sets to the value defined at class level. If the setting defined at
class level is not correct for one device, it is possible to
re-define it.</li>
</ol>
<p>This is the same principle than the one used for attribute configuration
modifiable parameters.</p>
</div>
<div class="section" id="resetting-modifiable-pipe-parameters">
<h3><a class="toc-backref" href="#id317">Resetting modifiable pipe parameters</a></h3>
<p>It is possible to reset pipe parameters to their default value at any
moment. This could be done via the network call available through the
DeviceProxy::set_pipe_config() method family. It uses the same
principle than the one used for resetting modifiable attribute pipe
parameters. Refer to their documentation if you want to know details
about this feature.</p>
</div>
</div>
<div class="section" id="device-class-parameter">
<h2><a class="toc-backref" href="#id318">Device class parameter</a></h2>
<p>A device documentation field is also defined at Tango device class
level. It is defined as Tango device class level because each device
belonging to a Tango device class should have the same behaviour and
therefore the same documentation. This field is store in the DeviceClass
class. It is possible to set this field via a class property. This
property name is</p>
<p>class name-&gt;doc_url</p>
<p>and is retrieved when instance of the DeviceClass object is created. A
default value is defined for this field.</p>
</div>
<div class="section" id="id60">
<h2><a class="toc-backref" href="#id319">The device black box</a></h2>
<p>This black box is a help tool to ease debugging session for a running
device server. The TANGO core software records every device request in
this black box. A tango client is able to retrieve the black box
contents with a specific CORBA operation availabble for every device.
Each black box entry is returned as a string with the following
information :</p>
<ul class="simple">
<li>The date where the request has been executed by the device. The date
format is dd/mm/yyyy hh24:mi:ss:SS (The last field is the second
hundredth number).</li>
<li>The type of CORBA requests. In case of attributes, the name of the
requested attribute is returned. In case of operation, the operation
type is returned. For “command_inout” operation, the command name is
returned.</li>
<li>The client host name</li>
</ul>
</div>
<div class="section" id="automatically-added-commands">
<h2><a class="toc-backref" href="#id320">Automatically added commands</a></h2>
<p>As already mentionned in this documentation, each Tango device supports
at least three commands which are State, Status and Init. The following
array details command input and output data type</p>
<dl class="docutils">
<dt>|c|c|c| Command name &amp; Input data type &amp; Output data type</dt>
<dd>State &amp; void &amp; Tango::DevState
Status &amp; void &amp; Tango::DevString
Init &amp; void &amp; void</dd>
</dl>
<div class="section" id="the-state-command">
<h3><a class="toc-backref" href="#id321">The State command</a></h3>
<p>This command gets the device state (stored in its <em>device_state</em> data
member) and returns it to the caller. The device state is a variable of
the Tango_DevState type (packed into a CORBA Any object when it is
returned by a command)</p>
</div>
<div class="section" id="the-status-command">
<h3><a class="toc-backref" href="#id322">The Status command</a></h3>
<p>This command gets the device status (stored in its <em>device_status</em> data
member) and returns it to the caller. The device status is a variable of
the string type.</p>
</div>
<div class="section" id="the-init-command">
<h3><a class="toc-backref" href="#id323">The Init command</a></h3>
<p>This commands re-initialise a device keeping the same network
connection. After an Init command executed on a device, it is not
necessary for client to re-connect to the device. This command first
calls the device <em>delete_device()</em> method and then execute its
<em>init_device()</em> method. For C++ device server, all the memory allocated
in the <em>init_device()</em> method must be freed in the <em>delete_device()</em>
method. The language device desctructor automatically calls the
<em>delete_device()</em> method.</p>
</div>
</div>
<div class="section" id="dserver-class-device-commands">
<h2><a class="toc-backref" href="#id324">DServer class device commands</a></h2>
<p>As already explained in [DServer_class], each device server process has
its own Tango device. This device supports the three commands previously
described plus 32 commands which are DevRestart, RestartServer,
QueryClass, QueryDevice, Kill, QueryWizardClassProperty,
QueryWizardDevProperty, QuerySubDevice, the polling related commands
which are StartPolling, StopPolling, AddObjPolling, RemObjPolling,
UpdObjPollingPeriod, PolledDevice and DevPollStatus, the device locking
related commands which are LockDevice, UnLockDevice, ReLockDevices and
DevLockStatus, the event related commands called
EventSubscriptionChange, ZmqEventSubscriptionChange and
EventConfirmSubscription and finally the logging related commands which
are AddLoggingTarget, RemoveLoggingTarget, GetLoggingTarget,
GetLoggingLevel, SetLoggingLevel, StopLogging and StartLogging. The
following table give all commands input and output data types</p>
<dl class="docutils">
<dt>|c|c|c| Command name &amp; Input data type &amp; Output data type</dt>
<dd>State &amp; void &amp; Tango::DevState
Status &amp; void &amp; Tango::DevString
Init &amp; void &amp; void
DevRestart &amp; Tango::DevString &amp; void
RestartServer &amp; void &amp; void
QueryClass &amp; void &amp; Tango::DevVarStringArray
QueryDevice &amp; void &amp; Tango::DevVarStringArray
Kill &amp; void &amp; void
QueryWizardClassProperty &amp; Tango::DevString &amp; Tango::DevVarStringArray
QueryWizardDevProperty &amp; Tango::DevString &amp; Tango::DevVarStringArray
QuerySubDevice &amp; void &amp; Tango::DevVarStringArray
StartPolling &amp; void &amp; void
StopPolling &amp; void &amp; void
AddObjPolling &amp; Tango::DevVarLongStringArray &amp; void
RemObjPolling &amp; Tango::DevVarStringArray &amp; void
UpdObjPollingPeriod &amp; Tango::DevVarLongStringArray &amp; void
PolledDevice &amp; void &amp; Tango::DevVarStringArray
DevPollStatus &amp; Tango::DevString &amp; Tango::DevVarStringArray
LockDevice &amp; Tango::DevVarLongStringArray &amp; void
UnLockDevice &amp; Tango::DevVarLongStringArray &amp; Tango::DevLong
ReLockDevices &amp; Tango::DevVarStringArray &amp; void
DevLockStatus &amp; Tango::DevString &amp; Tango::DevVarLongStringArray
EventSubscribeChange &amp; Tango::DevVarStringArray &amp; Tango::DevLong
ZmqEventSubscriptionChange &amp; Tango::DevVarStringArray &amp;</dd>
<dt>Tango::DevVarLongStringArray</dt>
<dd>EventConfirmSubscription &amp; Tango::DevVarStringArray &amp; void
AddLoggingTarget &amp; Tango::DevVarStringArray &amp; void
RemoveLoggingTarget &amp; Tango::DevVarStringArray &amp; void
GetLoggingTarget &amp; Tango::DevString &amp; Tango::DevVarStringArray
GetLoggingLevel &amp; Tango::DevVarStringArray &amp;</dd>
<dt>Tango::DevVarLongStringArray</dt>
<dd>SetLoggingLevel &amp; Tango::DevVarLongStringArray &amp; void
StopLogging &amp; void &amp; void
StartLogging &amp; void &amp; void</dd>
</dl>
<p>The device description field is set to “A device server device”. Device
server started with the -file command line option also supports a
command called QueryEventChannelIOR. This command is used interanally by
the Tango kernel classes when the event system is used with device
server using database on file.</p>
<div class="section" id="id61">
<h3><a class="toc-backref" href="#id325">The State command</a></h3>
<p>This device state is always set to ON</p>
</div>
<div class="section" id="id62">
<h3><a class="toc-backref" href="#id326">The Status command</a></h3>
<p>This device status is always set to “The device is ON” followed by a new
line character and a string describing polling thread status. This
string is either “The polling is OFF” or “The polling is ON” according
to polling state.</p>
</div>
<div class="section" id="the-devrestart-command">
<h3><a class="toc-backref" href="#id327">The DevRestart command</a></h3>
<p>The DevRestart command restart a device. The name of the device to be
re-started is the command input parameter. The command destroys the
device by calling its destructor and re-create it from its constructor.</p>
</div>
<div class="section" id="the-restartserver-command">
<h3><a class="toc-backref" href="#id328">The RestartServer command</a></h3>
<p>The DevRestartServer command restarts all the device pattern(s) embedded
in the device server process. Therefore, all the devices implemented in
the server process are destroyed and re-built <a class="footnote-reference" href="#id147" id="id63">[13]</a>. The network
connection between client(s) and device(s) implemented in the device
server process is destroyed and re-built.</p>
<p>Executing this command allows a complete restart of the device server
without stopping the process.</p>
</div>
<div class="section" id="the-queryclass-command">
<h3><a class="toc-backref" href="#id329">The QueryClass command</a></h3>
<p>This command returns to the client the list of Tango device class(es)
embedded in the device server. It returns only class(es) implemented by
the device server programmer. The DServer device class name (implemented
by the TANGO core software) is not returned by this command.</p>
</div>
<div class="section" id="the-querydevice-command">
<h3><a class="toc-backref" href="#id330">The QueryDevice command</a></h3>
<p>This command returns to the client the list of device name for all the
device(s) implemented in the device server process. Each device name is
returned using the following syntax :</p>
<p>&lt;class name&gt;::&lt;device name&gt;</p>
<p>The name of the DServer class device is not returned by this command.</p>
</div>
<div class="section" id="the-kill-command">
<h3><a class="toc-backref" href="#id331">The Kill command</a></h3>
<p>This command stops the device server process. In order that the client
receives a last answer from the server, this command starts a thread
which will after a short delay, kills the device server process.</p>
</div>
<div class="section" id="the-querywizardclassproperty-command">
<h3><a class="toc-backref" href="#id332">The QueryWizardClassProperty command</a></h3>
<p>This command returns the list of property(ies) defined for a class
stored in the device server process property wizard. For each property,
its name, a description and a default value is returned.</p>
</div>
<div class="section" id="the-querywizarddevproperty-command">
<h3><a class="toc-backref" href="#id333">The QueryWizardDevProperty command</a></h3>
<p>This command returns the list of property(ies) defined for a device
stored in the device server process property wizard. For each property,
its name, a description and a default value is returned.</p>
</div>
<div class="section" id="the-querysubdevice-command">
<h3><a class="toc-backref" href="#id334">The QuerySubDevice command</a></h3>
<p>This command returns the list of sub-device(s) imported by each device
within the server. A sub-device is a device used ( to execute command(s)
and/or to read/write attribute(s) ) by one of the device server process
devices. There is one element in the returned strings array for each
sub-device. The syntax of each string is the device name, a space and
the sub-device name. In case of device server process starting threads
using a sub-device, it is not possible to link this sub-device to any
process devices. In such a case, the string contains only the sub-device
name</p>
</div>
<div class="section" id="the-startpolling-command">
<h3><a class="toc-backref" href="#id335">The StartPolling command</a></h3>
<p>This command starts the polling thread</p>
</div>
<div class="section" id="the-stoppolling-command">
<h3><a class="toc-backref" href="#id336">The StopPolling command</a></h3>
<p>This command stops the polling thread</p>
</div>
<div class="section" id="the-addobjpolling-command">
<h3><a class="toc-backref" href="#id337">The AddObjPolling command</a></h3>
<p>This command adds a new object in the list of object(s) to be polled.
The command input parameters are embedded within a
Tango::DevVarLongStringArray data type with one long data and three
strings. The input parameters are:</p>
<dl class="docutils">
<dt>|c|c| Command parameter &amp; Parameter meaning</dt>
<dd>svalue[0] &amp; Device name
svalue[1] &amp; Object type (“command“ or “attribute“)
svalue[2] &amp; Object name
lvalue[0] &amp; polling period in mS</dd>
</dl>
<p>The object type string is case independent. The object name string
(command name or attribute name) is case dependant. This command does
not start polling if it is stopped. This command is not allowed in case
the device is locked and the command requester is not the lock owner.</p>
</div>
<div class="section" id="the-remobjpolling-command">
<h3><a class="toc-backref" href="#id338">The RemObjPolling command</a></h3>
<p>This command removes an object of the list of polled objects. The
command input data type is a Tango::DevVarStringArray with three
strings. These strings meaning are :</p>
<dl class="docutils">
<dt>|c|c| String &amp; Meaning</dt>
<dd>string[0] &amp; Device name
string[1] &amp; Object type (“command“ or “attribute“)
string[2] &amp; Object name</dd>
</dl>
<p>The object type string is case independent. The object name string
(command name or attribute name) is case dependant. This command is not
allowed in case the device is locked and the command requester is not
the lock owner.</p>
</div>
<div class="section" id="the-updobjpollingperiod-command">
<h3><a class="toc-backref" href="#id339">The UpdObjPollingPeriod command</a></h3>
<p>This command changes the polling period for a specified object. The
command input parameters are embedded within a
Tango::DevVarLongStringArray data type with one long data and three
strings. The input parameters are:</p>
<dl class="docutils">
<dt>|c|c| Command parameter &amp; Parameter meaning</dt>
<dd>svalue[0] &amp; Device name
svalue[1] &amp; Object type (“command“ or “attribute“)
svalue[2] &amp; Object name
lvalue[0] &amp; new polling period in mS</dd>
</dl>
<p>The object type string is case independent. The object name string
(command name or attribute name) is case dependant. This command does
not start polling if it is stopped. This command is not allowed in case
the device is locked and the command requester is not the lock owner.</p>
</div>
<div class="section" id="the-polleddevice-command">
<h3><a class="toc-backref" href="#id340">The PolledDevice command</a></h3>
<p>This command returns the name of device which are polled. Each string in
the Tango::DevVarStringArray returned by the command is a device name
which has at least one command or attribute polled. The list is
alphabetically sorted.</p>
</div>
<div class="section" id="the-devpollstatus-command">
<h3><a class="toc-backref" href="#id341">The DevPollStatus command</a></h3>
<p>This command returns a polling status for a specific device. The input
parameter is a device name. Each string in the Tango::DevVarStringArray
returned by the command is the polling status for each polled device
objects (command or attribute). For each polled objects, the polling
status is :</p>
<ul class="simple">
<li>The object name</li>
<li>The object polling period (in mS)</li>
<li>The object polling ring buffer depth</li>
<li>The time needed (in mS) for the last command execution or attribute
reading</li>
<li>The time since data in the ring buffer has not been updated. This
allows a check of the polling thread</li>
<li>The delta time between the last records in the ring buffer. This
allows checking that the polling period is respected by the polling
thread.</li>
<li>The exception parameters in case of the last command execution or the
last attribute reading failed.</li>
</ul>
<p>A new line character is inserted between each piece of information.</p>
</div>
<div class="section" id="the-lockdevice-command">
<h3><a class="toc-backref" href="#id342">The LockDevice command</a></h3>
<p>This command locks a device for the calling process. The command input
parameters are embedded within a Tango::DevVarLongStringArray data type
with one long data and one string. The input parameters are:</p>
<dl class="docutils">
<dt>|c|c| Command parameter &amp; Parameter meaning</dt>
<dd>svalue[0] &amp; Device name
lvalue[0] &amp; Lock validity</dd>
</dl>
</div>
<div class="section" id="the-unlockdevice-command">
<h3><a class="toc-backref" href="#id343">The UnLockDevice command</a></h3>
<p>This command unlocks a device. The command input parameters are embedded
within a Tango::DevVarLongStringArray data type with one long data and
one string. The input parameters are:</p>
<dl class="docutils">
<dt>|c|c| Command parameter &amp; Parameter meaning</dt>
<dd>svalue[0] &amp; Device name
lvalue[0] &amp; Force flag</dd>
</dl>
<p>The force flag parameter allows a client to unlock a device already
locked by another process (for admin usage only)</p>
</div>
<div class="section" id="the-relockdevices-command">
<h3><a class="toc-backref" href="#id344">The ReLockDevices command</a></h3>
<p>This command re-lock devices. The input argument is the list of devices
to be re-locked. It’s an error to re-lock a device which is not already
locked.</p>
</div>
<div class="section" id="the-devlockstatus-command">
<h3><a class="toc-backref" href="#id345">The DevLockStatus command</a></h3>
<p>This command returns a device locking status to the caller. Its input
parameter is the device name. The output parameters are embedded within
a Tango::DevVarLongStringArray data type with three strings and six
long. These data are</p>
<dl class="docutils">
<dt>|c|c| Command parameter &amp; Parameter meaning</dt>
<dd>svalue[0] &amp; Locking string
svalue[1] &amp; CPP client host IP address or Not defined
svalue[2] &amp; Java VM main class for Java client or Not defined
lvalue[0] &amp; Lock flag (1 if locked, 0 othterwise)
lvalue[1] &amp; CPP client host IP address or 0 for Java locker
lvalue[2] &amp; Java locker UUID part 1or 0 for CPP locker
lvalue[3] &amp; Java locker UUID part 2 or 0 for CPP locker
lvalue[4] &amp; Java locker UUID part 3 or 0 for CPP locker
lvalue[5] &amp; Java locker UUID part 4 or 0 for CPP locker</dd>
</dl>
</div>
<div class="section" id="the-eventsubscriptionchange-command-c-server-only">
<h3><a class="toc-backref" href="#id346">The EventSubscriptionChange command (C++ server only)</a></h3>
<p>This command is used as a piece of the heartbeat system between an event
client and the device server generating the event. There is no reason to
generate events if there is no client which has subscribed to it. It is
used by the <em>DeviceProxy::subscribe_event()</em> method and one of the
event thread on the client side to inform the server to keep on
generating events for the attribute in question. It reloads the
subscription timer with the current time. Events are not generated when
there are no clients subscribed within the last 10 minutes. The input
parameters are:</p>
<dl class="docutils">
<dt>|c|c| Command parameter &amp; Parameter meaning</dt>
<dd>argin[0] &amp; Device name
argin[1] &amp; Attribute name
argin[2] &amp; action (subscribe or unsubsribe)
argin[3] &amp; event name (change, periodic, archive,attr_conf)</dd>
</dl>
<p>The command output data is the simply the Tango release used by the
device server process. This is necessary for compatibility reason.</p>
</div>
<div class="section" id="the-zmqeventsubscriptionchange-command">
<h3><a class="toc-backref" href="#id347">The ZmqEventSubscriptionChange command</a></h3>
<p>This command is used as a piece of the heartbeat system between an event
client and the device server generating the event when client and/or
device server uses Tango release 8 or above. There is no reason to
generate events if there is no client which has subscribed to it. It is
used by the <em>DeviceProxy::subscribe_event()</em> method and one of the
event thread on the client side to inform the server to keep on
generating events for the attribute in question. It reloads the
subscription timer with the current time. Events are not generated when
there are no clients subscribed within the last 10 minutes. The input
parameters are the same than the one used for the
EventSubscriptionChange command. They are:</p>
<dl class="docutils">
<dt>|c|c| Command in parameter &amp; Parameter meaning</dt>
<dd>argin[0] &amp; Device name
argin[1] &amp; Attribute name
argin[2] &amp; action (subscribe or unsubsribe)
argin[3] &amp; event name (change, periodic, archive,attr_conf)</dd>
</dl>
<p>The command output parameters aer all the necessary data to build one
event connection between a client and the device server process
generating the events. This means:</p>
<dl class="docutils">
<dt>|c|c| Command out parameter &amp; Parameter meaning</dt>
<dd>svalue[0] &amp; Heartbeat ZMQ socket connect end point
svalue[1] &amp; Event ZMQ socket connect end point
lvalue[0] &amp; Tango lib release used by device server
lvalue[1] &amp; Device IDL release
lvalue[2] &amp; Subscriber HWM
lvalue[3] &amp; Rate (Multicasting related)
lvalue[4] &amp; IVL (Multicasting related)</dd>
</dl>
</div>
<div class="section" id="the-eventconfirmsubscription-command">
<h3><a class="toc-backref" href="#id348">The EventConfirmSubscription command</a></h3>
<p>This command is used by client to regularly notify to device server
process their interest in receiving events. If this command is not
received, after a delay of 600 sec (10 mins), event(s) will not be sent
any more. The input parameters for the EventConfirmSubscription command
must be a multiple of 3. They are 3 parameters for each event confirmed
by this command. Per event, these parameters are:</p>
<dl class="docutils">
<dt>|c|c| Command in parameter &amp; Parameter meaning</dt>
<dd>argin[x] &amp; Device name
argin[x + 1] &amp; Attribute name
argin[x + 2] &amp; Event name</dd>
</dl>
</div>
<div class="section" id="the-addloggingtarget-command">
<h3><a class="toc-backref" href="#id349">The AddLoggingTarget command</a></h3>
<p>This command adds one (or more) logging target(s) to the specified
device(s). The command input parameter is an array of string logically
composed of {device_name, target_type::target_name} groups where the
elements have the following semantic:</p>
<ul class="simple">
<li>device_name is the name of the device which logging behavior is to
be controlled. The wildcard is supported to apply the modification to
all devices encapsulated within the device server (e.g. to ask all
devices to log to the same device target).</li>
<li>target_type::target_name: target_type is one of the supported
target types and target_name, the name of the target. Supported
target types are: <em>console</em>, <em>file</em> and <em>device</em>. For a device
target, target_name must contain the name of a log consumer device
(as defined in [sec:Tango-log-consumer]). For a file target,
target_name is the full path to the file to log to. If omitted the
device’s name is used to build the file name
(domain_family_member.log). Finally, target_name is ignored in the
case of a console target and can be omitted.</li>
</ul>
<p>This command is not allowed in case the device is locked and the command
requester is not the lock owner.</p>
</div>
<div class="section" id="the-removeloggingtarget-command">
<h3><a class="toc-backref" href="#id350">The RemoveLoggingTarget command</a></h3>
<p>Remove one (or more) logging target(s) from the specified device(s).The
command input parameter is an array of string logically composed of
{device_name, target_type::target_name} groups where the elements
have the following semantic:</p>
<ul class="simple">
<li>device_name: the name of the device which logging behavior is to be
controlled. The wildcard is supported to apply the modification to
all devices encapsulated within the device server (e.g. to ask all
devices to stop logging to a given device target).</li>
<li>target_type::target_name: target_type is one of the supported
target types and target_name, the name of the target. Supported
target types are: <em>console</em>, <em>file</em> and <em>device</em>. For a device
target, target_name must contain the name of a log consumer device
(as defined in [sec:Tango-log-consumer]). For a file target,
target_name is the full path to the file to log to. If omitted the
device’s name is used to build the file name
(domain_family_member.log). Finally, target_name is ignored in the
case of a console target and can be omitted.</li>
</ul>
<p>The wildcard is supported for target_name. For instance,
RemoveLoggingTarget ([, device::*) removes all the device targets from
all the devices running in the device server. This command is not
allowed in case the device is locked and the command requester is not
the lock owner.</p>
</div>
<div class="section" id="the-getloggingtarget-command">
<h3><a class="toc-backref" href="#id351">The GetLoggingTarget command</a></h3>
<p>Returns the current target list of the specified device. The command
parameter device_name is the name of the device which logging target
list is requested. The list is returned as a DevVarStringArray
containing target_type::target_name elements.</p>
</div>
<div class="section" id="the-getlogginglevel-command">
<h3><a class="toc-backref" href="#id352">The GetLoggingLevel command</a></h3>
<p>Returns the logging level of the specified devices. The command input
parameter device_list contains the names of the devices which logging
target list is requested. The wildcard is supported to get the logging
level of all the devices running within the server. The string part of
the result contains the name of the devices and its long part contains
the levels. Obviously, result.lvalue[i] is the current logging level of
the device named result.svalue[i].</p>
</div>
<div class="section" id="the-setlogginglevel-command">
<h3><a class="toc-backref" href="#id353">The SetLoggingLevel command</a></h3>
<p>Changes the logging level of the specified devices. The string part of
the command input parameter contains the device names while its long
part contains the logging levels. The set of possible values for levels
is: 0=OFF, 1=FATAL, 2=ERROR, 3=WARNING, 4=INFO, 5=DEBUG.</p>
<p>The wildcard is supported to assign all devices the same logging level.
For instance, SetLoggingLevel ([3]) set the logging level of all the
devices running within the server to WARNING. This command is not
allowed in case the device is locked and the command requester is not
the lock owner.</p>
</div>
<div class="section" id="the-stoplogging-command">
<h3><a class="toc-backref" href="#id354">The StopLogging command</a></h3>
<p>For all the devices running within the server, StopLogging saves their
current logging level and set their logging level to OFF.</p>
</div>
<div class="section" id="the-startlogging-command">
<h3><a class="toc-backref" href="#id355">The StartLogging command</a></h3>
<p>For each device running within the server, StartLogging restores their
logging level to the value stored during a previous StopLogging call.</p>
</div>
</div>
<div class="section" id="dserver-class-device-properties">
<h2><a class="toc-backref" href="#id356">DServer class device properties</a></h2>
<p>This device has two properties related to polling threads pool
management plus another one for the choice of polling algorithm. These
properties are described in the following table</p>
<dl class="docutils">
<dt>|c|c|c| Property name &amp; property rule &amp; default value</dt>
<dd>polling_threads_pool_size &amp; Max number of thread in the polling pool</dd>
<dt>&amp; 1</dt>
<dd>polling_threads_pool_conf &amp; Polling threads pool configuration &amp;
polling_before_9 &amp; Choice of the polling algorithm &amp; false</dd>
</dl>
<p>The rule of the polling_threads_pool_size is to define the maximun
number of thread created for the polling threads pool size. The rule of
the polling_threads_pool_conf is to define which thread in the pool
is in charge of all the polled object(s) of which device. This property
is an array of strings with one string per used thread in the pool. The
content of the string is simply a device name list with device name
splitted by a comma. Example of polling_threads_pool_conf property
for 3 threads used:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">dserver</span><span class="operator">/&lt;</span><span class="name">ds</span> <span class="name">exec</span> <span class="name">name</span><span class="operator">&gt;/&lt;</span><span class="name">inst</span><span class="punctuation">.</span> <span class="name">name</span><span class="operator">&gt;/</span><span class="name">polling_threads_pool_conf</span><span class="operator">-&gt;</span> <span class="name">the</span><span class="operator">/</span><span class="name">dev</span><span class="operator">/</span><span class="literal number oct">01</span>
<span class="ln">2 </span>                    <span class="name">the</span><span class="operator">/</span><span class="name">dev</span><span class="operator">/</span><span class="literal number oct">02</span><span class="punctuation">,</span><span class="name">the</span><span class="operator">/</span><span class="name">dev</span><span class="operator">/</span><span class="literal number oct">06</span>
<span class="ln">3 </span>                    <span class="name">the</span><span class="operator">/</span><span class="name">dev</span><span class="operator">/</span><span class="literal number oct">03</span>
</pre>
<p>Thread number 2 is in charge of 2 devices. Note that there is an entry
in this list only for the used threads in the pool.</p>
<p>The rule of the polling_before_9 property is to select the polling
algorithm which was used in Tango device server process before Tango
release 9.</p>
</div>
<div class="section" id="tango-log-consumer">
<h2><a class="toc-backref" href="#id357">Tango log consumer</a></h2>
<div class="section" id="the-available-log-consumer">
<h3><a class="toc-backref" href="#id358">The available Log Consumer</a></h3>
<p>One implementation of a log consumer associated to a graphical user
interface is available within Tango. It is a standalone java application
called <strong>LogViewer</strong> based on the publicly available chainsaw
application from the log4j package. It supports two way of running which
are:</p>
<ul class="simple">
<li>The static mode: In this mode, LogViewer is started with a parameter
which is the name of the log consumer device implemented by the
application. All messages sent by devices with a logging target type
set to <em>device</em> and with a logging target name set to the same device
name than the device name passed as application parameter will be
displayed (if the logging level allows it).</li>
<li>The dynamic mode: In this mode, the name of the log consumer device
implemented by the application is build at application startup and is
dynamic. The user with the help of the graphical interface chooses
device(s) for which he want to see log messages.</li>
</ul>
</div>
<div class="section" id="the-log-consumer-interface">
<h3><a class="toc-backref" href="#id359">The Log Consumer interface</a></h3>
<p>A Tango Log Consumer device is nothing but a tango device supporting the
following tango command :</p>
<p>void log (Tango::DevVarStringArray details)</p>
<p>where details is an array of string carrying the log details. Its
structure is:</p>
<ul class="simple">
<li>details[0] : the timestamp in millisecond since epoch (01.01.1970)</li>
<li>details[1] : the log level</li>
<li>details[2] : the log source (i.e. device name)</li>
<li>details[3] : the log message</li>
<li>details[4] : the log NDC (contextual info) - Not used but reserved</li>
<li>details[5] : the thread identifier (i.e. the thread from which the
log request comes from)</li>
</ul>
<p>These log details can easily be extended. Any tango device supporting
this command can act as a device target for other devices.</p>
</div>
</div>
<div class="section" id="control-system-specific">
<h2><a class="toc-backref" href="#id360">Control system specific</a></h2>
<p>It is possible to define a few control system parameters. By control
system, we mean for each set of computers having the same database
device server (the same TANGO_HOST environment variable)</p>
<div class="section" id="the-device-class-documentation-default-value">
<h3><a class="toc-backref" href="#id361">The device class documentation default value</a></h3>
<p>Each control system may have it’s own default device class documentation
value. This is defined via a class property. The property name is</p>
<p>Default-&gt;doc_url</p>
<p>It’s retrieved if the device class itself does not define any doc_url
property. If the Default-&gt;doc_url property is also not defined, a
hard-coded default value is provided.</p>
</div>
<div class="section" id="the-services-definition">
<h3><a class="toc-backref" href="#id362">The services definition</a></h3>
<p>The property used to defined control system services is named
<strong>Services</strong> and belongs to the free object <strong>CtrlSystem</strong>. This
property is an array of strings. Each string defines a service available
within the control system. The syntax of each service definition is</p>
<p>Service name/Instance name:service device name</p>
</div>
<div class="section" id="tuning-the-event-system-buffers-hwm">
<h3><a class="toc-backref" href="#id363">Tuning the event system buffers (HWM)</a></h3>
<p>Starting with Tango release 8, ZMQ is used for the event based
communication between clients and device server processes. ZMQ
implementation provides asynchronous communication in the sense that the
data to be transmitted is first stored in a buffer and then really sent
on the network by dedicated threads. The size of this buffers (on client
and device server side) is called High Water Mark (HWM) and is tunable.
This is tunable at several level.</p>
<ol class="arabic simple">
<li>The library set a default value of <strong>1000</strong> for both buffers (client
and device server side)</li>
<li>Control system properties used to tune these size are named
<strong>DSEventBufferHwm</strong> (device server side) and <strong>EventBufferHwm</strong>
(client side). They both belongs to the free object <strong>CtrlSystem</strong>.
Each property is the max number of events storable in these buffer.</li>
<li>At client or device server level using the library calls
<em>Util::set_ds_event_buffer_hwm()</em> documented in
 or
<em>ApiUtil::set_event_buffer_hwm()</em> documented in
[sec:Tango::ApiUtil]</li>
<li>Using environment variables TANGO_DS_EVENT_BUFFER_HWM or
TANGO_EVENT_BUFFER_HWM</li>
</ol>
</div>
<div class="section" id="allowing-nan-when-writing-attributes-floating-point">
<h3><a class="toc-backref" href="#id364">Allowing NaN when writing attributes (floating point)</a></h3>
<p>A property named <strong>WAttrNaNAllowed</strong> belonging to the free object
<strong>CtrlSystem</strong> allows a Tango control system administrator to allow or
disallow NaN numbers when writing attributes of the DevFloat or
DevDouble data type. This is a boolean property and by default, it’s
value is taken as false (Meaning NaN values are rejected).</p>
</div>
<div class="section" id="tuning-multicasting-event-propagation">
<h3><a class="toc-backref" href="#id365">Tuning multicasting event propagation</a></h3>
<p>Starting with Tango 8.1, it is possible to transfer event(s) between
devices and clients using a multicast protocol. The properties
<strong>MulticastEvent</strong>, <strong>MulticastRate</strong>, <strong>MulticastIvl</strong> and
<strong>MulticastHops</strong> also belonging to the free object <strong>CtrlSystem</strong> allow
the user to configure which events has to be sent using multicasting and
with which parameters. See chapter Advanced features/Using multicast
protocol to transfer events to get details about these properties.</p>
</div>
<div class="section" id="summary-of-ctrlsystem-free-object-properties">
<h3><a class="toc-backref" href="#id366">Summary of CtrlSystem free object properties</a></h3>
<p>The following table summarizes properties defined at control system
level and belonging to the free object CtrlSystem</p>
<dl class="docutils">
<dt>|c|c|c| Property name &amp; property rule &amp; default value</dt>
<dd>Services &amp; List of defined services &amp; No default
DsEventBufferHwm &amp; DS event buffer high water mark &amp; 1000
EventBufferHwm &amp; Client event buffer high water mark &amp; 1000
WAttrNaNAllowed &amp; Allow NaN when writing attr. &amp; false
MulticastEvent &amp; List of multicasting events &amp; No default
MulticastRate &amp; Rate for multicast event transport &amp; 80
MulticastIvl &amp; Time to keep data for re-transmission &amp; 20
MulticastHops &amp; Max number of eleemnts to cross &amp; 5</dd>
</dl>
</div>
</div>
<div class="section" id="c-specific">
<h2><a class="toc-backref" href="#id367">C++ specific</a></h2>
<div class="section" id="the-tango-master-include-file-tango-h">
<h3><a class="toc-backref" href="#id368">The Tango master include file (tango.h)</a></h3>
<p>Tango has a master include file called</p>
<p>tango.h</p>
<p>This master include file includes the following files :</p>
<ul class="simple">
<li>Tango configuration include file : <strong>tango_config.h</strong></li>
<li>CORBA include file : <strong>idl/tango.h</strong></li>
<li>Some network include files for WIN32 : <strong>winsock2.h</strong> and
<strong>mswsock.h</strong></li>
<li>C++ streams include file :<ul>
<li><strong>iostream</strong>, <strong>sstream</strong> and <strong>fstream</strong></li>
</ul>
</li>
<li>Some standard C++ library include files : <strong>memory, string</strong> and
<strong>vector</strong></li>
<li>A long list of other Tango include files</li>
</ul>
</div>
<div class="section" id="tango-specific-pre-processor-define">
<h3><a class="toc-backref" href="#id369">Tango specific pre-processor define</a></h3>
<p>The tango.h previously described also defined some pre-processor macros
allowing Tango release to be checked at compile time. These macros are:</p>
<ul class="simple">
<li>TANGO_VERSION_MAJOR</li>
<li>TANGO_VERSION_MINOR</li>
<li>TANGO_VERSION_PATCH</li>
</ul>
<p>For instance, with Tango release 8.1.2, TANGO_VERSION_MAJOR will be
set to 8 while TANGO_VERSION_MINOR will be 1 and TANGO_VERSION_PATCH
will be 2.</p>
</div>
<div class="section" id="tango-specific-types">
<h3><a class="toc-backref" href="#id370">Tango specific types</a></h3>
<div class="section" id="operating-system-free-type">
<h4>Operating system free type</h4>
<p>Some data type used in the TANGO core software have been defined. They
are described in the following table.</p>
<dl class="docutils">
<dt>|c|c| Type name &amp; C++ name</dt>
<dd>TangoSys_MemStream &amp; stringstream
TangoSys_OMemStream &amp; ostringstream
TangoSys_Pid &amp; int
TangoSys_Cout &amp; ostream</dd>
</dl>
<p>These types are defined in the tango_config.h file</p>
</div>
<div class="section" id="template-command-model-related-type">
<h4>Template command model related type</h4>
<p>As explained in [Command fact], command created with the template
command model uses static casting. Many type definition have been
written for these casting.</p>
<p>|c|c|c| Class name &amp; Command allowed method (if any) &amp; Command
execute method</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 12709)</p>
Unexpected indentation.</div>
<blockquote>
TemplCommand &amp; Tango::StateMethodPtr &amp; Tango::CmdMethPtr
TemplCommandIn &amp; Tango::StateMethodPtr &amp; Tango::CmdMethPtr_xxx
TemplCommandOut &amp; Tango::StateMethodPtr &amp; Tango::xxx_CmdMethPtr
TemplCommandInOut &amp; Tango::StateMethodPtr &amp; Tango::xxx_CmdMethPtr_yyy</blockquote>
<p>The <strong>Tango::StateMethPtr</strong> is a pointer to a method of the DeviceImpl
class which returns a boolean and has one parameter which is a reference
to a const CORBA::Any obect.</p>
<p>The <strong>Tango::CmdMethPtr</strong> is a pointer to a method of the DeviceImpl
class which returns nothing and needs nothing as parameter.</p>
<p>The <strong>Tango::CmdMethPtr_xxx</strong> is a pointer to a method of the
DeviceImpl class which returns nothing and has one parameter. xxx must
be set according to the method parameter type as described in the next
table</p>
<dl class="docutils">
<dt>|c|c| Tango type &amp; short cut (xxx)</dt>
<dd>Tango::DevBoolean &amp; Bo
Tango::DevShort &amp; Sh
Tango::DevLong &amp; Lg
Tango::DevFloat &amp; Fl
Tango::DevDouble &amp; Db
Tango::DevUshort &amp; US
Tango::DevULong &amp; UL
Tango::DevString &amp; Str
Tango::DevVarCharArray &amp; ChA
Tango::DevVarShortArray &amp; ShA
Tango::DevVarLongArray &amp; LgA
Tango::DevVarFloatArray &amp; FlA
Tango::DevVarDoubleArray &amp; DbA
Tango::DevVarUShortArray &amp; USA
Tango::DevVarULongArray &amp; ULA
Tango::DevVarStringArray &amp; StrA
Tango::DevVarLongStringArray &amp; LSA
Tango::DevVarDoubleStringArray &amp; DSA
Tango::DevState &amp; Sta</dd>
</dl>
<p>For instance, a pointer to a method which takes a
Tango::DevVarStringArray as input parameter must be statically casted to
a Tango::CmdMethPtr_StrA, a pointer to a method which takes a
Tango::DevLong data as input parameter must be statically casted to a
Tango::CmdMethPtr_Lg.</p>
<p>The <strong>Tango::xxx_CmdMethPtr</strong> is a pointer to a method of the
DeviceImpl class which returns data of one of the Tango type and has no
input parameter. xxx must be set according to the method return data
type following the same rules than those described in the previous
table. For instance, a pointer to a method which returns a
Tango::DevDouble data must be statically casted to a
Tango::Db_CmdMethPtr.</p>
<p>The <strong>Tango::xxx_CmdMethPtr_yyy</strong> is a pointer to a method of the
DeviceImpl class which returns data of one of the Tango type and has one
input parameter of one of the Tango data type. xxx and yyy must be set
according to the method return data type and parameter type following
the same rules than those described in the previous table. For instance,
a pointer to a method which returns a Tango::DevDouble data and which
takes a Tango::DevVarLongStringArray must be statically casted to a
Tango::Db_CmdMethPtr_LSA.</p>
<p>All those type are defined in the tango_const.h file.</p>
</div>
</div>
<div class="section" id="tango-device-state-code">
<h3><a class="toc-backref" href="#id371">Tango device state code</a></h3>
<p>The Tango::DevState type is a C++ enumeration starting at 0. The code
associated with each state is defined in the following table.</p>
<dl class="docutils">
<dt>|c|c| State name &amp; Value</dt>
<dd>Tango::ON &amp; 0
Tango::OFF &amp; 1
Tango::CLOSE &amp; 2
Tango::OPEN &amp; 3
Tango::INSERT &amp; 4
Tango::EXTRACT &amp; 5
Tango::MOVING &amp; 6
Tango::STANDBY &amp; 7
Tango::FAULT &amp; 8
Tango::INIT &amp; 9
Tango::RUNNING &amp; 10
Tango::ALARM &amp; 11
Tango::DISABLE &amp; 12
Tango::UNKNOWN &amp; 13</dd>
</dl>
<p>A strings array called <strong>Tango::DevStateName</strong> can be used to get the
device state as a string. Use the Tango device state code as index into
the array to get the correct string.</p>
</div>
<div class="section" id="tango-data-type">
<h3><a class="toc-backref" href="#id372">Tango data type</a></h3>
<p>A “define” has been created for each Tango data type. This is summarized
in the following table</p>
<dl class="docutils">
<dt>|c|c|c| Type name &amp; Type code &amp; Value</dt>
<dd>Tango::DevBoolean &amp; Tango::DEV_BOOLEAN &amp; 1
Tango::DevShort &amp; Tango::DEV_SHORT &amp; 2
Tango::DevLong &amp; Tango::DEV_LONG &amp; 3
Tango::DevFloat &amp; Tango::DEV_FLOAT &amp; 4
Tango::DevDouble &amp; Tango::DEV_DOUBLE &amp; 5
Tango::DevUShort &amp; Tango::DEV_USHORT &amp; 6
Tango::DevULong &amp; Tango::DEV_ULONG &amp; 7
Tango::DevString &amp; Tango::DEV_STRING &amp; 8
Tango::DevVarCharArray &amp; Tango::DEVVAR_CHARARRAY &amp; 9
Tango::DevVarShortArray &amp; Tango::DEVVAR_SHORTARRAY &amp; 10
Tango::DevVarLongArray &amp; Tango::DEVVAR_LONGARRAY &amp; 11
Tango::DevVarFloatArray &amp; Tango::DEVVAR_FLOATARRAY &amp; 12
Tango::DevVarDoubleArray &amp; Tango::DEVVAR_DOUBLEARRAY &amp; 13
Tango::DevVarUShortArray &amp; Tango::DEVVAR_USHORTARRAY &amp; 14
Tango::DevVarULongArray &amp; Tango::DEVVAR_ULONGARRAY &amp; 15
Tango::DevVarStringArray &amp; Tango::DEVVAR_STRINGARRAY &amp; 16
Tango::DevVarLongStringArray &amp; Tango::DEVVAR_LONGSTRINGARRAY &amp; 17
Tango::DevVarDoubleStringArray &amp; Tango::DEVVAR_DOUBLESTRINGARRAY &amp; 18
Tango::DevState &amp; Tango::DEV_STATE &amp; 19
Tango::ConstDevString &amp; Tango::CONST_DEV_STRING &amp; 20
Tango::DevVarBooleanArray &amp; Tango::DEVVAR_BOOLEANARRAY &amp; 21
Tango::DevUChar &amp; Tango::DEV_UCHAR &amp; 22
Tango::DevLong64 &amp; Tango::DEV_LONG64 &amp; 23
Tango::DevULong64 &amp; Tango::DEV_ULONG64 &amp; 24
Tango::DevVarLong64Array &amp; Tango::DEVVAR_LONG64ARRAY &amp; 25
Tango::DevVarULong64Array &amp; Tango::DEVVAR_ULONG64ARRAY &amp; 26
Tango::DevInt &amp; Tango::DEV_INT &amp; 27
Tango::DevEncoded &amp; Tango::DEV_ENCODED &amp; 28
Tango::DevEnum &amp; Tango::DEV_ENUM &amp; 29
Tango::DevPipeBlob &amp; Tango::DEV_PIPE_BLOB &amp; 30
Tango::DevVarStateArray &amp; Tango::DEVVAR_STATEARRAY &amp; 31</dd>
</dl>
<p>For command which do not take input parameter, the type code
Tango::DEV_VOID (value = 0) has been defined.</p>
<p>A strings array called <strong>Tango::CmdArgTypeName</strong> can be used to get the
data type as a string. Use the Tango data type code as index into the
array to get the correct string.</p>
</div>
<div class="section" id="tango-command-display-level">
<h3><a class="toc-backref" href="#id373">Tango command display level</a></h3>
<p>Like attribute, Tango command has a display level. The Tango::DispLevel
type is a C++ enumeration starting at 0. The code associated with each
command display level is already described in page</p>
<p>As for attribute, this parameter allows a graphical application to
support two types of operation :</p>
<ul class="simple">
<li>An operator mode for day to day operation</li>
<li>An expert mode when tuning is necessary</li>
</ul>
<p>According to this parameter, a graphical application knows if the
command is for the operator mode or for the expert mode.</p>
</div>
</div>
<div class="section" id="device-server-process-option-and-environment-variables">
<h2><a class="toc-backref" href="#id374">Device server process option and environment variables</a></h2>
<div class="section" id="classical-device-server">
<h3><a class="toc-backref" href="#id375">Classical device server</a></h3>
<p>The synopsis of a device server process is</p>
<p>ds_name instance_name [OPTIONS]</p>
<p>The supported options are :</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>-h, -? -help</strong></div>
<div class="line">Print the device server synopsis and a list of instance name
defined in the database for this device server. An instance name in
not mandatory in the command line to use this option</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>-v[trace level]</strong></div>
<div class="line">Set the verbose level. If no trace level is given, a default value
of 4 is used</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>-file=&lt;file name path&gt;</strong></div>
<div class="line">Start a device server using an ASCII file instead of the Tango
database.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>-nodb</strong></div>
<div class="line">Start a device server without using the database.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>-dlist &lt;device name list&gt;</strong></div>
<div class="line">Give the device name list. This option is supported only with the
-nodb option.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>ORB options</strong> (started with -ORBxxx)</div>
<div class="line">Options directly passed to the underlying ORB. Should be rarely
used except the -ORBendPoint option for device server not using the
database</div>
</div>
</li>
</ul>
</div>
<div class="section" id="device-server-process-as-windows-service">
<h3><a class="toc-backref" href="#id376">Device server process as Windows service</a></h3>
<p>When used as a Windows service, a Tango device server supports several
new options. These options are :</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>-i</strong></div>
<div class="line">Install the service</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>-s</strong></div>
<div class="line">Install the service and choose the automatic startup mode</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>-u</strong></div>
<div class="line">Un-install the service</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>-dbg</strong></div>
<div class="line">Run in console mode to debug service. The service must have been
installed prior to use it.</div>
</div>
</li>
</ul>
<p>Note that these options must be used after the device server instance
name.</p>
</div>
<div class="section" id="environment-variables">
<h3><a class="toc-backref" href="#id377">Environment variables</a></h3>
<p>A few environment variables can be used to tune a Tango control system.
TANGO_HOST is the most important one but on top it, some Tango features
like Tango logging service or controlled access (if used) can be tuned
using environment variable. If these environment variables are not
defined, the software searches in the file <strong>$HOME/.tangorc</strong> for its
value. If the file is not defined or if the environment variable is also
not defined in this file, the software searches in the file
<strong>/etc/tangorc</strong> for its value. For Windows, the file is
<strong>$TANGO_ROOT/tangorc</strong> TANGO_ROOT being the mandatory environment
variable of the Windows binary distribution.</p>
<div class="section" id="tango-host">
<h4>TANGO_HOST</h4>
<p>This environment variable is the anchor of the system. It specifies
where the Tango database server is running. Most of the time, its syntax
is</p>
<p>TANGO_HOST=&lt;host&gt;:&lt;port&gt;</p>
<p>host is the name of the computer where the database server is running
and port is th eport number on which it is litenning. If you want to
have a Tango control system which has several database servers (but only
one database) in order to survive a database server crashes, use the
following syntax</p>
<p>TANGO_HOST=&lt;host_1&gt;:&lt;port_1&gt;,&lt;host_2&gt;:&lt;port_2&gt;,&lt;host_3&gt;:&lt;port_3&gt;</p>
<p>Obviously, host_1 is the name of the computer where the first database
server is running, port_1 is the port number on which this server is
listenning. host_2 is the name of the computer where the second
database server is running and port_2 is its port number. All access to
database will automatically switch from one server to another one in the
list if the one which was used has died.</p>
</div>
<div class="section" id="tango-logging-service-tango-log-path">
<h4>Tango Logging Service (TANGO_LOG_PATH)</h4>
<p>The TANGO_LOG_PATH environment variable can be used to specify the log
files location. If not set it defaults to /tmp/tango-&lt;user logging name&gt;
under Unix and C:/tango-&lt;user logging name&gt; under Windows. For a given
device-server, the files are actually saved into $TANGO_LOG_PATH/{
server_name}/{ server_instance_name}. This means that all the devices
running within the same process log into the same directory.</p>
</div>
<div class="section" id="the-database-and-controlled-access-server-mysql-user-mysql-password-mysql-host-and-mysql-database">
<h4>The database and controlled access server (MYSQL_USER, MYSQL_PASSWORD, MYSQL_HOST and MYSQL_DATABASE)</h4>
<p>The Tango database server and the controlled access server (if used)
need to connect to the MySQL database. They are using four environment
variables called MYSQL_USER, MYSQL_PASSWORD to know which
user/password they must use to access the database, MYSQL_HOST in case
the MySQL database is running on another host and MYSQL_DATABASE to
specify the name of the database to connect to. The MYSQL_HOST
environment variable allows you to specify the host and port number
where MySQL is running. Its syntax is</p>
<p>host:port</p>
<p>The port definition is optional. If it is not specified, the default
MySQL port will be used. If these environment variables are not defined,
they will connect to the DBMS using the root login on localhost with the
MySQL default port number (3306). The MYSQL_DATABASE environment
variable has to be used in case your are using the same Tango Database
device server executable code to connect to several Tango databases each
of them having a different name.</p>
</div>
<div class="section" id="id64">
<h4>The controlled access</h4>
<p>Even if a controlled access system is running, it is possible to by-pass
it if in the environment of the client application the environment
variable SUPER_TANGO is defined to true.</p>
</div>
<div class="section" id="the-event-buffer-size">
<h4>The event buffer size</h4>
<p>If required, the event buffer used by the ZMQ software could be tuned
using environment variables. These variables are named
TANGO_DS_EVENT_BUFFER_HWM for the event buffer on a device server
side and TANGO_EVENT_BUFFER_HWM for the event buffer on the client
size. Both of them are a number which is the maximum number of events
which could be stored in these buffers.</p>
</div>
</div>
</div>
</div>
<div class="section" id="the-tango-idl-file-module-tango">
<h1><a class="toc-backref" href="#id378">The TANGO IDL file : Module Tango</a></h1>
<p>The fundamental idea of a device as a network object which has methods
and data has been retained for TANGO. In TANGO objects are real C++/Java
objects which can be instantiated and accessed via their methods and
data by the client as if they were local objects. This interface is
defined in CORBA IDL. The fundamental interface is Device. All TANGO
control objects will be of this type i.e. they will implement and offer
the Device interface. Some wrapper classes group in an API will hide the
calls to the Device interface from the client so that the client will
only see the wrapper classes. All CORBA details will be hidden from the
client as far as possible.</p>
<div class="section" id="aliases">
<h2><a class="toc-backref" href="#id379">Aliases</a></h2>
<p><strong>AttributeConfigList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeConfig&gt; AttributeConfigList;</div>
</div>
<p><strong>AttributeConfigList_2</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeConfig_2&gt; AttributeConfigList_2;</div>
</div>
<p><strong>AttributeConfigList_3</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeConfig_3&gt; AttributeConfigList_3;</div>
</div>
<p><strong>AttributeConfigList_5</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeConfig_5&gt; AttributeConfigList_5;</div>
</div>
<p><strong>AttributeDimList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeDim&gt; AttributeDimList;</div>
</div>
<p><strong>AttributeValueList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeValue&gt; AttributeValueList;</div>
</div>
<p><strong>AttributeValueList_3</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeValue_3&gt; AttributeValueList_3;</div>
</div>
<p><strong>AttributeValueList_4</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeValue_4&gt; AttributeValueList_4;</div>
</div>
<p><strong>AttributeValueList_5</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttributeValue_5&gt; AttributeValueList_5;</div>
</div>
<p><strong>AttrQualityList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;AttrQuality&gt; AttrQualityList;</div>
</div>
<p><strong>CppClntIdent</strong></p>
<div class="line-block">
<div class="line">typedef unsigned long CppClntIdent;</div>
</div>
<p><strong>DevAttrHistoryList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevAttrHistory&gt; DevAttrHistoryList;</div>
</div>
<p><strong>DevAttrHistoryList_3</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevAttrHistory_3&gt; DevAttrHistoryList_3;</div>
</div>
<p><strong>DevBoolean</strong></p>
<div class="line-block">
<div class="line">typedef boolean DevBoolean;</div>
</div>
<p><strong>DevCmdHistoryList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevCmdHistory&gt; DevCmdHistoryList</div>
</div>
<p><strong>DevCmdInfoList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevCmdInfo&gt; DevCmdInfoList;</div>
</div>
<p><strong>DevCmdInfoList_2</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevCmdInfo_2&gt; DevCmdInfoList_2;</div>
</div>
<p><strong>DevDouble</strong></p>
<div class="line-block">
<div class="line">typedef double DevDouble;</div>
</div>
<p><strong>DevErrorList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevError&gt; DevErrorList;</div>
</div>
<p><strong>DevErrorListList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevErrorList&gt; DevErrorListList;</div>
</div>
<p><strong>DevFloat</strong></p>
<div class="line-block">
<div class="line">typedef float DevFloat;</div>
</div>
<p><strong>DevLong</strong></p>
<div class="line-block">
<div class="line">typedef long DevLong;</div>
</div>
<p><strong>DevShort</strong></p>
<div class="line-block">
<div class="line">typedef short DevShort;</div>
</div>
<p><strong>DevString</strong></p>
<div class="line-block">
<div class="line">typedef string DevString;</div>
</div>
<p><strong>DevULong</strong></p>
<div class="line-block">
<div class="line">typedef unsigned long DevULong;</div>
</div>
<p><strong>DevUShort</strong></p>
<div class="line-block">
<div class="line">typedef unsigned short DevUShort;</div>
</div>
<p><strong>DevVarCharArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;octet&gt; DevVarCharArray;</div>
</div>
<p><strong>DevVarDoubleArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;double&gt; DevVarDoubleArray;</div>
</div>
<p><strong>DevVarEncodedArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevEncoded&gt; DevVarEncodedArray;</div>
</div>
<p><strong>DevVarFloatArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;float&gt; DevVarFloatArray;</div>
</div>
<p><strong>DevVarLongArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;long&gt; DevVarLongArray;</div>
</div>
<p><strong>DevVarPipeDataEltArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;DevPipeDataElt&gt; DevVarPipeDataEltArray;</div>
</div>
<p><strong>DevVarShortArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;short&gt; DevVarShortArray;</div>
<div class="line"><strong>DevVarStateArray</strong></div>
</div>
<div class="line-block">
<div class="line">typedef sequence&lt;DevState&gt; DevVarStateArray;</div>
</div>
<p><strong>DevVarStringArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;string&gt; DevVarStringArray;</div>
</div>
<p><strong>DevVarULongArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;unsigned long&gt; DevVarULongArray;</div>
</div>
<p><strong>DevVarUShortArray</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;unsigned short&gt; DevVarUShortArray;</div>
</div>
<p><strong>EltInArrayList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;EltInArray&gt; EltInArrayList;<a href="#id65"><span class="problematic" id="id66">**</span></a><a href="#id67"><span class="problematic" id="id68">**</span></a></div>
</div>
<div class="system-message" id="id65">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13173); <em><a href="#id66">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id67">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13173); <em><a href="#id68">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p><strong>JavaUUID</strong></p>
<div class="line-block">
<div class="line">typedef unsigned long long JavaUUID[2];</div>
<div class="line"><strong>PipeConfigList</strong></div>
</div>
<div class="line-block">
<div class="line">typedef sequence&lt;PipeConfig&gt; PipeConfigList;</div>
<div class="line"><strong>NamedDevErrorList</strong></div>
</div>
<div class="line-block">
<div class="line">typedef sequence&lt;NamedDevError&gt; NamedDevErrorList;</div>
</div>
<p><strong>TimeValList</strong></p>
<div class="line-block">
<div class="line">typedef sequence&lt;TimeVal&gt; TimeValList;<a href="#id69"><span class="problematic" id="id70">**</span></a><a href="#id71"><span class="problematic" id="id72">**</span></a></div>
</div>
<div class="system-message" id="id69">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13187); <em><a href="#id70">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id71">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13187); <em><a href="#id72">backlink</a></em></p>
Inline strong start-string without end-string.</div>
</div>
<div class="section" id="enums">
<h2><a class="toc-backref" href="#id380">Enums</a></h2>
<p><strong>AttrDataFormat</strong></p>
<p>enum AttrDataFormat</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;SCALAR,</p>
<p>&nbsp;&nbsp;&nbsp;SPECTRUM,</p>
<p>&nbsp;&nbsp;&nbsp;IMAGE,</p>
<p>&nbsp;&nbsp;&nbsp;FMT_UNKNOWN</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeDataType</strong></p>
<p>enum AttributeDataType</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;ATT_BOOL,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_SHORT,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_LONG,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_LONG64,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_FLOAT,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_DOUBLE,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_UCHAR,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_USHORT,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_ULONG,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_ULONG64,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_STRING,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_STATE,</p>
<p>&nbsp;&nbsp;&nbsp;DEVICE_STATE,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_ENCODED,</p>
<p>&nbsp;&nbsp;&nbsp;ATT_NO_DATA</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttrQuality</strong></p>
<p>enum AttrQuality</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;ATTR_VALID,</p>
<p>&nbsp;&nbsp;&nbsp;ATTR_INVALID,</p>
<p>&nbsp;&nbsp;&nbsp;ATTR_ALARM,</p>
<p>&nbsp;&nbsp;&nbsp;ATTR_CHANGING,</p>
<p>&nbsp;&nbsp;&nbsp;ATTR_WARNING</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttrWriteType</strong></p>
<p>enum AttrWriteType</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;READ,</p>
<p>&nbsp;&nbsp;&nbsp;READ_WITH_WRITE,</p>
<p>&nbsp;&nbsp;&nbsp;WRITE,</p>
<p>&nbsp;&nbsp;&nbsp;READ_WRITE,</p>
<p>&nbsp;&nbsp;&nbsp;WT_UNKNOWN</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DispLevel</strong></p>
<p>enum DispLevel</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;OPERATOR,</p>
<p>&nbsp;&nbsp;&nbsp;EXPERT,</p>
<p>&nbsp;&nbsp;&nbsp;DL_UNKNOWN</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevSource</strong></p>
<p>enum DevSource</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;DEV,</p>
<p>&nbsp;&nbsp;&nbsp;CACHE,</p>
<p>&nbsp;&nbsp;&nbsp;CACHE_DEV</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevState</strong></p>
<p>enum DevState</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;ON,</p>
<p>&nbsp;&nbsp;&nbsp;OFF,</p>
<p>&nbsp;&nbsp;&nbsp;CLOSE,</p>
<p>&nbsp;&nbsp;&nbsp;OPEN,</p>
<p>&nbsp;&nbsp;&nbsp;INSERT,</p>
<p>&nbsp;&nbsp;&nbsp;EXTRACT,</p>
<p>&nbsp;&nbsp;&nbsp;MOVING,</p>
<p>&nbsp;&nbsp;&nbsp;STANDBY,</p>
<p>&nbsp;&nbsp;&nbsp;FAULT,</p>
<p>&nbsp;&nbsp;&nbsp;INIT,</p>
<p>&nbsp;&nbsp;&nbsp;RUNNING,</p>
<p>&nbsp;&nbsp;&nbsp;ALARM,</p>
<p>&nbsp;&nbsp;&nbsp;DISABLE,</p>
<p>&nbsp;&nbsp;&nbsp;UNKNOWN</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>ErrSeverity</strong></p>
<p>enum ErrSeverity</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;WARN,</p>
<p>&nbsp;&nbsp;&nbsp;ERR,</p>
<p>&nbsp;&nbsp;&nbsp;PANIC</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>LockerLanguage</strong></p>
<p>enum LockerLanguage</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;CPP,</p>
<p>&nbsp;&nbsp;&nbsp;JAVA</p>
<div class="line-block">
<div class="line">};</div>
<div class="line"><strong>PipeWriteType</strong></div>
</div>
<p>enum PipeWriteType</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;PIPE_READ,</p>
<p>&nbsp;&nbsp;&nbsp;PIPE_READ_WRITE,</p>
<p>&nbsp;&nbsp;&nbsp;PIPE_WT_UNKNOWN</p>
<p>};</p>
</div>
<div class="section" id="structs">
<h2><a class="toc-backref" href="#id381">Structs</a></h2>
<p><strong>ArchiveEventProp</strong></p>
<p>struct ArchiveEventProp</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string rel_change;</p>
<p>&nbsp;&nbsp;&nbsp;string abs_change;</p>
<p>&nbsp;&nbsp;&nbsp;string period;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<div class="line-block">
<div class="line">};<a href="#id73"><span class="problematic" id="id74">**</span></a><a href="#id75"><span class="problematic" id="id76">**</span></a></div>
<div class="line"><a href="#id77"><span class="problematic" id="id78">**</span></a><a href="#id79"><span class="problematic" id="id80">**</span></a></div>
<div class="line"><strong>AttributeAlarm</strong></div>
</div>
<div class="system-message" id="id73">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13402); <em><a href="#id74">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id75">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13402); <em><a href="#id76">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id77">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13403); <em><a href="#id78">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id79">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13403); <em><a href="#id80">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p>struct AttributeAlarm</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string min_alarm;</p>
<p>&nbsp;&nbsp;&nbsp;string max_alarm;</p>
<p>&nbsp;&nbsp;&nbsp;string min_warning;</p>
<p>&nbsp;&nbsp;&nbsp;string max_warning;</p>
<p>&nbsp;&nbsp;&nbsp;string delta_t;</p>
<p>&nbsp;&nbsp;&nbsp;string delta_val;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<div class="line-block">
<div class="line">};<a href="#id81"><span class="problematic" id="id82">**</span></a><a href="#id83"><span class="problematic" id="id84">**</span></a></div>
<div class="line"><a href="#id85"><span class="problematic" id="id86">**</span></a><a href="#id87"><span class="problematic" id="id88">**</span></a></div>
<div class="line"><strong>AttDataReady</strong></div>
</div>
<div class="system-message" id="id81">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13424); <em><a href="#id82">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id83">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13424); <em><a href="#id84">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id85">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13425); <em><a href="#id86">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id87">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13425); <em><a href="#id88">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p>struct AttributeAlarm</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;long data_type;</p>
<p>&nbsp;&nbsp;&nbsp;long ctr;</p>
<div class="line-block">
<div class="line">}<strong>;</strong></div>
<div class="line"><a href="#id89"><span class="problematic" id="id90">**</span></a><a href="#id91"><span class="problematic" id="id92">**</span></a></div>
<div class="line"><strong>AttributeConfig</strong></div>
</div>
<div class="system-message" id="id89">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13439); <em><a href="#id90">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id91">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 13439); <em><a href="#id92">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p>struct AttributeConfig</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttrWriteType writable;</p>
<p>&nbsp;&nbsp;&nbsp;AttrDataFormat data_format;</p>
<p>&nbsp;&nbsp;&nbsp;long data_type;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_x;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_y;</p>
<p>&nbsp;&nbsp;&nbsp;string description;</p>
<p>&nbsp;&nbsp;&nbsp;string label;</p>
<p>&nbsp;&nbsp;&nbsp;string unit;</p>
<p>&nbsp;&nbsp;&nbsp;string standard_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string display_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string format;</p>
<p>&nbsp;&nbsp;&nbsp;string min_value;</p>
<p>&nbsp;&nbsp;&nbsp;string max_value;</p>
<p>&nbsp;&nbsp;&nbsp;string min_alarm;</p>
<p>&nbsp;&nbsp;&nbsp;string max_alarm;</p>
<p>&nbsp;&nbsp;&nbsp;string writable_attr_name;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeConfig_2</strong></p>
<p>struct AttributeConfig_2</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttrWriteType writable;</p>
<p>&nbsp;&nbsp;&nbsp;AttrDataFormat data_format;</p>
<p>&nbsp;&nbsp;&nbsp;long data_type;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_x;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_y;</p>
<p>&nbsp;&nbsp;&nbsp;string description;</p>
<p>&nbsp;&nbsp;&nbsp;string label;</p>
<p>&nbsp;&nbsp;&nbsp;string unit;</p>
<p>&nbsp;&nbsp;&nbsp;string standard_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string display_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string format;</p>
<p>&nbsp;&nbsp;&nbsp;string min_value;</p>
<p>&nbsp;&nbsp;&nbsp;string max_value;</p>
<p>&nbsp;&nbsp;&nbsp;string min_alarm;</p>
<p>&nbsp;&nbsp;&nbsp;string max_alarm;</p>
<p>&nbsp;&nbsp;&nbsp;string writable_attr_name;</p>
<p>&nbsp;&nbsp;&nbsp;DispLevel level;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeConfig_3</strong></p>
<p>struct AttributeConfig_3</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttrWriteType writable;</p>
<p>&nbsp;&nbsp;&nbsp;AttrDataFormat data_format;</p>
<p>&nbsp;&nbsp;&nbsp;long data_type;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_x;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_y;</p>
<p>&nbsp;&nbsp;&nbsp;string description;</p>
<p>&nbsp;&nbsp;&nbsp;string label;</p>
<p>&nbsp;&nbsp;&nbsp;string unit;</p>
<p>&nbsp;&nbsp;&nbsp;string standard_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string display_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string format;</p>
<p>&nbsp;&nbsp;&nbsp;string min_value;</p>
<p>&nbsp;&nbsp;&nbsp;string max_value;</p>
<p>&nbsp;&nbsp;&nbsp;string writable_attr_name;</p>
<p>&nbsp;&nbsp;&nbsp;DispLevel level;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeAlarm alarm;</p>
<p>&nbsp;&nbsp;&nbsp;EventProperties event_prop;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray sys_extensions;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeConfig_5</strong></p>
<p>struct AttributeConfig_5</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttrWriteType writable;</p>
<p>&nbsp;&nbsp;&nbsp;AttrDataFormat data_format;</p>
<p>&nbsp;&nbsp;&nbsp;long data_type;</p>
<p>&nbsp;&nbsp;&nbsp;boolean memorized;</p>
<p>&nbsp;&nbsp;&nbsp;boolean mem_init;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_x;</p>
<p>&nbsp;&nbsp;&nbsp;long max_dim_y;</p>
<p>&nbsp;&nbsp;&nbsp;string description;</p>
<p>&nbsp;&nbsp;&nbsp;string label;</p>
<p>&nbsp;&nbsp;&nbsp;string unit;</p>
<p>&nbsp;&nbsp;&nbsp;string standard_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string display_unit;</p>
<p>&nbsp;&nbsp;&nbsp;string format;</p>
<p>&nbsp;&nbsp;&nbsp;string min_value;</p>
<p>&nbsp;&nbsp;&nbsp;string max_value;</p>
<p>&nbsp;&nbsp;&nbsp;string writable_attr_name;</p>
<p>&nbsp;&nbsp;&nbsp;DispLevel level;</p>
<p>&nbsp;&nbsp;&nbsp;string root_attr_name;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray enum_labels;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeAlarm att_alarm;</p>
<p>&nbsp;&nbsp;&nbsp;EventProperties event_prop;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray sys_extensions;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeDim</strong></p>
<p>struct AttributeDim</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;long dim_x;</p>
<p>&nbsp;&nbsp;&nbsp;long dim_y;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeValue</strong></p>
<p>struct AttributeValue</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;any value;</p>
<p>&nbsp;&nbsp;&nbsp;AttrQuality quality;</p>
<p>&nbsp;&nbsp;&nbsp;TimeVal time;</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;long dim_x;</p>
<p>&nbsp;&nbsp;&nbsp;long dim_y;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeValue_3</strong></p>
<p>struct AttributeValue_3</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;any value;</p>
<p>&nbsp;&nbsp;&nbsp;AttrQuality quality;</p>
<p>&nbsp;&nbsp;&nbsp;TimeVal time;</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDim r_dim;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDim w_dim;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorList err_list;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeValue_4</strong></p>
<p>struct AttributeValue_4</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;AttrValUnion value;</p>
<p>&nbsp;&nbsp;&nbsp;AttrQuality quality;</p>
<p>&nbsp;&nbsp;&nbsp;AttrDataFormat data_format;</p>
<p>&nbsp;&nbsp;&nbsp;TimeVal time;</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDim r_dim;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDim w_dim;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorList err_list;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>AttributeValue_5</strong></p>
<p>struct AttributeValue_5</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;AttrValUnion value;</p>
<p>&nbsp;&nbsp;&nbsp;AttrQuality quality;</p>
<p>&nbsp;&nbsp;&nbsp;AttrDataFormat data_format;</p>
<p>&nbsp;&nbsp;&nbsp;long data_type;</p>
<p>&nbsp;&nbsp;&nbsp;TimeVal time;</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDim r_dim;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDim w_dim;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorList err_list;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>ChangeEventProp</strong></p>
<p>struct ChangeEventProp</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string rel_change;</p>
<p>&nbsp;&nbsp;&nbsp;string abs_change;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevAttrHistory</strong></p>
<p>struct DevAttrHistory</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;boolean attr_failed;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeValue value;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorList errors;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevAttrHistory_3</strong></p>
<p>struct DevAttrHistory_3</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;boolean attr_failed;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeValue_3 value;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevAttrHistory_4</strong></p>
<p>struct DevAttrHistory_4</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;TimeValList dates;</p>
<p>&nbsp;&nbsp;&nbsp;any value;</p>
<p>&nbsp;&nbsp;&nbsp;AttrQualityList quals;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList quals_array;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDimList r_dims;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList r_dims_array;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDimList w_dims;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList w_dims_array;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorListList errors;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList errors_array;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevAttrHistory_5</strong></p>
<p>struct DevAttrHistory_5</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttrDataFormat data_format;</p>
<p>&nbsp;&nbsp;&nbsp;long data_type;</p>
<p>&nbsp;&nbsp;&nbsp;TimeValList dates;</p>
<p>&nbsp;&nbsp;&nbsp;any value;</p>
<p>&nbsp;&nbsp;&nbsp;AttrQualityList quals;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList quals_array;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDimList r_dims;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList r_dims_array;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDimList w_dims;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList w_dims_array;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorListList errors;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList errors_array;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevCmdHistory</strong></p>
<p>struct DevCmdHistory</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;TimeVal time;</p>
<p>&nbsp;&nbsp;&nbsp;boolean cmd_failed;</p>
<p>&nbsp;&nbsp;&nbsp;any value;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorList errors;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevCmdHistory_4</strong></p>
<p>struct DevCmdHistory_4</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;TimeValList dates;</p>
<p>&nbsp;&nbsp;&nbsp;any value;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeDimList dims;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList dims_array;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorListList errors;</p>
<p>&nbsp;&nbsp;&nbsp;EltInArrayList errors_array;</p>
<p>&nbsp;&nbsp;&nbsp;long cmd_type;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevCmdInfo</strong></p>
<p>struct DevCmdInfo</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string cmd_name;</p>
<p>&nbsp;&nbsp;&nbsp;long cmd_tag;</p>
<p>&nbsp;&nbsp;&nbsp;long in_type;</p>
<p>&nbsp;&nbsp;&nbsp;long out_type;</p>
<p>&nbsp;&nbsp;&nbsp;string in_type_desc;</p>
<p>&nbsp;&nbsp;&nbsp;string out_type_desc;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevCmdInfo_2</strong></p>
<p>struct DevCmdInfo_2</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string cmd_name;</p>
<p>&nbsp;&nbsp;&nbsp;DispLevel level;</p>
<p>&nbsp;&nbsp;&nbsp;long cmd_tag;</p>
<p>&nbsp;&nbsp;&nbsp;long in_type;</p>
<p>&nbsp;&nbsp;&nbsp;long out_type;</p>
<p>&nbsp;&nbsp;&nbsp;string in_type_desc;</p>
<p>&nbsp;&nbsp;&nbsp;string out_type_desc;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevEncoded</strong></p>
<p>struct DevEncoded</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;DevString encoded_format;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarCharArray encoded_data;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevError</strong></p>
<p>struct DevError</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string reason;</p>
<p>&nbsp;&nbsp;&nbsp;ErrSeverity severity;</p>
<p>&nbsp;&nbsp;&nbsp;string desc;</p>
<p>&nbsp;&nbsp;&nbsp;string origin;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevInfo</strong></p>
<p>struct DevInfo</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string dev_class;</p>
<p>&nbsp;&nbsp;&nbsp;string server_id;</p>
<p>&nbsp;&nbsp;&nbsp;string server_host;</p>
<p>&nbsp;&nbsp;&nbsp;long server_version;</p>
<p>&nbsp;&nbsp;&nbsp;string doc_url;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevInfo_3</strong></p>
<p>struct DevInfo_3</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string dev_class;</p>
<p>&nbsp;&nbsp;&nbsp;string server_id;</p>
<p>&nbsp;&nbsp;&nbsp;string server_host;</p>
<p>&nbsp;&nbsp;&nbsp;long server_version;</p>
<p>&nbsp;&nbsp;&nbsp;string doc_url;</p>
<p>&nbsp;&nbsp;&nbsp;string dev_type;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevIntrChange</strong></p>
<p>struct DevIntrChange</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;boolean dev_started;</p>
<p>&nbsp;&nbsp;&nbsp;DevCmdInfoList_2 cmds;</p>
<p>&nbsp;&nbsp;&nbsp;AttributeConfigList_5 atts;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevPipeBlob</strong></p>
<p>struct DevPipeBlob</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarPipeDataEltArray blob_data;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevPipeData</strong></p>
<p>struct DevPipeData</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;TimeVal time;</p>
<p>&nbsp;&nbsp;&nbsp;DevPipeBlob data_blob;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevPipeDataElt</strong></p>
<p>struct DevPipeDataElt</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;AttrValUnion value;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarPipeDataEltArray inner_blob;</p>
<p>&nbsp;&nbsp;&nbsp;string inner_blob_name;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevVarDoubleStringArray</strong></p>
<p>struct DevVarDoubleStringArray</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;DevVarDoubleArray dvalue;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray svalue;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>DevVarLongStringArray</strong></p>
<p>struct DevVarLongStringArray</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;DevVarLongArray lvalue;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray svalue;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>EltInArray</strong></p>
<p>struct EltInArray</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;long start;</p>
<p>&nbsp;&nbsp;&nbsp;long nb_elt;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>EventProperties</strong></p>
<p>struct EventProperties</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;ChangeEventProp ch_event;</p>
<p>&nbsp;&nbsp;&nbsp;PeriodicEventProp per_event;</p>
<p>&nbsp;&nbsp;&nbsp;ArchiveEventProp arch_event;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>JavaClntIdent</strong></p>
<p>struct JavaClntIdent</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string MainClass;</p>
<p>&nbsp;&nbsp;&nbsp;JavaUUID uuid;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>NamedDevError</strong></p>
<p>struct NamedDevError</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;long index_in_call;</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorList err_list;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>PeriodicEventProp</strong></p>
<p>struct PeriodicEventProp</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string period;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>PipeConfig</strong></p>
<p>struct PipeConfig</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;string name;</p>
<p>&nbsp;&nbsp;&nbsp;string description;</p>
<p>&nbsp;&nbsp;&nbsp;string label;</p>
<p>&nbsp;&nbsp;&nbsp;DispLevel level;</p>
<p>&nbsp;&nbsp;&nbsp;PipeWriteType writable;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray extensions;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>TimeV</strong>a<strong>l</strong></p>
<p>struct TimeVal</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;long tv_sec;</p>
<p>&nbsp;&nbsp;&nbsp;long tv_usec;</p>
<p>&nbsp;&nbsp;&nbsp;long tv_nsec;</p>
<div class="line-block">
<div class="line">};</div>
</div>
<p><strong>ZmqCallInfo</strong></p>
<p>struct ZmqCallInfo</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;long version;</p>
<p>&nbsp;&nbsp;&nbsp;unsigned long ctr;</p>
<p>&nbsp;&nbsp;&nbsp;string method_name;</p>
<p>&nbsp;&nbsp;&nbsp;DevVarCharArray oid;</p>
<p>&nbsp;&nbsp;&nbsp;boolean call_is_except;</p>
<p>};</p>
</div>
<div class="section" id="unions">
<h2><a class="toc-backref" href="#id382">Unions</a></h2>
<p><strong>AttrValUnion</strong></p>
<p>union AttrValUnion switch (AttributeDataType)</p>
<p>{</p>
<p>case ATT_BOOL:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarBooleanArray bool_att_value;</p>
<p>case ATT_SHORT:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarShortArray short_att_value;</p>
<p>case ATT_LONG:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarLongArray long_att_value;</p>
<p>case ATT_LONG64:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarLong64Array long64_att_value;</p>
<p>case ATT_FLOAT:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarFloatArray float_att_value;</p>
<p>case ATT_DOUBLE:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarDoubleArray double_att_value;</p>
<p>case ATT_UCHAR</p>
<p>&nbsp;&nbsp;&nbsp;DevVarCharArray uchar_att_value;</p>
<p>case ATT_USHORT:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarUShortArray ushort_att_value;</p>
<p>case ATT_ULONG:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarULongArray ulong_att_value;</p>
<p>case ATT_ULONG64:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarULong64Array ulong64_att_value;</p>
<p>case ATT_STRING:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStringArray string_att_value;</p>
<p>case ATT_STATE:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarStateArray state_att_value;</p>
<p>case DEVICE_STATE:</p>
<p>&nbsp;&nbsp;&nbsp;DevState dev_state_att;</p>
<p>case ATT_ENCODED:</p>
<p>&nbsp;&nbsp;&nbsp;DevVarEncodedArray encoded_att_value;</p>
<p>case ATT_NO_DATA:</p>
<p>&nbsp;&nbsp;&nbsp;DevBoolean union_no_data;</p>
<div class="line-block">
<div class="line">};<a href="#id93"><span class="problematic" id="id94">**</span></a><a href="#id95"><span class="problematic" id="id96">**</span></a></div>
<div class="line"><a href="#id97"><span class="problematic" id="id98">**</span></a><a href="#id99"><span class="problematic" id="id100">**</span></a></div>
<div class="line"><strong>ClntIdent</strong></div>
</div>
<div class="system-message" id="id93">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14253); <em><a href="#id94">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id95">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14253); <em><a href="#id96">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id97">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14254); <em><a href="#id98">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id99">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14254); <em><a href="#id100">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p>union ClntIdent switch (LockerLanguage)</p>
<p>{</p>
<p>case CPP:</p>
<p>&nbsp;&nbsp;&nbsp;CppClntIdent cpp_clnt;</p>
<p>case JAVA:</p>
<p>&nbsp;&nbsp;&nbsp;JavaClntIdent java_clnt;</p>
<p>};</p>
</div>
<div class="section" id="exceptions">
<h2><a class="toc-backref" href="#id383">Exceptions</a></h2>
<p><strong>DevFailed</strong></p>
<p>exception DevFailed</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;DevErrorList errors;</p>
<div class="line-block">
<div class="line">};<a href="#id101"><span class="problematic" id="id102">**</span></a><a href="#id103"><span class="problematic" id="id104">**</span></a></div>
<div class="line"><a href="#id105"><span class="problematic" id="id106">**</span></a><a href="#id107"><span class="problematic" id="id108">**</span></a></div>
<div class="line"><strong>MultiDevFailed</strong></div>
</div>
<div class="system-message" id="id101">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14282); <em><a href="#id102">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id103">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14282); <em><a href="#id104">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id105">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14283); <em><a href="#id106">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id107">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14283); <em><a href="#id108">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p>exception MultiDevFailed</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;NamedDevErrorList errors;</p>
<div class="line-block">
<div class="line">};</div>
</div>
</div>
<div class="section" id="interface-tango-device">
<h2><a class="toc-backref" href="#id384">Interface Tango::Device</a></h2>
<p>The fundamental interface for all TANGO objects. Each Device is a
network object which can be accessed locally or via network. The network
protocol on the wire will be IIOP. The Device interface implements all
the basic functions needed for doing generic synchronous and
asynchronous I/O on a device. A Device object has data and actions. Data
are represented in the form of Attributes. Actions are represented in
the form of Commands. The CORBA Device interface offers attributes and
methods to access the attributes and commands. A client will either use
these methods directly from C++ or Java or access them via wrapper
classes implemented in a API. The Device interface describes only the
remote network interface. Implementation features like threads, command
security, priority etc. are dealt with in server side of the device
server model.</p>
<div class="section" id="attributes">
<h3><a class="toc-backref" href="#id385">Attributes</a></h3>
<p><strong>adm_name</strong></p>
<p>readonly attribute string adm_name;</p>
<div class="line-block">
<div class="line">adm_name (readonly) - administrator device unique ascii identifier</div>
</div>
<p><strong>description</strong></p>
<p>readonly attribute string description;</p>
<div class="line-block">
<div class="line">description (readonly) - general description of device</div>
</div>
<p><strong>name</strong></p>
<p>readonly attribute string name;</p>
<div class="line-block">
<div class="line">name (readonly) - unique ascii identifier</div>
</div>
<p><strong>state</strong></p>
<p>readonly attribute DevState state;</p>
<div class="line-block">
<div class="line">state (readonly) - device state</div>
</div>
<p><strong>status</strong></p>
<p>readonly attribute string status;</p>
<p>status (readonly) - device state as ascii string</p>
</div>
<div class="section" id="operations">
<h3><a class="toc-backref" href="#id386">Operations</a></h3>
<p><strong>black_box</strong></p>
<p>DevVarStringArray black_box(in long number)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read list of last N commands executed by clients</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;number – of commands to return</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of command and clients</div>
</div>
<p><strong>command_inout</strong></p>
<p>any command_inout(in string command, in any argin)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">execute a command on a device synchronously with no input parameter
and one one output parameter</div>
<div class="line"><em>Parameters:</em></div>
</div>
<p>&nbsp;&nbsp;&nbsp;command – ascii string e.g. On</p>
<p>&nbsp;&nbsp;&nbsp;argin – command input parameter e.g. float</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;command result.</div>
</div>
<p><strong>command_list_query</strong></p>
<p>DevCmdInfoList command_list_query()</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">query device to see what commands it supports</div>
<div class="line"><em>Returns</em>:</div>
</div>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of commands and their types</div>
</div>
<p><strong>command_query</strong></p>
<p>DevCmdInfo command_query(in string command)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">query device to see command argument</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;command – name</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;command and its types</div>
</div>
<p><strong>get_attribute_config</strong></p>
<p>AttributeConfigList get_attribute_config(in DevVarStringArray names)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read the configuration for a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute configurations read</div>
</div>
<p><strong>info</strong></p>
<p>DevInfo info()</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">return general information about object e.g. class, type, ...</div>
<div class="line"><em>Returns</em>:</div>
</div>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;device info</div>
</div>
<p><strong>ping</strong></p>
<p>void ping()</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">ping a device to see if it alive</div>
</div>
<p><strong>read_attributes</strong></p>
<p>AttributeValueList read_attributes(in DevVarStringArray names)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute values read</div>
</div>
<p><strong>set_attribute_config</strong></p>
<p>void set_attribute_config(in AttributeConfigList new_conf)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">set the configuration for a variable list of attributes from the
device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;new_conf – list of attribute configuration to be set</div>
</div>
<p><strong>write_attributes</strong></p>
<p>void write_attributes(in AttributeValueList values)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">write a variable list of attributes to a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;values – list of attribute values to write</p>
</div>
</div>
<div class="section" id="interface-tango-device-2">
<h2><a class="toc-backref" href="#id387">Interface Tango::Device_2</a></h2>
<div class="line-block">
<div class="line">interface Device_2 inherits from Tango::Device</div>
<div class="line">The updated Tango device interface. It inherits from Tango::Device and
therefore supports all attribute/operation defined in the
Tango::Device interface. Two CORBA operations have been modified to
support more parameters (command_inout_2 and read_attribute_2).
Three CORBA operations now retrun a different data type
(command_list_query_2, command_query_2 and
get_attribute_config)</div>
</div>
<div class="section" id="id109">
<h3><a class="toc-backref" href="#id388">Operations</a></h3>
<p><strong>command_inout_2</strong></p>
<p>any command_inout_2(in string command, in any argin, in DevSource
source)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">execute a command on a device synchronously with no input parameter
and one one output parameter</div>
<div class="line"><em>Parameters:</em></div>
</div>
<p>&nbsp;&nbsp;&nbsp;command – ascii string e.g. On</p>
<p>&nbsp;&nbsp;&nbsp;argin – command input parameter</p>
<p>&nbsp;&nbsp;&nbsp;source – data source</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;command result.</div>
</div>
<p><strong>command_inout_history_2</strong></p>
<p>DevCmdHistoryList command_inout_history_2(in string command, in long
n)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">Get command result history from polling buffer. Obviously, the command
must be polled.</div>
<div class="line"><em>Parameters:</em></div>
</div>
<p>&nbsp;&nbsp;&nbsp;command – ascii string e.g. On</p>
<p>&nbsp;&nbsp;&nbsp;n – record number</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of command result (or exception parameters if the command
failed).</div>
</div>
<p><strong>command_list_query_2</strong></p>
<p>DevCmdInfoList_2 command_list_query_2()</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">query device to see what commands it supports</div>
<div class="line"><em>Returns</em>:</div>
</div>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of commands and their types</div>
</div>
<p><strong>command_query_2</strong></p>
<p>DevCmdInfo_2 command_query_2(in string command)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">query device to see command argument</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;command – name</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;command and its types</div>
</div>
<p><strong>get_attribute_config_2</strong></p>
<p>AttributeConfigList_2 get_attribute_config_2(in DevVarStringArray
names)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read the configuration for a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute configurations read</div>
</div>
<p><strong>read_attributes_2</strong></p>
<p>AttributeValueList read_attributes_2(in DevVarStringArray names, in
DevSource source)</p>
<div class="line-block">
<div class="line">raises(DevFailed)</div>
<div class="line">read a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute values read <a href="#id110"><span class="problematic" id="id111">**</span></a><a href="#id112"><span class="problematic" id="id113">**</span></a></div>
</div>
<div class="system-message" id="id110">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14574); <em><a href="#id111">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id112">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14574); <em><a href="#id113">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p><strong>read_attribute_history_2</strong></p>
<p>DevAttrHistoryList read_attributes_history_2(in string name, in long
n)</p>
<div class="line-block">
<div class="line">raises(DevFailed)</div>
<div class="line">Get attribute value history from polling buffer. Obviously, the
attribute must be polled.</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – Attribute name to read history</p>
<p>&nbsp;&nbsp;&nbsp;n – Record number</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute value (or exception parameters if the attribute
failed).</div>
</div>
</div>
</div>
<div class="section" id="interface-tango-device-3">
<h2><a class="toc-backref" href="#id389">Interface Tango::Device_3</a></h2>
<div class="line-block">
<div class="line">interface Device_3 inherits from Tango::Device_2</div>
<div class="line">The updated Tango device interface for Tango release 5. It inherits
from Tango::Device_2 and therefore supports all attribute/operation
defined in the Tango::Device_2 interface. Six CORBA operations now
return a different data type (read_attributes_3,
write_attributes_3, read_attribute_history_3, info_3,
get_attribute_config_3 and set_attribute_config_3)</div>
</div>
<div class="section" id="id114">
<h3><a class="toc-backref" href="#id390">Operations</a></h3>
<p><strong>read_attributes_3</strong></p>
<p>AttributeValueList_3 read_attributes_3(in DevVarStringArray names, in
DevSource source)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p>&nbsp;&nbsp;&nbsp;source – data source</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute values read <a href="#id115"><span class="problematic" id="id116">**</span></a><a href="#id117"><span class="problematic" id="id118">**</span></a></div>
</div>
<div class="system-message" id="id115">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14624); <em><a href="#id116">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id117">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14624); <em><a href="#id118">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p><strong>write_attributes_3</strong></p>
<p>void write_attributes_3(in AttributeValueList values)</p>
<div class="line-block">
<div class="line">raises(DevFailed, MultiDevFailed);</div>
<div class="line">write a variable list of attributes to a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;values – list of attribute values to write</div>
</div>
<p><strong>read_attribute_history_3</strong></p>
<p>DevAttrHistoryList_3 read_attributes_history_3(in string name, in
long n)</p>
<div class="line-block">
<div class="line">raises(DevFailed)</div>
<div class="line">Get attribute value history from polling buffer. Obviously, the
attribute must be polled.</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – Attribute name to read history</p>
<p>&nbsp;&nbsp;&nbsp;n – Record number</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute value (or exception parameters if the attribute
failed).</div>
</div>
<p><strong>info_3</strong></p>
<p>DevInfo_3 info()</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">return general information about object e.g. class, type, ...</div>
<div class="line"><em>Returns</em>:</div>
</div>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;device info</div>
</div>
<p><strong>get_attribute_config_3</strong></p>
<p>AttributeConfigList_3 get_attribute_config_3(in DevVarStringArray
names)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read the configuration for a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute configurations read</div>
</div>
<p><strong>set_attribute_config_3</strong></p>
<p>void set_attribute_config_3(in AttributeConfigList_3 new_conf)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">set the configuration for a variable list of attributes from the
device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;new_conf – list of attribute configuration to be set</div>
</div>
</div>
</div>
<div class="section" id="interface-tango-device-4">
<h2><a class="toc-backref" href="#id391">Interface Tango::Device_4</a></h2>
<div class="line-block">
<div class="line">interface Device_4 inherits from Tango::Device_3</div>
<div class="line">The updated Tango device interface for Tango release 7. It inherits
from Tango::Device_3 and therefore supports all attribute/operation
defined in the Tango::Device_3 interface.</div>
</div>
<div class="section" id="id119">
<h3><a class="toc-backref" href="#id392">Operations</a></h3>
<p><strong>read_attributes_4</strong></p>
<p>AttributeValueList_4 read_attributes_4(in DevVarStringArray names, in
DevSource source,in ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p>&nbsp;&nbsp;&nbsp;source – data source</p>
<p>&nbsp;&nbsp;&nbsp;cl_ident – client identificator</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute values read <a href="#id120"><span class="problematic" id="id121">**</span></a><a href="#id122"><span class="problematic" id="id123">**</span></a></div>
</div>
<div class="system-message" id="id120">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14719); <em><a href="#id121">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id122">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14719); <em><a href="#id123">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p><strong>write_attributes_4</strong></p>
<p>void write_attributes_3(in AttributeValueList_4 values, in ClniIdent
cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed, MultiDevFailed);</div>
<div class="line">write a variable list of attributes to a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;values – list of attribute values to write</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;cl_ident – client identificator</div>
</div>
<p><strong>command_inout_4</strong></p>
<p>any command_inout_4(in string command, in any argin, in DevSource
source, In ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">Execute a command on a device synchronously with one input parameter
and one one output parameter</div>
<div class="line"><em>Parameters:</em></div>
</div>
<p>&nbsp;&nbsp;&nbsp;command – ascii string e.g. On</p>
<p>&nbsp;&nbsp;&nbsp;argin – command input parameter</p>
<p>&nbsp;&nbsp;&nbsp;source – data source</p>
<p>&nbsp;&nbsp;&nbsp;cl_ident – client identificator</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;command result</div>
</div>
<p><strong>read_attribute_history_4</strong></p>
<p>DevAttrHistory_4 read_attributes_history_4(in string name, in long
n)</p>
<div class="line-block">
<div class="line">raises(DevFailed)</div>
<div class="line">Get attribute value history from polling buffer. Obviously, the
attribute must be polled.</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – Attribute name to read history</p>
<p>&nbsp;&nbsp;&nbsp;n – Record number</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;Attribute value (or exception parameters if the attribute failed)
coded in a structure.</div>
</div>
<p><strong>command_inout_history_4</strong></p>
<p>DevCmdHistory_4 command_inout_history_4(in string command, in long
n)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">Get command value history from polling buffer. Obviously, the command
must be polled.</div>
<div class="line">Parameters:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – Command name to read history</p>
<p>&nbsp;&nbsp;&nbsp;n – Record number</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;Command value (or exception paramteters) coded in a structure</div>
</div>
<p><strong>write_read_attribute_4</strong></p>
<p>AttributeValueList_4 write_read_attribute_4(in AttributeValueList_4
values, in ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed,MultiDevFailed);</div>
<div class="line">Write then read a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;values – list of attribute values to write</p>
<p>&nbsp;&nbsp;&nbsp;cl_ident – client identificator</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute values read</div>
</div>
<p><strong>set_attribute_config_4</strong></p>
<p>void set_attribute_config_4(in AttributeConfigList_3 new_conf, in
ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">set the configuration for a variable list of attributes from the
device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;new_conf – list of attribute configuration to be set</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;cl_ident – client identificator</div>
<div class="line">Interface Tango::Device_4</div>
</div>
<div class="line-block">
<div class="line">interface Device_4 inherits from Tango::Device_3</div>
<div class="line">The updated Tango device interface for Tango release 7. It inherits
from Tango::Device_3 and therefore supports all attribute/operation
defined in the Tango::Device_3 interface.</div>
</div>
</div>
</div>
<div class="section" id="interface-tango-device-5">
<h2><a class="toc-backref" href="#id393">Interface Tango::Device_5</a></h2>
<div class="line-block">
<div class="line">interface Device_5 inherits from Tango::Device_4</div>
<div class="line">The updated Tango device interface for Tango release 9. It inherits
from Tango::Device_4 and therefore supports all attribute/operation
defined in the Tango::Device_4 interface.</div>
</div>
<div class="section" id="id124">
<h3><a class="toc-backref" href="#id394">operations</a></h3>
<p><strong>get_attribute_config_5</strong></p>
<p>AttributeConfigList_5 get_attribute_config_5(in DevVarStringArray
names)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read the configuration for a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute configurations read</div>
</div>
<p><strong>set_attribute_config_5</strong></p>
<p>void set_attribute_config_5(in AttributeConfigList_5 new_conf, in
ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">set the configuration for a variable list of attributes from the
device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;new_conf – list of attribute configuration to be set</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;cl_ident – client identificator</div>
<div class="line"><strong>read_attributes_5</strong></div>
</div>
<p>AttributeValueList_5 read_attributes_5(in DevVarStringArray names, in
DevSource source,in ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of attribute names to read</p>
<p>&nbsp;&nbsp;&nbsp;source – data source</p>
<p>&nbsp;&nbsp;&nbsp;cl_ident – client identificator</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute values read</div>
<div class="line"><strong>write_read_attributes_5</strong></div>
</div>
<p>AttributeValueList_5 write_read_attributes_5(in
AttributeValueList_4 values, in DevVarStringArray r_names, in
ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed,MultiDevFailed);</div>
<div class="line">Write then read a variable list of attributes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;values – list of attribute values to write</p>
<p>&nbsp;&nbsp;&nbsp;r_names – list of attribute to read</p>
<p>&nbsp;&nbsp;&nbsp;cl_ident – client identificator</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of attribute values read<a href="#id125"><span class="problematic" id="id126">**</span></a><a href="#id127"><span class="problematic" id="id128">**</span></a></div>
<div class="line"><strong>read_attribute_history_5</strong></div>
</div>
<div class="system-message" id="id125">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14905); <em><a href="#id126">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id127">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14905); <em><a href="#id128">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p>DevAttrHistory_5 read_attributes_history_5(in string name, in long
n)</p>
<div class="line-block">
<div class="line">raises(DevFailed)</div>
<div class="line">Get attribute value history from polling buffer. Obviously, the
attribute must be polled.</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – Attribute name to read history</p>
<p>&nbsp;&nbsp;&nbsp;n – Record number</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;Attribute value (or exception parameters if the attribute failed)
coded in a structure.</div>
<div class="line"><strong>get_pipe_config_5</strong></div>
</div>
<p>PipeConfigList get_pipe_config_5(in DevVarStringArray names)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read the configuration for a variable list of pipes from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – list of pipe names to read</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;list of pipe configurations</div>
<div class="line"><strong>set_pipe_config_5</strong></div>
</div>
<p>void set_pipe_config_5(in PipeConfigList new_conf, in ClntIdent
cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">set the configuration for a variable list of pipes from the device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;new_conf – list of pipe configuration to be set</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;cl_ident – client identificator<a href="#id129"><span class="problematic" id="id130">**</span></a><a href="#id131"><span class="problematic" id="id132">**</span></a></div>
<div class="line"><strong>read_pipe_5</strong></div>
</div>
<div class="system-message" id="id129">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14948); <em><a href="#id130">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<div class="system-message" id="id131">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">tango.rst</tt>, line 14948); <em><a href="#id132">backlink</a></em></p>
Inline strong start-string without end-string.</div>
<p>DevPipeData read_pipe_5(in string name, in ClntIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">read a pipe from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;name – pipe name to read</p>
<p>&nbsp;&nbsp;&nbsp;cl_ident – client identificator</p>
<p><em>Returns</em>:</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;Pipe value</div>
</div>
<p><strong>write_pipe_5</strong></p>
<p>void write_pipe_5(in DevPipeData value, in ClniIdent cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">write a pipe to a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;value – new pipe value to write</p>
<div class="line-block">
<div class="line">&nbsp;&nbsp;&nbsp;cl_ident – client identificator</div>
<div class="line"><strong>write_read_pipe_5</strong></div>
</div>
<p>DevPipeData write_read_pipe_5(in DevPipeData value, in ClntIdent
cl_ident)</p>
<div class="line-block">
<div class="line">raises(DevFailed);</div>
<div class="line">Write then read a pipe from a device</div>
<div class="line"><em>Parameters</em>:</div>
</div>
<p>&nbsp;&nbsp;&nbsp;value – New pipe value to write</p>
<p>&nbsp;&nbsp;&nbsp;cl_ident – client identificator</p>
<p><em>Returns</em>:</p>
<p>&nbsp;&nbsp;&nbsp;pipe values read</p>
</div>
</div>
</div>
<div class="section" id="tango-object-naming-device-attribute-and-property">
<h1><a class="toc-backref" href="#id395">Tango object naming (device, attribute and property)</a></h1>
<div class="section" id="device-name">
<h2><a class="toc-backref" href="#id396">Device name</a></h2>
<p>A Tango device name is a three fields name. The field separator is the
<strong>/</strong> character. The first field is named <strong>domain</strong>, the second field
is named <strong>family</strong> and the last field is named <strong>member</strong>.A tango
device name looks like</p>
<p>domain/family/member</p>
<p>It is a hierarchical notation. The member specifies which element within
a family. The family specifies which kind of equipment within a domain.
The domain groups devices related to which part of the
accelerator/experiment they belongs to. At ESRF, some of the machine
control system domain name are SR for the storage ring, TL1 for the
transfer line 1 or SY for the synchrotron booster. For experiment, ID11
is the domain name for all devices belonging to the experiment behind
insertion device 11. Here are some examples of Tango device name used at
the ESRF :</p>
<ul class="simple">
<li><strong>sr/d-ct/1</strong> : The current transformer. The domain part is sr for
storage ring. The family part is d-ct for diagnostic/current
transformer and the member part is 1</li>
<li><strong>fe/v-pen/id11-1</strong> : A Penning gauge. The domain part is fe for
front-end. The family part is v-pen for vacuum/penning and the member
name is id11-1 to specify that this is the first gauge on the
front-end part after the insertion device 11</li>
</ul>
</div>
<div class="section" id="full-object-name">
<h2><a class="toc-backref" href="#id397">Full object name</a></h2>
<p>The device name as described above is not enough to cover all Tango
usage like device server without database or device access for multi
control system. With the naming schema, we must also be able to name
attribute and property. Therefore, the full naming schema is</p>
<p><em>[protocol://][host:port/]device_name[/attribute][-&gt;property][#dbase=xx</em>]</p>
<p>The protocol, host, port, attribute, property and dbase fields are
optional. The meaning of these fields are :</p>
<p>00.00.0000</p>
<p>: Specifies which protocol is used (Tango or Taco). Tango is the default</p>
<p>: The supported value for xx is <em>yes</em> and <em>no</em>. This field is used to
specify that the device is a device served by a device server started
with or without database usage. The default value is <em>dbase=yes</em></p>
<p>: This field has different meaning according to the dbase value. If
<em>dbase=yes</em> (the default), the host is the host where the control system
database server is running and port is the database server port. It has
a higher priority than the value defined by the TANGO_HOST environment
variable. If <em>dbase=no</em>, host is the host name where the device server
process serving the device is running and port is the device server
process port.</p>
<p>: The attribute name</p>
<p>: The property name</p>
<p>The host:port and dbase=xx fields are necessary only when creating the
DeviceProxy object used to remotely access the device. The -&gt; characters
are used to specify a property name.</p>
<div class="section" id="some-examples">
<h3><a class="toc-backref" href="#id398">Some examples</a></h3>
<div class="section" id="full-device-name-examples">
<h4>Full device name examples</h4>
<ul class="simple">
<li><strong>gizmo:20000/sr/d-ct/1</strong> : Device sr/d-ct/1 running in a specified
control system with the database server running on a host called
gizmo and using the port number 20000. The TANGO_HOST environment
variable will not be used.</li>
<li><strong>tango://freak:2345/id11/rv/1#dbase=no</strong> : Device served by a device
server started without database. The server is running on a host
called freak and use port number 2345.
//freak:2345/id11/rv/1#dbase=no is also possible for the same device.</li>
<li><strong>Taco://sy/ps-ki/1</strong> : Taco device sy/ps-ki/1</li>
</ul>
</div>
<div class="section" id="attribute-name-examples">
<h4>Attribute name examples</h4>
<ul class="simple">
<li><strong>id11/mot/1/Position</strong> : Attribute position for device id11/mot/1</li>
<li><strong>sr/d-ct/1/Lifetime</strong> : Attribute lifetime for Tango device
sr/d-ct/1</li>
</ul>
</div>
<div class="section" id="attribute-property-name">
<h4>Attribute property name</h4>
<ul class="simple">
<li><strong>id11/rv/1/temp-&gt;label</strong> : Property label for attribute temp for
device id11/rv/1.</li>
<li><strong>sr/d-ct/1/Lifetime-&gt;unit</strong> : The unit property for the Lifetime
attribute of the sr/d-ct/1 device</li>
</ul>
</div>
<div class="section" id="device-property-name">
<h4>Device property name</h4>
<ul class="simple">
<li><strong>sr/d-ct/1-&gt;address</strong> : the address property for device sr/d-ct/1</li>
</ul>
</div>
<div class="section" id="class-property-name">
<h4>Class property name</h4>
<ul class="simple">
<li><strong>Starter-&gt;doc_url</strong> : The doc_url property for a class called
Starter</li>
</ul>
</div>
</div>
</div>
<div class="section" id="device-and-attribute-name-alias">
<h2><a class="toc-backref" href="#id399">Device and attribute name alias</a></h2>
<p>Within Tango, each device or attribute can have an alias name defined in
the database. Every time a device or an attribute name is requested by
the API’s, it is possible to use the alias. The alias is simply an open
string stored in the database. The rule of the alias is to give device
or attribute name a name more natural from the physicist point of view.
Let’s imagine that for experiment, the sample position is described by
angles called teta and psi in physics book. It is more natural for
physicist when they move the motor related to sample position to use
<em>teta</em> and <em>psi</em> rather device name like <em>idxx/mot/1</em> or <em>idxx/mot/2</em>.
An attribute alias is a synonym for the four fields used to name an
attribute. For instance, the attribute <em>Current</em> of a power-supply
device called <em>sr/ps/dipole</em> could have an alias <em>DipoleCurrent</em>. This
alias can be used when creating an instance of a AttributeProxy class
instead of the full attribute name which is <em>sr/ps/dipole/Current</em>.
Device alias name are uniq within a Tango control system. Attribute
alias name are also uniq within a Tango control system.</p>
</div>
<div class="section" id="reserved-words-and-characters-limitations">
<h2><a class="toc-backref" href="#id400">Reserved words and characters, limitations</a></h2>
<p>From the naming schema described above, the reserved characters are
<strong>:</strong>,<strong>#</strong>,<strong>/</strong> and the reserved string is : <strong>-&gt;</strong>. On top of
that, the dbt_update tool (tool to fulfill database from the content of
a file) reserved the <strong>device</strong> word</p>
<p>The device name, its domain, member and family fields and its alias are
stored in the Tango database. The default maximum size for these items
are :</p>
<dl class="docutils">
<dt>|c|c| Item &amp; max length</dt>
<dd>device name &amp; 255
domain field &amp; 85
family field &amp; 85
member field &amp; 85
device alias name &amp; 255</dd>
</dl>
<p>The device name, the command name, the attribute name, the property
name, the device alias name and the device server name are <strong>case
insensitive</strong>.</p>
</div>
</div>
<div class="section" id="starting-a-tango-control-system">
<h1><a class="toc-backref" href="#id401">Starting a Tango control system</a></h1>
<div class="section" id="without-database">
<h2><a class="toc-backref" href="#id402">Without database</a></h2>
<p>When used without database, there is no additional process to start.
Simply starts device server using the -nodb option (and eventually the
-dlist option) on specific port. See [sec:Device-server-without] to find
informations on how to start/write Tango device server not using the
database.</p>
</div>
<div class="section" id="with-database">
<h2><a class="toc-backref" href="#id403">With database</a></h2>
<p>Starting the Tango control system simply means starting its database
device server on a well defined host using a well defined port. Use the
host name and the port number to build the TANGO_HOST environment
variable. See [Env variable] to find how starting a device server on a
specific host. Obviously, the underlying database software (MySQL) must
be started before the Tango database device server. The Tango database
server connects to MySQL using a default logging name set to root. You
can change this behaviour with the MYSQL_USER and MYSQL_PASSWORD
environment variables. Define them before starting the database server.</p>
<p>If you are using the Tango administration graphical tool called
<strong>Astor</strong>, you also need to start a specific Tango device server called
<strong>Starter</strong> on each host where Tango device server(s) are running. See
 for Astor documentation. This starter
device server is able to start even before the Tango database device
server is started. In this case, it will enter a loop in which it
periodically tries to access the Tango database device. The loop exits
and the server starts only if the database device access succeed.</p>
</div>
<div class="section" id="with-database-and-event">
<h2><a class="toc-backref" href="#id404">With database and event</a></h2>
<div class="section" id="for-tango-releases-lower-than-8">
<h3><a class="toc-backref" href="#id405">For Tango releases lower than 8</a></h3>
<p>On top of what is described in the previous chapter, using event means
using CORBA Notification service. Start one Notification Service daemon
on each host where device server(s) used via events are running. The
Notification Service daemon event channel factory IOR has to be
registered in the Tango database. This is done with the <strong>notifd2db</strong>
command. The notification daemon is a process with a high thread number.
By default, Unix like operating systems reserve a big amount of memory
for each thread stack (8 MByte for Linux/Ubuntu, 10 MByte for
Linux/RedHat 4). If your process has several hundreds of threads, this
could generate a too high memory requirement on virtual memory and even
exceed the maximun allowed memory per process (3 GBytes on Linux for 32
bits computer). The notification service daemon works very well with a
value of only 2 Mybtes for thread stack. The Unix command line ulimit -s
2048 asks the operating system to give 2 Mbytes for each thread stack.
Example of starting and registering a Notification Service daemon on a
UNIX like operating system</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">ulimit</span> <span class="operator">-</span><span class="name">s</span> <span class="literal number integer">2048</span>
<span class="ln">2 </span>  <span class="name">notifd</span> <span class="operator">-</span><span class="name">n</span> <span class="operator">-</span><span class="name">DDeadFilterInterval</span><span class="operator">=</span><span class="literal number integer">300</span> <span class="operator">&amp;</span>
<span class="ln">3 </span>  <span class="name">notifd2db</span>
</pre>
<p>The Notification Service daemon is started at line 2. Its
-DDeadFilterInterval option is used to specify some internal cleaning of
dead objects within the notification service. The -n option is used to
disable the use of the CORBA Naming Service for registering the default
event channel factory. The registration of the Notification Service
daemon in the Tango database is done at line 2.</p>
<p>It differs on a Windows computer</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">notifd</span> <span class="operator">-</span><span class="name">n</span> <span class="operator">-</span><span class="name">DDeadFilterInterval</span><span class="operator">=</span><span class="literal number integer">300</span> <span class="operator">-</span><span class="name">DFactoryIORFileName</span><span class="operator">=</span><span class="name label">C</span><span class="punctuation">:</span><span class="error">\</span><span class="name">Temp</span><span class="error">\</span><span class="name">evfact</span><span class="punctuation">.</span><span class="name">ior</span> <span class="operator">&amp;</span>
<span class="ln">2 </span>  <span class="name">notifd2db</span> <span class="name label">C</span><span class="punctuation">:</span><span class="error">\</span><span class="name">Temp</span><span class="error">\</span><span class="name">evfact</span><span class="punctuation">.</span><span class="name">ior</span>
</pre>
</div>
<div class="section" id="for-release-8-and-above">
<h3><a class="toc-backref" href="#id406">For release 8 and above</a></h3>
<p>A new event system has been implemented starting with Tango release 8.
With this new event system, the CORBA Notification service is not needed
any more. This means that <strong>as soon</strong> as all Tango device server
processes running on a host and all clients using events from their
devices used Tango 8, it is not required to start any process other than
the device servers and the clients. You can forget the previous
sub-chapter!</p>
</div>
</div>
<div class="section" id="with-file-used-as-database">
<h2><a class="toc-backref" href="#id407">With file used as database</a></h2>
<p>When used with database on file, there is no additional process to
start. Simply starts device server using the -file option specifying
file name port. See [sec:Device-server-file] to find informations on how
to start Tango device server using database on file.</p>
</div>
<div class="section" id="with-file-used-as-database-and-event">
<h2><a class="toc-backref" href="#id408">With file used as database and event</a></h2>
<div class="section" id="id133">
<h3><a class="toc-backref" href="#id409">For Tango releases lower than 8</a></h3>
<p>Using event means using CORBA Notification service. Start one
Notification Service daemon on the host where device server(s) using
events are running. The Notification Service daemon event channel
factory IOR has to be registered in the file(s) use as database. This is
done with the <strong>notifd2db</strong> command. Example of starting and registering
a Notification Service daemon on a UNIX like operating system</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">notifd</span> <span class="operator">-</span><span class="name">n</span> <span class="operator">-</span><span class="name">DDeadFilterInterval</span><span class="operator">=</span><span class="literal number integer">300</span> <span class="operator">&amp;</span>
<span class="ln">2 </span>  <span class="name">notifd2db</span> <span class="operator">-</span><span class="name">o</span> <span class="operator">/</span><span class="name">var</span><span class="operator">/</span><span class="name">myfile</span><span class="punctuation">.</span><span class="name">res</span>
</pre>
<p>The Notification Service daemon is started at line 1. Its -n option is
used to disable the use of the CORBA Naming Service for registering the
default event channel factory. The registration of the Notification
Service daemon in the file used as database is done at line 2 with its
<strong>-o</strong> command line option.</p>
<p>It differs on a Windows computer because the name of the file used by
the CORBA notification service to store its channel factory IOR must be
specified using its -D command line option. This file name has also to
be passed to the notifd2db command.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">notifd</span> <span class="operator">-</span><span class="name">n</span> <span class="operator">-</span><span class="name">DDeadFilterInterval</span><span class="operator">=</span><span class="literal number integer">300</span> <span class="operator">-</span><span class="name">DFactoryIORFileName</span><span class="operator">=</span><span class="name label">C</span><span class="punctuation">:</span><span class="error">\</span><span class="name">Temp</span><span class="error">\</span><span class="name">evfact</span><span class="punctuation">.</span><span class="name">ior</span> <span class="operator">&amp;</span>
<span class="ln">2 </span>  <span class="name">notifd2db</span> <span class="name label">C</span><span class="punctuation">:</span><span class="error">\</span><span class="name">Temp</span><span class="error">\</span><span class="name">evfact</span><span class="punctuation">.</span><span class="name">ior</span> <span class="operator">-</span><span class="name">o</span> <span class="name label">C</span><span class="punctuation">:</span><span class="error">\</span><span class="name">Temp</span><span class="error">\</span><span class="name">myfile</span><span class="punctuation">.</span><span class="name">res</span>
</pre>
</div>
<div class="section" id="id134">
<h3><a class="toc-backref" href="#id410">For release 8 and above</a></h3>
<p>A new event system has been implemented starting with Tango release 8.
With this new event system, the CORBA Notification service is not needed
any more. This means that <strong>as soon</strong> as all clients using events from
devices embedded in the device server use Tango 8, it is not required to
start any process other than the device server and its clients.</p>
</div>
</div>
<div class="section" id="with-the-controlled-access">
<h2><a class="toc-backref" href="#id411">With the controlled access</a></h2>
<p>Using the Tango controlled access means starting a specific device
server called TangoAccessControl. By default, this server has to be
started with the instance name set to 1 and its device name is
sys/access_control/1. The command line to start this device server is:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">TangoAccessControl</span> <span class="literal number integer">1</span>
</pre>
<p>This server connects to MySQL using a default logging name set to root.
You can change this behaviour with the MYSQL_USER and MYSQL_PASSWORD
environment variables. Define them before starting the controlled access
device server. This server also uses the MYSQL_HOST environment
variable if you need to connect it to some MySQL server running on
another host. The syntax of this environment varaible is host:port. Port
is optional and if it is not defined, the MySQL default port is used
(3306). If it is not defined at all, a connection to the localhost is
made. This controlled access system uses the Tango database to retrieve
user rights and it is not possible to run it in a Tango control system
running without database.</p>
</div>
</div>
<div class="section" id="the-notifd2db-utility">
<h1><a class="toc-backref" href="#id412">The notifd2db utility</a></h1>
<div class="section" id="the-notifd2db-utility-usage-for-tango-releases-lower-than-8">
<h2><a class="toc-backref" href="#id413">The notifd2db utility usage (For Tango releases lower than 8)</a></h2>
<p>The notifd2db utility is used to pass to Tango the necessary information
for the Tango servers or clients to build connection with the CORBA
notification service. Its usage is:</p>
<p>notifd2db [notifd2db_IOR_file] [host] [-o
Device_server_database_file_name] [-h]</p>
<p>The [notifd2db_IOR_file] parameter is used to specify the file name
used by the notification service to store its main IOR. This parameter
is not mandatoty. Its default value is /tmp/rdfact.ior. The [host]
parameter is ued to specify on which host the notification service
should be exported. The default value is the host on which the command
is run. The [-o Device_server_database_file_name] is used in case of
event and device server started with the file as database (the -file
device server command line option). The file name used here must be the
file name used by the device server in its -file option. The [-h] option
is just to display an help message. Notifd2db utility usage example:</p>
<p>notifd2db</p>
<p>to register notification service on the current host using the default
notifictaion service IOR file name.</p>
<p>notifd C:\Temp\nd.ior</p>
<p>to register a notification service with IOR file named C:\Temp\nd.ior.</p>
<p>notifd -o /var/my_ds_file.res</p>
<p>to register notification service in the /var/my_ds_file.res file used
by a device server started with the device server -file command line
option.</p>
</div>
</div>
<div class="section" id="the-property-file-syntax">
<h1><a class="toc-backref" href="#id414">The property file syntax</a></h1>
<div class="section" id="property-file-usage">
<h2><a class="toc-backref" href="#id415">Property file usage</a></h2>
<p>A property file is a file where you store all the property(ies) related
to device(s) belonging to a specific device server process. In this
file, one can find:</p>
<ul class="simple">
<li>Which device(s) has to be created for each Tango class embedded in
the device server process</li>
<li>Device(s) properties</li>
<li>Device(s) attribute properties</li>
</ul>
<p>This type of file is not required by a Tango control system. These
informations are stored in the Tango database and having them also in a
file could generate some data duplication issues. Nevertheless, in some
cases, it could very very helpful to generate this type of file. These
cases are:</p>
<ol class="arabic simple">
<li>If you want to run a device server process on a host which does not
have access to the Tango control system database. In such a case, the
user can generate the file from the database content and run the
device server process using this file as database (-file option of
device server process)</li>
<li>In case of massive property changes where no tool will be more
adapted than your favorite text editor. In such a case, the user can
generate a file from the database content, change/add/modify file
contents using his favorite tool and then reload file content into
the database.</li>
</ol>
<p>Jive:raw-latex:<cite>cite{Jive doc}</cite> is the tool provided to generate and
load a property file. To generate a device server process properties
file, select your device server process in the Server tab, right click
and select Save Server Data. A file selection window pops up allowing
you to choose your file name and path. To reload a file in the Tango
database, click on File then Load Property File.</p>
</div>
<div class="section" id="property-file-syntax">
<h2><a class="toc-backref" href="#id416">Property file syntax</a></h2>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="error">\</span><span class="name">textbf</span><span class="punctuation">{</span><span class="literal number integer">1</span> <span class="punctuation">}</span><span class="error">#</span><span class="operator">---------------------------------------------------------</span>
<span class="ln"> 2 </span> <span class="comment preproc"># SERVER TimeoutTest/manu, TimeoutTest device declaration
</span><span class="ln"> 3 </span><span class="comment preproc"></span> <span class="comment preproc">#---------------------------------------------------------
</span><span class="ln"> 4 </span><span class="comment preproc"></span>
<span class="ln"> 5 </span> <span class="name">TimeoutTest</span><span class="operator">/</span><span class="name">manu</span><span class="operator">/</span><span class="name">DEVICE</span><span class="operator">/</span><span class="name label">TimeoutTest</span><span class="punctuation">:</span> <span class="literal string">&quot;et/to/01&quot;</span><span class="punctuation">,</span>\
<span class="ln"> 6 </span>                                      <span class="literal string">&quot;et/to/02&quot;</span><span class="punctuation">,</span>\
<span class="ln"> 7 </span>                                      <span class="literal string">&quot;et/to/03&quot;</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>
<span class="ln">10 </span> <span class="comment preproc"># --- et/to/01 properties
</span><span class="ln">11 </span><span class="comment preproc"></span>
<span class="ln">12 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">-&gt;</span><span class="name label">StringProp</span><span class="punctuation">:</span> <span class="name">Property</span>
<span class="ln">13 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">-&gt;</span><span class="name label">ArrayProp</span><span class="punctuation">:</span> <span class="literal number integer">1</span><span class="punctuation">,</span>\
<span class="ln">14 </span>                      <span class="literal number integer">2</span><span class="punctuation">,</span>\
<span class="ln">15 </span>                      <span class="literal number integer">3</span>
<span class="ln">16 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">-&gt;</span><span class="name label">attr_min_poll_period</span><span class="punctuation">:</span> <span class="name">TheAttr</span><span class="punctuation">,</span>\
<span class="ln">17 </span>                                 <span class="literal number integer">1000</span>
<span class="ln">18 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">-&gt;</span><span class="name label">AnotherStringProp</span><span class="punctuation">:</span> <span class="literal string">&quot;A long string&quot;</span>
<span class="ln">19 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">-&gt;</span><span class="name label">ArrayStringProp</span><span class="punctuation">:</span> <span class="literal string">&quot;the first prop&quot;</span><span class="punctuation">,</span>\
<span class="ln">20 </span>                            <span class="literal string">&quot;the second prop&quot;</span>
<span class="ln">21 </span>
<span class="ln">22 </span> <span class="comment preproc"># --- et/to/01 attribute properties
</span><span class="ln">23 </span><span class="comment preproc"></span>
<span class="ln">24 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TheAttr</span><span class="operator">-&gt;</span><span class="name label">display_unit</span><span class="punctuation">:</span> <span class="literal number float">1.0</span>
<span class="ln">25 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TheAttr</span><span class="operator">-&gt;</span><span class="name label">event_period</span><span class="punctuation">:</span> <span class="literal number integer">1000</span>
<span class="ln">26 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TheAttr</span><span class="operator">-&gt;</span><span class="name label">format</span><span class="punctuation">:</span> <span class="operator">%</span><span class="literal number integer">4</span><span class="name">d</span>
<span class="ln">27 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TheAttr</span><span class="operator">-&gt;</span><span class="name label">min_alarm</span><span class="punctuation">:</span> <span class="operator">-</span><span class="literal number float">2.0</span>
<span class="ln">28 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TheAttr</span><span class="operator">-&gt;</span><span class="name label">min_value</span><span class="punctuation">:</span> <span class="operator">-</span><span class="literal number float">5.0</span>
<span class="ln">29 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TheAttr</span><span class="operator">-&gt;</span><span class="name label">standard_unit</span><span class="punctuation">:</span> <span class="literal number float">1.0</span>
<span class="ln">30 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TheAttr</span><span class="operator">-&gt;</span><span class="name label">__value</span><span class="punctuation">:</span> <span class="literal number integer">111</span>
<span class="ln">31 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">BooAttr</span><span class="operator">-&gt;</span><span class="name label">event_period</span><span class="punctuation">:</span> <span class="literal number integer">1000</span><span class="name">doc_url</span>
<span class="ln">32 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TestAttr</span><span class="operator">-&gt;</span><span class="name label">display_unit</span><span class="punctuation">:</span> <span class="literal number float">1.0</span>
<span class="ln">33 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TestAttr</span><span class="operator">-&gt;</span><span class="name label">event_period</span><span class="punctuation">:</span> <span class="literal number integer">1000</span>
<span class="ln">34 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TestAttr</span><span class="operator">-&gt;</span><span class="name label">format</span><span class="punctuation">:</span> <span class="operator">%</span><span class="literal number integer">4</span><span class="name">d</span>
<span class="ln">35 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">TestAttr</span><span class="operator">-&gt;</span><span class="name label">standard_unit</span><span class="punctuation">:</span> <span class="literal number float">1.0</span>
<span class="ln">36 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">DbAttr</span><span class="operator">-&gt;</span><span class="name label">abs_change</span><span class="punctuation">:</span> <span class="literal number float">1.1</span>
<span class="ln">37 </span> <span class="name">et</span><span class="operator">/</span><span class="name">to</span><span class="operator">/</span><span class="literal number oct">01</span><span class="operator">/</span><span class="name">DbAttr</span><span class="operator">-&gt;</span><span class="name label">event_period</span><span class="punctuation">:</span> <span class="literal number integer">1000</span>
<span class="ln">38 </span>
<span class="ln">39 </span> <span class="name">CLASS</span><span class="operator">/</span><span class="name">TimeoutTest</span><span class="operator">-&gt;</span><span class="name label">InheritedFrom</span><span class="punctuation">:</span>   <span class="name">Device_4Impl</span>
<span class="ln">40 </span> <span class="name">CLASS</span><span class="operator">/</span><span class="name">TimeoutTest</span><span class="operator">-&gt;</span><span class="name label">doc_url</span><span class="punctuation">:</span>   <span class="literal string">&quot;http://www.esrf.fr/some/path&quot;</span>
</pre>
<p>Line 1 - 3: Comments. Comment starts with the ’#’ character</p>
<p>Line 4: Blank line</p>
<p>Line 5 - 7: Devices definition. DEVICE is the keyword to declare a
device(s) definition sequence. The general syntax is:</p>
<p>&lt;DS name&gt;/&lt;inst name&gt;/DEVICE/&lt;Class name&gt;: dev1,dev2,dev3</p>
<p>Device(s) name can follow on next line if the last line character is
’\’ (see line 5,6). The ’’ characters around device name are generated
by the Jive tool and are not mandatory.</p>
<p>Line 12: Device property definition. The general device property syntax
is</p>
<p>&lt;device name&gt;<strong>-&gt;</strong>&lt;property name&gt;: &lt;property value&gt;</p>
<p>In case of array, the array element delimiter is the character ’,’.
Array definition can be splitted on several lines if the last line
character is ’\’. Allowed characters after the ’:’ delimiter are space,
tabulation or nothing.</p>
<p>Line 13 - 15 and 16 - 17: Device property (array)</p>
<p>Line 18: A device string property with special characters (spaces). The
’’ character is used to delimit the string</p>
<p>Line 24 - 37: Device attribute property definition. The general device
attribute property syntax is</p>
<p>&lt;device name&gt;/&lt;attribute name&gt;<strong>-&gt;</strong>&lt;property name&gt;: &lt;property
value&gt;</p>
<p>Allowed characters after the ’:’ delimiter are space, tabulation or
nothing.</p>
<p>Line 39 - 40: Class property definition. The general class property
syntax is</p>
<p>CLASS/&lt;class name&gt;<strong>-&gt;</strong>&lt;property name&gt;: &lt;property value&gt;</p>
<p>CLASS is the keyword to declare a class property definition. Allowed
characters after the ’:’ delimiter are space, tabulation or nothing. On
line 40, the ’’ characters around the property value are mandatory due
to the ’/’ character contains in the property value.</p>
</div>
</div>
<div class="section" id="list-of-pictures">
<h1><a class="toc-backref" href="#id417">List of pictures</a></h1>
<ul class="simple">
<li>Cover page: From <a class="reference external" href="http://www.juliaetandres.com">http://www.juliaetandres.com</a></li>
<li>: By O. Chevre from <a class="reference external" href="http://www.forteresses.free.fr">http://www.forteresses.free.fr</a></li>
<li>: From <a class="reference external" href="http://www.photo-evasion.com">http://www.photo-evasion.com</a> licence Creative Commons</li>
<li>: By R. STEINMANN ©ECK2000</li>
<li>: By R. STEINMANN ©ECK2000</li>
<li>: By R. STEINMANN ©ECK2000</li>
<li>: By O. Chevre from <a class="reference external" href="http://www.forteresses.free.fr">http://www.forteresses.free.fr</a></li>
<li>: By R. STEINMANN ©ECK2000</li>
</ul>
<p>10 <a class="reference external" href="http://www.omg.org">OMG home page</a></p>
<p>Advanced CORBA programming with C++ by M.Henning and S.Vinosky
(Addison-Wesley 1999)</p>
<p><a class="reference external" href="http://www.tango-controls.org">TANGO home page</a></p>
<p><a class="reference external" href="http://www.cells.es">ALBA home page</a></p>
<p><a class="reference external" href="http://www.synchrotron-soleil.fr">Soleil home page</a></p>
<p><a class="reference external" href="http://www.mysql.com">MySQL home page</a></p>
<p>MySQL and mSQL by Randy Jay Yarger, George Reese and Tim King (O’Reilly
1999)</p>
<p><a class="reference external" href="http://www.tango-controls.org/device-servers">Tango classes on-line
documentation</a></p>
<p>C++ programming language third edition by Stroustrup (Addison-Wesley)</p>
<p>Design Patterns by Erich Gamma, Richard Helm, Ralph Johnson, John
Vlissides (Addison-Wesley 1995)</p>
<p><a class="reference external" href="http://omniorb.sourceforge.net">omniORB home page</a></p>
<p>The Common Object Request Broker: Architecture and Specification
Revision 2.3 available from OMG home page</p>
<p>Java Pro - June 1999 : Plugging memory leak by Tony Leung</p>
<p>CVS WEB page - <a class="reference external" href="http://www.cyclic.com">http://www.cyclic.com</a></p>
<p><a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/tools_doc/pogo_doc/index.html">POGO home
page</a></p>
<p><a class="reference external" href="http://www.jacorb.org">JacORB home page</a></p>
<p><a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/atk_doc/index.html">Tango ATK reference on-line
documentation</a></p>
<p>The Notification Service specification available from OMG home page -
<a class="reference external" href="http://www.omg.org">http://www.omg.org</a></p>
<p><a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/tools_doc/astor_doc/index.html">ASTOR home
page</a></p>
<p><a class="reference external" href="http://www.elettra.trieste.it">Elettra home page</a></p>
<p><a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/tools_doc/jive_doc/index.html">JIVE home
page</a></p>
<p><a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/atk_tutorial/Tutorials.pdf">Tango ATK
Tutorials</a></p>
<p><a class="reference external" href="http://www.zeromq.org">ZMQ home page</a></p>
<p><a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/kernel_doc/cpp_doc/index.html">Tango class development reference
documentation</a></p>
<table class="docutils footnote" frame="void" id="id135" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>TACO stands for <strong>T</strong>elescope and <strong>A</strong>ccelerator
<strong>C</strong>ontrolled with <strong>O</strong>bjects</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id136" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>TANGO stands for <strong>TA</strong>co <strong>N</strong>ext <strong>G</strong>eneration <strong>O</strong>bject</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id137" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>CORBA stands for <strong>C</strong>ommon <strong>O</strong>bject <strong>R</strong>equest <strong>B</strong>roker
<strong>A</strong>rchitecture</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id138" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>In contrary to the state_handler method of the TACO device server
model which is not specific to each command.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id139" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td>TANGO attributes were known as signals in the TACO device server
model</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id140" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td>Properties were known as resources in the TACO device server model</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id141" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[7]</a></td><td>note: the polling is not synchronized is currently not synchronized
on the hour</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id142" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id15">[8]</a></td><td>The default is_allowed method behavior is to always allows the
command</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id143" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id19">[9]</a></td><td>URL stands for <strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id144" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id38">[10]</a></td><td>The StepperMotor class inherits from the DeviceImpl class and
therefore is a DeviceImpl</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id145" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id54">[11]</a></td><td>The StepperMotorClass inherits from the DeviceClass and therefore is
a DeviceClass</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id146" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id55">[12]</a></td><td>It can also be data declared as object data members or memory
declared as static</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id147" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id63">[13]</a></td><td>Their black-box is also destroyed and re-built</td></tr>
</tbody>
</table>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15622)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15623)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15624)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15627)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15628)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15629)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15630)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15631)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15632)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15633)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15634)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15635)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15636)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15637)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15639)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15641)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15642)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15643)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15644)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15645)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">tango.rst</tt>, line 15646)</p>
Duplicate substitution definition name: &quot;image&quot;.</div>
</div>
</div>
</body>
</html>
